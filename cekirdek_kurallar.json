{
  "__backups": {
    "rolling": []
  },
  "__manifest": {
    "features": {
      "auto_backup": true,
      "drift_alarm": true,
      "immutable_core": true
    },
    "policy_version": 1
  },
  "__policy__": {
    "artifact_versioning": "timestamped",
    "deterministic_seed": 1337,
    "forbid_field_overwrite": true,
    "forbid_silent_drop": true,
    "no_merge_by_default": true,
    "require_changelog_for_any_edit": true,
    "timezone": "Europe/Istanbul"
  },
  "__rules__": {
    "default_no_skip": true,
    "default_requires_policy": "hard",
    "no_step_skip": true,
    "result_only_mode_mandatory": true,
    "stop_on_preprocessing_error": true,
    "strict_order": true
  },
  "_admin": {
    "unlock_request": {
      "approved_at": "2025-09-09T18:09:16.385761Z",
      "rationale": "SEO rules, Ads optimization and A/B testing revamp per references (Etsy Ads, Alura metrics, SEO guide).",
      "requested_steps": [
        "10",
        "11",
        "14",
        "15"
      ],
      "status": "approved"
    }
  },
  "_bootstrap": {
    "on_load": {
      "banner_text": "Welcome back 👋\n- Required user checkpoints: Step 0 (Product Info), Media Upload, CSV uploads (3/4/6), Record Type decision (16).\n- CSV schemas are defined under /_policy/csv_ingest/* (strict headers).\n- Current mode: preview (learning mode). Export (Step 17) is ENABLED.\n- Resume point → last: 16, next: 18. Use checkpoints at 16 & 18 to review/fix.\n",
      "session_banner": true
    },
    "flags": {
      "step17_enabled": true
    }
  },
  "_commands": {
    "allowed": [
      "ONAY",
      "DÜZELT",
      "YÜKLE",
      "DEVAM",
      "DUR"
    ],
    "descriptions": {
      "DEVAM": "Bekleyen adımı çalıştırır, sonraki durakta durur.",
      "DUR": "Koşuyu güvenli biçimde durdurur (durum raporu verilir).",
      "DÜZELT": "Gösterilen metni/detayı belirtilen şekilde düzeltir (run-time, JSON'a yazılmaz).",
      "ONAY": "Gösterilen adımı bu haliyle onaylar ve bir sonrakine geçer.",
      "YÜKLE": "İstenen dosyayı yükler (görseller/CSV vb., run-time)."
    }
  },
  "_csv_rules": {
    "competitor_csv": {
      "headers": [
        "Title",
        "Monthly sales",
        "Sales",
        "Monthly revenue",
        "Revenue",
        "LQS",
        "Price",
        "Category",
        "Shop",
        "BSR Category (%)",
        "BSR Category",
        "Conversion rate",
        "Creator",
        "Product creation era",
        "Views",
        "Video",
        "URL",
        "Tag count",
        "Tags",
        "Review rate",
        "Reviews",
        "Review score",
        "Production partners",
        "Processing time",
        "Min processing time",
        "Max processing time",
        "Personalization required",
        "Creation date",
        "Favorites",
        "Listing type",
        "Listing age (days)",
        "Vintage",
        "Supply item",
        "Personalizable",
        "Image count",
        "Free US shipping"
      ],
      "preprocess": {
        "dedupe_on": [
          "URL"
        ],
        "delimiter_probe": [
          ",",
          ";",
          "\t",
          "|"
        ],
        "drop_extras": false,
        "encoding": [
          "utf-8",
          "utf-8-sig",
          "latin-1"
        ],
        "header_canonical": true,
        "outputs": {
          "clean": "/runtime/csv/competitor_clean.csv",
          "corrected": "/runtime/csv/competitor_corrected.csv",
          "log": "/runtime/reports/competitor_prepare"
        },
        "semantic_soft_repair": {
          "Shop": {
            "must_contain_alpha": true
          },
          "Title": {
            "must_contain_alpha": true
          },
          "URL": {
            "must_contain_http": true
          }
        }
      },
      "required": [
        "Title",
        "URL",
        "Shop"
      ],
      "expected_headers_strict": false,
      "preprocess_overrides": {
        "Keyword": {
          "forbid_all_numeric": false
        }
      }
    },
    "popular_listings": {
      "headers": [
        "Title",
        "Revenue",
        "LQS",
        "Price",
        "Category",
        "Shop",
        "Sales",
        "Monthly sales",
        "Creator",
        "Product creation era",
        "Views",
        "Video",
        "URL",
        "Tag count",
        "Tags",
        "Review rate",
        "Reviews",
        "Review score",
        "Production partners",
        "Processing time",
        "Min processing time",
        "Max processing time",
        "Favorites",
        "Listing age (days)",
        "Personalization required",
        "Creation date",
        "Listing type",
        "Vintage",
        "Supply item",
        "Personalizable",
        "Image count",
        "Free US shipping",
        "Conversion rate",
        "BSR Category",
        "BSR Category (%)",
        "Monthly revenue"
      ],
      "preprocess": {
        "dedupe_on": [
          "URL"
        ],
        "delimiter_probe": [
          ",",
          ";",
          "\t",
          "|"
        ],
        "drop_extras": false,
        "encoding": [
          "utf-8",
          "utf-8-sig",
          "latin-1"
        ],
        "header_canonical": true,
        "outputs": {
          "clean": "/runtime/csv/top_listings_dar_clean.csv",
          "corrected": "/runtime/csv/top_listings_dar_corrected.csv",
          "log": "/runtime/reports/top_listings_prepare"
        },
        "semantic_soft_repair": {
          "Title": {
            "must_contain_alpha": true
          },
          "URL": {
            "must_contain_http": true
          }
        }
      },
      "required": [
        "Title",
        "URL",
        "Shop"
      ],
      "expected_headers_strict": false,
      "preprocess_overrides": {
        "Keyword": {
          "forbid_all_numeric": false
        }
      }
    },
    "similar_keywords": {
      "headers": [
        "Keyword",
        "Search volume",
        "3mo. change",
        "Competition",
        "Sales",
        "Score",
        "Trend status",
        "Search to competition ratio",
        "Google top of page bid (low range)",
        "Long-tail keyword",
        "Listing age",
        "Length",
        "Google top of page bid (high range)",
        "Google CPC",
        "Google competition level",
        "Google competition index",
        "Etsy tag",
        "Conversion rate",
        "Competition level",
        "Sales per listing",
        "Annual search trend"
      ],
      "preprocess": {
        "dedupe_on": [
          "Keyword"
        ],
        "delimiter_probe": [
          ",",
          ";",
          "\t",
          "|"
        ],
        "drop_extras": false,
        "encoding": [
          "utf-8",
          "utf-8-sig",
          "latin-1"
        ],
        "header_canonical": true,
        "outputs": {
          "clean": "/runtime/csv/similar_keywords_clean.csv",
          "corrected": "/runtime/csv/similar_keywords_corrected_merged.csv",
          "log": "/runtime/reports/similar_prepare"
        },
        "semantic_soft_repair": {
          "3mo. change": {
            "percent_like": true
          },
          "Keyword": {
            "forbid_all_numeric": true,
            "must_contain_alpha": true,
            "repair_from": [
              "Competition level",
              "Etsy tag"
            ]
          },
          "Listing age": {
            "days_like": true
          },
          "Long-tail keyword": {
            "enum_like": [
              "Yes",
              "No"
            ]
          },
          "Search volume": {
            "number_like": true
          }
        }
      },
      "required": [
        "Keyword"
      ],
      "expected_headers_strict": false,
      "preprocess_overrides": {
        "Keyword": {
          "forbid_all_numeric": false
        }
      }
    },
    "top_listings_csv": {
      "examples": {
        "header_line": "Title,Revenue,LQS,Price,Category,Shop,Sales,Monthly sales,Creator,Product creation era,Views,Video,URL,Tag count,Tags,Review rate,Reviews,Review score,Production partners,Processing time,Min processing time,Max processing time,Favorites,Listing age (days),Personalization required,Creation date,Listing type,Vintage,Supply item,Personalizable,Image count,Free US shipping,Conversion rate,BSR Category,BSR Category (%),Monthly revenue",
        "sample_row_line": "Rose gold wedding band Moissanite wedding band Marquise cut Diamond stacking matching Unique Full eternity Ring Vintage Wedding Promise gift,\"$752131\",\"53\",\"$293.00\",\"Jewelry\",\"CoolRingJewelry\",\"2567\",\"34\",\"Shop owner\",\"Made to Order\",\"824029\",\"Yes\",\"https://www.etsy.com/listing/708009353/rose-gold-wedding-band-moissanite\",\"13\",\"Moissanite ring,rose gold ring,Full eternity ring,diamond ring,art deco,wedding band women,vintage ring,stacking ring,Custom Jewelry,Birthstone Jewelry,Personalized Gift,Marquise cut ring,solid gold ring\",\"29.37%\",\"754\",\"4.93\",\"None\",\"14.00 days\",\"14 days\",\"14 days\",\"38681\",\"2300\",\"Yes\",\"21 May, 2019\",\"Physical\",\"No\",\"No\",\"Yes\",\"8\",\"Yes\",\"0.31%\",\"NaN\",\"0.0\",\"$9828\",",
        "notes": "Title virgül içerebilir; doğru ayrım için Title bitişindeki ,\" noktasına kadar tek alan sayılmalıdır."
      }
    },
    "competitor_shops_csv": {
      "examples": {
        "header_line": "Title,Monthly sales,Sales,Monthly revenue,Revenue,LQS,Price,Category,Shop,BSR Category (%),BSR Category,Conversion rate,Creator,Product creation era,Views,Video,URL,Tag count,Tags,Review rate,Reviews,Review score,Production partners,Processing time,Min processing time,Max processing time,Personalization required,Creation date,Favorites,Listing type,Listing age (days),Vintage,Supply item,Personalizable,Image count,Free US shipping",
        "sample_row_line": "Petite Twisted Vine Diamond Wedding Band in Sterling Silver Engagement Ring for Women Dainty Promise Ring- Anniversary Birthday Gift For Her,\"14\",\"626\",\"$1105\",\"$49454\",\"63\",\"$79.00\",\"Jewelry\",\"Aquamarise\",\"0.0\",\"NaN\",\"0.91%\",\"Shop owner\",\"Made to Order\",\"68711\",\"Yes\",\"https://www.etsy.com/listing/1135807985/petite-twisted-vine-diamond-wedding-band\",\"13\",\"Twisted Wedding Band,Anniversary Gift,Gift For Her,Dainty promise ring,STACKABLE RING,Women silver ring,ANNIVERSARY RING,PERSONALIZED JEWELRY,GIFTS FOR HER,PROMISE RING FOR HER,infinity ring,vow renewal ring,silver wedding band\",\"30.83%\",\"193\",\"4.90\",\"None\",\"4.00 days\",\"3 days\",\"5 days\",\"No\",\"07 Ara, 2021\",\"3924\",\"Physical\",\"1342\",\"No\",\"No\",\"Yes\",\"6\",\"Yes\",",
        "notes": "Title alanı tırnaksız olabilir; diğer alanlar çift tırnak içinde gelir. Görünmez leading index varsa satır sayısı +1 olabilir."
      }
    },
    "similar_keywords_csv": {
      "examples": {
        "header_line": "Keyword,Search volume,3mo. change,Competition,Sales,Score,Trend status,Search to competition ratio,Google top of page bid (low range),Long-tail keyword,Listing age,Length,Google top of page bid (high range),Google CPC,Google competition level,Google competition index,Etsy tag,Conversion rate,Competition level,Sales per listing,Annual search trend",
        "sample_row_line": "modern gold band,\"10\",\"0%\",\"24018\",\"962401\",\"37\",\"Stable\",\"0.00\",\"87\",\"Yes\",\"1747 days\",\"16\",\"295\",\"191\",\"High\",\"96\",\"Yes\",\"1.00%\",\"Low\",\"40\",\"0%\",",
        "notes": "İlk alan (Keyword) bazı dosyalarda tırnaksız gelebilir; diğer tüm alanlar çift tırnak içindedir."
      }
    },
    "similar_keywords_v2": {
      "id": "similar_keywords_v2",
      "title": "Similar Keywords (strict, no numeric-only)",
      "parse": {
        "delimiter": ",",
        "quotechar": "\"",
        "doublequote": true,
        "multiline": true,
        "keep_default_na": false,
        "na_filter": false,
        "encoding_candidates": [
          "utf-8",
          "utf-8-sig",
          "cp1254",
          "windows-1254",
          "latin-1"
        ]
      },
      "preprocess": {
        "trim_headers": true,
        "trim_cells": true,
        "normalize_nbsp": true
      },
      "headers": [
        "Keyword",
        "Search volume",
        "3mo. change",
        "Competition",
        "Sales",
        "Score",
        "Trend status",
        "Search to competition ratio",
        "Google top of page bid (low range)",
        "Long-tail keyword",
        "Listing age",
        "Length",
        "Google top of page bid (high range)",
        "Google CPC",
        "Google competition level",
        "Google competition index",
        "Etsy tag",
        "Conversion rate",
        "Competition level",
        "Sales per listing",
        "Annual search trend"
      ],
      "header_aliases": {
        "Keyword": [
          "keyword",
          "query",
          "search_term",
          "search term"
        ],
        "Search volume": [
          "search_volume",
          "search volume",
          "Search Volume"
        ]
      },
      "example_header": [
        "Keyword",
        "Search volume",
        "3mo. change",
        "Competition",
        "Sales",
        "Score",
        "Trend status",
        "Search to competition ratio",
        "Google top of page bid (low range)",
        "Long-tail keyword",
        "Listing age",
        "Length",
        "Google top of page bid (high range)",
        "Google CPC",
        "Google competition level",
        "Google competition index",
        "Etsy tag",
        "Conversion rate",
        "Competition level",
        "Sales per listing",
        "Annual search trend"
      ],
      "example_rows": [
        [
          "modern gold band",
          "10",
          "0%",
          "24018",
          "962401",
          "37",
          "Stable",
          "0.00",
          "87",
          "Yes",
          "1747 days",
          "16",
          "295",
          "191",
          "High",
          "96",
          "Yes",
          "1.00%",
          "Low",
          "40",
          "0%"
        ]
      ],
      "preprocess_overrides": {
        "Keyword": {
          "forbid_all_numeric": true
        }
      },
      "validations": {
        "required_columns_any_of": [
          [
            "Keyword"
          ]
        ],
        "row_length_equals_header": {
          "on_fail": "halt",
          "report_first_n": 50
        },
        "keyword_has_letters_min_ratio": {
          "min_ratio": 0.2,
          "sample_n": 1000,
          "on_fail": "halt",
          "explain": "Harf içeren Keyword oranı çok düşük; veri muhtemelen ID/kod içeriyor."
        }
      },
      "outputs": {
        "frame_name": "similar_keywords_norm_v2",
        "canonical_headers": [
          "Keyword",
          "Search volume",
          "3mo. change",
          "Competition",
          "Sales",
          "Score",
          "Trend status",
          "Search to competition ratio",
          "Google top of page bid (low range)",
          "Long-tail keyword",
          "Listing age",
          "Length",
          "Google top of page bid (high range)",
          "Google CPC",
          "Google competition level",
          "Google competition index",
          "Etsy tag",
          "Conversion rate",
          "Competition level",
          "Sales per listing",
          "Annual search trend"
        ],
        "notes": "Boş alanlar \"\" olarak korunur; dosyada yazılı 'nan' aynen kalır."
      }
    },
    "similar_keywords_strict": {
      "id": "similar_keywords_strict",
      "title": "Similar Keywords (strict)",
      "parse": {
        "delimiter": ",",
        "quotechar": "\"",
        "doublequote": true,
        "multiline": true,
        "keep_default_na": false,
        "na_filter": false,
        "encoding_candidates": [
          "utf-8",
          "utf-8-sig",
          "cp1254",
          "windows-1254",
          "latin-1"
        ]
      },
      "preprocess": {
        "trim_headers": true,
        "trim_cells": true,
        "normalize_nbsp": true
      },
      "headers": [
        "Keyword",
        "Search volume",
        "3mo. change",
        "Competition",
        "Sales",
        "Score",
        "Trend status",
        "Search to competition ratio",
        "Google top of page bid (low range)",
        "Long-tail keyword",
        "Listing age",
        "Length",
        "Google top of page bid (high range)",
        "Google CPC",
        "Google competition level",
        "Google competition index",
        "Etsy tag",
        "Conversion rate",
        "Competition level",
        "Sales per listing",
        "Annual search trend"
      ],
      "header_aliases": {
        "Keyword": [
          "keyword",
          "query",
          "search_term",
          "search term"
        ],
        "Search volume": [
          "search_volume",
          "search volume",
          "Search Volume"
        ]
      },
      "example_header": [
        "Keyword",
        "Search volume",
        "3mo. change",
        "Competition",
        "Sales",
        "Score",
        "Trend status",
        "Search to competition ratio",
        "Google top of page bid (low range)",
        "Long-tail keyword",
        "Listing age",
        "Length",
        "Google top of page bid (high range)",
        "Google CPC",
        "Google competition level",
        "Google competition index",
        "Etsy tag",
        "Conversion rate",
        "Competition level",
        "Sales per listing",
        "Annual search trend"
      ],
      "example_rows": [
        [
          "modern gold band",
          "10",
          "0%",
          "24018",
          "962401",
          "37",
          "Stable",
          "0.00",
          "87",
          "Yes",
          "1747 days",
          "16",
          "295",
          "191",
          "High",
          "96",
          "Yes",
          "1.00%",
          "Low",
          "40",
          "0%"
        ]
      ],
      "validations": {
        "required_columns_any_of": [
          [
            "Keyword"
          ]
        ],
        "row_length_equals_header": {
          "on_fail": "halt",
          "report_first_n": 50
        }
      },
      "outputs": {
        "frame_name": "similar_keywords_norm"
      }
    },
    "top_listings_title_first_v1": {
      "id": "top_listings_title_first_v1",
      "title": "Top Listings (Title-first)",
      "parse": {
        "delimiter": ",",
        "quotechar": "\"",
        "doublequote": true,
        "multiline": true,
        "keep_default_na": false,
        "na_filter": false,
        "encoding_candidates": [
          "utf-8",
          "utf-8-sig",
          "cp1254",
          "windows-1254",
          "latin-1"
        ],
        "title_first": {
          "field": "Title",
          "split_at_first": ",\"",
          "merge_extra_leading_into_title": true,
          "tolerate_already_quoted_title": true
        }
      },
      "preprocess": {
        "trim_headers": true,
        "trim_cells": true,
        "normalize_nbsp": true
      },
      "headers": [
        "Title",
        "Revenue",
        "LQS",
        "Price",
        "Category",
        "Shop",
        "Sales",
        "Monthly sales",
        "Creator",
        "Product creation era",
        "Views",
        "Video",
        "URL",
        "Tag count",
        "Tags",
        "Review rate",
        "Reviews",
        "Review score",
        "Production partners",
        "Processing time",
        "Min processing time",
        "Max processing time",
        "Favorites",
        "Listing age (days)",
        "Personalization required",
        "Creation date",
        "Listing type",
        "Vintage",
        "Supply item",
        "Personalizable",
        "Image count",
        "Free US shipping",
        "Conversion rate",
        "BSR Category",
        "BSR Category (%)",
        "Monthly revenue"
      ],
      "example_rows": [
        [
          "Rose gold wedding band Moissanite wedding band Marquise cut Diamond stacking matching Unique Full eternity Ring Vintage Wedding Promise gift",
          "$752131",
          "53",
          "$293.00",
          "Jewelry",
          "CoolRingJewelry",
          "2567",
          "34",
          "Shop owner",
          "Made to Order",
          "824029",
          "Yes",
          "https://www.etsy.com/listing/708009353/rose-gold-wedding-band-moissanite",
          "13",
          "Moissanite ring,rose gold ring,Full eternity ring,diamond ring,art deco,wedding band women,vintage ring,stacking ring,Custom Jewelry,Birthstone Jewelry,Personalized Gift,Marquise cut ring,solid gold ring",
          "29.37%",
          "754",
          "4.93",
          "None",
          "14.00 days",
          "14 days",
          "14 days",
          "38681",
          "2300",
          "Yes",
          "21 May, 2019",
          "Physical",
          "No",
          "No",
          "Yes",
          "8",
          "Yes",
          "0.31%",
          "NaN",
          "0.0",
          "$9828"
        ]
      ],
      "validations": {
        "required_columns_any_of": [
          [
            "Title"
          ]
        ],
        "row_length_equals_header": {
          "on_fail": "halt",
          "report_first_n": 50
        }
      },
      "outputs": {
        "frame_name": "top_listings_norm"
      }
    },
    "listings_title_first_v1": {
      "id": "listings_title_first_v1",
      "title": "Listings (Title-first)",
      "parse": {
        "delimiter": ",",
        "quotechar": "\"",
        "doublequote": true,
        "multiline": true,
        "keep_default_na": false,
        "na_filter": false,
        "encoding_candidates": [
          "utf-8",
          "utf-8-sig",
          "cp1254",
          "windows-1254",
          "latin-1"
        ],
        "title_first": {
          "field": "Title",
          "split_at_first": ",\"",
          "merge_extra_leading_into_title": true,
          "tolerate_already_quoted_title": true
        }
      },
      "preprocess": {
        "trim_headers": true,
        "trim_cells": true,
        "normalize_nbsp": true
      },
      "headers": [
        "Title",
        "Monthly sales",
        "Sales",
        "Monthly revenue",
        "Revenue",
        "LQS",
        "Price",
        "Category",
        "Shop",
        "BSR Category (%)",
        "BSR Category",
        "Conversion rate",
        "Creator",
        "Product creation era",
        "Views",
        "Video",
        "URL",
        "Tag count",
        "Tags",
        "Review rate",
        "Reviews",
        "Review score",
        "Production partners",
        "Processing time",
        "Min processing time",
        "Max processing time",
        "Personalization required",
        "Creation date",
        "Favorites",
        "Listing type",
        "Listing age (days)",
        "Vintage",
        "Supply item",
        "Personalizable",
        "Image count",
        "Free US shipping"
      ],
      "example_rows": [
        [
          "Petite Twisted Vine Diamond Wedding Band in Sterling Silver Engagement Ring for Women Dainty Promise Ring- Anniversary Birthday Gift For Her",
          "14",
          "626",
          "$1105",
          "$49454",
          "63",
          "$79.00",
          "Jewelry",
          "Aquamarise",
          "0.0",
          "NaN",
          "0.91%",
          "Shop owner",
          "Made to Order",
          "68711",
          "Yes",
          "https://www.etsy.com/listing/1135807985/petite-twisted-vine-diamond-wedding-band",
          "13",
          "Twisted Wedding Band,Anniversary Gift,Gift For Her,Dainty promise ring,STACKABLE RING,Women silver ring,ANNIVERSARY RING,PERSONALIZED JEWELRY,GIFTS FOR HER,PROMISE RING FOR HER,infinity ring,vow renewal ring,silver wedding band",
          "30.83%",
          "193",
          "4.90",
          "None",
          "4.00 days",
          "3 days",
          "5 days",
          "No",
          "07 Ara, 2021",
          "3924",
          "Physical",
          "1342",
          "No",
          "No",
          "Yes",
          "6",
          "Yes"
        ]
      ],
      "validations": {
        "required_columns_any_of": [
          [
            "Title"
          ]
        ],
        "row_length_equals_header": {
          "on_fail": "halt",
          "report_first_n": 50
        }
      },
      "outputs": {
        "frame_name": "listings_norm"
      }
    }
  },
  "_export_contract": {
    "columns": [
      "record_id",
      "op_type",
      "is_deleted",
      "product.title",
      "product.description",
      "product.tags",
      "pricing.price_value",
      "pricing.price_currency",
      "image_1",
      "image_2",
      "image_3",
      "image_4",
      "image_5"
    ],
    "fail_on_missing": true,
    "format": "csv"
  },
  "_final_safety": {
    "created_at": "2025-09-08 08:06:53",
    "diff_journal": {
      "enabled": true,
      "pattern": "PATCH_%Y%m%d_%H%M%S.diff.json"
    },
    "runtime_persistence": {
      "recovery_file": "RECOVERY.txt",
      "run_state_file": "RUN_STATE.json"
    },
    "schema_validation": {
      "enabled": true,
      "fail_on_invalid": true,
      "schema_ref": "internal://schemas/finalset.schema.json"
    },
    "sha256_lock": "c0a4472f9bc8f0f6cfd2c399924a41759bdae7caf000d5f248df73761237eb52",
    "source_of_truth": "FINALSET__RESULT_ONLY__20250907_161225__CLEANED.json",
    "versioning": {
      "enabled": true,
      "pattern": "FINALSET__%Y%m%d_%H%M__v{N}__{sha12}.json"
    },
    "write_mode": {
      "require_user_approval": true,
      "type": "copy_only"
    }
  },
  "_help": {
    "admin": {
      "restore_flow": [
        "Önce /_policy/audit/steps_snapshots listesinden snapshot id seç.",
        "Talimat ver: 'restore steps from <snapshot_id>' — ben steps + manifest'i o fotoğrafa geri alırım.",
        "Geri alma da audit'e işlenir."
      ],
      "unlock_flow": [
        "JSON'a şu alanı doldur: /_admin/unlock_request = {status:'request', requested_steps:['<id>','...'], rationale:'neden'}",
        "Ben onaylayınca ilgili /workflow_patches/steps_locks/<id>/locked=false yapılır.",
        "Düzenleme bittiğinde yeniden lock=true yapılır."
      ]
    },
    "assets": {
      "visual_examples": {
        "checklist": [
          "Min 5 görsel (studio,lifestyle,scale,detail,packaging)",
          "BOM yok; EXIF zorunlu değil; çözünürlük ≥ 1500px",
          "Aşırı watermark yok; yanıltıcı taş bilgisi yok"
        ],
        "file_naming": {
          "examples": [
            "ring_studio_front_01.jpg",
            "ring_lifestyle_hand_01.jpg",
            "ring_scale_ringsizer_01.jpg",
            "ring_detail_edge_01.jpg",
            "ring_packaging_box_01.jpg"
          ],
          "pattern": "ring_<type>_<view>_<index>.jpg"
        },
        "guides": {
          "detail": [
            "Yüzey dokusu (hammered/polish) yakın plan",
            "Kenarlarda comfort-fit formu görünmeli",
            "Lehim/ek yerleri temizliği kontrol"
          ],
          "lifestyle": [
            "Elde/parmakta kullanım; ölçü algısı",
            "Günlük ışık; aşırı filtre yok",
            "Takı kombinasyonu (stacking) gösterimi"
          ],
          "packaging": [
            "Özel kutu + hediye notu opsiyonu kadrajda",
            "Kargo paket bütünlüğü (yastıklama)",
            "Markasız/markalı görünüm tercihi net"
          ],
          "scale": [
            "Cetvel/halka ölçer ile mm/mm gösterimi",
            "US size kartı ile boyut referansı",
            "Genişlik ve kalınlık notu (metin katmanı)"
          ],
          "studio": [
            "Düz arka plan (tercihen açık, gölge yumuşak)",
            "Ön-arka-yan açı; parlama kontrolü",
            "Yüksek çözünürlük, net odak (ring/band yüzeyi)"
          ]
        },
        "required_types": [
          "studio",
          "lifestyle",
          "scale",
          "detail",
          "packaging"
        ]
      }
    },
    "authoring": {
      "how_to_add": [
        "workshop.bulk_add.pending_names listesine isimleri ekle.",
        "Her isim için kind (registry/step_kinds) seç.",
        "status='ready' yap ve promote et (promotion.strategy=manual_confirm)."
      ],
      "how_to_promote": [
        "Promote onayı ile backlog → steps kopyalanır.",
        "enabled=false gelir; manifest'e ekleme opsiyoneldir.",
        "manifest'e eklersen yürütme sırasına girer."
      ],
      "safety": [
        "Learning/preview modunda export yine kapalı.",
        "digest_only=true; publish akışı etkilenmez."
      ]
    },
    "steps": {
      "0": {
        "checks": [
          "Eksik/kritik alan yok"
        ],
        "inputs": [
          "/product_record",
          "/shop_profile"
        ],
        "outputs": [
          "Kanıtlanmış ürün/mağaza profili"
        ],
        "what_gpt_does": "Kayıtları okur, akış boyunca referans alır.",
        "what_user_does": "Ürün/mağaza bilgilerini doğrula (read-only)."
      },
      "16": {
        "checks": [
          "All constraints pass; media çeşitliliği uyarı olabilir"
        ],
        "inputs": [
          "title/desc/tags + shop profile"
        ],
        "outputs": [
          "listing.assembled (digest)"
        ],
        "what_gpt_does": "Final assembly/prep; soft uyumsuzlukta uyarı.",
        "what_user_does": "Record Type seç → publish/draft/preview."
      },
      "17": {
        "checks": [
          "Learning mode’da guard ile kapalı"
        ],
        "inputs": [
          "record_type=publish"
        ],
        "outputs": [
          "CSV/XLSX/JSON"
        ],
        "what_gpt_does": "Export (publish gerekli).",
        "what_user_does": "—"
      },
      "18": {
        "checks": [
          "checkpoint 18: fix-or-continue"
        ],
        "inputs": [
          "assembled listing"
        ],
        "outputs": [
          "pre-publish report"
        ],
        "what_gpt_does": "Publish öncesi kontrolleri çalıştırır.",
        "what_user_does": "Gerekirse düzeltmeleri onayla."
      },
      "1a": {
        "checks": [
          "Min 5 tür görsel; BOM yok, okunabilir"
        ],
        "inputs": [
          "images/*"
        ],
        "outputs": [
          "media.manifest"
        ],
        "what_gpt_does": "Görsel QC uygular (arka plan).",
        "what_user_does": "Görselleri yükle."
      },
      "3": {
        "checks": [
          "Header birebir; EOL LF/CRLF OK; BOM yok"
        ],
        "inputs": [
          "/_policy/csv_ingest/similar_keywords"
        ],
        "outputs": [
          "keywords.pool.ranked[]"
        ],
        "what_gpt_does": "Normalize + dedupe (Keyword).",
        "what_user_does": "Similar Keywords CSV’yi yükle (strict header)."
      },
      "4": {
        "checks": [
          "Money/% alan dönüşümü; header birebir"
        ],
        "inputs": [
          "/_policy/csv_ingest/top_listings"
        ],
        "outputs": [
          "toplistings.normalized"
        ],
        "what_gpt_does": "Normalize + dedupe (URL→Title fallback).",
        "what_user_does": "Top Listings CSV’yi yükle."
      },
      "6": {
        "checks": [
          "Shop numeric değil; header strict"
        ],
        "inputs": [
          "/_policy/csv_ingest/competitor_listings"
        ],
        "outputs": [
          "competitors.normalized"
        ],
        "what_gpt_does": "Normalize + filtre ring/band; dedupe URL.",
        "what_user_does": "Competitor Listings CSV’yi yükle."
      }
    }
  },
  "_meta": {
    "base_sha256": "11fa43142bcc5144f588686999903744a5e83a03bc0e7c6f1169ce598a1f32f2",
    "changelog": [
      {
        "by": "gpt_prod_executor_v1",
        "id": "chg-20250909-175247",
        "summary": "Add help visual examples, artifacts tech drawings, step defaults, dynamic substeps, and templates for portability.",
        "ts": "2025-09-09T17:52:47.321647Z"
      },
      {
        "by": "gpt",
        "id": "chg-export-fallback-rawlink-manualupload",
        "summary": "Add export fallback policy: prefer raw_link; fallback to manual_upload on tool failure.",
        "ts": "2025-09-12T00:00:00Z"
      },
      {
        "by": "gpt",
        "id": "chg-20250912-auto-version-hash-log",
        "summary": "Enable auto-versioning (visible.v{N}.json), hash policy (export.sha256 capture), and export log entries.",
        "ts": "2025-09-12T21:29:45+0300"
      }
    ],
    "dependency_model": {
      "baseline_applied_at": "2025-09-08T21:19:13.860814Z",
      "hardened_at": "2025-09-08T21:13:49.469030Z"
    },
    "final_version": "v7-relaxed",
    "first_message_template": "Final JSON’u yükledim, doğrula. Beklenen: name=FINALLOCK__WITH_TRIGGER__PATCHED_v7_relaxed.json. Doğrulanmadan hiçbir adımı çalıştırma. Sadece DIGEST/HALT.",
    "fixed_at": "2025-09-05T16:14:42.167036Z",
    "fixed_by": "gpt",
    "last_patched_at": "2025-09-08T12:30:20.345771",
    "note": "Relaxed handshake: only filename is checked to avoid hash/size mismatch due to downloads.",
    "patch_notes": "Added CSV prep profiles (3 types), common rules, examples, strict workflow enforcement, UI policy, and error handling. | Added Step0.product_info (logistics + fixed_product) and confirmation gates.",
    "patched_by": "ChatGPT",
    "schema_version": "8.3-portable-selfdoc-autoresume",
    "self_guard_added_at": "2025-09-05T16:49:46.930583Z",
    "taahhut": {
      "cevaplama": "JSON path göstereceğim (ör. /workflow_patches/governance/step_manifest/20).",
      "fail": "Yüklenmezse veya hash tutmazsa: HALT (nedenini tek satırda yazıp dururum).",
      "ilk_is": "Yeni oturumda 'Final JSON’u yükleyin' diyeceğim.",
      "oturum": "Oturum kapanınca asla varsaymam; tekrar JSON isterim.",
      "success": "Yüklenirse: sadece DIGEST/HALT; tablo/Excel yok; öneri/sertleştirme yok."
    },
    "version": "v8_relaxed",
    "export_log": [
      {
        "event": "policy_upgrade",
        "version": 5,
        "filename": "visible.v5.json",
        "ts": "2025-09-12T21:29:45+0300",
        "export_sha256": null,
        "notes": "Enable auto-versioning, hash policy, and export log."
      }
    ],
    "repacked_at_utc": "2025-09-19T18:50:10Z",
    "repack_note": "PIPELINE_ENRICHED reapply (no schema changes).",
    "source_file": "final_json__EXEC_ORDER_FIXED__20250919-184039__.json",
    "fully_linked_built_at_utc": "2025-09-19T19:04:21Z",
    "fully_linked_note": "Tek dosyalık tam sürüm: execution_order + canonical_order + run_order pointers eklendi (0 veri kaybı).",
    "fully_linked_source_file": "final_json__PIPELINE_ENRICHED__REPACK__1758307810.json",
    "backups": {
      "rolling": {
        "daily": 7,
        "weekly": 4,
        "monthly": 12
      },
      "offsite": {
        "enabled": true,
        "provider": "s3",
        "bucket": "acme/json-backups"
      }
    },
    "versioning": {
      "etag_strategy": "sha256-of-final",
      "require_etag_match_on_write": true
    },
    "ops": {
      "restore_drill": {
        "frequency": "quarterly",
        "last_run": null
      }
    },
    "bridges_info": {
      "purpose": "Non-destructive runtime read-bridges to feed orchestrator without editing step/policy.",
      "version": 1,
      "notes": [
        "All bridges are __REF__ to existing runtime values.",
        "No step/policy keys were modified."
      ]
    },
    "calendar_switch_info": {
      "purpose": "Auto-activates seasonal weights by current date using _runtime/seasonal.windows.",
      "mode": "single_best",
      "timezone": "UTC",
      "notes": [
        "Pure add-only bridge. No step/policy edits.",
        "If overlapping windows, 'priority' order decides."
      ]
    },
    "tags_pipeline_info": {
      "purpose": "Union Top/Competitor/Similar → normalize → score → select 13 tags aligned with title & description.",
      "non_destructive": true,
      "notes": [
        "No writes to /workflow_patches; orchestrator reads via /_runtime/bridges/bind_points.",
        "Stopwords/punctuation stripped, en-US casing normalized.",
        "Requires min 1 exact phrase overlap with title; semantic similarity with description >= 0.70."
      ]
    },
    "best_practices_info": {
      "source_notes": [
        "Etsy search: use 13 multi-word tags; title+tags+attributes+description work together.",
        "Etsy images: >=2000px, first photo >=635px, alt text up to 250 chars.",
        "Google helpful content: people-first, avoid keyword stuffing.",
        "Video helps discovery; show usage context."
      ],
      "non_destructive": true,
      "version": 1
    },
    "reports_info": {
      "purpose": "Append-only, per-step runtime reports (counters + log). Orchestrator writes entries; no destructive edits.",
      "sinks": [
        "visual_qc",
        "shipping_guard",
        "tags_hard_gates",
        "title_guidelines",
        "description_people_first",
        "tags_selection",
        "remote_cache"
      ],
      "retention": "max_entries_per_sink=200 (rotate=true)"
    },
    "schemas": {
      "runtime_reports": {
        "$id": "urn:mcinar:listing-workflow:runtime_reports.schema.json",
        "draft": "2020-12",
        "file": "runtime_reports.schema.json",
        "path": "/_runtime/reports/*",
        "notes": "Add-only JSON Schema for runtime report entries; external file referenced here."
      },
      "tags_pipeline": {
        "$id": "urn:mcinar:listing-workflow:tags_pipeline.schema.json",
        "draft": "2020-12",
        "file": "tags_pipeline.schema.json",
        "path": "/_runtime/tags_pipeline",
        "notes": "Schema for tags pipeline configuration (add-only)."
      },
      "media_qc_strict": {
        "$id": "urn:mcinar:listing-workflow:media_qc_strict.schema.json",
        "draft": "2020-12",
        "file": "media_qc_strict.schema.json",
        "path": "/_runtime/policy_overrides/media/strict_qc",
        "notes": "Schema for strict QC of images/alt-text/video (add-only)."
      },
      "compliance_denylist_seeds": {
        "$id": "urn:mcinar:listing-workflow:compliance_denylist_seeds.schema.json",
        "draft": "2020-12",
        "file": "compliance_denylist_seeds.schema.json",
        "path": "/_runtime/compliance/denylist_seeds",
        "notes": "Schema for denylist seeds (add-only)."
      },
      "remote_cache_report": {
        "$id": "urn:mcinar:listing-workflow:remote_cache_report.schema.json",
        "draft": "2020-12",
        "file": "remote_cache_report.schema.json",
        "path": "/_runtime/reports/remote_cache/log/*",
        "notes": "Schema for remote cache report log entries (add-only)."
      },
      "visual_qc_report": {
        "$id": "urn:mcinar:listing-workflow:visual_qc_report.schema.json",
        "draft": "2020-12",
        "file": "visual_qc_report.schema.json",
        "path": "/_runtime/reports/visual_qc/log/*",
        "notes": "Schema for visual_qc report log entries (add-only)."
      },
      "title_guidelines_report": {
        "$id": "urn:mcinar:listing-workflow:title_guidelines_report.schema.json",
        "draft": "2020-12",
        "file": "title_guidelines_report.schema.json",
        "path": "/_runtime/reports/title_guidelines/log/*",
        "notes": "Schema for title_guidelines report log entries (add-only)."
      },
      "description_people_first_report": {
        "$id": "urn:mcinar:listing-workflow:description_people_first_report.schema.json",
        "draft": "2020-12",
        "file": "description_people_first_report.schema.json",
        "path": "/_runtime/reports/description_people_first/log/*",
        "notes": "Schema for description_people_first report log entries (add-only)."
      },
      "shipping_guard_report": {
        "$id": "urn:mcinar:listing-workflow:shipping_guard_report.schema.json",
        "draft": "2020-12",
        "file": "shipping_guard_report.schema.json",
        "path": "/_runtime/reports/shipping_guard/log/*",
        "notes": "Schema for shipping_guard report log entries (add-only)."
      },
      "tags_hard_gates_report": {
        "$id": "urn:mcinar:listing-workflow:tags_hard_gates_report.schema.json",
        "draft": "2020-12",
        "file": "tags_hard_gates_report.schema.json",
        "path": "/_runtime/reports/tags_hard_gates/log/*",
        "notes": "Schema for tags_hard_gates report log entries (add-only)."
      },
      "tags_selection_report": {
        "$id": "urn:mcinar:listing-workflow:tags_selection_report.schema.json",
        "draft": "2020-12",
        "file": "tags_selection_report.schema.json",
        "path": "/_runtime/reports/tags_selection/log/*",
        "notes": "Schema for tags_selection report log entries (add-only)."
      },
      "preflight_report": {
        "$id": "urn:mcinar:listing-workflow:preflight_report.schema.json",
        "draft": "2020-12",
        "file": "preflight_report.schema.json",
        "path": "/_runtime/reports/preflight/report",
        "notes": "Schema for preflight report object (add-only)."
      },
      "preflight_profile": {
        "$id": "urn:mcinar:listing-workflow:preflight_profile.schema.json",
        "draft": "2020-12",
        "file": "preflight_profile.schema.json",
        "path": "/_runtime/knowledge/preflight_profile",
        "notes": "Schema for preflight knowledge profile (add-only)."
      },
      "visual_qc_report.schema.json": {
        "$schema": "https://json-schema.org/draft/2020-12/schema",
        "type": "object",
        "additionalProperties": true,
        "properties": {
          "image_id": {
            "type": "string"
          },
          "passed": {
            "type": "boolean"
          },
          "reasons": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "score": {
            "type": "number"
          }
        },
        "required": [
          "image_id",
          "passed"
        ]
      },
      "title_guidelines_report.schema.json": {
        "$schema": "https://json-schema.org/draft/2020-12/schema",
        "type": "object",
        "additionalProperties": true,
        "properties": {
          "listing_id": {
            "type": "string"
          },
          "length_ok": {
            "type": "boolean"
          },
          "forbidden_hits": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "readability": {
            "type": "number"
          }
        },
        "required": [
          "listing_id",
          "length_ok"
        ]
      },
      "description_people_first_report.schema.json": {
        "$schema": "https://json-schema.org/draft/2020-12/schema",
        "type": "object",
        "additionalProperties": true,
        "properties": {
          "listing_id": {
            "type": "string"
          },
          "clarity": {
            "type": "number"
          },
          "helpfulness": {
            "type": "number"
          },
          "ddp_disclosure_ok": {
            "type": "boolean"
          }
        },
        "required": [
          "listing_id"
        ]
      },
      "shipping_guard_report.schema.json": {
        "$schema": "https://json-schema.org/draft/2020-12/schema",
        "type": "object",
        "additionalProperties": true,
        "properties": {
          "destination": {
            "type": "string"
          },
          "ddp_enabled": {
            "type": "boolean"
          },
          "tariff_inclusive_pricing": {
            "type": "boolean"
          },
          "message": {
            "type": "string"
          }
        },
        "required": [
          "destination"
        ]
      },
      "tags_hard_gates_report.schema.json": {
        "$schema": "https://json-schema.org/draft/2020-12/schema",
        "type": "object",
        "additionalProperties": true,
        "properties": {
          "listing_id": {
            "type": "string"
          },
          "denylist_hits": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "duplicates": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "count_ok": {
            "type": "boolean"
          }
        },
        "required": [
          "listing_id"
        ]
      }
    },
    "compliance_denylist_info": {
      "seeds_path": "/_runtime/compliance/denylist_seeds",
      "merged_into": "/_runtime/compliance/denylist/patterns",
      "notes": [
        "This is an add-only seed list. Orchestrator may merge seeds into live denylist patterns before scoring/selection.",
        "Ref exposed via /_runtime/bridges/compliance/denylist_seeds_ref for steps 6 and 9."
      ]
    },
    "remote_sources_info": {
      "purpose": "Mirror cache for GitHub Raw JSON to avoid rate-limit/caching hiccups.",
      "policy": "Prefer cache; refresh manually or when TTL expired.",
      "ttl_minutes_default": 120,
      "paths": {
        "source": "/_runtime/remote_sources/sources/github_raw_main",
        "mirror": "/_runtime/remote_sources/mirrors/github_raw_main",
        "bridge_ref": "/_runtime/bridges/remote_cache/github_raw_main_ref"
      },
      "last_added_utc": "2025-09-20T14:36:01Z"
    },
    "ui_review_paths_patch_info": {
      "step_0": {
        "added": [
          "/_product_static/material",
          "/_product_static/olculer"
        ],
        "mode": "union",
        "reason": "Step 0 UI incelemesinde materyal ve ölçüler alanlarının gözden kaçmaması için add-only ek."
      }
    },
    "policy_notes_info": {
      "text_mappings.shipping.tracking_true_phrase": "Takip numarası sağlanır",
      "returns_policy_days": 15
    },
    "templates_info": {
      "description_sections": [
        "shipping_and_returns"
      ],
      "render_hint_default": "markdown",
      "description_sections_extra": [
        "tariff_notice"
      ]
    },
    "policy_overrides_info": {
      "title_generation_forbidden_fields": [
        "returns"
      ],
      "title_generation_forbidden_terms": [
        "iade",
        "iade:",
        "15 gün",
        "return",
        "returns",
        "free returns"
      ]
    },
    "preflight_autorun_info": {
      "step_00": {
        "auto_preflight_on_start": true,
        "stateless_mode": "enabled",
        "memory_guard": "8MB browser budget / 128KB chunks",
        "notes": "00 reads rules & builds knowledge/hints; persists to /_runtime/knowledge for reload-friendly behavior."
      }
    },
    "memory_guard_info": {
      "adaptive": {
        "mode": "adaptive",
        "chunk_bytes_min": 131072,
        "chunk_bytes_max": 524288,
        "chunk_bytes_current_default": 262144,
        "target_browser_utilization_pct": 0.6,
        "notes": "Hard limit yok; geri-basınç + iki geçişli tarama ile stabilite."
      }
    },
    "merge_report_20250920T182527Z": {
      "source_files": {
        "A_path": "/mnt/data/final_json__PIPELINE_ENRICHED__REPACK__1758307810.json",
        "A_sha256": "bb646f4c00dd96fd26cd4a5e7fe3fe642c258901cf99079b4d7f89836e642785",
        "A_bytes": 1475440,
        "B_path": "/mnt/data/final_json__step00_autorun__adaptive_guard__ddp_patch.json",
        "B_sha256": "fa15fd2ec55b485b1d39b7e53e0e580a38300f848f5210d329b94843b4dc6eed",
        "B_bytes": 1170257
      },
      "merge_strategy": "add-only (B into A); no overwrite; conflicts recorded",
      "touched_count": 55,
      "touched_paths_preview": [
        "/_meta/fully_linked_built_at_utc",
        "/_meta/fully_linked_note",
        "/_meta/fully_linked_source_file",
        "/_meta/backups",
        "/_meta/versioning",
        "/_meta/ops",
        "/_meta/bridges_info",
        "/_meta/calendar_switch_info",
        "/_meta/tags_pipeline_info",
        "/_meta/best_practices_info",
        "/_meta/reports_info",
        "/_meta/schemas",
        "/_meta/compliance_denylist_info",
        "/_meta/remote_sources_info",
        "/_meta/ui_review_paths_patch_info",
        "/_meta/policy_notes_info",
        "/_meta/templates_info",
        "/_meta/policy_overrides_info",
        "/_meta/preflight_autorun_info",
        "/_meta/memory_guard_info",
        "/_run_order/source",
        "/_run_order/notes",
        "/_store_profile/returns",
        "/_store_profile/shipping",
        "/context_info/basics/returns",
        "/product_record/shop_logistics/returns",
        "/steps/0/product_info/logistics/returns",
        "/steps/0/summary/returns",
        "/workflow_enforcement/execution_order_all",
        "/workflow_patches/steps/4a/enabled"
      ],
      "conflicts_count": 1,
      "conflicts_preview": [
        {
          "path": "/_run_order/steps",
          "kept_from": "A",
          "kept_value_preview": "{'0': {'auto_continue': True, 'await_user': False, 'requires': [], 'requires_context': True, 'title': 'Product Info (read-only) — Kullanıcı Onayı', 'validators': [{'fn': 'equals', 'left': 'outputs.step0_review_confirmed', 'right': True}, {'id': 'require_verbatim_block', 'message': 'STEP0_REQUIRED: Verbatim Product/Store info must be present and shown before production starts.', 'paths': ['/steps/0",
          "other_from": "B",
          "other_value_preview": "[{'id': '0', 'ref': '/workflow_patches/steps/0', 'name': 'Product Info (read-only) — Kullanıcı Onayı'}, {'id': '00', 'ref': '/workflow_patches/steps/00', 'name': 'Sistem Başlatma / Ön Yük'}, {'id': '0a', 'ref': '/workflow_patches/steps/0a', 'name': 'Ortam Kontrolleri'}, {'id': '1', 'ref': '/workflow_patches/steps/1', 'name': 'Görsel Yükleme'}, {'id': '1a', 'ref': '/workflow_patches/steps/1a', 'nam",
          "note": "add-only: existing value kept; other recorded as conflict"
        }
      ]
    },
    "run_order_views": [
      "steps (index)",
      "steps_list_snapshot (list)"
    ],
    "patch_report_addonly_20250920T190107Z_token_bind_mirror": {
      "paths_added": [
        "/_runtime/logging/token_usage",
        "/_runtime/bridges/bind_points/step_3_upload/preprocess_ref",
        "/_runtime/bridges/bind_points/step_5_upload/preprocess_ref",
        "/_runtime/bridges/bind_points/step_6_upload/preprocess_ref",
        "/_runtime/mirror_cache"
      ],
      "strategy": "add-only; no overwrites; safe defaults"
    },
    "patch_log": [
      {
        "patched_at_utc": "2025-09-20T19:34:47Z",
        "note": "Mirrors duplicated under _run_order/steps/00 without altering _run_order/steps structure (dict).",
        "touched_paths": [
          "/_run_order/steps/00/mirrors/cache  <= COPY of /_runtime/mirror_cache",
          "/_run_order/steps/00/mirrors/sources_ref  -> __REF__: /_runtime/remote_sources"
        ]
      }
    ],
    "notes": [
      {
        "kind": "consistency_patch",
        "what": [
          "enable_5b_in_manifest",
          "sync_run_enabled_from_manifest",
          "fill_missing_names_from_manifest",
          "ensure_execution_order_ref"
        ],
        "source": "assistant",
        "sha_hint_prev": "415dac0192a88735cc358147a0f14f687322e472f2f8719bbecaf87a72e703bc"
      }
    ]
  },
  "_padding": "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ",
  "_policy": {
    "alert_router": {
      "rules": {
        "batch": {
          "message": "5/5 doldu — baseline restore zorunlu.",
          "when": "batch.reach_max"
        },
        "rule_1": {
          "message": "Çöküş algılandı — son snapshot + WAL geri yüklendi.",
          "severity": "error",
          "when": "session.crash_detected"
        },
        "rule_2": {
          "message": "Oturum temiz kapandı — snapshot alındı.",
          "severity": "info",
          "when": "session.clean_close"
        },
        "rule_3": {
          "message": "5/5 doldu — baseline restore zorunlu.",
          "severity": "error",
          "when": "batch.reach_max"
        }
      }
    },
    "answering": {
      "block_on_mismatch_checksum": true,
      "block_on_missing_final_marker": true,
      "require_json_path_citations": true,
      "source_of_truth": "this_file"
    },
    "answering_policy": {
      "block_on_nonfinal_reference": true,
      "refuse_when_no_consent": true,
      "source": "final_json_only"
    },
    "audit": {
      "diff": [
        {
          "backout": "revert to previous_release_id; restore filename/hash triplet",
          "paths_changed": [
            "/_meta/version",
            "/_policy/handshake/expected.filename",
            "/_workflow_patches/guards/session_handshake/min_prefix_len",
            "/_workflow_patches/guards/session_handshake/hash_bytes_mode",
            "/_workflow_patches/guards/session_handshake/required_fields",
            "/_workflow_patches/guards/actor_check/allowed",
            "/_workflow_patches/governance/dry_run",
            "/_workflow_patches/governance/sim_gate",
            "/_workflow_patches/steps/*/output/digest_only",
            "/_policy/csv_ingest/line_endings",
            "/_policy/csv_ingest/bom",
            "/_policy/csv_ingest/expected_headers_strict",
            "/_policy/csv_ingest/shopname_numeric_guard",
            "/_policy/zip_distribution",
            "/_profiles/gpt_prod_executor_v1/handshake_required",
            "/_policy/audit/logging",
            "/_policy/handshake/relaxed_note",
            "/_policy/rollback/one_click",
            "/_policy/audit/releases:+last"
          ],
          "rationale": "version rollover + guard hardening + distribution policy"
        },
        {
          "actor": "gpt_prod_executor_v1",
          "authorized_by": "user:@mcinar1905",
          "paths_changed": [
            "/workflow_patches/steps/18a/enabled",
            "/workflow_patches/steps/18a/notes/lifecycle",
            "/workflow_patches/steps/18a/ui/hidden",
            "/workflow_patches/steps/5b/enabled",
            "/workflow_patches/steps/5b/notes/lifecycle",
            "/workflow_patches/steps/5b/ui/hidden"
          ],
          "rationale": "User chose manifest_disable for steps 5b and 18a: disable + hide steps and ensure they are not referenced in the execution manifest."
        },
        {
          "actor": "gpt_prod_executor_v1",
          "authorized_by": "user:@mcinar1905",
          "paths_changed": [
            "/_policy/handshake/accepted_filenames:+",
            "/_policy/handshake/accepted_globs:+",
            "/_policy/handshake/mode",
            "/_policy/handshake/on_filename_mismatch",
            "/_policy/handshake/preferred_filename",
            "/_policy/handshake/require_actor",
            "/_policy/handshake/session_reminder"
          ],
          "rationale": "Relaxed filename handshake hardened: accept canonical + versioned names; add glob; require actor; keep HALT on mismatch; add reminder."
        },
        {
          "actor": "gpt_prod_executor_v1",
          "authorized_by": "user:@mcinar1905",
          "paths_changed": [
            "/_policy/csv_ingest/common/bom",
            "/_policy/csv_ingest/common/converters/bool_yes_no",
            "/_policy/csv_ingest/common/converters/date_to_iso",
            "/_policy/csv_ingest/common/converters/float_locale_safe",
            "/_policy/csv_ingest/common/converters/int_locale_safe",
            "/_policy/csv_ingest/common/converters/money_to_float",
            "/_policy/csv_ingest/common/converters/percent_to_ratio",
            "/_policy/csv_ingest/common/delimiter_candidates",
            "/_policy/csv_ingest/common/line_endings",
            "/_policy/csv_ingest/common/normalize/trim_whitespace",
            "/_policy/csv_ingest/common/normalize/unicode_nfkc",
            "/_policy/csv_ingest/competitor_listings/bom",
            "/_policy/csv_ingest/competitor_listings/dedupe_key",
            "/_policy/csv_ingest/competitor_listings/expected_headers_strict",
            "/_policy/csv_ingest/competitor_listings/field_types",
            "/_policy/csv_ingest/competitor_listings/line_endings",
            "/_policy/csv_ingest/competitor_listings/negative_terms",
            "/_policy/csv_ingest/competitor_listings/ring_or_band_required",
            "/_policy/csv_ingest/competitor_listings/shop_name_not_numeric",
            "/_policy/csv_ingest/negative_terms:+",
            "/_policy/csv_ingest/similar_keywords/bom",
            "/_policy/csv_ingest/similar_keywords/dedupe_key",
            "/_policy/csv_ingest/similar_keywords/expected_headers",
            "/_policy/csv_ingest/similar_keywords/expected_headers_strict",
            "/_policy/csv_ingest/similar_keywords/filter",
            "/_policy/csv_ingest/similar_keywords/header_map/3mo. change",
            "/_policy/csv_ingest/similar_keywords/line_endings",
            "/_policy/csv_ingest/top_listings/bom",
            "/_policy/csv_ingest/top_listings/dedupe_key",
            "/_policy/csv_ingest/top_listings/expected_headers",
            "/_policy/csv_ingest/top_listings/expected_headers_strict",
            "/_policy/csv_ingest/top_listings/field_types",
            "/_policy/csv_ingest/top_listings/line_endings",
            "/product_record/colors",
            "/product_record/discount_policy",
            "/product_record/karats",
            "/product_record/materials:+",
            "/product_record/pricing_by_karat",
            "/product_record/sizes_us",
            "/product_record/stone_policy",
            "/product_record/type",
            "/shop_profile/destinations",
            "/shop_profile/duty_payer",
            "/shop_profile/handling_days",
            "/shop_profile/packaging",
            "/shop_profile/shipping_fee",
            "/shop_profile/shipping_profile",
            "/shop_profile/sla_days",
            "/shop_profile/tracking",
            "/workflow_patches/steps/3/preprocess/header_map",
            "/workflow_patches/steps/4/preprocess/dialect/lineterminator",
            "/workflow_patches/steps/4/preprocess/normalize/strip_bom",
            "/workflow_patches/steps/6/preprocess/dialect/lineterminator",
            "/workflow_patches/steps/6/preprocess/normalize/strip_bom"
          ],
          "rationale": "Canonical CSV pipeline: common policy + type-specific ingest rules (headers, EOL, BOM, dedupe, converters, preprocess), and Step 0 product/shop info."
        },
        {
          "actor": "gpt_prod_executor_v1",
          "authorized_by": "user:@mcinar1905",
          "paths_changed": [
            "/workflow_enforcement/rules/correction_checkpoints"
          ],
          "rationale": "Add correction checkpoints at Steps 16 and 18 for pause/fix gates."
        },
        {
          "actor": "gpt_prod_executor_v1",
          "authorized_by": "user:@mcinar1905",
          "paths_changed": [
            "/_run/user_ack/csv_upload/competitor_listings",
            "/_run/user_ack/csv_upload/similar_keywords",
            "/_run/user_ack/csv_upload/top_listings",
            "/_run/user_ack/media_upload",
            "/_run/user_ack/product_info",
            "/_run/user_ack/record_type_decision",
            "/workflow_enforcement/guards/require_ack_before:+",
            "/workflow_enforcement/rules/auto_backtrack_fix_allowed",
            "/workflow_enforcement/rules/auto_run_without_user_approval",
            "/workflow_enforcement/rules/enforce_user_ack",
            "/workflow_enforcement/rules/user_required_steps",
            "/workflow_patches/steps/10/gates/on_soft_misalignment",
            "/workflow_patches/steps/11/gates/on_soft_misalignment",
            "/workflow_patches/steps/12/gates/on_soft_misalignment",
            "/workflow_patches/steps/14/gates/on_soft_misalignment",
            "/workflow_patches/steps/15/gates/on_soft_misalignment",
            "/workflow_patches/steps/16/gates/on_soft_misalignment",
            "/workflow_patches/steps/18/gates/on_soft_misalignment",
            "/workflow_patches/steps/19/gates/on_soft_misalignment",
            "/workflow_patches/steps/20/gates/on_soft_misalignment",
            "/workflow_patches/steps/5/gates/on_soft_misalignment",
            "/workflow_patches/steps/5a/gates/on_soft_misalignment",
            "/workflow_patches/steps/6a/gates/on_soft_misalignment",
            "/workflow_patches/steps/7/gates/on_soft_misalignment",
            "/workflow_patches/steps/8/gates/on_soft_misalignment",
            "/workflow_patches/steps/8a/gates/on_soft_misalignment",
            "/workflow_patches/steps/9/gates/on_soft_misalignment"
          ],
          "rationale": "Enforce user-required checkpoints (0, 1, CSV uploads, 16) with explicit acks; allow auto-run/backtrack for other steps; auto-fix soft misalignments."
        },
        {
          "actor": "gpt_prod_executor_v1",
          "authorized_by": "user:@mcinar1905",
          "details": [
            {
              "from": false,
              "path": "/_run/user_ack/product_info",
              "to": true
            },
            {
              "from": false,
              "path": "/_run/user_ack/media_upload",
              "to": true
            },
            {
              "from": false,
              "path": "/_run/user_ack/csv_upload/similar_keywords",
              "to": true
            },
            {
              "from": false,
              "path": "/_run/user_ack/csv_upload/top_listings",
              "to": true
            },
            {
              "from": false,
              "path": "/_run/user_ack/csv_upload/competitor_listings",
              "to": true
            },
            {
              "from": false,
              "path": "/_run/user_ack/record_type_decision",
              "to": true
            },
            {
              "from": "publish",
              "path": "/_run/record_type",
              "to": "preview"
            }
          ],
          "paths_changed": [
            "/_run/record_type",
            "/_run/user_ack/csv_upload/competitor_listings",
            "/_run/user_ack/csv_upload/similar_keywords",
            "/_run/user_ack/csv_upload/top_listings",
            "/_run/user_ack/media_upload",
            "/_run/user_ack/product_info",
            "/_run/user_ack/record_type_decision"
          ],
          "rationale": "User-approved ACKs set and record_type confirmed to 'preview'."
        },
        {
          "actor": "gpt_prod_executor_v1",
          "authorized_by": "user:@mcinar1905",
          "paths_changed": [
            "/_artifacts/competitors",
            "/_artifacts/description",
            "/_artifacts/note",
            "/_artifacts/segments",
            "/_artifacts/tags",
            "/_artifacts/title",
            "/_artifacts/updated_at",
            "/_bootstrap/on_load/banner_text",
            "/_bootstrap/on_load/session_banner",
            "/_help/steps/0",
            "/_help/steps/16",
            "/_help/steps/17",
            "/_help/steps/18",
            "/_help/steps/1a",
            "/_help/steps/3",
            "/_help/steps/4",
            "/_help/steps/6",
            "/_run/state/checkpoints",
            "/_run/state/last_completed",
            "/_run/state/next",
            "/workflow_enforcement/guards/unknown_step",
            "/workflow_enforcement/rules/auto_resume",
            "/workflow_enforcement/rules/default_record_type_on_new_session",
            "/workflow_patches/governance/step_manifest_resolver"
          ],
          "rationale": "Add portable state & artifacts, self-doc quickstart, and auto-resume/resilience semantics."
        },
        {
          "actor": "gpt_prod_executor_v1",
          "authorized_by": "user:@mcinar1905",
          "paths_changed": [
            "/_artifacts/tech_drawings/metal_colors_palette",
            "/_artifacts/tech_drawings/ring_cross_section",
            "/_artifacts/tech_drawings/size_chart_us",
            "/_help/assets/visual_examples/checklist",
            "/_help/assets/visual_examples/file_naming",
            "/_help/assets/visual_examples/guides/detail",
            "/_help/assets/visual_examples/guides/lifestyle",
            "/_help/assets/visual_examples/guides/packaging",
            "/_help/assets/visual_examples/guides/scale",
            "/_help/assets/visual_examples/guides/studio",
            "/_help/assets/visual_examples/required_types",
            "/_meta/changelog:+",
            "/_meta/schema_version",
            "/workflow_patches/governance/dynamic_steps",
            "/workflow_patches/governance/step_manifest_resolver/auto_register_in_manifest",
            "/workflow_patches/registry/step_kinds/analyze_market",
            "/workflow_patches/registry/step_kinds/assemble_listing",
            "/workflow_patches/registry/step_kinds/compliance_check",
            "/workflow_patches/registry/step_kinds/export",
            "/workflow_patches/registry/step_kinds/generate_description",
            "/workflow_patches/registry/step_kinds/generate_title",
            "/workflow_patches/registry/step_kinds/ingest_csv",
            "/workflow_patches/registry/step_kinds/seo_tags",
            "/workflow_patches/steps_defaults/gates/on_soft_misalignment",
            "/workflow_patches/steps_defaults/output/digest_only",
            "/workflow_patches/steps_defaults/preprocess/dialect/lineterminator",
            "/workflow_patches/steps_defaults/preprocess/normalize/strip_bom"
          ],
          "rationale": "Make steps/substeps resilient across sessions: help visuals, artifacts placeholders, defaults, dynamic substeps, and templates."
        },
        {
          "actor": "gpt_prod_executor_v1",
          "authorized_by": "user:@mcinar1905",
          "paths_changed": [
            "/_help/authoring",
            "/workflow_patches/governance/step_manifest_resolver/allow_workshop_auto_promote",
            "/workflow_patches/workshop/authoring_guide/text",
            "/workflow_patches/workshop/backlog:+",
            "/workflow_patches/workshop/backlog_spec_schema",
            "/workflow_patches/workshop/bulk_add/examples",
            "/workflow_patches/workshop/bulk_add/pending_names",
            "/workflow_patches/workshop/promotion"
          ],
          "rationale": "Add Steps Workshop: backlog + bulk_add + promotion plan; authoring help; keep auto-promote off for safety."
        },
        {
          "actor": "gpt_prod_executor_v1",
          "authorized_by": "user:@mcinar1905",
          "paths_changed": [
            "/_admin/unlock_request/rationale",
            "/_admin/unlock_request/requested_steps",
            "/_admin/unlock_request/status",
            "/_help/admin",
            "/_policy/audit/steps_snapshots:+",
            "/workflow_enforcement/rules/steps_persistence/allow_workshop_changes",
            "/workflow_enforcement/rules/steps_persistence/autosnapshot_on_modify",
            "/workflow_enforcement/rules/steps_persistence/lock_default",
            "/workflow_enforcement/rules/steps_persistence/max_snapshots",
            "/workflow_enforcement/rules/steps_persistence/require_unlock_to_modify",
            "/workflow_patches/steps_index",
            "/workflow_patches/steps_locks/0/locked",
            "/workflow_patches/steps_locks/0/owner",
            "/workflow_patches/steps_locks/0/unlock_via",
            "/workflow_patches/steps_locks/00/locked",
            "/workflow_patches/steps_locks/00/owner",
            "/workflow_patches/steps_locks/00/unlock_via",
            "/workflow_patches/steps_locks/0a/locked",
            "/workflow_patches/steps_locks/0a/owner",
            "/workflow_patches/steps_locks/0a/unlock_via",
            "/workflow_patches/steps_locks/1/locked",
            "/workflow_patches/steps_locks/1/owner",
            "/workflow_patches/steps_locks/1/unlock_via",
            "/workflow_patches/steps_locks/10/locked",
            "/workflow_patches/steps_locks/10/owner",
            "/workflow_patches/steps_locks/10/unlock_via",
            "/workflow_patches/steps_locks/11/locked",
            "/workflow_patches/steps_locks/11/owner",
            "/workflow_patches/steps_locks/11/unlock_via",
            "/workflow_patches/steps_locks/12/locked",
            "/workflow_patches/steps_locks/12/owner",
            "/workflow_patches/steps_locks/12/unlock_via",
            "/workflow_patches/steps_locks/13/locked",
            "/workflow_patches/steps_locks/13/owner",
            "/workflow_patches/steps_locks/13/unlock_via",
            "/workflow_patches/steps_locks/14/locked",
            "/workflow_patches/steps_locks/14/owner",
            "/workflow_patches/steps_locks/14/unlock_via",
            "/workflow_patches/steps_locks/15/locked",
            "/workflow_patches/steps_locks/15/owner",
            "/workflow_patches/steps_locks/15/unlock_via",
            "/workflow_patches/steps_locks/16/locked",
            "/workflow_patches/steps_locks/16/owner",
            "/workflow_patches/steps_locks/16/unlock_via",
            "/workflow_patches/steps_locks/17/locked",
            "/workflow_patches/steps_locks/17/owner",
            "/workflow_patches/steps_locks/17/unlock_via",
            "/workflow_patches/steps_locks/18/locked",
            "/workflow_patches/steps_locks/18/owner",
            "/workflow_patches/steps_locks/18/unlock_via",
            "/workflow_patches/steps_locks/18a/locked",
            "/workflow_patches/steps_locks/18a/owner",
            "/workflow_patches/steps_locks/18a/unlock_via",
            "/workflow_patches/steps_locks/19/locked",
            "/workflow_patches/steps_locks/19/owner",
            "/workflow_patches/steps_locks/19/unlock_via",
            "/workflow_patches/steps_locks/1a/locked",
            "/workflow_patches/steps_locks/1a/owner",
            "/workflow_patches/steps_locks/1a/unlock_via",
            "/workflow_patches/steps_locks/1b/locked",
            "/workflow_patches/steps_locks/1b/owner",
            "/workflow_patches/steps_locks/1b/unlock_via",
            "/workflow_patches/steps_locks/20/locked",
            "/workflow_patches/steps_locks/20/owner",
            "/workflow_patches/steps_locks/20/unlock_via",
            "/workflow_patches/steps_locks/3/locked",
            "/workflow_patches/steps_locks/3/owner",
            "/workflow_patches/steps_locks/3/unlock_via",
            "/workflow_patches/steps_locks/3a/locked",
            "/workflow_patches/steps_locks/3a/owner",
            "/workflow_patches/steps_locks/3a/unlock_via",
            "/workflow_patches/steps_locks/3b/locked",
            "/workflow_patches/steps_locks/3b/owner",
            "/workflow_patches/steps_locks/3b/unlock_via",
            "/workflow_patches/steps_locks/4/locked",
            "/workflow_patches/steps_locks/4/owner",
            "/workflow_patches/steps_locks/4/unlock_via",
            "/workflow_patches/steps_locks/5/locked",
            "/workflow_patches/steps_locks/5/owner",
            "/workflow_patches/steps_locks/5/unlock_via",
            "/workflow_patches/steps_locks/5a/locked",
            "/workflow_patches/steps_locks/5a/owner",
            "/workflow_patches/steps_locks/5a/unlock_via",
            "/workflow_patches/steps_locks/5b/locked",
            "/workflow_patches/steps_locks/5b/owner",
            "/workflow_patches/steps_locks/5b/unlock_via",
            "/workflow_patches/steps_locks/6/locked",
            "/workflow_patches/steps_locks/6/owner",
            "/workflow_patches/steps_locks/6/unlock_via",
            "/workflow_patches/steps_locks/6a/locked",
            "/workflow_patches/steps_locks/6a/owner",
            "/workflow_patches/steps_locks/6a/unlock_via",
            "/workflow_patches/steps_locks/7/locked",
            "/workflow_patches/steps_locks/7/owner",
            "/workflow_patches/steps_locks/7/unlock_via",
            "/workflow_patches/steps_locks/8/locked",
            "/workflow_patches/steps_locks/8/owner",
            "/workflow_patches/steps_locks/8/unlock_via",
            "/workflow_patches/steps_locks/8a/locked",
            "/workflow_patches/steps_locks/8a/owner",
            "/workflow_patches/steps_locks/8a/unlock_via",
            "/workflow_patches/steps_locks/9/locked",
            "/workflow_patches/steps_locks/9/owner",
            "/workflow_patches/steps_locks/9/unlock_via",
            "/workflow_patches/steps_locks/seo_package/locked",
            "/workflow_patches/steps_locks/seo_package/owner",
            "/workflow_patches/steps_locks/seo_package/unlock_via"
          ],
          "rationale": "Add steps persistence: default locks, autosnapshots, admin unlock & restore help, steps name index."
        },
        {
          "actor": "gpt_prod_executor_v1",
          "authorized_by": "user:@mcinar1905",
          "paths_changed": [
            "/_admin/unlock_request",
            "/workflow_patches/steps_locks/10/locked",
            "/workflow_patches/steps_locks/10/unlock_actor",
            "/workflow_patches/steps_locks/10/unlock_authorized_by",
            "/workflow_patches/steps_locks/10/unlocked_at",
            "/workflow_patches/steps_locks/11/locked",
            "/workflow_patches/steps_locks/11/unlock_actor",
            "/workflow_patches/steps_locks/11/unlock_authorized_by",
            "/workflow_patches/steps_locks/11/unlocked_at",
            "/workflow_patches/steps_locks/14/locked",
            "/workflow_patches/steps_locks/14/unlock_actor",
            "/workflow_patches/steps_locks/14/unlock_authorized_by",
            "/workflow_patches/steps_locks/14/unlocked_at",
            "/workflow_patches/steps_locks/15/locked",
            "/workflow_patches/steps_locks/15/unlock_actor",
            "/workflow_patches/steps_locks/15/unlock_authorized_by",
            "/workflow_patches/steps_locks/15/unlocked_at"
          ],
          "rationale": "Unlock approved for steps ['10', '11', '14', '15'] to allow rule revisions per new references."
        },
        {
          "actor": "gpt_prod_executor_v1",
          "authorized_by": "user:@mcinar1905",
          "paths_changed": [
            "/workflow_patches/steps/ab.1",
            "/workflow_patches/steps/ads.1",
            "/workflow_patches/steps/kw.1",
            "/workflow_patches/steps/media.1",
            "/workflow_patches/steps/seo.1",
            "/workflow_patches/steps/trend.1",
            "/workflow_patches/steps_locks/ab.1",
            "/workflow_patches/steps_locks/ads.1",
            "/workflow_patches/steps_locks/kw.1",
            "/workflow_patches/steps_locks/media.1",
            "/workflow_patches/steps_locks/seo.1",
            "/workflow_patches/steps_locks/trend.1",
            "/workflow_patches/workshop/backlog:+"
          ],
          "rationale": "Promote 6 workshop entries (enabled=false, manifest untouched) for future use."
        },
        {
          "actor": "gpt_prod_executor_v1",
          "authorized_by": "user:@mcinar1905",
          "paths_changed": [
            "/workflow_patches/governance/csv_schema_mode",
            "/workflow_patches/governance/safety",
            "/workflow_patches/steps/3b/ruleset/policy",
            "/workflow_patches/steps/4b/ruleset/policy",
            "/workflow_patches/steps/5a/ruleset",
            "/workflow_patches/steps/6a/ruleset/dedup",
            "/workflow_patches/steps/6b/ruleset/dedup",
            "/workflow_patches/steps/6b/ruleset/policy"
          ],
          "rationale": "Switch CSV checks to relaxed mode + header aliases; keep extras; warn-only on mismatch; parsing/dedup tweaks.",
          "ts": "2025-09-10T09:58:11.511081Z"
        }
      ],
      "digest_log": true,
      "include_guard": true,
      "include_step_id": true,
      "logging": {
        "fields": [
          "filename",
          "size_bytes",
          "sha256_prefix",
          "actor",
          "timestamp"
        ],
        "record_session_handshake": true
      },
      "redact_secrets": true,
      "releases": [
        {
          "filename": "FINALLOCK__WITH_TRIGGER__PATCHED_v8_relaxed.json",
          "id": "rel-v8-20250909-152757",
          "previous_release_id": "rel-v7-unknown",
          "promoted_at": "2025-09-09T15:27:57.739719Z",
          "promoted_by": "gpt_prod_executor_v1",
          "sha256": "871ea3d0bdf4510ceb91457f6f27c41992c5b3f54d5b2a5c408a50a44a4cfd1f",
          "size_bytes": 631650,
          "zip_sha256": "0091a7729c0011b8e5965dc0ee06fd7d79e847fa21ac616e5be75acb3f251d66"
        },
        {
          "filename": "FINALLOCK__WITH_TRIGGER__PATCHED_v8_relaxed.json",
          "id": "rel-v8-20250909-172439-manifest-disable-5b-18a",
          "previous_release_id": "rel-v8-20250909-152757",
          "promoted_at": "2025-09-09T17:24:39.621550Z",
          "promoted_by": "gpt_prod_executor_v1",
          "sha256": "0dc419a5b4c436dcc4efe85c0f35b5655027eecad9fa410be342a1301d2ac618",
          "size_bytes": 634349
        },
        {
          "filename": "FINALLOCK__WITH_TRIGGER__PATCHED_v8_relaxed.json",
          "id": "rel-v8-20250909-172821-handshake-filenames",
          "previous_release_id": "rel-v8-20250909-172439-manifest-disable-5b-18a",
          "promoted_at": "2025-09-09T17:28:21.331825Z",
          "promoted_by": "gpt_prod_executor_v1",
          "sha256": "c994a6416a0aab41b6d96a83da5d216196aecd5280b5866e89b22cd0f94b3ff8",
          "size_bytes": 635247
        },
        {
          "filename": "FINALLOCK__WITH_TRIGGER__PATCHED_v8_relaxed.json",
          "id": "rel-v8-20250909-173255-csv-pipeline",
          "previous_release_id": "rel-v8-20250909-172821-handshake-filenames",
          "promoted_at": "2025-09-09T17:32:55.366771Z",
          "promoted_by": "gpt_prod_executor_v1",
          "sha256": "0dd284b2b6093434909558a43fd50031ba9b508fac77fbdeda215d29c9472940",
          "size_bytes": 641211
        },
        {
          "filename": "FINALLOCK__WITH_TRIGGER__PATCHED_v8_relaxed.json",
          "id": "rel-v8-20250909-173825-correction-checkpoints",
          "previous_release_id": "rel-v8-20250909-173255-csv-pipeline",
          "promoted_at": "2025-09-09T17:38:25.331149Z",
          "promoted_by": "gpt_prod_executor_v1",
          "sha256": "2c2bb78baed2bfc0fb385021c219e2866b33ffae6fb0ae33d059e0e269952b95",
          "size_bytes": 642044
        },
        {
          "filename": "FINALLOCK__WITH_TRIGGER__PATCHED_v8_relaxed.json",
          "id": "rel-v8-20250909-174107-user-checkpoints",
          "previous_release_id": "rel-v8-20250909-173825-correction-checkpoints",
          "promoted_at": "2025-09-09T17:41:07.362929Z",
          "promoted_by": "gpt_prod_executor_v1",
          "sha256": "9465bae42e2b4863721e7de426f192ff0c1c0319b6762da5cc86ecbec6d2f482",
          "size_bytes": 646769
        },
        {
          "filename": "FINALLOCK__WITH_TRIGGER__PATCHED_v8_relaxed.json",
          "id": "rel-v8-20250909-174311-ack-preview",
          "previous_release_id": "rel-v8-20250909-174107-user-checkpoints",
          "promoted_at": "2025-09-09T17:43:11.359760Z",
          "promoted_by": "gpt_prod_executor_v1",
          "sha256": "2440430ef0ee86c7bed03752926d54b974e8b79d9571e4ff4a091d0b2107cca1",
          "size_bytes": 648844
        },
        {
          "filename": "FINALLOCK__WITH_TRIGGER__PATCHED_v8_relaxed.json",
          "id": "rel-v8-20250909-174856-portable-selfdoc-autoresume",
          "previous_release_id": "rel-v8-20250909-174311-ack-preview",
          "promoted_at": "2025-09-09T17:48:56.125189Z",
          "promoted_by": "gpt_prod_executor_v1",
          "sha256": "33685edcf877f0db06b2608224f6f022e82ac860d206105bbc2c77787d7841ed",
          "size_bytes": 657185
        },
        {
          "filename": "FINALLOCK__WITH_TRIGGER__PATCHED_v8_relaxed.json",
          "id": "rel-v8-20250909-175247-help-artifacts-dynamic",
          "previous_release_id": "rel-v8-20250909-174856-portable-selfdoc-autoresume",
          "promoted_at": "2025-09-09T17:52:47.353850Z",
          "promoted_by": "gpt_prod_executor_v1",
          "sha256": "5d093a26eb55077fda9291d54e0c808623e181ef058fb7080051d7051f6e9da0",
          "size_bytes": 665265
        },
        {
          "filename": "FINALLOCK__WITH_TRIGGER__PATCHED_v8_relaxed.json",
          "id": "rel-v8-20250909-175720-steps-workshop",
          "previous_release_id": "rel-v8-20250909-175247-help-artifacts-dynamic",
          "promoted_at": "2025-09-09T17:57:20.721750Z",
          "promoted_by": "gpt_prod_executor_v1",
          "sha256": "429ad0df6d9d5830ceb080d676f5ebe03d1e69dac415ff397ec6d33451fbfa86",
          "size_bytes": 671131
        },
        {
          "filename": "FINALLOCK__WITH_TRIGGER__PATCHED_v8_relaxed.json",
          "id": "rel-v8-20250909-180121-steps-persistence",
          "previous_release_id": "rel-v8-20250909-175720-steps-workshop",
          "promoted_at": "2025-09-09T18:01:21.723308Z",
          "promoted_by": "gpt_prod_executor_v1",
          "sha256": "ea3c921391b9c4387c512050ee49111f55424dbe02c3b8cdd3389a77ae6f0341",
          "size_bytes": 855550
        },
        {
          "filename": "FINALLOCK__WITH_TRIGGER__PATCHED_v8_relaxed.json",
          "id": "rel-v8-20250909-180916-unlock-10-11-14-15",
          "previous_release_id": "rel-v8-20250909-180121-steps-persistence",
          "promoted_at": "2025-09-09T18:09:16.446534Z",
          "promoted_by": "gpt_prod_executor_v1",
          "sha256": "fb7b1c8cb0d37b65194ea47a3641d389ef34b7122598b77c9c18db66163953fd",
          "size_bytes": 858134
        }
      ],
      "steps_snapshots": [
        {
          "actor": "gpt_prod_executor_v1",
          "id": "ss-20250909-180121",
          "manifest": [
            {
              "id": "0"
            },
            {
              "id": "1"
            },
            {
              "id": "1a"
            },
            {
              "id": "1b"
            },
            {
              "id": "3"
            },
            {
              "id": "3a"
            },
            {
              "id": "3b"
            },
            {
              "guards": [
                "no_ui_tables"
              ],
              "id": "4",
              "policy_ref": "csv_ingest.top_listings"
            },
            {
              "guards": [
                "title_subtitle_template",
                "no_ui_tables"
              ],
              "id": "5"
            },
            {
              "guards": [
                "shop_name_presence",
                "no_ui_tables"
              ],
              "id": "5a"
            },
            {
              "id": "6"
            },
            {
              "id": "6a"
            },
            {
              "id": "7"
            },
            {
              "id": "8"
            },
            {
              "id": "8a"
            },
            {
              "id": "9"
            },
            {
              "id": "10"
            },
            {
              "id": "11"
            },
            {
              "id": "12"
            },
            {
              "id": "14"
            },
            {
              "id": "15"
            },
            {
              "id": "16"
            },
            {
              "id": "17"
            },
            {
              "id": "18"
            },
            {
              "id": "19"
            },
            {
              "id": "20"
            }
          ],
          "steps": {
            "0": {
              "constraints": {
                "must_confirm": true,
                "no_skip": true,
                "require_gpt_task": false,
                "require_user_task": true,
                "require_validations_pass": false
              },
              "description": "product_record kaydını ekranda gösterir; veri tek kaynaktan okunur.",
              "flow": {
                "guard": {
                  "advance_only_if": []
                },
                "on_success_next": "00"
              },
              "gates": {
                "must": [
                  "validations_ok"
                ],
                "on_contract_violation": "halt_and_report",
                "on_miss": "halt",
                "on_missing_required_path": "halt_and_report",
                "on_soft_misalignment": "warn_and_continue"
              },
              "hitl_contract": {
                "gpt_tasks": [],
                "user_tasks": []
              },
              "name": "Product Info (read-only)",
              "next": [
                "00"
              ],
              "outputs": {
                "review_confirmed": true
              },
              "preconditions": {
                "critical_pass": {
                  "require_ancestors_done": [
                    "0",
                    "1",
                    "3",
                    "6",
                    "16"
                  ]
                }
              },
              "product_info": {
                "fixed_product": {
                  "colors": [
                    "Yellow Gold",
                    "White Gold",
                    "Rose Gold"
                  ],
                  "discount_percent_hidden": 30,
                  "sizes_us": "4–14¾",
                  "stone_policy": {
                    "provided_by_user": true,
                    "use_gpt_visual_inference_if_confidence_gte": 0.9
                  },
                  "variations": [
                    {
                      "karat": "10K",
                      "price_usd": "450"
                    },
                    {
                      "karat": "14K",
                      "price_usd": "750"
                    },
                    {
                      "karat": "18K",
                      "price_usd": "1200"
                    }
                  ]
                },
                "logistics": {
                  "customs_duties_payer": "seller",
                  "delivery_estimate_business_days": {
                    "max": 5,
                    "min": 2
                  },
                  "destinations": [
                    "Canada",
                    "United States",
                    "Germany",
                    "United Kingdom",
                    "France"
                  ],
                  "handling_time_business_days": {
                    "max": 3,
                    "min": 1
                  },
                  "origin_country": "Türkiye",
                  "packaging": "Özel kutu + hediye notu eklenebilir.",
                  "shipping_fee": "Ücretsiz kargo",
                  "shipping_profile": "LUXURYJEWELERY",
                  "tracking": true
                }
              },
              "requires": [],
              "ruleset": [
                {
                  "id": "REQUIRE_PRODUCT_RECORD_PRESENT",
                  "params": {}
                },
                {
                  "id": "DISPLAY_PRODUCT_RECORD_SUMMARY",
                  "params": {
                    "source": "product_record"
                  }
                },
                {
                  "id": "BLOCK_IF_MISSING",
                  "params": {}
                }
              ],
              "title": "Product Info (read-only)",
              "ui": {
                "review_paths": [
                  "/_product_static/colors",
                  "/_product_static/discount",
                  "/_product_static/ring_sizes_us",
                  "/_product_static/stone_policy",
                  "/_product_static/variation_prices",
                  "/_store_profile/*"
                ],
                "title": "Ön İnceleme (Step 0)"
              },
              "upstream_signature": {
                "policy": "mark_stale_on_upstream_change"
              },
              "user_task": {
                "confirm": "review_confirmed",
                "read": [
                  "product_info.logistics",
                  "product_info.fixed_product"
                ]
              },
              "validations": {
                "review_confirmed_is_true": {
                  "equals": true,
                  "field": "outputs.review_confirmed"
                }
              }
            },
            "00": {
              "constraints": {
                "must_confirm": false,
                "no_skip": true,
                "require_gpt_task": true,
                "require_user_task": false,
                "require_validations_pass": true,
                "status_values": [
                  "PASS",
                  "FAIL"
                ]
              },
              "description": "Patch sonrası otomatik doğrulama: required_rule_ids ve required_requires kontrolü. PASS değilse kritik akışlar durur.",
              "flow": {
                "guard": {
                  "advance_only_if": []
                }
              },
              "gates": {
                "must": [
                  "validations_ok"
                ],
                "on_contract_violation": "halt_and_report",
                "on_miss": "halt",
                "on_missing_required_path": "halt_and_report",
                "on_soft_misalignment": "warn_and_continue",
                "on_validation_fail": "halt_and_report"
              },
              "hitl_contract": {
                "gpt_tasks": [],
                "user_tasks": []
              },
              "inputs": [
                "workflow_patches.steps{}",
                "workflow_patches.governance.required_rule_ids{}",
                "workflow_patches.governance.required_requires{}"
              ],
              "name": "Self-Check (arka planda)",
              "next": [
                "0a"
              ],
              "notes": {
                "hardened_at": "2025-09-08T20:59:54.302900Z"
              },
              "outputs": [
                "self_check.report{}",
                "self_check.missing[]",
                "self_check.status",
                "self_check.timestamp"
              ],
              "preconditions": {
                "critical_pass": {
                  "require_ancestors_done": [
                    "0",
                    "1",
                    "3",
                    "6",
                    "16"
                  ]
                }
              },
              "requires": [
                "0"
              ],
              "rules": [
                "validate each step has all required ruleset IDs",
                "validate each step has required 'requires' deps (e.g., 0a for CSV-driven steps)",
                "produce a detailed report of missing IDs/deps",
                "self_check.status = PASS if no issues else FAIL",
                "CSV: On upload, detect encoding (Office 2007/Turkish) and parse with defined dialect; never auto-infer types.",
                "CSV: Header count must equal data field count (or +1 with removable leading numeric index for Top/Competitor files).",
                "CSV: Preserve empty strings and literal 'NaN'; do NOT invent NaN; do NOT trim inside quotes.",
                "CSV: Snapshot parsed table under /_runs/<run_id>/csv/<type> and compute sha256; block run if header/data mismatch.",
                "ROW NORMALIZE (Top/Competitor): If data row has expected+1 columns and first cell is pure numeric index, drop that first cell to align with headers.",
                "ROW NORMALIZE (Similar Keywords): If data row has expected+1 columns and last cell is empty, drop the trailing empty cell to align with headers.",
                "PRE-RUN: Show /workflow_patches/steps/0 (Product Info) fields in FULL (no summary). Ask user: 'Değişiklik var mı? (EVET/HAYIR)'. If EVET, block run and request exact edits; if HAYIR, continue.",
                "PRE-RUN: Capture product_info_snapshot under /_runs/<run_id>/product_info_snapshot with hash; require user_ack=true before step 1.",
                "ENFORCE: Fail run if any /policy/guard/mandatory_fields/step_0 item is missing/empty OR if snapshot missing/mismatched.",
                "ENFORCE: Steps must run sequentially by key order; skipping/fast-forward is forbidden unless 'requires' explicitly satisfied and user_ack present for gated steps.",
                "ENFORCE: Any user-gated step with 'block_until_user_ack:true' cannot auto-advance and must be acknowledged by the user before proceeding."
              ],
              "ruleset": [
                {
                  "id": "CHECK_REQUIRED_RULE_IDS",
                  "params": {
                    "source": "governance.required_rule_ids"
                  }
                },
                {
                  "id": "CHECK_REQUIRED_REQUIRES",
                  "params": {
                    "source": "governance.required_requires"
                  }
                },
                {
                  "id": "SELF_CHECK_STATUS_VALUES",
                  "params": {
                    "values": [
                      "PASS",
                      "FAIL"
                    ]
                  }
                },
                {
                  "id": "SAFE_COOLDOWN_ENFORCED",
                  "params": {}
                },
                {
                  "id": "SAFE_CHECKPOINT_ENFORCED",
                  "params": {}
                },
                {
                  "id": "SAFE_REQUIRE_FILENAME_SHA_MATCH",
                  "params": {}
                },
                {
                  "id": "SAFE_BLOCK_ON_SUSPECT",
                  "params": {}
                },
                {
                  "id": "MUTATION_POLICY_BLOCK",
                  "params": {}
                },
                {
                  "id": "MANIFEST_LOCK_ENFORCER",
                  "params": {}
                },
                {
                  "id": "INVARIANTS_ENFORCER",
                  "params": {}
                },
                {
                  "id": "APPROVAL_GUARD_ENFORCER",
                  "params": {}
                },
                {
                  "assert": [
                    "hard_locks.require_filename",
                    "hard_locks.require_sha256"
                  ],
                  "id": "FILE_LOCK_ENFORCED"
                },
                {
                  "assert": [
                    "hard_locks.bind_to_session",
                    "hard_locks.require_active_session"
                  ],
                  "id": "SESSION_BIND_ENFORCED"
                }
              ],
              "title": "Self-Check",
              "upstream_signature": {
                "policy": "mark_stale_on_upstream_change"
              },
              "validations": {
                "execution_order_defined": true,
                "external_rules_forbidden": true,
                "present": true,
                "source_is_json_only": true
              }
            },
            "0a": {
              "constraints": {
                "blocking": false,
                "must_confirm": false,
                "no_skip": true,
                "require_gpt_task": true,
                "require_user_task": false,
                "require_validations_pass": true,
                "status_values": [
                  "PASS",
                  "WARN",
                  "FAIL"
                ]
              },
              "description": "Her CSV türü için analizden önce daima çalışan, bloklamayan temizlik ve standardizasyon.",
              "flow": {
                "guard": {
                  "advance_only_if": []
                }
              },
              "gates": {
                "must": [
                  "validations_ok"
                ],
                "on_contract_violation": "halt_and_report",
                "on_miss": "halt",
                "on_missing_required_field": "halt_and_request_fix",
                "on_missing_required_path": "halt_and_report",
                "on_soft_misalignment": "warn_and_continue",
                "on_validation_fail": "halt_and_report"
              },
              "hitl_contract": {
                "gpt_tasks": [],
                "user_tasks": []
              },
              "inputs": [
                "csv.input"
              ],
              "name": "Pre-Run Prep (Light, arka planda)",
              "next": [
                "1",
                "3",
                "6"
              ],
              "notes": {
                "hardened_at": "2025-09-08T20:59:54.303204Z"
              },
              "outputs": [
                "csv.prep.output",
                "prep.report{}",
                "prep.issues[]",
                "prep.status",
                "prep.stats{}"
              ],
              "preconditions": {
                "critical_pass": {
                  "require_ancestors_done": [
                    "0",
                    "1",
                    "3",
                    "6",
                    "16"
                  ]
                },
                "parent_defined": {
                  "exists": true,
                  "path": "/workflow_patches/steps/0"
                },
                "step0_review_confirmed": {
                  "equals": true,
                  "path": "/workflow_patches/steps/0/outputs/review_confirmed"
                }
              },
              "requires": [
                "00"
              ],
              "rules": [
                "always-run: true",
                "non-blocking: true (only WARN, never BLOCK)",
                "auto-fix encoding (UTF-8), newline normalize (\\n), trim",
                "type-specific header/field mappers",
                "dedupe (case/diacritics insensitive)",
                "tags split normalize (',',';','|') -> ','",
                "numeric normalize (comma as decimal)",
                "warn on missing critical fields per type; auto-skip row but continue",
                "produce prep.report{}, prep.issues[], prep.stats{rows_in, rows_out, skipped, fixed}"
              ],
              "ruleset": [
                {
                  "id": "ALWAYS_RUN",
                  "params": {
                    "enforced": true
                  }
                },
                {
                  "id": "NON_BLOCKING",
                  "params": {
                    "warn_only": true
                  }
                },
                {
                  "id": "ENCODING_NORMALIZE",
                  "params": {
                    "encoding": "UTF-8",
                    "newline": "\\n"
                  }
                },
                {
                  "id": "TRIM_LOWER_PUNCT_NORMALIZE",
                  "params": {
                    "enabled": true
                  }
                },
                {
                  "id": "DEDUPE_POLICY",
                  "params": {
                    "case_insensitive": true,
                    "diacritics_insensitive": true
                  }
                },
                {
                  "id": "TAGS_SPLIT_NORMALIZE",
                  "params": {
                    "delims": [
                      ",",
                      ";",
                      "|"
                    ],
                    "target": ","
                  }
                },
                {
                  "id": "NUMERIC_NORMALIZE",
                  "params": {
                    "comma_as_decimal": true
                  }
                },
                {
                  "id": "WARN_MISSING_CRITICAL",
                  "params": {
                    "fields": {
                      "competitor": [
                        "shop_name",
                        "shop_url"
                      ],
                      "top_listings": [
                        "title",
                        "tags"
                      ]
                    }
                  }
                },
                {
                  "id": "REPORT_FIELDS",
                  "params": {
                    "include": [
                      "rows_in",
                      "rows_out",
                      "skipped",
                      "fixed"
                    ]
                  }
                }
              ],
              "title": "Pre-Run Prep (Light)",
              "upstream_signature": {
                "policy": "mark_stale_on_upstream_change"
              },
              "validations": {
                "colors_defined": {
                  "min_len": 3,
                  "path": "/_product_static/colors"
                },
                "present": true,
                "product_material_present": {
                  "path": "/_product_static/material",
                  "required": true
                },
                "variation_prices_complete": {
                  "paths": [
                    "/_product_static/variation_prices/10K",
                    "/_product_static/variation_prices/14K",
                    "/_product_static/variation_prices/18K"
                  ],
                  "required_all": true
                }
              }
            },
            "1": {
              "artifacts": [
                "media.manifest.json",
                "media.qc.report.json"
              ],
              "constraints": {
                "must_confirm": false,
                "no_skip": true,
                "require_gpt_task": false,
                "require_user_task": false,
                "require_validations_pass": true
              },
              "description": "Ürün fotoğrafları ve varsa ürün videosu sisteme yüklenir. Dosya tipleri, çözünürlük ve oran kontrolleri yapılır; başarılı olanlar ürün varlık deposuna kaydedilir.",
              "flow": {
                "guard": {
                  "advance_only_if": []
                },
                "on_fail": "halt",
                "on_success_next": "1a"
              },
              "gates": {
                "must": [
                  "validations_ok"
                ],
                "on_contract_violation": "halt_and_report",
                "on_miss": "halt",
                "on_missing_required_path": "halt_and_report",
                "on_soft_misalignment": "warn_and_continue"
              },
              "hitl_contract": {
                "gpt_tasks": [
                  "EXIF ve boyut kontrolü yap; geçersizleri uyar."
                ],
                "user_tasks": [
                  "Görselleri (JPG/PNG/WEBP) yükle (1-20 adet)."
                ]
              },
              "id": "1",
              "inputs": [
                "user.upload.photos[]?",
                "user.upload.video?"
              ],
              "name": "Görsel Yükleme",
              "next": [
                "1a"
              ],
              "on_error": {
                "fallback_next": [],
                "policy": "fail-soft"
              },
              "outputs": [
                "product.photos[]",
                "product.video?"
              ],
              "preconditions": {
                "critical_pass": {
                  "require_ancestors_done": [
                    "0",
                    "1",
                    "3",
                    "6",
                    "16"
                  ]
                }
              },
              "requires": [
                "0a"
              ],
              "title": "Görsel Yükleme",
              "type": "upload_images",
              "ui": {
                "accept": [
                  ".jpg",
                  ".jpeg",
                  ".png",
                  ".webp"
                ],
                "help": "JPG, PNG veya WEBP yükleyin. En az 1, en fazla 20 görsel.",
                "max_files": 20,
                "max_size_mb": 25,
                "min_files": 1,
                "title": "Görselleri Yükle"
              },
              "upstream_signature": {
                "policy": "mark_stale_on_upstream_change"
              },
              "validation": {
                "required": true,
                "rules": [
                  {
                    "id": "IMG_COUNT_MIN",
                    "params": {
                      "min": 1
                    }
                  },
                  {
                    "id": "IMG_DIM_MIN",
                    "params": {
                      "min_height": 512,
                      "min_width": 512
                    }
                  },
                  {
                    "id": "IMG_FORMAT",
                    "params": {
                      "allow": [
                        "jpg",
                        "jpeg",
                        "png",
                        "webp"
                      ]
                    }
                  }
                ]
              },
              "validations": {
                "photos.max_files": 10,
                "photos.mime": [
                  "image/jpeg",
                  "image/png",
                  "image/webp"
                ],
                "photos.min_resolution": "1200x1200",
                "video.max_duration_sec": 60,
                "video.mime": [
                  "video/mp4",
                  "video/quicktime"
                ]
              },
              "value_handling": {
                "cast_all_as_text": true,
                "normalize_yes_no": true,
                "treat_empty_as_valid": true,
                "treat_nan_as_empty": true
              }
            },
            "10": {
              "constraints": {
                "must_confirm": false,
                "no_skip": true,
                "require_gpt_task": false,
                "require_user_task": false,
                "require_validations_pass": false
              },
              "description": "Odak/support keywordler, ürün attribute'ları ve mağaza sesi ile SEO uyumlu başlık oluşturulur.",
              "flow": {
                "guard": {
                  "advance_only_if": []
                }
              },
              "gates": {
                "must": [
                  "validations_ok"
                ],
                "on_contract_violation": "halt_and_report",
                "on_miss": "halt",
                "on_missing_required_path": "halt_and_report",
                "on_soft_misalignment": "auto_fix_and_continue"
              },
              "guards": {
                "title_repetition": {
                  "max_repeat": 2
                }
              },
              "hitl_contract": {
                "gpt_tasks": [],
                "user_tasks": []
              },
              "inputs": [
                "keywords.focus[1..4]",
                "seo.keywords.supporting[]",
                "product.info{}",
                "shop.profile{}"
              ],
              "name": "Başlık (Title)",
              "outputs": [
                "title.final"
              ],
              "preconditions": {
                "critical_pass": {
                  "require_ancestors_done": [
                    "0",
                    "1",
                    "3",
                    "6",
                    "16"
                  ]
                }
              },
              "requires": [
                "7"
              ],
              "rules": [
                "title length: 80-140 chars (optimum 110-130)",
                "first 30-40 chars must include focus_1",
                "slots: focus keyword, 1 product attribute, 1 occasion/audience, optional brand voice",
                "no stuffing, no ALL CAPS",
                "forbidden terms: ['Turkey','Istanbul']"
              ],
              "ruleset": [
                {
                  "id": "TITLE_FRONTLOAD",
                  "params": {
                    "first_chars": 40
                  }
                },
                {
                  "id": "TITLE_LENGTH_RANGE",
                  "params": {
                    "max": 140,
                    "min": 80
                  }
                },
                {
                  "id": "TITLE_REQUIRE_ATTRIBUTE",
                  "params": {
                    "required": true
                  }
                },
                {
                  "id": "TITLE_REQUIRE_OCCASION_OR_AUDIENCE",
                  "params": {
                    "required": true
                  }
                },
                {
                  "id": "TITLE_FORBIDDEN_TERMS",
                  "params": {
                    "terms": [
                      "Turkey",
                      "Istanbul"
                    ]
                  }
                },
                {
                  "id": "TITLE_NO_STUFFING_ALLCAPS",
                  "params": {
                    "enforced": true
                  }
                },
                {
                  "id": "PRODUCT_RECORD_CONFIRMED_REQUIRED",
                  "params": {
                    "source": "product_record",
                    "status": "CONFIRMED"
                  }
                }
              ],
              "title": "Başlık (Title)",
              "upstream_signature": {
                "policy": "mark_stale_on_upstream_change"
              },
              "validations": {
                "present": true
              }
            },
            "11": {
              "constraints": {
                "must_confirm": false,
                "no_skip": true,
                "require_gpt_task": false,
                "require_user_task": false,
                "require_validations_pass": false
              },
              "description": "Ürün bilgileri ve mağaza sabitleriyle desteklenmiş, SEO uyumlu açıklama oluşturulur.",
              "flow": {
                "guard": {
                  "advance_only_if": []
                }
              },
              "gates": {
                "must": [
                  "validations_ok"
                ],
                "on_contract_violation": "halt_and_report",
                "on_miss": "halt",
                "on_missing_required_path": "halt_and_report",
                "on_soft_misalignment": "auto_fix_and_continue"
              },
              "guards": {
                "desc_repetition": {
                  "global_max": 5,
                  "max_repeat": 3,
                  "window": 200
                }
              },
              "hitl_contract": {
                "gpt_tasks": [],
                "user_tasks": []
              },
              "inputs": [
                "draft.title",
                "keywords.focus[]",
                "keywords.supporting[]",
                "product.info{}",
                "shop.profile{}"
              ],
              "inputs_contract": {
                "required_paths": [
                  "/workflow_patches/steps/10/outputs/title",
                  "/workflow_patches/steps/9/outputs/refined_keywords"
                ],
                "schema": {
                  "refined_keywords": {
                    "min_items": 10,
                    "type": "array"
                  },
                  "title": {
                    "max_len": 140,
                    "min_len": 20,
                    "type": "string"
                  }
                }
              },
              "name": "Açıklama (Description)",
              "outputs": [
                "description.final"
              ],
              "preconditions": {
                "critical_pass": {
                  "require_ancestors_done": [
                    "0",
                    "1",
                    "3",
                    "6",
                    "16"
                  ]
                },
                "title_required": "/workflow_patches/steps/10/outputs/title"
              },
              "requires": [
                "10"
              ],
              "rules": [
                "length: 300-500 words",
                "paragraphs: 2-5",
                "first sentence includes focus_1 naturally",
                "structure: intro (focus+benefit) -> product details (material, stone, size, options) -> occasion/usage -> care/durability -> shipping/store trust",
                "2-3 supporting keywords included naturally",
                "no stuffing, no duplicate roots",
                "forbidden terms: ['Turkey','Istanbul']"
              ],
              "ruleset": [
                {
                  "id": "DESC_WORDCOUNT_RANGE",
                  "params": {
                    "max": 500,
                    "min": 300
                  }
                },
                {
                  "id": "DESC_PARAGRAPHS_RANGE",
                  "params": {
                    "max": 5,
                    "min": 2
                  }
                },
                {
                  "id": "DESC_OPENING_HAS_FOCUS",
                  "params": {
                    "required": true
                  }
                },
                {
                  "id": "DESC_SUPPORTS_USED_RANGE",
                  "params": {
                    "max": 3,
                    "min": 2
                  }
                },
                {
                  "id": "DESC_FORBIDDEN_TERMS",
                  "params": {
                    "terms": [
                      "Turkey",
                      "Istanbul"
                    ]
                  }
                },
                {
                  "id": "DESC_NO_STUFFING_ROOTDUP",
                  "params": {
                    "enforced": true
                  }
                },
                {
                  "id": "PRODUCT_RECORD_CONFIRMED_REQUIRED",
                  "params": {
                    "source": "product_record",
                    "status": "CONFIRMED"
                  }
                }
              ],
              "title": "Açıklama (Description)",
              "upstream_signature": {
                "depends_on": [
                  "/workflow_patches/steps/10/outputs/title",
                  "/workflow_patches/steps/9/outputs/refined_keywords"
                ],
                "on_change": "invalidate_and_rerun"
              },
              "validations": {
                "present": true
              }
            },
            "12": {
              "constraints": {
                "must_confirm": false,
                "no_skip": true,
                "require_gpt_task": false,
                "require_user_task": false,
                "require_validations_pass": false
              },
              "description": "SEO, ürün attribute ve mağaza sesi yansıtan 13/13 benzersiz etiket seti oluşturulur.",
              "flow": {
                "guard": {
                  "advance_only_if": []
                }
              },
              "gates": {
                "must": [
                  "validations_ok"
                ],
                "on_contract_violation": "halt_and_report",
                "on_miss": "halt",
                "on_missing_required_path": "halt_and_report",
                "on_soft_misalignment": "auto_fix_and_continue"
              },
              "guards": {
                "tags": {
                  "count": 13,
                  "no_duplicate_roots": true,
                  "unique": true
                }
              },
              "hitl_contract": {
                "gpt_tasks": [],
                "user_tasks": []
              },
              "inputs": [
                "keywords.focus[]",
                "keywords.supporting[]",
                "product.info{}",
                "shop.profile{}"
              ],
              "inputs_contract": {
                "required_paths": [
                  "/workflow_patches/steps/11/outputs/description",
                  "/workflow_patches/steps/9/outputs/refined_keywords"
                ],
                "schema": {
                  "tags": {
                    "min_items": 10,
                    "type": "array"
                  }
                }
              },
              "name": "Etiketler (Tags)",
              "outputs": [
                "tags.final[13]"
              ],
              "preconditions": {
                "critical_pass": {
                  "require_ancestors_done": [
                    "0",
                    "1",
                    "3",
                    "6",
                    "16"
                  ]
                },
                "desc_required": "/workflow_patches/steps/11/outputs/description",
                "title_required": "/workflow_patches/steps/10/outputs/title"
              },
              "requires": [
                "11"
              ],
              "rules": [
                "exactly 13 unique tags",
                "distribution: 4-5 SEO/high-volume, 3-4 product attributes, 2-3 occasion/audience, 1-2 brand voice",
                "no duplicate roots, no attr/category duplicates",
                "negatives forbidden: ['DIY','free','tutorial','plated*','kit','supplies','raw*']",
                "forbidden terms: ['Turkey','Istanbul']"
              ],
              "ruleset": [
                {
                  "id": "TAGS_COUNT_13",
                  "params": {
                    "count": 13
                  }
                },
                {
                  "id": "TAGS_UNIQUE",
                  "params": {
                    "required": true
                  }
                },
                {
                  "id": "SEGMENT_DIVERSITY_MIN",
                  "params": {
                    "min": 3
                  }
                },
                {
                  "id": "NO_ATTR_DUPLICATES",
                  "params": {
                    "required": true
                  }
                },
                {
                  "id": "SAME_ROOT_LIMIT",
                  "params": {
                    "max": 1
                  }
                },
                {
                  "id": "TAGS_FORBIDDEN_TERMS",
                  "params": {
                    "terms": [
                      "Turkey",
                      "Istanbul"
                    ]
                  }
                },
                {
                  "id": "NEGATIVE_TERMS",
                  "params": {
                    "terms": [
                      "DIY",
                      "free",
                      "tutorial",
                      "plated*",
                      "kit",
                      "supplies",
                      "raw*"
                    ]
                  }
                },
                {
                  "id": "PRODUCT_RECORD_CONFIRMED_REQUIRED",
                  "params": {
                    "source": "product_record",
                    "status": "CONFIRMED"
                  }
                }
              ],
              "soft_influences": {
                "from": [
                  "/workflow_patches/steps/8a/outputs/ads_keywords"
                ],
                "policy": "warn_if_misaligned_topN",
                "topN": 10
              },
              "title": "Etiketler (Tags)",
              "upstream_signature": {
                "depends_on": [
                  "/workflow_patches/steps/11/outputs/description",
                  "/workflow_patches/steps/10/outputs/title",
                  "/workflow_patches/steps/9/outputs/refined_keywords",
                  "/workflow_patches/steps/8a/outputs/ads_keywords"
                ],
                "on_change": "invalidate_and_rerun"
              },
              "validations": {
                "present": true
              }
            },
            "13": {
              "constraints": {
                "must_confirm": false,
                "no_skip": true,
                "require_gpt_task": false,
                "require_user_task": false,
                "require_validations_pass": false
              },
              "flow": {
                "guard": {
                  "advance_only_if": []
                }
              },
              "gates": {
                "must": [
                  "validations_ok"
                ],
                "on_contract_violation": "halt_and_report",
                "on_miss": "halt",
                "on_missing_required_path": "halt_and_report",
                "on_soft_misalignment": "warn_and_continue"
              },
              "label": "Görsel QC (moved to 1a, kept as background)",
              "preconditions": {
                "critical_pass": {
                  "require_ancestors_done": [
                    "0",
                    "1",
                    "3",
                    "6",
                    "16"
                  ]
                }
              },
              "status": "background_only",
              "upstream_signature": {
                "policy": "mark_stale_on_upstream_change"
              },
              "validations": {
                "present": true
              }
            },
            "14": {
              "constraints": {
                "must_confirm": false,
                "no_skip": true,
                "require_gpt_task": false,
                "require_user_task": false,
                "require_validations_pass": false,
                "status_values": [
                  "PASS",
                  "WARN",
                  "FAIL"
                ]
              },
              "description": "Başlık, açıklama, etiketler ve görsellerin Etsy kuralları ve SEO/Ads stratejisi ile uyumunu denetler.",
              "flow": {
                "guard": {
                  "advance_only_if": []
                }
              },
              "gates": {
                "must": [
                  "validations_ok"
                ],
                "on_contract_violation": "halt_and_report",
                "on_miss": "halt",
                "on_missing_required_path": "halt_and_report",
                "on_soft_misalignment": "auto_fix_and_continue"
              },
              "hitl_contract": {
                "gpt_tasks": [],
                "user_tasks": []
              },
              "inputs": [
                "title.final",
                "description.final",
                "tags.final[13]",
                "media.checklist",
                "media.issues[]",
                "seo.keywords.focus[]",
                "seo.keywords.supporting[]",
                "ads.keywords.final[]"
              ],
              "name": "Uyumluluk Kontrolü (Compliance)",
              "outputs": [
                "compliance.report{}",
                "compliance.issues[]",
                "compliance.recommendations[]",
                "compliance.status"
              ],
              "preconditions": {
                "critical_pass": {
                  "require_ancestors_done": [
                    "0",
                    "1",
                    "3",
                    "6",
                    "16"
                  ]
                }
              },
              "requires": [
                "13"
              ],
              "rules": [
                "no banned terms (e.g., brand infringement, Rolex, Disney, etc.)",
                "no ALL CAPS, no spam, no misleading claims (e.g., 'free shipping')",
                "etsy policy compliance: handmade/vintage/supplies classification",
                "SEO-Ads consistency: no conflict between SEO focus/support and Ads plan",
                "visuals must align with attributes and tags",
                "negatives forbidden: ['DIY', 'free', 'tutorial', 'plated*', 'kit', 'supplies', 'raw*', 'Turkey', 'Istanbul']",
                "self_check.status must be PASS"
              ],
              "ruleset": [
                {
                  "id": "NO_BANNED_TERMS",
                  "params": {
                    "examples": [
                      "Rolex",
                      "Disney"
                    ]
                  }
                },
                {
                  "id": "NO_ALLCAPS_SPAM",
                  "params": {
                    "enforced": true
                  }
                },
                {
                  "id": "NO_MISLEADING_CLAIMS",
                  "params": {
                    "forbidden": [
                      "free shipping"
                    ]
                  }
                },
                {
                  "id": "ETSY_POLICY_COMPLIANCE",
                  "params": {
                    "required": true
                  }
                },
                {
                  "id": "SEO_ADS_CONSISTENCY",
                  "params": {
                    "required": true
                  }
                },
                {
                  "id": "VISUAL_ALIGNMENT",
                  "params": {
                    "required": true
                  }
                },
                {
                  "id": "NEGATIVE_TERMS",
                  "params": {
                    "terms": [
                      "DIY",
                      "free",
                      "tutorial",
                      "plated*",
                      "kit",
                      "supplies",
                      "raw*",
                      "Turkey",
                      "Istanbul"
                    ]
                  }
                },
                {
                  "id": "SPAM_BLOCKS_COMPLIANCE",
                  "params": {
                    "block_on": "BLOCK"
                  }
                },
                {
                  "id": "SELF_CHECK_PASS_REQUIRED",
                  "params": {
                    "status": "PASS"
                  }
                },
                {
                  "id": "PRODUCT_RECORD_CONFIRMED_REQUIRED",
                  "params": {
                    "source": "product_record",
                    "status": "CONFIRMED"
                  }
                },
                {
                  "id": "COUNTRY_POLICY_COMPLIANCE",
                  "params": {
                    "source": "governance.policy.country"
                  }
                }
              ],
              "title": "Uyumluluk Kontrolü (Compliance Check)",
              "upstream_signature": {
                "policy": "mark_stale_on_upstream_change"
              },
              "validations": {
                "present": true
              }
            },
            "15": {
              "constraints": {
                "must_confirm": false,
                "no_skip": true,
                "require_gpt_task": false,
                "require_user_task": false,
                "require_validations_pass": false,
                "status_values": [
                  "PASS",
                  "WARN",
                  "FAIL"
                ]
              },
              "description": "SEO focus/support kelimeleri ile Ads pozitif/negatif setlerini senkronize eder, final seti üretir.",
              "flow": {
                "guard": {
                  "advance_only_if": []
                }
              },
              "gates": {
                "must": [
                  "validations_ok"
                ],
                "on_contract_violation": "halt_and_report",
                "on_miss": "halt",
                "on_missing_required_path": "halt_and_report",
                "on_soft_misalignment": "auto_fix_and_continue"
              },
              "hitl_contract": {
                "gpt_tasks": [],
                "user_tasks": []
              },
              "inputs": [
                "seo.keywords.focus[]",
                "seo.keywords.supporting[]",
                "ads.keywords.final[]",
                "ads.negative_terms[]",
                "title.final",
                "description.final",
                "tags.final[13]",
                "compliance.status"
              ],
              "inputs_contract": {
                "required_paths": [
                  "/workflow_patches/steps/8a/outputs/ads_keywords",
                  "/workflow_patches/steps/9/outputs/refined_keywords"
                ],
                "schema": {
                  "ads_keywords": {
                    "min_items": 8,
                    "type": "array"
                  },
                  "refined_keywords": {
                    "min_items": 10,
                    "type": "array"
                  }
                }
              },
              "name": "Ads Entegrasyonu & Final Keyword Sync",
              "outputs": [
                "ads_sync.report{}",
                "ads_sync.issues[]",
                "ads_sync.final_positive[]",
                "ads_sync.final_negative[]",
                "ads_sync.status"
              ],
              "preconditions": {
                "ads_keywords_required": "/workflow_patches/steps/8a/outputs/ads_keywords",
                "critical_pass": {
                  "require_ancestors_done": [
                    "0",
                    "1",
                    "3",
                    "6",
                    "16"
                  ]
                },
                "refined_keywords_required": "/workflow_patches/steps/9/outputs/refined_keywords"
              },
              "requires": [
                "14"
              ],
              "rules": [
                "SEO vs Ads intersection: warn if no overlap",
                "remove SEO keywords that are in Ads negatives",
                "focus_1 must be present in Ads positives",
                "no title/tags keyword should appear in Ads negatives",
                "ads_sync.status = PASS if fully aligned, WARN/FAIL otherwise"
              ],
              "ruleset": [
                {
                  "id": "SEO_ADS_INTERSECTION_CHECK",
                  "params": {
                    "warn_if_empty": true
                  }
                },
                {
                  "id": "REMOVE_SEO_IF_IN_NEGATIVES",
                  "params": {
                    "enforced": true
                  }
                },
                {
                  "id": "FOCUS1_MUST_IN_ADS_POSITIVE",
                  "params": {
                    "required": true
                  }
                },
                {
                  "id": "NO_TITLE_TAGS_IN_ADS_NEGATIVES",
                  "params": {
                    "enforced": true
                  }
                },
                {
                  "id": "ADS_SYNC_STATUS_VALUES",
                  "params": {
                    "values": [
                      "PASS",
                      "WARN",
                      "FAIL"
                    ]
                  }
                },
                {
                  "id": "PRODUCT_RECORD_CONFIRMED_REQUIRED",
                  "params": {
                    "source": "product_record",
                    "status": "CONFIRMED"
                  }
                }
              ],
              "title": "Ads Entegrasyonu & Final Keyword Sync",
              "upstream_signature": {
                "depends_on": [
                  "/workflow_patches/steps/8a/outputs/ads_keywords",
                  "/workflow_patches/steps/9/outputs/refined_keywords"
                ],
                "on_change": "invalidate_and_rerun"
              },
              "validations": {
                "present": true
              }
            },
            "16": {
              "constraints": {
                "must_confirm": false,
                "no_skip": true,
                "require_gpt_task": false,
                "require_user_task": false,
                "require_validations_pass": false,
                "status_values": [
                  "PASS",
                  "WARN",
                  "FAIL"
                ]
              },
              "description": "Önceki adımlardan gelen tüm çıktıları birleştirerek yayına hazır tam ürün listing paketi oluşturur.",
              "flow": {
                "guard": {
                  "advance_only_if": []
                }
              },
              "gates": {
                "must": [
                  "validations_ok"
                ],
                "on_contract_violation": "halt_and_report",
                "on_miss": "halt",
                "on_missing_required_path": "halt_and_report",
                "on_soft_misalignment": "auto_fix_and_continue",
                "required_inputs": [
                  "title.final",
                  "description.final",
                  "tags.final[13]",
                  "media.checklist",
                  "compliance.status",
                  "ads_sync.status",
                  "seo.keywords.focus[]",
                  "seo.keywords.supporting[]",
                  "product.info{}",
                  "shop.profile{}"
                ]
              },
              "guards": {
                "final_check": "repetition_guard_enforced"
              },
              "hitl_contract": {
                "gpt_tasks": [],
                "user_tasks": []
              },
              "inputs": [
                "title.final",
                "description.final",
                "tags.final[13]",
                "media.checklist",
                "media.qc_report",
                "media.recommendations[]",
                "compliance.status",
                "compliance.issues[]",
                "ads_sync.final_positive[]",
                "ads_sync.final_negative[]",
                "ads_sync.status",
                "seo.keywords.focus[]",
                "seo.keywords.supporting[]",
                "product.info{}",
                "shop.profile{}"
              ],
              "name": "Final Listing Assembly / Publish Prep",
              "outputs": [
                "listing.final{}",
                "listing.issues[]",
                "listing.status",
                "listing.notes"
              ],
              "preconditions": {
                "critical_pass": {
                  "require_ancestors_done": [
                    "0",
                    "1",
                    "3",
                    "6",
                    "16"
                  ]
                }
              },
              "requires": [
                "10",
                "11",
                "12",
                "13",
                "14",
                "15"
              ],
              "rules": [
                "title length: 80-140 chars",
                "description length: 300-500 words, 2-5 paragraphs",
                "tags: 13 unique",
                "media: at least 5 required types (studio,lifestyle,scale,detail,packaging)",
                "compliance.status must be PASS to publish",
                "ads_sync.status PASS required for full Ads alignment (else WARN)",
                "attributes from product.info must appear in title/description/media",
                "shop.profile info (voice,shipping,gift) must appear in description end",
                "self_check.status must be PASS"
              ],
              "ruleset": [
                {
                  "id": "TITLE_LENGTH_RANGE",
                  "params": {
                    "max": 140,
                    "min": 80
                  }
                },
                {
                  "id": "DESC_WORDCOUNT_RANGE",
                  "params": {
                    "max": 500,
                    "min": 300
                  }
                },
                {
                  "id": "DESC_PARAGRAPHS_RANGE",
                  "params": {
                    "max": 5,
                    "min": 2
                  }
                },
                {
                  "id": "TAGS_COUNT_13",
                  "params": {
                    "count": 13
                  }
                },
                {
                  "id": "MEDIA_REQUIRED_TYPES",
                  "params": {
                    "min_count": 5,
                    "types": [
                      "studio",
                      "lifestyle",
                      "scale",
                      "detail",
                      "packaging"
                    ]
                  }
                },
                {
                  "id": "COMPLIANCE_PASS_REQUIRED",
                  "params": {
                    "status": "PASS"
                  }
                },
                {
                  "id": "ADS_SYNC_PASS_REQUIRED",
                  "params": {
                    "warn_if_not_pass": true
                  }
                },
                {
                  "id": "ATTRIBUTES_MUST_MATCH",
                  "params": {
                    "required": true
                  }
                },
                {
                  "id": "SHOP_PROFILE_INTEGRATION",
                  "params": {
                    "required": true
                  }
                },
                {
                  "id": "SPAM_BLOCKS_ASSEMBLY",
                  "params": {
                    "block_on": "BLOCK"
                  }
                },
                {
                  "id": "SELF_CHECK_PASS_REQUIRED",
                  "params": {
                    "status": "PASS"
                  }
                },
                {
                  "id": "PRODUCT_RECORD_CONFIRMED_REQUIRED",
                  "params": {
                    "source": "product_record",
                    "status": "CONFIRMED"
                  }
                }
              ],
              "title": "Final Listing Assembly / Publish Prep",
              "upstream_signature": {
                "policy": "mark_stale_on_upstream_change"
              },
              "validations": {
                "present": true
              }
            },
            "17": {
              "constraints": {
                "description_wordcount_range": {
                  "max": 500,
                  "min": 300
                },
                "media_min_count": 5,
                "min_attributes": [
                  "material"
                ],
                "min_shop_profile": [
                  "brand_voice"
                ],
                "must_confirm": false,
                "no_skip": true,
                "require_gpt_task": false,
                "require_record_type": "publish",
                "require_user_task": false,
                "require_validations_pass": false,
                "required_columns": [
                  "title",
                  "description",
                  "tags",
                  "media",
                  "status"
                ],
                "status_values": [
                  "PASS",
                  "WARN",
                  "FAIL"
                ],
                "tags_exact_count": 13
              },
              "description": "Listing.final çıktısını Office 2007 uyumlu CSV formatına dönüştürür.",
              "flow": {
                "guard": {
                  "advance_only_if": []
                }
              },
              "gates": {
                "must": [
                  "validations_ok"
                ],
                "on_contract_violation": "halt_and_report",
                "on_miss": "halt",
                "on_missing_required_path": "halt_and_report",
                "on_soft_misalignment": "warn_and_continue"
              },
              "hitl_contract": {
                "gpt_tasks": [],
                "user_tasks": []
              },
              "inputs": [
                "listing.final{}",
                "listing.status",
                "listing.notes"
              ],
              "inputs_contract": {
                "required_paths": [
                  "/workflow_patches/steps/16/outputs/listing",
                  "/workflow_patches/steps/10/outputs/title",
                  "/workflow_patches/steps/11/outputs/description",
                  "/workflow_patches/steps/12/outputs/tags"
                ],
                "schema": {
                  "export_row": {
                    "description": {
                      "max_words": 500,
                      "min_words": 300,
                      "type": "string"
                    },
                    "media": {
                      "min_items": 5,
                      "type": "array"
                    },
                    "tags": {
                      "min_items": 13,
                      "type": "array"
                    },
                    "title": {
                      "max_len": 140,
                      "min_len": 20,
                      "type": "string"
                    }
                  }
                }
              },
              "name": "Export CSV/Excel",
              "output_policy": {
                "display": "file_only",
                "format": [
                  "CSV",
                  "Excel"
                ]
              },
              "outputs": [
                "export.file_path",
                "export.sha256",
                "export.status",
                "export.notes"
              ],
              "preconditions": {
                "critical_pass": {
                  "require_ancestors_done": [
                    "0",
                    "1",
                    "3",
                    "6",
                    "16"
                  ]
                },
                "listing_ready": "/workflow_patches/steps/16/outputs/listing",
                "record_type_set": {
                  "in": [
                    "publish",
                    "draft",
                    "preview"
                  ],
                  "path": "/_run/record_type"
                }
              },
              "requires": [
                "16"
              ],
              "rules": [
                "format: CSV UTF-8, Office 2007 uyumlu",
                "row = 1 product",
                "columns: title, description, tags (comma-separated), media (comma-separated), attributes.*, shop_profile.*, status, notes",
                "no empty mandatory fields",
                "file name: listings_export_<timestamp>.csv",
                "compute SHA256 of file",
                "required columns: [title, description, tags, media, status]",
                "attributes: at least material",
                "shop_profile: at least brand_voice",
                "tags must be exactly 13 and unique",
                "media must be >=5 items, must include studio,lifestyle,scale,detail,packaging",
                "description wordcount: 300..500",
                "status must be PASS/WARN/FAIL",
                "csv quoting/escaping strict",
                "split tags and media into fixed columns optional",
                "produce export.report summary: row_count, empty_required_count, warn_rows, fail_rows, sample_issues",
                "fallback to last PASS export if hard failure",
                "self_check.status must be PASS"
              ],
              "ruleset": [
                {
                  "id": "EXPORT_FORMAT",
                  "params": {
                    "compat": "Office2007",
                    "encoding": "UTF-8",
                    "type": "CSV"
                  }
                },
                {
                  "id": "ROW_PER_PRODUCT",
                  "params": {
                    "enforced": true
                  }
                },
                {
                  "id": "EXPORT_COLUMNS",
                  "params": {
                    "list": [
                      "title",
                      "description",
                      "tags",
                      "media",
                      "attributes.*",
                      "shop_profile.*",
                      "status",
                      "notes"
                    ]
                  }
                },
                {
                  "id": "NO_EMPTY_MANDATORY_FIELDS",
                  "params": {
                    "enforced": true
                  }
                },
                {
                  "id": "FILENAME_PATTERN",
                  "params": {
                    "pattern": "listings_export_<timestamp>.csv"
                  }
                },
                {
                  "id": "SHA256_COMPUTE",
                  "params": {
                    "enforced": true
                  }
                },
                {
                  "id": "EXPORT_REQUIRED_COLUMNS",
                  "params": {
                    "columns": [
                      "title",
                      "description",
                      "tags",
                      "media",
                      "status"
                    ]
                  }
                },
                {
                  "id": "EXPORT_MIN_ATTRIBUTES",
                  "params": {
                    "attributes": [
                      "material"
                    ]
                  }
                },
                {
                  "id": "EXPORT_MIN_SHOP_PROFILE",
                  "params": {
                    "fields": [
                      "brand_voice"
                    ]
                  }
                },
                {
                  "id": "TAGS_COUNT_EXACT_13",
                  "params": {
                    "required": true
                  }
                },
                {
                  "id": "MEDIA_MIN_COUNT",
                  "params": {
                    "min": 5,
                    "required_types": [
                      "studio",
                      "lifestyle",
                      "scale",
                      "detail",
                      "packaging"
                    ]
                  }
                },
                {
                  "id": "DESCRIPTION_WORDCOUNT_RANGE",
                  "params": {
                    "max": 500,
                    "min": 300
                  }
                },
                {
                  "id": "EXPORT_STATUS_VALUES",
                  "params": {
                    "values": [
                      "PASS",
                      "WARN",
                      "FAIL"
                    ]
                  }
                },
                {
                  "id": "CSV_QUOTING_ESCAPING_STRICT",
                  "params": {
                    "required": true
                  }
                },
                {
                  "id": "SPLIT_TAGS_MEDIA_COLUMNS",
                  "params": {
                    "optional": true
                  }
                },
                {
                  "id": "EXPORT_REPORT_SUMMARY",
                  "params": {
                    "fields": [
                      "row_count",
                      "empty_required_count",
                      "warn_rows",
                      "fail_rows",
                      "sample_issues"
                    ]
                  }
                },
                {
                  "id": "EXPORT_FALLBACK_LAST_PASS",
                  "params": {
                    "enabled": true
                  }
                },
                {
                  "id": "NO_EMPTY_REQUIRED_FIELDS",
                  "params": {
                    "enforced": true,
                    "on_missing": "WARN"
                  }
                },
                {
                  "id": "COMPUTE_SHA256",
                  "params": {
                    "record_to": "export.sha256"
                  }
                },
                {
                  "id": "MEDIA_MIN_COUNT_5",
                  "params": {
                    "min": 5,
                    "validate_url_or_filename": true
                  }
                },
                {
                  "id": "EXPORT_SPAM_STATUS_POLICY",
                  "params": {
                    "allowed": [
                      "PASS",
                      "WARN"
                    ]
                  }
                },
                {
                  "id": "SELF_CHECK_PASS_REQUIRED",
                  "params": {
                    "status": "PASS"
                  }
                },
                {
                  "id": "PRODUCT_RECORD_CONFIRMED_REQUIRED",
                  "params": {
                    "source": "product_record",
                    "status": "CONFIRMED"
                  }
                }
              ],
              "title": "Export CSV",
              "upstream_signature": {
                "depends_on": [
                  "/workflow_patches/steps/16/outputs/listing",
                  "/workflow_patches/steps/10/outputs/title",
                  "/workflow_patches/steps/11/outputs/description",
                  "/workflow_patches/steps/12/outputs/tags"
                ],
                "on_change": "reexport"
              },
              "validations": {
                "present": true
              }
            },
            "18": {
              "constraints": {
                "must_confirm": false,
                "no_skip": true,
                "require_gpt_task": false,
                "require_record_type": "publish",
                "require_user_task": false,
                "require_validations_pass": false,
                "status_values": [
                  "READY",
                  "WARN",
                  "BLOCK"
                ]
              },
              "description": "Etsy'ye yükleme öncesi go/no-go kontrol listesi ve son onay.",
              "flow": {
                "guard": {
                  "advance_only_if": []
                }
              },
              "gates": {
                "must": [
                  "validations_ok"
                ],
                "on_contract_violation": "halt_and_report",
                "on_manifest_mismatch": "halt_and_report",
                "on_miss": "halt",
                "on_missing_required_path": "halt_and_report",
                "on_soft_misalignment": "auto_fix_and_continue"
              },
              "hitl_contract": {
                "gpt_tasks": [],
                "user_tasks": []
              },
              "inputs": [
                "listing.final{}",
                "listing.status",
                "export.file_path",
                "export.sha256",
                "compliance.status",
                "ads_sync.status"
              ],
              "inputs_contract": {
                "required_paths": [
                  "/workflow_patches/steps/17/outputs/files"
                ],
                "schema": {
                  "files": {
                    "min_items": 1,
                    "type": "array"
                  }
                }
              },
              "manifest": {
                "policy": "hash_and_compare",
                "required_paths": [
                  "/workflow_patches/steps/10/outputs/title",
                  "/workflow_patches/steps/11/outputs/description",
                  "/workflow_patches/steps/12/outputs/tags",
                  "/workflow_patches/steps/16/outputs/listing",
                  "/workflow_patches/steps/17/outputs/files"
                ]
              },
              "name": "Publish Checklist",
              "outputs": [
                "publish.checklist{}",
                "publish.status",
                "publish.notes"
              ],
              "preconditions": {
                "critical_pass": {
                  "require_ancestors_done": [
                    "0",
                    "1",
                    "3",
                    "6",
                    "16"
                  ]
                },
                "export_files_exist": "/workflow_patches/steps/17/outputs/files"
              },
              "requires": [
                "17"
              ],
              "rules": [
                "listing.status must be PASS",
                "export.file_path must exist and export.sha256 present",
                "compliance.status must be PASS (else BLOCK)",
                "ads_sync.status PASS preferred; if WARN -> checklist WARN, if FAIL -> BLOCK",
                "self_check.status must be PASS"
              ],
              "ruleset": [
                {
                  "id": "LISTING_PASS_REQUIRED",
                  "params": {
                    "status": "PASS"
                  }
                },
                {
                  "id": "EXPORT_FILE_AND_HASH_REQUIRED",
                  "params": {
                    "required": true
                  }
                },
                {
                  "id": "COMPLIANCE_PASS_REQUIRED",
                  "params": {
                    "status": "PASS"
                  }
                },
                {
                  "id": "ADS_SYNC_STATUS_POLICY",
                  "params": {
                    "fail": "BLOCK",
                    "pass": "READY",
                    "warn": "WARN"
                  }
                },
                {
                  "id": "PUBLISH_STATUS_VALUES",
                  "params": {
                    "values": [
                      "READY",
                      "WARN",
                      "BLOCK"
                    ]
                  }
                },
                {
                  "id": "SELF_CHECK_PASS_REQUIRED",
                  "params": {
                    "status": "PASS"
                  }
                }
              ],
              "title": "Publish Checklist",
              "upstream_signature": {
                "depends_on": [
                  "/workflow_patches/steps/17/outputs/files"
                ],
                "on_change": "recheck"
              },
              "validations": {
                "present": true
              }
            },
            "18a": {
              "constraints": {
                "must_confirm": true,
                "no_skip": true
              },
              "enabled": false,
              "gates": {
                "must": [
                  "validations_ok"
                ],
                "on_contract_violation": "halt_and_report",
                "on_missing_required_path": "halt_and_report",
                "on_soft_misalignment": "warn_and_continue"
              },
              "gpt_task": {
                "check": [
                  "step14.pass==true",
                  "step16.ready==true",
                  "step17.files_ready==true",
                  "step18.checklist_pass==true"
                ]
              },
              "id": "18a",
              "notes": {
                "lifecycle": "manifest-disabled"
              },
              "outputs": {
                "decision_at": null,
                "decision_by": "",
                "publish_go": false,
                "reason_if_no_go": ""
              },
              "preconditions": {
                "critical_pass": {
                  "require_ancestors_done": [
                    "0",
                    "1",
                    "3",
                    "6",
                    "16"
                  ]
                },
                "parent_defined": {
                  "exists": true,
                  "path": "/workflow_patches/steps/18"
                }
              },
              "title": "Publish Go/No-Go",
              "ui": {
                "hidden": true
              },
              "upstream_signature": {
                "policy": "mark_stale_on_upstream_change"
              },
              "user_task": {
                "confirm": "outputs.publish_go"
              },
              "validations": {
                "all_prior_ok": true
              }
            },
            "19": {
              "constraints": {
                "must_confirm": false,
                "no_skip": true,
                "require_gpt_task": false,
                "require_user_task": false,
                "require_validations_pass": false
              },
              "description": "Yayın sonrası 14–30 gün performans takibi ve aksiyon sinyalleri (Ads + SEO).",
              "flow": {
                "guard": {
                  "advance_only_if": []
                }
              },
              "gates": {
                "must": [
                  "validations_ok"
                ],
                "on_contract_violation": "halt_and_report",
                "on_miss": "halt",
                "on_missing_required_path": "halt_and_report",
                "on_soft_misalignment": "auto_fix_and_continue"
              },
              "hitl_contract": {
                "gpt_tasks": [],
                "user_tasks": []
              },
              "inputs": [
                "metrics.ads{ctr,roas,orders,cpc,spend}",
                "metrics.seo{impressions,visits,orders,conv_rate}",
                "ab_test.plan",
                "ads.plan{}",
                "ads_sync.final_positive[]",
                "ads_sync.final_negative[]"
              ],
              "name": "Monitoring",
              "outputs": [
                "monitoring.report{}",
                "monitoring.issues[]",
                "monitoring.recommendations[]"
              ],
              "preconditions": {
                "critical_pass": {
                  "require_ancestors_done": [
                    "0",
                    "1",
                    "3",
                    "6",
                    "16"
                  ]
                }
              },
              "requires": [
                "18"
              ],
              "rules": [
                "window_days: 14..30",
                "warn if CTR < 1.0% or ROAS < 1.0",
                "boost if Orders >= 3 and ROAS >= target",
                "pause if Clicks >= 20 and ROAS < 1.0",
                "produce actionable recommendations per AdGroup/keyword"
              ],
              "ruleset": [
                {
                  "id": "MONITORING_WINDOW_DAYS",
                  "params": {
                    "max": 30,
                    "min": 14
                  }
                },
                {
                  "id": "WARN_THRESHOLDS",
                  "params": {
                    "ctr_lt": 0.01,
                    "roas_lt": 1.0
                  }
                },
                {
                  "id": "BOOST_RULE",
                  "params": {
                    "orders_gte": 3,
                    "roas_gte": "target"
                  }
                },
                {
                  "id": "PAUSE_RULE",
                  "params": {
                    "clicks_gte": 20,
                    "roas_lt": 1.0
                  }
                },
                {
                  "id": "ACTIONABLE_PER_GROUP",
                  "params": {
                    "required": true
                  }
                }
              ],
              "title": "Monitoring",
              "upstream_signature": {
                "policy": "mark_stale_on_upstream_change"
              },
              "validations": {
                "present": true
              }
            },
            "1a": {
              "advisory_pack": {
                "hero_thumbnail": {
                  "block": false,
                  "rules": {
                    "no_text_overlay": true,
                    "plain_bg_preferred": true,
                    "subject_fill_min": 0.7
                  },
                  "severity": "advisory"
                },
                "metrics_binding": {
                  "block": false,
                  "capture": [
                    "ctr",
                    "engagement"
                  ],
                  "improvement_note_required": true,
                  "severity": "advisory"
                },
                "scale_photo": {
                  "block": false,
                  "rules": {
                    "must_include_scale_indicator": true
                  },
                  "severity": "advisory"
                },
                "seo_context_photo": {
                  "block": false,
                  "rules": {
                    "must_include_context": [
                      "wedding",
                      "gift",
                      "everyday"
                    ]
                  },
                  "severity": "advisory"
                },
                "video_quality": {
                  "block": false,
                  "rules": {
                    "duration_seconds": {
                      "max": 15,
                      "min": 5
                    },
                    "motion": "minimal",
                    "show_scale": true
                  },
                  "severity": "advisory"
                }
              },
              "constraints": {
                "must_confirm": false,
                "no_skip": true,
                "require_gpt_task": false,
                "require_user_task": false,
                "require_validations_pass": false
              },
              "description": "Ürün görselleri ve (varsa) video; kalite, set bütünlüğü ve SEO uyumu açısından kontrol edilir. Çıktı yalnızca rapordur; görseller otomatik değiştirilmez.",
              "flow": {
                "guard": {
                  "advance_only_if": []
                }
              },
              "gates": {
                "must": [
                  "validations_ok"
                ],
                "on_contract_violation": "halt_and_report",
                "on_miss": "halt",
                "on_missing_required_path": "halt_and_report",
                "on_soft_misalignment": "warn_and_continue"
              },
              "governance": {
                "notes_required": true,
                "qc_checklist": [
                  "has_studio",
                  "has_lifestyle",
                  "has_scale",
                  "has_detail",
                  "has_packaging",
                  "resolution_ok",
                  "background_ok",
                  "lighting_ok",
                  "set_consistent",
                  "seo_context_ok",
                  "attribute_truth_ok",
                  "no_watermark_or_heavy_text",
                  "no_blurry_lowres"
                ]
              },
              "guards": {
                "first_image_ctr_check": true,
                "image_count": {
                  "block_on_fail": false,
                  "min_required": 8,
                  "note": "Üretim durmasın, sadece WARN verilsin",
                  "severity": "warn"
                },
                "image_variety": [
                  "closeup",
                  "usage",
                  "variations",
                  "packaging"
                ],
                "video_required": true
              },
              "hitl_contract": {
                "gpt_tasks": [],
                "user_tasks": []
              },
              "inputs": [
                "product.photos[]",
                "product.video?",
                "draft.title",
                "draft.description",
                "draft.tags[13]",
                "seo.keywords.focus[]",
                "seo.keywords.supporting[]"
              ],
              "name": "Görsel Analiz (+13 SEO Uyumu, arka planda)",
              "outputs": [
                "media.checklist",
                "media.issues[]",
                "media.recommendations[]",
                "media.qc_report"
              ],
              "preconditions": {
                "critical_pass": {
                  "require_ancestors_done": [
                    "0",
                    "1",
                    "3",
                    "6",
                    "16"
                  ]
                },
                "parent_defined": {
                  "exists": true,
                  "path": "/workflow_patches/steps/1"
                }
              },
              "requires": [
                "1"
              ],
              "rules": [
                "required_photos: [studio, lifestyle, scale, detail, packaging]",
                "optional_video: true (360° veya kullanım sahnesi)",
                "min_resolution: 2000x2000 (kare tercih)",
                "background: clean/consistent (white/soft preferred)",
                "lighting: true colors, minimal harsh shadows",
                "set_consistency: same tone/lighting across photos",
                "seo_alignment: at least one image reflects focus_1 context (e.g., wedding, gift)",
                "attribute_truth: images must reflect mentioned attributes (e.g., gemstone=color)",
                "negatives_forbidden: [watermark, heavy text overlays, blurry/low-res]"
              ],
              "ruleset": [
                {
                  "id": "PRODUCT_RECORD_CONFIRMED_REQUIRED",
                  "params": {
                    "source": "product_record",
                    "status": "CONFIRMED"
                  }
                }
              ],
              "title": "Görsel Analiz & SEO Uyumu",
              "upstream_signature": {
                "policy": "mark_stale_on_upstream_change"
              },
              "validations": {
                "present": true
              }
            },
            "1b": {
              "constraints": {
                "dedupe": {
                  "case_insensitive": true,
                  "exact_match": true,
                  "normalize_diacritics": true,
                  "semantic_diversity_required": true,
                  "semantic_similarity_threshold": 0.85
                },
                "exact_words_per_query": 2,
                "min_segments": 3,
                "must_confirm": false,
                "no_skip": true,
                "optional_segments": [
                  "gemstone",
                  "style_aesthetic",
                  "color_tone",
                  "price_intent"
                ],
                "require_gpt_task": false,
                "require_user_task": false,
                "require_validations_pass": false,
                "required_segments": [
                  "material_finish",
                  "use_case_occasion",
                  "audience_gift"
                ],
                "total_queries": 8
              },
              "description": "Bu adım, Alura'dan indirilecek CSV'lerin kalitesini belirleyen 8 adet, her biri 2 kelimeden oluşan çekirdek sorguları üretir.",
              "examples": {
                "invalid": [
                  "silver plated",
                  "free tutorial",
                  "bracelet bracelet",
                  "ring"
                ],
                "valid": [
                  "gold bracelet",
                  "dainty necklace",
                  "mom gift",
                  "wedding ring",
                  "opal ring",
                  "gothic jewelry",
                  "black earrings",
                  "luxury bracelet"
                ]
              },
              "flow": {
                "guard": {
                  "advance_only_if": []
                }
              },
              "gates": {
                "must": [
                  "validations_ok"
                ],
                "on_contract_violation": "halt_and_report",
                "on_miss": "halt",
                "on_missing_required_path": "halt_and_report",
                "on_soft_misalignment": "warn_and_continue"
              },
              "hitl_contract": {
                "gpt_tasks": [
                  "2 kelimelik 8 farklı arama önerisi üret, tür çeşitliliği koru."
                ],
                "user_tasks": []
              },
              "name": "Arama Önerileri",
              "negative_filters": [
                "DIY",
                "free",
                "tutorial",
                "plated* (silver/gold plated/kf)",
                "kit",
                "supplies",
                "raw*"
              ],
              "outputs": [
                "alura.search_suggestions[8]",
                "alura.segments_coverage",
                "alura.rejection_reasons[]",
                "alura.selection_notes"
              ],
              "policy_ref": "_profiles.gpt_prod_executor_v1.languages.rules.search_suggestions_1b",
              "preconditions": {
                "critical_pass": {
                  "require_ancestors_done": [
                    "0",
                    "1",
                    "3",
                    "6",
                    "16"
                  ]
                },
                "parent_defined": {
                  "exists": true,
                  "path": "/workflow_patches/steps/1"
                }
              },
              "quality_filters": {
                "alura_score_min": 70,
                "competition_max": "Medium",
                "conversion_rate_min": 0.015,
                "fallback_policy": "Eşik altı ama stratejik niş sorgular gerekçelendirilirse (notes.reason) en fazla 2 adet dahil edilebilir."
              },
              "requires": [
                "1a"
              ],
              "ruleset": [
                {
                  "id": "ALURA_TOTAL_QUERIES",
                  "params": {
                    "count": 8
                  }
                },
                {
                  "id": "ALURA_EXACT_WORDS_PER_QUERY",
                  "params": {
                    "count": 2
                  }
                },
                {
                  "id": "ALURA_MIN_SEGMENTS",
                  "params": {
                    "count": 3
                  }
                },
                {
                  "id": "ALURA_QUALITY_THRESHOLDS",
                  "params": {
                    "competition_max": "Medium",
                    "conv_min": 0.015,
                    "score_min": 70
                  }
                },
                {
                  "id": "ALURA_DEDUPE",
                  "params": {
                    "case_insensitive": true,
                    "normalize_diacritics": true,
                    "semantic_threshold": 0.85
                  }
                },
                {
                  "id": "ALURA_NEGATIVE_TERMS",
                  "params": {
                    "terms": [
                      "DIY",
                      "free",
                      "tutorial",
                      "plated*",
                      "kit",
                      "supplies",
                      "raw*"
                    ]
                  }
                },
                {
                  "id": "NO_DERIVATION",
                  "params": {
                    "enforced": true
                  }
                },
                {
                  "id": "PRODUCT_RECORD_CONFIRMED_REQUIRED",
                  "params": {
                    "source": "product_record",
                    "status": "CONFIRMED"
                  }
                }
              ],
              "selection_policy": [
                "Her segmentten en az 1 öneri; toplamda min 3 segment kapsanmalı.",
                "1-2 öneri yüksek hacim (pop), 2-3 öneri long-tail; geri kalanı dengeli karma.",
                "Aynı kökten gelen varyasyonlar (ör. gold bracelet ~ dainty gold bracelet) 1 öneriyle sınırlandırılır."
              ],
              "title": "Alura Arama Önerileri (8 adet, 2 kelime, çeşitlilik odaklı)",
              "ui": {
                "instructions": "8 öneri üret: her biri tam 2 kelime, tekrar yok, kategori çeşitliliği yüksek."
              },
              "upstream_signature": {
                "policy": "mark_stale_on_upstream_change"
              },
              "uses": "suggestions/image",
              "validations": {
                "present": true
              }
            },
            "20": {
              "constraints": {
                "must_confirm": false,
                "no_skip": true,
                "require_gpt_task": false,
                "require_user_task": false,
                "require_validations_pass": false
              },
              "description": "Sürüm geçmişi, onaylar, checkpointler ve rollback noktalarının denetimi.",
              "flow": {
                "guard": {
                  "advance_only_if": []
                }
              },
              "gates": {
                "must": [
                  "validations_ok"
                ],
                "on_contract_violation": "halt_and_report",
                "on_miss": "halt",
                "on_missing_required_path": "halt_and_report",
                "on_soft_misalignment": "auto_fix_and_continue"
              },
              "hitl_contract": {
                "gpt_tasks": [],
                "user_tasks": []
              },
              "inputs": [
                "workflow_patches.metadata",
                "workflow_patches.governance"
              ],
              "name": "Audit",
              "notes": {
                "include": [
                  "_run.record_type"
                ]
              },
              "outputs": [
                "audit.report{}",
                "audit.findings[]",
                "audit.rollback_points[]"
              ],
              "preconditions": {
                "critical_pass": {
                  "require_ancestors_done": [
                    "0",
                    "1",
                    "3",
                    "6",
                    "16"
                  ]
                }
              },
              "requires": [
                "19"
              ],
              "rules": [
                "each patch must have patch_note_tr",
                "every 5th patch must record a checkpoint in version history (if enabled)",
                "ruleset_hash must be present and consistent",
                "produce rollback points and audit findings"
              ],
              "ruleset": [
                {
                  "id": "PATCH_NOTE_REQUIRED",
                  "params": {
                    "field": "patch_note_tr"
                  }
                },
                {
                  "id": "CHECKPOINT_EVERY_5",
                  "params": {
                    "enabled": true
                  }
                },
                {
                  "id": "RULESET_HASH_REQUIRED",
                  "params": {
                    "field": "ruleset_hash"
                  }
                },
                {
                  "id": "ROLLBACK_POINTS_PRODUCE",
                  "params": {
                    "required": true
                  }
                }
              ],
              "title": "Audit",
              "upstream_signature": {
                "policy": "mark_stale_on_upstream_change"
              },
              "validations": {
                "present": true
              }
            },
            "3": {
              "artifacts": [
                "alura.load.report.json"
              ],
              "constraints": {
                "must_confirm": true,
                "no_skip": true,
                "require_gpt_task": false,
                "require_user_task": false,
                "require_validations_pass": true
              },
              "description": "Alura/benzeri kaynaklardan 8 adet CSV yüklenir. Kolon adları normalize edilir; satır ve dil filtreleri uygulanır; temel metrikler hesaplanır.",
              "example": {
                "header": [
                  "Keyword",
                  "Search volume",
                  "3mo. change",
                  "Competition",
                  "Sales",
                  "Score",
                  "undefined",
                  "Search to competition ratio",
                  "Google top of page bid (low range)",
                  "Long-tail keyword",
                  "Listing age",
                  "Length",
                  "Google top of page bid (high range)",
                  "Google CPC",
                  "Google competition level",
                  "Google competition index",
                  "Etsy tag",
                  "Conversion rate",
                  "Competition level",
                  "Sales per listing",
                  "Annual search trend"
                ],
                "row": [
                  "promise ring",
                  "550000",
                  "-6%",
                  "626301",
                  "1201509",
                  "60",
                  "",
                  "0.88",
                  "34",
                  "Yes",
                  "334 days",
                  "12",
                  "153",
                  "94",
                  "Low",
                  "100",
                  "Yes",
                  "1.05%",
                  "Very high",
                  "48",
                  "-33%"
                ]
              },
              "flow": {
                "guard": {
                  "advance_only_if": []
                },
                "on_fail": "halt",
                "on_success_next": "3a"
              },
              "gates": {
                "must": [
                  "validations_ok"
                ],
                "on_contract_violation": "halt_and_report",
                "on_miss": "halt",
                "on_missing_required_path": "halt_and_report",
                "on_soft_misalignment": "warn_and_continue"
              },
              "guards": {
                "analysis_blocked_until": "pre.csv.report.status==PASS",
                "require_preprocess_pass": true
              },
              "hitl_contract": {
                "gpt_tasks": [],
                "user_tasks": []
              },
              "id": "3",
              "input_prep": {
                "apply_common": true,
                "enabled": true,
                "enforce": true,
                "on_fail": "halt",
                "profile_ref": "similar_keywords"
              },
              "inputs": [
                "alura.csv[8]"
              ],
              "label": "Similar CSV Yükleme (Sessiz Önişleme)",
              "name": "Similar CSV Yükleme",
              "next": [
                "3a"
              ],
              "on_error": {
                "fallback_next": [],
                "policy": "fail-fast"
              },
              "outputs": [
                "alura.csv[8]",
                "alura.metrics"
              ],
              "params": {
                "allow_missing": false,
                "expected_files": 8,
                "language": "auto",
                "normalize_columns": true
              },
              "parsing": {
                "allow_extra_headers": true,
                "cast_all_as_text": true,
                "dedupe": {
                  "case_insensitive": true,
                  "diacritics_insensitive": true,
                  "enabled": true
                },
                "encodings_priority": [
                  "utf-8",
                  "ISO-8859-1",
                  "cp1254",
                  "cp1252"
                ],
                "header_aliases": [
                  "Keyword",
                  "query",
                  "search_term"
                ],
                "ignore_header_order": true,
                "normalize": {
                  "case_insensitive": true,
                  "collapse_spaces": true,
                  "diacritics_insensitive": true,
                  "trim_whitespace": true
                },
                "primary_field": "query",
                "quote_mode": "relaxed",
                "value_handling": {
                  "cast_all_as_text": true,
                  "normalize_yes_no": true,
                  "treat_empty_as_valid": true,
                  "treat_nan_as_empty": true
                }
              },
              "post": {
                "only_signal_ready": true,
                "signal": "similar_ready"
              },
              "pre": {
                "run_preprocessing": true,
                "silent": true
              },
              "preconditions": {
                "critical_pass": {
                  "require_ancestors_done": [
                    "0",
                    "1",
                    "3",
                    "6",
                    "16"
                  ]
                }
              },
              "preprocess": {
                "dialect": {
                  "delimiter": ",",
                  "doublequote": true,
                  "escapechar": null,
                  "lineterminator": "auto",
                  "quotechar": "\""
                },
                "encoding": [
                  "utf-8-sig",
                  "utf-8",
                  "latin1"
                ],
                "header_map": {
                  "3mo. change": [
                    "3mo change",
                    "3 mo change",
                    "3-month change"
                  ]
                },
                "id": "csv_normalize_v2",
                "integrity": {
                  "header_strict": true,
                  "max_repaired_per_file": 50,
                  "reject_if_any_rowlen_mismatch_after_repair": true,
                  "repair_strategy": "merge_split_fields_if_quoted_else_reject",
                  "row_len_must_equal_header": true
                },
                "normalize": {
                  "cast_all_as_text": true,
                  "do_not_invent_nan": true,
                  "keep_default_na": false,
                  "na_filter": false,
                  "preserve_empty_strings": true,
                  "strip_bom": true,
                  "trim_whitespace": false
                },
                "outputs": {
                  "header": "pre.csv.header",
                  "report": "pre.csv.report",
                  "row_count": "pre.csv.rows",
                  "table": "pre.csv.table"
                }
              },
              "requires": [
                "0a"
              ],
              "suggestion_mode": "suppress",
              "title": "Similar CSV Yükleme (8 adet)",
              "type": "upload_csv",
              "ui": {
                "accept": [
                  ".csv"
                ],
                "help": "Header esnek: Keyword | query | search_term. Ek sütunlar serbest; NaN/boş/Yes/No kabul.",
                "max_files": 10,
                "min_files": 1,
                "title": "Similar Keywords CSV"
              },
              "upstream_signature": {
                "policy": "mark_stale_on_upstream_change"
              },
              "validations": {
                "file_count": "=8",
                "required_columns": [
                  "keyword",
                  "search_volume?"
                ]
              },
              "value_handling": {
                "cast_all_as_text": true,
                "treat_empty_as_valid": true,
                "treat_nan_as_empty": false
              }
            },
            "3a": {
              "can_revise_after": [
                "4",
                "5a",
                "5b"
              ],
              "constraints": {
                "max_same_root_in_top50": 3,
                "min_pool_size": 100,
                "must_confirm": false,
                "no_derivation": true,
                "no_skip": true,
                "require_gpt_task": false,
                "require_user_task": false,
                "require_validations_pass": false,
                "semantic_similarity_threshold": 0.85
              },
              "description": "Bu adımda herhangi bir türetim yapılmaz. 1b’de üretilen 8×2‑kelimelik arama önerisi ile indirilen 8 Alura CSV’sinden birleşik bir anahtar kelime havuzu oluşturulur; havuz çeşitlilik ve kalite kriterlerine göre temizlenir, birleştirilir ve önceliklendirilir. Ardından 1..4 numaralı odak anahtar kelimeler (geçici) belirlenir.",
              "display": {
                "hide": [
                  "tables",
                  "raw_rows",
                  "excel_like"
                ],
                "show": [
                  "text_summary",
                  "key_metrics"
                ]
              },
              "diversity": {
                "root_crowding": {
                  "equivalence": "case_insensitive_exact",
                  "max_per_root_in_top100": 3
                },
                "segment_cover_min": 3,
                "segments": {
                  "material": [
                    "gold",
                    "10k",
                    "14k",
                    "18k",
                    "yellow gold",
                    "white gold",
                    "rose gold"
                  ],
                  "setting": [
                    "bezel",
                    "flush",
                    "solitaire",
                    "channel",
                    "pavé",
                    "prong"
                  ],
                  "style": [
                    "minimalist",
                    "dainty",
                    "simple",
                    "thin",
                    "delicate",
                    "everyday"
                  ],
                  "usage": [
                    "wedding",
                    "promise",
                    "bridal",
                    "engagement",
                    "stacking",
                    "anniversary"
                  ]
                }
              },
              "flow": {
                "guard": {
                  "advance_only_if": []
                }
              },
              "gates": {
                "must": [
                  "validations_ok"
                ],
                "on_contract_violation": "halt_and_report",
                "on_miss": "halt",
                "on_missing_required_path": "halt_and_report",
                "on_soft_misalignment": "warn_and_continue"
              },
              "governance": {
                "audit_fields": [
                  "source_csv_id",
                  "original_query",
                  "metrics_at_selection_time"
                ],
                "reproducibility": "store seeds and weights for ranking formula (w1..w5)"
              },
              "guards": {
                "keyword_pool": {
                  "criteria": [
                    "relevance",
                    "volume",
                    "competition"
                  ],
                  "max_size": 50,
                  "min_size": 30,
                  "note": "Odak seçimi için geniş çeşit havuzu",
                  "require_types": [
                    "short",
                    "mid",
                    "long_tail"
                  ]
                }
              },
              "hitl_contract": {
                "gpt_tasks": [],
                "user_tasks": []
              },
              "inputs": [
                "alura.csv[8]",
                "alura.metrics",
                "context.product_category",
                "prior.signals"
              ],
              "label": "Odak Anahtar Kelime + Havuz (Sonuç Odaklı)",
              "name": "Odak Anahtar Kelime + Havuz",
              "operations": [
                "concat -> dedupe (case-insensitive, diacritics normalized)",
                "filter by quality thresholds (score>=70, conv>=0.015, competition<=Medium) with fallback allowance<=10%",
                "segment_coverage ensure >=3 segments (material/use_case/audience + optional gemstone/style/color/price)",
                "normalize & canonicalize keywords (singular/plural, common misspellings) without creating new derivatives",
                "rank by multi-score: w1*score + w2*conv + w3*ctr + w4*volume - w5*competition_penalty",
                "diversity re-ranking: penalize near-duplicates (semantic_sim>=0.85) and same-root crowding",
                "produce ranked pool and pick provisional focus_keywords[1..4]"
              ],
              "outputs": [
                "keywords.pool.ranked[]",
                "keywords.focus[1..4].provisional",
                "keywords.selection_notes",
                "keywords.segment_coverage"
              ],
              "pool_policy": {
                "allowed_fields": {
                  "competitor_listings": [
                    "Title",
                    "Tags",
                    "Sales",
                    "Revenue",
                    "Conversion rate"
                  ],
                  "similar_keywords": [
                    "Keyword",
                    "Score",
                    "Search volume",
                    "3mo. change",
                    "Competition",
                    "Conversion rate"
                  ],
                  "top_listings": [
                    "Title",
                    "Tags",
                    "Sales",
                    "Revenue",
                    "Conversion rate"
                  ]
                },
                "dedupe": {
                  "mode": "case_insensitive_exact"
                },
                "negatives_ref": "global_negatives",
                "normalization": {
                  "case_preserve": true,
                  "no_lemmatize_stem_synonym": true,
                  "single_space_only": true,
                  "trim_whitespace": true
                },
                "pool_limits": {
                  "allow_less": true,
                  "max": 100,
                  "target_min": 100
                },
                "source": "csv_only"
              },
              "preconditions": {
                "critical_pass": {
                  "require_ancestors_done": [
                    "0",
                    "1",
                    "3",
                    "6",
                    "16"
                  ]
                },
                "parent_defined": {
                  "exists": true,
                  "path": "/workflow_patches/steps/3"
                }
              },
              "requires": [
                "3"
              ],
              "ruleset": [
                {
                  "id": "NO_DERIVATION",
                  "params": {
                    "enforced": true
                  }
                },
                {
                  "id": "POOL_MIN_SIZE",
                  "params": {
                    "min": 100
                  }
                },
                {
                  "id": "SEMANTIC_DIVERSITY_THRESHOLD",
                  "params": {
                    "similarity_max": 0.85
                  }
                },
                {
                  "id": "FOCUS_KEYWORDS_COUNT",
                  "params": {
                    "count": 4
                  }
                },
                {
                  "id": "DIVERSITY_RE_RANK",
                  "params": {
                    "enabled": true
                  }
                },
                {
                  "id": "PRODUCT_RECORD_CONFIRMED_REQUIRED",
                  "params": {
                    "source": "product_record",
                    "status": "CONFIRMED"
                  }
                }
              ],
              "scoring": {
                "combine": [
                  {
                    "take": "similar",
                    "weight": 0.6
                  },
                  {
                    "take": "market",
                    "weight": 0.4
                  }
                ],
                "features": {
                  "market": {
                    "revenue_signal": {
                      "agg": "sum_norm",
                      "any_of": [
                        "Revenue",
                        "Monthly revenue"
                      ],
                      "weight": 0.15
                    },
                    "sales_signal": {
                      "agg": "sum_norm",
                      "any_of": [
                        "Sales",
                        "Monthly sales"
                      ],
                      "weight": 0.15
                    },
                    "tag_hits_comp": {
                      "count": true,
                      "field": "Tags",
                      "source": "competitor_listings",
                      "weight": 0.2
                    },
                    "tag_hits_top": {
                      "count": true,
                      "field": "Tags",
                      "source": "top_listings",
                      "weight": 0.2
                    },
                    "title_hits_comp": {
                      "count": true,
                      "field": "Title",
                      "source": "competitor_listings",
                      "weight": 0.15
                    },
                    "title_hits_top": {
                      "count": true,
                      "field": "Title",
                      "source": "top_listings",
                      "weight": 0.15
                    }
                  },
                  "similar": {
                    "competition": {
                      "field": "Competition",
                      "norm": "inv",
                      "weight": 0.1
                    },
                    "conv": {
                      "field": "Conversion rate",
                      "norm": "pct",
                      "weight": 0.2
                    },
                    "score": {
                      "field": "Score",
                      "norm": "minmax",
                      "weight": 0.45
                    },
                    "trend_3mo": {
                      "field": "3mo. change",
                      "norm": "pct",
                      "weight": 0.05
                    },
                    "volume": {
                      "field": "Search volume",
                      "norm": "log1p",
                      "weight": 0.2
                    }
                  }
                },
                "missing_values": {
                  "no_imputation": true,
                  "skip_feature_if_missing": true
                }
              },
              "selection": {
                "allow_focus_lt_4_if_pool_lt_4": true,
                "focus_count": 4,
                "outputs": {
                  "focus_keywords": "outputs.focus_keywords",
                  "pool": "outputs.pool",
                  "selection_notes": "outputs.selection_notes"
                },
                "tie_breakers": [
                  "conversion_rate",
                  "title_tag_occurrence",
                  "similar_score"
                ],
                "validations": {
                  "halt_on_fail": true,
                  "require": [
                    "len(outputs.pool) >= 1",
                    "len(outputs.focus_keywords) >= (outputs.pool.length < 4 ? outputs.pool.length : 4)"
                  ]
                }
              },
              "selection_policy": {
                "focus_keywords_count": 4,
                "notes_required": true,
                "tie_breakers": [
                  "higher conversion_rate",
                  "higher overall score",
                  "better segment diversification"
                ],
                "use_in_3b": 1
              },
              "title": "Odak Anahtar Kelime + Havuz Oluşturma (8 Alura CSV’den)",
              "upstream_signature": {
                "policy": "mark_stale_on_upstream_change"
              },
              "validations": {
                "present": true
              }
            },
            "3b": {
              "actions": {
                "draft_package": {
                  "description": "first_160_chars_mobile_optimized",
                  "tags": {
                    "count": 13,
                    "diverse": true,
                    "unique": true
                  },
                  "title": "use_focus_and_support_keywords"
                }
              },
              "can_revise_after": [
                "4",
                "5a",
                "5b"
              ],
              "constraints": {
                "max_same_root_in_tags": 1,
                "must_confirm": false,
                "no_derivation": true,
                "no_skip": true,
                "require_gpt_task": false,
                "require_user_task": false,
                "require_validations_pass": false
              },
              "description": "3.a’daki havuz ve odak #1 (varsayılan) kullanılarak taslak başlık, açıklama ve 13 etiket oluşturulur. Nihai SEO adımlarına geçmeden önce kullanıcı gözden geçirmesi içindir.",
              "flow": {
                "guard": {
                  "advance_only_if": []
                }
              },
              "gates": {
                "must": [
                  "validations_ok"
                ],
                "on_contract_violation": "halt_and_report",
                "on_miss": "halt",
                "on_missing_required_path": "halt_and_report",
                "on_soft_misalignment": "warn_and_continue"
              },
              "governance": {
                "notes_required": true,
                "qc_checklist": [
                  "frontload_title",
                  "13_unique_tags",
                  "no_attr_duplicate",
                  "no_stuffing"
                ]
              },
              "hitl_contract": {
                "gpt_tasks": [],
                "user_tasks": []
              },
              "includes_rules_from": [
                "10",
                "11",
                "12"
              ],
              "inputs": [
                "keywords.pool.ranked[]",
                "keywords.focus[1..4].provisional",
                "segment_coverage",
                "product_attributes?",
                "prior.signals?"
              ],
              "label": "Taslak Paket (Title + Description + Tags)",
              "name": "Taslak Paket (Title, Desc, Tags)",
              "outputs": [
                "draft.title",
                "draft.description",
                "draft.tags[13]",
                "draft.notes",
                "draft.qc"
              ],
              "preconditions": {
                "critical_pass": {
                  "require_ancestors_done": [
                    "0",
                    "1",
                    "3",
                    "6",
                    "16"
                  ]
                },
                "parent_defined": {
                  "exists": true,
                  "path": "/workflow_patches/steps/3"
                }
              },
              "requires": [
                "3a"
              ],
              "rules": [
                "use focus_1 by default; switch to focus_2..4 only if rationale provided",
                "title.frontload focus; title<=140; readable separators; no stuffing",
                "description: first sentence includes focus naturally; benefits-first; scannable",
                "tags: 13 unique; from pool; no duplicates with category attributes; ensure >=3 segments",
                "negative filters: [\"DIY\",\"free\",\"tutorial\",\"plated*\",\"supplies\",\"raw*\"]",
                "no fabrication of materials/stones"
              ],
              "ruleset": [
                {
                  "id": "USE_FOCUS1_BY_DEFAULT",
                  "params": {
                    "allow_switch_with_rationale": true
                  }
                },
                {
                  "id": "TITLE_FRONTLOAD",
                  "params": {
                    "first_chars": 40
                  }
                },
                {
                  "id": "TITLE_MAX_LEN",
                  "params": {
                    "max": 140
                  }
                },
                {
                  "id": "TAGS_COUNT_13",
                  "params": {
                    "count": 13
                  }
                },
                {
                  "id": "TAGS_UNIQUE",
                  "params": {
                    "required": true
                  }
                },
                {
                  "id": "MAX_SAME_ROOT_IN_TAGS",
                  "params": {
                    "max": 1
                  }
                },
                {
                  "id": "NEGATIVE_TERMS",
                  "params": {
                    "terms": [
                      "DIY",
                      "free",
                      "tutorial",
                      "plated*",
                      "kit",
                      "supplies",
                      "raw*"
                    ]
                  }
                },
                {
                  "id": "NO_DERIVATION",
                  "params": {
                    "enforced": true
                  }
                },
                {
                  "id": "PRODUCT_RECORD_CONFIRMED_REQUIRED",
                  "params": {
                    "source": "product_record",
                    "status": "CONFIRMED"
                  }
                }
              ],
              "title": "Taslak Paket — DRAFT (Başlık, Açıklama, 13 Etiket)",
              "upstream_signature": {
                "policy": "mark_stale_on_upstream_change"
              },
              "validations": {
                "present": true
              }
            },
            "4": {
              "constraints": {
                "expected_products_per_csv": 200,
                "min_products_per_csv": 150,
                "must_confirm": true,
                "negatives": [
                  "DIY",
                  "supplies",
                  "kit",
                  "raw",
                  "tutorial",
                  "plated*"
                ],
                "no_skip": true,
                "require_gpt_task": false,
                "require_user_task": false,
                "require_validations_pass": false,
                "semantic_similarity_threshold": 0.85
              },
              "description": "Kullanıcıdan gelen 4 dar Top Listings CSV (focus_1..4’e denk gelen, her biri ≈200 ürün) temizlenir, normalize edilir ve konsolide edilir. 3.a odak kelime sırasının revizyonuna dair sinyaller üretilir.",
              "flow": {
                "guard": {
                  "advance_only_if": []
                }
              },
              "gates": {
                "must": [
                  "validations_ok"
                ],
                "on_contract_violation": "halt_and_report",
                "on_miss": "halt",
                "on_missing_required_path": "halt_and_report",
                "on_soft_misalignment": "warn_and_continue"
              },
              "governance": {
                "audit_fields": [
                  "source_csv_id",
                  "focus_id",
                  "metrics_at_selection_time"
                ],
                "notes_required": true
              },
              "hitl_contract": {
                "gpt_tasks": [],
                "user_tasks": []
              },
              "ingest_policy_ref": "csv_ingest.top_listings",
              "input_prep": {
                "apply_common": true,
                "enabled": true,
                "enforce": true,
                "on_fail": "halt",
                "profile_ref": "top_listings"
              },
              "inputs": [
                "top_listings_focus1.csv",
                "top_listings_focus2.csv",
                "top_listings_focus3.csv",
                "top_listings_focus4.csv",
                "keywords.focus[1..4].provisional",
                "draft.title",
                "draft.tags[13]"
              ],
              "label": "Top Listings Upload (Sessiz Önişleme)",
              "name": "Top Listings Upload",
              "operations": [
                "validate CSVs (encoding, delimiter, missing cells)",
                "tag each file with focus_id",
                "normalize text (case, diacritics, plural/singular)",
                "clean special chars, preserve attributes",
                "extract metrics (views, favorites, orders, conversion_rate)",
                "assign focus_weight per file; merge duplicates with consolidated metrics",
                "analyze overlap with keywords pool and draft",
                "diversity & bias correction: penalize same-root crowding, enforce segment coverage >=3",
                "compute focus_reorder_suggestion with rationale"
              ],
              "outputs": [
                "top_listings.cleaned.focus1..4",
                "top_listings.merged",
                "top_listings.keyword_metrics{}",
                "top_listings.keyword_overlap[]",
                "focus.reorder_suggestion",
                "top_listings.notes"
              ],
              "post": {
                "only_signal_ready": true,
                "signal": "top_listings_ready"
              },
              "pre": {
                "run_preprocessing": true,
                "silent": true
              },
              "preconditions": {
                "critical_pass": {
                  "require_ancestors_done": [
                    "0",
                    "1",
                    "3",
                    "6",
                    "16"
                  ]
                }
              },
              "preprocess": {
                "dialect": {
                  "lineterminator": "auto"
                },
                "normalize": {
                  "strip_bom": true
                }
              },
              "relations": {
                "default_focus_for_3b": "focus_1",
                "revision_candidates_after": [
                  "focus.reorder_suggestion"
                ]
              },
              "requires": [
                "3b"
              ],
              "ruleset": [
                {
                  "id": "TOPLISTINGS_MIN_PER_CSV",
                  "params": {
                    "min": 150
                  }
                },
                {
                  "id": "TOPLISTINGS_EXPECTED_PER_CSV",
                  "params": {
                    "expected": 200
                  }
                },
                {
                  "id": "EXCLUDE_NEGATIVE_TERMS",
                  "params": {
                    "terms": [
                      "DIY",
                      "free",
                      "tutorial",
                      "plated*",
                      "kit",
                      "supplies",
                      "raw*"
                    ]
                  }
                },
                {
                  "id": "DEDUP_NEAR_DUPLICATES",
                  "params": {
                    "semantic_threshold": 0.85
                  }
                },
                {
                  "id": "PRODUCT_RECORD_CONFIRMED_REQUIRED",
                  "params": {
                    "source": "product_record",
                    "status": "CONFIRMED"
                  }
                }
              ],
              "suggestion_mode": "suppress",
              "title": "Top Listings Upload (Dar, 4 CSV focus-specific)",
              "upstream_signature": {
                "policy": "mark_stale_on_upstream_change"
              },
              "validations": {
                "present": true
              }
            },
            "5": {
              "advisory_pack_similarity": {
                "advisory_signals": {
                  "favorites_views": true,
                  "listing_age": true,
                  "review_count": true
                },
                "block": false,
                "notes": "Top Listings analizinde ekstra sütunlar (Favorites, Reviews, Age) küçük ağırlıklarla puana katkı yapar.",
                "severity": "advisory",
                "similarity_score": {
                  "enabled": true,
                  "factors": {
                    "category_match": 0.2,
                    "price_band_match": 0.1,
                    "tags_keyword_match": 0.2,
                    "title_keyword_match": 0.5
                  },
                  "normalization": "0_to_1",
                  "note": "Benzerlik puanı 0–1; Title/Tags/Category/Fiyat uyumu ile hesaplanır."
                },
                "title": "Similarity & Extra Signals for Top Listings"
              },
              "constraints": {
                "must_confirm": false,
                "no_skip": true,
                "require_gpt_task": false,
                "require_user_task": false,
                "require_validations_pass": false
              },
              "display": {
                "hide": [
                  "tables",
                  "raw_rows",
                  "excel_like"
                ],
                "show": [
                  "text_summary",
                  "key_metrics"
                ]
              },
              "flow": {
                "guard": {
                  "advance_only_if": []
                }
              },
              "gates": {
                "must": [
                  "validations_ok"
                ],
                "on_contract_violation": "halt_and_report",
                "on_miss": "halt",
                "on_missing_required_path": "halt_and_report",
                "on_soft_misalignment": "auto_fix_and_continue"
              },
              "hitl_contract": {
                "gpt_tasks": [],
                "user_tasks": []
              },
              "label": "Popüler Ürünler Analizi (Sonuç Odaklı)",
              "name": "Popüler Ürünler Analizi",
              "output": {
                "digest_only": true,
                "ui_table": false
              },
              "preconditions": {
                "critical_pass": {
                  "require_ancestors_done": [
                    "0",
                    "1",
                    "3",
                    "6",
                    "16"
                  ]
                }
              },
              "requires": [],
              "upstream_signature": {
                "policy": "mark_stale_on_upstream_change"
              },
              "uses": "analysis/top_listings",
              "validations": {
                "present": true
              }
            },
            "5a": {
              "can_revise": [
                "keywords.focus[1..4]"
              ],
              "constraints": {
                "min_total_rows_warning": 600,
                "must_confirm": false,
                "negatives": [
                  "DIY",
                  "supplies",
                  "kit",
                  "raw",
                  "tutorial",
                  "plated*"
                ],
                "no_skip": true,
                "require_gpt_task": false,
                "require_user_task": false,
                "require_validations_pass": false
              },
              "description": "Top listings verisinden ürün/anahtar kelime performans içgörüleri çıkarılır; niş fırsatlar ve doygun alanlar işaretlenir; odak sıralaması için sinyal üretilir.",
              "flow": {
                "guard": {
                  "advance_only_if": []
                }
              },
              "gates": {
                "must": [],
                "on_contract_violation": "halt_and_report",
                "on_miss": "halt",
                "on_missing_required_path": "halt_and_report",
                "on_soft_misalignment": "auto_fix_and_continue"
              },
              "governance": {
                "notes_required": true
              },
              "guards": {
                "analysis": {
                  "include_metrics": [
                    "conversion_rate",
                    "listing_age"
                  ],
                  "note": "Popüler ürün analizinde satış dışında metrikler de hesaba katılmalı"
                }
              },
              "hitl_contract": {
                "gpt_tasks": [],
                "user_tasks": []
              },
              "inputs": [
                "top_listings.cleaned.*",
                "top_listings.merged",
                "top_listings.keyword_metrics{}",
                "top_listings.keyword_overlap[]",
                "keywords.pool.ranked[]",
                "keywords.focus[1..4].provisional",
                "draft.title",
                "draft.tags[13]"
              ],
              "min_samples_per_shop": 1,
              "name": "Rakip Mağaza Seçimi",
              "output": {
                "digest_only": true,
                "top_n": 8,
                "ui_table": false
              },
              "outputs": [
                "popular.products.top[]",
                "popular.keywords.top[]",
                "popular.segments.summary{}",
                "popular.focus_signals{}",
                "popular.notes",
                "similarity.report{}",
                "similarity.score",
                "similarity.label",
                "similarity.notes"
              ],
              "pre": [
                {
                  "args": {
                    "mode": "auto_fix_warn",
                    "rules_ref": "_csv_rules.competitor_csv",
                    "write_outputs": true
                  },
                  "name": "csv_preprocess.competitor_csv"
                }
              ],
              "preconditions": {
                "critical_pass": {
                  "require_ancestors_done": [
                    "0",
                    "1",
                    "3",
                    "6",
                    "16"
                  ]
                },
                "parent_defined": {
                  "exists": true,
                  "path": "/workflow_patches/steps/5"
                }
              },
              "requires": [],
              "rules": [
                "normalize product metrics (views, favorites, orders, conversion_rate) -> z-scores -> product_score",
                "aggregate keyword occurrences across products -> keyword_score",
                "dedupe near-duplicate products (semantic_sim>=0.85)",
                "analyze segment coverage (material/use_case/audience + optional gemstone/style/color/price)",
                "flag opportunities (high-conv/low-comp) and risks (high-comp/low-conv)",
                "produce focus support/oppose signals for focus_1..4",
                "Compute similarity between our listing and each row (title/desc embeddings; tag overlap; attribute match).",
                "Attach similarity.score (0–1) and similarity.label (LOW/MEDIUM/HIGH) per row.",
                "Emit similarity.report and notes; use in later steps (ads/seo/spam guard)."
              ],
              "ruleset": [
                {
                  "id": "NEGATIVE_TERMS",
                  "params": {
                    "terms": [
                      "DIY",
                      "free",
                      "tutorial",
                      "plated*",
                      "kit",
                      "supplies",
                      "raw*"
                    ]
                  }
                },
                {
                  "id": "MIN_TOTAL_ROWS_WARNING",
                  "params": {
                    "min": 600
                  }
                },
                {
                  "id": "DEDUP_NEAR_DUPLICATES",
                  "params": {
                    "semantic_threshold": 0.85
                  }
                },
                {
                  "id": "FOCUS_SUPPORT_SIGNALS",
                  "params": {
                    "produce": true
                  }
                },
                {
                  "id": "SIMILARITY_TITLE_DESC_CHECK",
                  "params": {}
                },
                {
                  "id": "SIMILARITY_TAGS_OVERLAP",
                  "params": {}
                },
                {
                  "id": "SIMILARITY_ATTRIBUTES_MATCH",
                  "params": {}
                },
                {
                  "id": "SIMILARITY_SCORE_COMPUTE",
                  "params": {}
                },
                {
                  "id": "PRODUCT_RECORD_CONFIRMED_REQUIRED",
                  "params": {
                    "source": "product_record",
                    "status": "CONFIRMED"
                  }
                }
              ],
              "suggestion_mode": "suppress",
              "title": "Popüler Ürünler Analizi",
              "upstream_signature": {
                "policy": "mark_stale_on_upstream_change"
              },
              "uses": "selection/top8_by_shop"
            },
            "5b": {
              "constraints": {
                "coverage": "multiple segments must be represented",
                "exclusions": [
                  "brand infringement",
                  "supplies/DIY heavy presence"
                ],
                "must_confirm": false,
                "no_skip": true,
                "quality": ">=50% of selected shops have multi-match in popular.products.top[]",
                "require_gpt_task": false,
                "require_user_task": false,
                "require_validations_pass": false
              },
              "description": "5a ve 4 çıktıları üzerinden hedef rakip mağazalar belirlenir; ileride Ads ve SEO karşılaştırmaları için çekirdek set oluşturulur.",
              "enabled": false,
              "flow": {
                "guard": {
                  "advance_only_if": []
                }
              },
              "gates": {
                "must": [],
                "on_contract_violation": "halt_and_report",
                "on_miss": "halt",
                "on_missing_required_path": "halt_and_report",
                "on_soft_misalignment": "warn_and_continue"
              },
              "governance": {
                "notes_required": true
              },
              "guards": {
                "competitor_selection": {
                  "feedback_to": "3b",
                  "pattern_extraction": [
                    "titles",
                    "tags"
                  ],
                  "require_category_match": true
                }
              },
              "hitl_contract": {
                "gpt_tasks": [],
                "user_tasks": []
              },
              "inputs": [
                "popular.products.top[]",
                "popular.keywords.top[]",
                "top_listings.merged",
                "competitor_shops.csv?"
              ],
              "name": "Rakip Mağaza Seçimi",
              "notes": {
                "lifecycle": "manifest-disabled"
              },
              "outputs": [
                "competitors.candidates[]",
                "competitors.selected[]",
                "competitors.profiles{}",
                "competitors.notes",
                "similarity.report{}",
                "similarity.score",
                "similarity.label",
                "similarity.notes"
              ],
              "preconditions": {
                "critical_pass": {
                  "require_ancestors_done": [
                    "0",
                    "1",
                    "3",
                    "6",
                    "16"
                  ]
                },
                "parent_defined": {
                  "exists": true,
                  "path": "/workflow_patches/steps/5"
                }
              },
              "requires": [
                "5a"
              ],
              "rules": [
                "extract shop_candidates from ownership of top products",
                "if competitor_shops.csv present: clean/normalize and merge with candidates",
                "score shops by product_score_topK, keyword_overlap_quality, category_fit, diversity_contrib",
                "select 4–8 diverse shops; demote near-duplicate or same-root brands",
                "Compute similarity between our listing and each row (title/desc embeddings; tag overlap; attribute match).",
                "Attach similarity.score (0–1) and similarity.label (LOW/MEDIUM/HIGH) per row.",
                "Emit similarity.report and notes; use in later steps (ads/seo/spam guard)."
              ],
              "ruleset": [
                {
                  "id": "SHOP_SELECTION_COUNT_RANGE",
                  "params": {
                    "max": 8,
                    "min": 4
                  }
                },
                {
                  "id": "COVERAGE_MULTIPLE_SEGMENTS",
                  "params": {
                    "required": true
                  }
                },
                {
                  "id": "QUALITY_MIN_RATIO_TOP_MATCH",
                  "params": {
                    "ratio": 0.5
                  }
                },
                {
                  "id": "EXCLUSIONS",
                  "params": {
                    "terms": [
                      "brand infringement",
                      "supplies/DIY heavy"
                    ]
                  }
                },
                {
                  "id": "SIMILARITY_TITLE_DESC_CHECK",
                  "params": {}
                },
                {
                  "id": "SIMILARITY_TAGS_OVERLAP",
                  "params": {}
                },
                {
                  "id": "SIMILARITY_ATTRIBUTES_MATCH",
                  "params": {}
                },
                {
                  "id": "SIMILARITY_SCORE_COMPUTE",
                  "params": {}
                },
                {
                  "id": "PRODUCT_RECORD_CONFIRMED_REQUIRED",
                  "params": {
                    "source": "product_record",
                    "status": "CONFIRMED"
                  }
                }
              ],
              "suggestion_mode": "suppress",
              "title": "Rakip Mağaza Seçimi",
              "ui": {
                "hidden": true
              },
              "upstream_signature": {
                "policy": "mark_stale_on_upstream_change"
              }
            },
            "6": {
              "artifacts": [
                "competitors.load.report.json"
              ],
              "constraints": {
                "must_confirm": true,
                "no_skip": true,
                "require_gpt_task": false,
                "require_user_task": false,
                "require_validations_pass": true
              },
              "description": "Rakip mağaza listesi CSV’si (örn. competitor_shops.csv) yüklenir; mağaza URL/ID doğrulamaları ve temel temizlik yapılır.",
              "flow": {
                "guard": {
                  "advance_only_if": []
                }
              },
              "gates": {
                "must": [
                  "validations_ok"
                ],
                "on_contract_violation": "halt_and_report",
                "on_miss": "halt",
                "on_missing_required_path": "halt_and_report",
                "on_soft_misalignment": "warn_and_continue"
              },
              "input_prep": {
                "apply_common": true,
                "enabled": true,
                "enforce": true,
                "on_fail": "halt",
                "profile_ref": "competitor_listings"
              },
              "inputs": [
                "competitor_shops.csv"
              ],
              "label": "Rakip Mağaza CSV Yükleme (Sessiz Önişleme)",
              "name": "Rakip Mağaza CSV Yükleme",
              "next": [
                "6a"
              ],
              "on_error": {
                "fallback_next": [],
                "policy": "fail-soft"
              },
              "outputs": [
                "competitors.shops[]"
              ],
              "params": {
                "required_columns": [
                  "shop_name",
                  "shop_url?"
                ]
              },
              "post": {
                "only_signal_ready": true,
                "signal": "competitor_ready"
              },
              "pre": {
                "run_preprocessing": true,
                "silent": true
              },
              "preconditions": {
                "critical_pass": {
                  "require_ancestors_done": [
                    "0",
                    "1",
                    "3",
                    "6",
                    "16"
                  ]
                }
              },
              "preprocess": {
                "dialect": {
                  "lineterminator": "auto"
                },
                "normalize": {
                  "strip_bom": true
                }
              },
              "requires": [
                "0a"
              ],
              "title": "Rakip Mağaza CSV Yükleme",
              "upstream_signature": {
                "policy": "mark_stale_on_upstream_change"
              },
              "validations": {
                "row_min": 1
              }
            },
            "6a": {
              "advisory_pack_similarity": {
                "advisory_signals": {
                  "review_rate": true,
                  "review_score": true,
                  "shop_level_aggregation": {
                    "enabled": true,
                    "metrics": [
                      "avg_price",
                      "avg_conversion_rate",
                      "avg_review_score",
                      "total_listings"
                    ]
                  }
                },
                "block": false,
                "notes": "Rakip mağaza analizi shop-level özetler (ortalama fiyat, conversion, review) ile desteklenir.",
                "severity": "advisory",
                "similarity_score": {
                  "enabled": true,
                  "factors": {
                    "category_match": 0.2,
                    "price_band_match": 0.2,
                    "tags_keyword_match": 0.2,
                    "title_keyword_match": 0.4
                  },
                  "normalization": "0_to_1",
                  "note": "Rakip ürün benzerlik puanı; Title/Tags/Category/Fiyat üzerinden hesaplanır."
                },
                "title": "Similarity & Shop-Level Signals for Competitors"
              },
              "artifacts": [
                "competitors.analysis.report.json",
                "competitors.keywords.csv"
              ],
              "constraints": {
                "must_confirm": false,
                "no_skip": true,
                "require_gpt_task": false,
                "require_user_task": false,
                "require_validations_pass": true
              },
              "description": "Yüklenen rakip mağazalar üzerinden ürün/etiket/başlık ve fiyat dağılımı analiz edilir; kampanya/SEO için özet sinyaller üretilir.",
              "display": {
                "hide": [
                  "tables",
                  "raw_rows",
                  "excel_like"
                ],
                "show": [
                  "text_summary",
                  "key_metrics"
                ]
              },
              "flow": {
                "guard": {
                  "advance_only_if": []
                }
              },
              "gates": {
                "must": [
                  "validations_ok"
                ],
                "on_contract_violation": "halt_and_report",
                "on_miss": "halt",
                "on_missing_required_path": "halt_and_report",
                "on_soft_misalignment": "auto_fix_and_continue"
              },
              "inputs": [
                "competitors.shops[]"
              ],
              "label": "Rakip Mağaza Analizi (Sonuç Odaklı)",
              "name": "Rakip Mağaza Analizi",
              "next": [
                "7",
                "8A",
                "8B"
              ],
              "on_error": {
                "fallback_next": [
                  "7"
                ],
                "policy": "fail-soft"
              },
              "outputs": [
                "competitors.products[]",
                "competitors.keywords[]",
                "competitors.signals{}",
                "competitors.*"
              ],
              "params": {
                "extract_fields": [
                  "title",
                  "tags",
                  "price",
                  "category",
                  "reviews",
                  "sales?"
                ],
                "fetch_products": true,
                "max_products_per_shop": 200
              },
              "preconditions": {
                "critical_pass": {
                  "require_ancestors_done": [
                    "0",
                    "1",
                    "3",
                    "6",
                    "16"
                  ]
                },
                "parent_defined": {
                  "exists": true,
                  "path": "/workflow_patches/steps/6"
                }
              },
              "requires": [
                "6"
              ],
              "title": "Rakip Mağaza Analizi",
              "upstream_signature": {
                "policy": "mark_stale_on_upstream_change"
              },
              "validations": {
                "signals.non_empty": true
              }
            },
            "7": {
              "constraints": {
                "bias_correction": "penalize single-shop dominance",
                "min_segments": 3,
                "must_confirm": false,
                "no_derivation": true,
                "no_skip": true,
                "require_gpt_task": false,
                "require_user_task": false,
                "require_validations_pass": false
              },
              "description": "3.a–5b çıktılarından pazar özeti üretilir; Ads için pozitif/negatif çekirdek set hazırlanır.",
              "flow": {
                "guard": {
                  "advance_only_if": []
                }
              },
              "gates": {
                "must": [
                  "validations_ok"
                ],
                "on_contract_violation": "halt_and_report",
                "on_miss": "halt",
                "on_missing_required_path": "halt_and_report",
                "on_soft_misalignment": "auto_fix_and_continue"
              },
              "guards": {
                "market_aggregation": {
                  "include_negative_keywords": true
                }
              },
              "hitl_contract": {
                "gpt_tasks": [],
                "user_tasks": []
              },
              "inputs": [
                "keywords.pool.ranked[]",
                "keywords.focus[1..4].provisional",
                "draft.title",
                "draft.tags[13]",
                "top_listings.merged",
                "top_listings.keyword_metrics{}",
                "focus.reorder_suggestion",
                "popular.products.top[]",
                "popular.keywords.top[]",
                "popular.segments.summary{}",
                "competitors.selected[]",
                "competitors.profiles{}",
                "alura.metrics"
              ],
              "name": "Market Aggregation & Ads Prep",
              "outputs": [
                "market.snapshot{}",
                "ads.seed.positive[]",
                "ads.seed.negative[]",
                "market.notes"
              ],
              "preconditions": {
                "critical_pass": {
                  "require_ancestors_done": [
                    "0",
                    "1",
                    "3",
                    "6",
                    "16"
                  ]
                }
              },
              "requires": [
                "5b"
              ],
              "rules": [
                "cluster keywords into themes by material/use_case/audience (+gemstone/style/color/price)",
                "analyze demand-supply gaps: pool vs. popular",
                "ads.seed.positive = high score/conv, pazar uyumlu, rakiplerde kanıtlı",
                "ads.seed.negative = ['DIY','free','tutorial','plated*','kit','supplies','raw*'] + rakip gürültü",
                "prioritize intents: Purchase > Occasion > Material/Style"
              ],
              "ruleset": [
                {
                  "id": "NO_DERIVATION",
                  "params": {
                    "enforced": true
                  }
                },
                {
                  "id": "MIN_SEGMENTS",
                  "params": {
                    "count": 3
                  }
                },
                {
                  "id": "ADS_SEED_NEGATIVE_TERMS",
                  "params": {
                    "terms": [
                      "DIY",
                      "free",
                      "tutorial",
                      "plated*",
                      "kit",
                      "supplies",
                      "raw*"
                    ]
                  }
                },
                {
                  "id": "BIAS_CORRECTION_SINGLE_SHOP",
                  "params": {
                    "enabled": true
                  }
                },
                {
                  "id": "PRODUCT_RECORD_CONFIRMED_REQUIRED",
                  "params": {
                    "source": "product_record",
                    "status": "CONFIRMED"
                  }
                }
              ],
              "title": "Market Aggregation & Ads Prep",
              "upstream_signature": {
                "policy": "mark_stale_on_upstream_change"
              },
              "validations": {
                "present": true
              }
            },
            "8": {
              "constraints": {
                "must_confirm": false,
                "no_skip": true,
                "require_gpt_task": false,
                "require_user_task": false,
                "require_validations_pass": false
              },
              "description": "5a/5b ve 7 çıktılarından kampanya/ad group planını oluşturur; 8B'ye temiz, onaylı plan sağlar.",
              "flow": {
                "guard": {
                  "advance_only_if": []
                }
              },
              "gates": {
                "must": [
                  "validations_ok"
                ],
                "on_contract_violation": "halt_and_report",
                "on_miss": "halt",
                "on_missing_required_path": "halt_and_report",
                "on_soft_misalignment": "auto_fix_and_continue"
              },
              "hitl_contract": {
                "gpt_tasks": [],
                "user_tasks": []
              },
              "inputs": [
                "popular.products.top[]",
                "popular.keywords.top[]",
                "market.aggregation{}",
                "seed.terms[]",
                "negative_terms.base[]"
              ],
              "name": "Aggregate",
              "outputs": [
                "ads_plan.csv",
                "negative_keywords.csv",
                "campaign_settings.json",
                "ads_plan.status"
              ],
              "preconditions": {
                "critical_pass": {
                  "require_ancestors_done": [
                    "0",
                    "1",
                    "3",
                    "6",
                    "16"
                  ]
                }
              },
              "requires": [
                "7"
              ],
              "rules": [
                {
                  "id": "8A_GROUPING",
                  "title": "Ürün→Campaign/AdGroup eşleme; çeşitlilik koru"
                },
                {
                  "id": "8A_SEED_MATCHTYPES",
                  "title": "Seed'leri phrase/exact dağıt; genişleme yok"
                },
                {
                  "id": "8A_NEGATIVES",
                  "title": "Negatif liste uygula (marka/düşük niyet)"
                },
                {
                  "id": "8A_BUDGET_GEO",
                  "title": "Bütçe & lokasyon öner; onay şart"
                },
                {
                  "id": "8A_DUPE_CLEAN",
                  "title": "Çift/benzer seed temizliği (exact+semantic)"
                }
              ],
              "title": "8A — Ads Kampanya İskeleti / Gruplama",
              "upstream_signature": {
                "policy": "mark_stale_on_upstream_change"
              },
              "validations": {
                "present": true
              }
            },
            "8a": {
              "constraints": {
                "min_segments_per_group": 1,
                "must_confirm": false,
                "near_duplicate_limit": 1,
                "no_derivation": true,
                "no_skip": true,
                "require_gpt_task": false,
                "require_user_task": false,
                "require_validations_pass": false
              },
              "description": "7. adımdaki çekirdek setlerden Etsy Ads için plan üretilir.",
              "flow": {
                "guard": {
                  "advance_only_if": []
                }
              },
              "gates": {
                "must": [
                  "validations_ok"
                ],
                "on_contract_violation": "halt_and_report",
                "on_miss": "halt",
                "on_missing_required_path": "halt_and_report",
                "on_soft_misalignment": "auto_fix_and_continue"
              },
              "guards": {
                "ads_keywords": {
                  "ctr_check": true,
                  "relevance_check": true
                }
              },
              "hitl_contract": {
                "gpt_tasks": [],
                "user_tasks": []
              },
              "inputs": [
                "ads.seed.positive[]",
                "ads.seed.negative[]",
                "popular.products.top[]",
                "popular.keywords.top[]",
                "top_listings.*",
                "competitors.*",
                "keywords.pool.ranked[]",
                "keywords.focus[1..4]"
              ],
              "name": "Ads Keyword Generation",
              "outputs": [
                "ads.plan{}",
                "ads.keywords.final[]",
                "ads.negative_terms[]",
                "ab_test.plan",
                "ads.governance.notes"
              ],
              "preconditions": {
                "critical_pass": {
                  "require_ancestors_done": [
                    "0",
                    "1",
                    "3",
                    "6",
                    "16"
                  ]
                },
                "parent_defined": {
                  "exists": true,
                  "path": "/workflow_patches/steps/8"
                }
              },
              "requires": [
                "8A"
              ],
              "rules": [
                "map segments to AdGroups (Purchase/Occasion/Material-Style/Audience)",
                "select high conv/score, non-duplicate keywords per group",
                "ads.negative_terms = seed + competitor noise terms",
                "ab_test.window_days in [14,30]; single_variable = true",
                "pause if ROAS<1.0 and Clicks>=20",
                "boost if ROAS>=target and Orders>=3"
              ],
              "ruleset": [
                {
                  "id": "ADGROUP_SEGMENT_MAPPING",
                  "params": {
                    "groups": [
                      "Purchase",
                      "Occasion",
                      "Material-Style",
                      "Audience"
                    ]
                  }
                },
                {
                  "id": "AB_TEST_WINDOW_DAYS",
                  "params": {
                    "max": 30,
                    "min": 14
                  }
                },
                {
                  "id": "PAUSE_RULE",
                  "params": {
                    "clicks_gte": 20,
                    "roas_lt": 1.0
                  }
                },
                {
                  "id": "BOOST_RULE",
                  "params": {
                    "orders_gte": 3,
                    "roas_gte": "target"
                  }
                },
                {
                  "id": "NO_DERIVATION",
                  "params": {
                    "enforced": true
                  }
                },
                {
                  "id": "NEAR_DUP_LIMIT",
                  "params": {
                    "max_per_group": 1
                  }
                },
                {
                  "id": "PRODUCT_RECORD_CONFIRMED_REQUIRED",
                  "params": {
                    "source": "product_record",
                    "status": "CONFIRMED"
                  }
                }
              ],
              "title": "Ads Keyword Generation (Plan + Anahtarlar)",
              "upstream_signature": {
                "policy": "mark_stale_on_upstream_change"
              },
              "validations": {
                "present": true
              }
            },
            "9": {
              "constraints": {
                "min_segments": 3,
                "must_confirm": false,
                "near_duplicate_limit": 1,
                "negatives": [
                  "DIY",
                  "free",
                  "tutorial",
                  "plated*",
                  "kit",
                  "supplies",
                  "raw*"
                ],
                "no_derivation": true,
                "no_skip": true,
                "require_gpt_task": false,
                "require_user_task": false,
                "require_validations_pass": false
              },
              "description": "SEO için odak ve destek anahtar setleri kesinleştirilir; başlık/etiket uyumu sağlanır.",
              "flow": {
                "guard": {
                  "advance_only_if": []
                }
              },
              "gates": {
                "must": [
                  "validations_ok"
                ],
                "on_contract_violation": "halt_and_report",
                "on_miss": "halt",
                "on_missing_required_path": "halt_and_report",
                "on_soft_misalignment": "auto_fix_and_continue"
              },
              "guards": {
                "seo_refinement": {
                  "balance": [
                    "focus",
                    "support",
                    "long_tail"
                  ],
                  "diversity_required": true
                }
              },
              "hitl_contract": {
                "gpt_tasks": [],
                "user_tasks": []
              },
              "inputs": [
                "keywords.pool.ranked[]",
                "keywords.focus[1..4]",
                "draft.title",
                "draft.tags[13]",
                "market.snapshot{}",
                "ads.keywords.final[]",
                "popular.keywords.top[]",
                "top_listings.keyword_metrics{}",
                "alura.metrics"
              ],
              "name": "SEO Keyword Refinement",
              "outputs": [
                "seo.keywords.focus[]",
                "seo.keywords.supporting[]",
                "seo.rejected[]",
                "seo.notes"
              ],
              "preconditions": {
                "critical_pass": {
                  "require_ancestors_done": [
                    "0",
                    "1",
                    "3",
                    "6",
                    "16"
                  ]
                }
              },
              "requires": [
                "8B"
              ],
              "rules": [
                "validate focus_1..4 with market/performance overlap",
                "construct supporting set from long-tail/niche keywords",
                "avoid duplication: no repeated roots across title/tags",
                "no duplicates with category attributes",
                "record rationale for each acceptance/rejection"
              ],
              "ruleset": [
                {
                  "id": "NO_DERIVATION",
                  "params": {
                    "enforced": true
                  }
                },
                {
                  "id": "MIN_SEGMENTS",
                  "params": {
                    "count": 3
                  }
                },
                {
                  "id": "NEAR_DUP_LIMIT",
                  "params": {
                    "max": 1
                  }
                },
                {
                  "id": "NEGATIVE_TERMS",
                  "params": {
                    "terms": [
                      "DIY",
                      "free",
                      "tutorial",
                      "plated*",
                      "kit",
                      "supplies",
                      "raw*"
                    ]
                  }
                },
                {
                  "id": "RECORD_RATIONALE",
                  "params": {
                    "required": true
                  }
                },
                {
                  "id": "PRODUCT_RECORD_CONFIRMED_REQUIRED",
                  "params": {
                    "source": "product_record",
                    "status": "CONFIRMED"
                  }
                }
              ],
              "title": "SEO Keyword Refinement",
              "upstream_signature": {
                "policy": "mark_stale_on_upstream_change"
              },
              "validations": {
                "present": true
              }
            },
            "seo_package": {
              "constraints": {
                "desc_word_count_max": 500,
                "desc_word_count_min": 300,
                "must_confirm": false,
                "no_derivation": true,
                "no_skip": true,
                "par_max": 5,
                "par_min": 2,
                "require_gpt_task": false,
                "require_user_task": false,
                "require_validations_pass": false,
                "title_max_chars": 140,
                "title_min_chars": 80
              },
              "description": "Başlık (10), Açıklama (11) ve Etiketler (12) çıktılarının birlikte kalite kontrolü yapılır.",
              "flow": {
                "guard": {
                  "advance_only_if": []
                }
              },
              "gates": {
                "must": [
                  "validations_ok"
                ],
                "on_contract_violation": "halt_and_report",
                "on_miss": "halt",
                "on_missing_required_path": "halt_and_report",
                "on_soft_misalignment": "warn_and_continue"
              },
              "governance": {
                "notes_required": true,
                "qc_checklist": [
                  "title_frontload_focus",
                  "title_length_ok",
                  "desc_paragraphs_ok",
                  "desc_word_count_ok",
                  "tags_13_unique",
                  "tags_segment_diversity",
                  "no_root_duplicates",
                  "no_negatives"
                ]
              },
              "inputs": [
                "draft.title",
                "draft.description",
                "draft.tags[13]",
                "seo.keywords.focus[]",
                "seo.keywords.supporting[]",
                "alura.metrics",
                "popular.keywords.top[]",
                "top_listings.keyword_metrics{}"
              ],
              "name": "SEO Package QC",
              "outputs": [
                "seo_package.qc_report",
                "seo_package.issues[]",
                "seo_package.recommendations[]"
              ],
              "preconditions": {
                "critical_pass": {
                  "require_ancestors_done": [
                    "0",
                    "1",
                    "3",
                    "6",
                    "16"
                  ]
                }
              },
              "rules": [
                "title: 80-140 chars, front-load focus_1, no stuffing, no ALL CAPS",
                "description: 300-500 words, 2-5 paragraphs, first sentence includes focus_1, scannable (short paragraphs, bullets)",
                "tags: 13 unique, >=3 segments (material/use_case/audience), no duplicates with category attributes, max 1 same-root",
                "all three outputs aligned thematically",
                "exclude negatives: ['DIY','free','tutorial','plated*','kit','supplies','raw*']"
              ],
              "ruleset": [
                {
                  "id": "TITLE_LENGTH_RANGE",
                  "params": {
                    "max": 140,
                    "min": 80
                  }
                },
                {
                  "id": "DESC_WORDCOUNT_RANGE",
                  "params": {
                    "max": 500,
                    "min": 300
                  }
                },
                {
                  "id": "DESC_PARAGRAPHS_RANGE",
                  "params": {
                    "max": 5,
                    "min": 2
                  }
                },
                {
                  "id": "TAGS_COUNT_13",
                  "params": {
                    "count": 13
                  }
                },
                {
                  "id": "SEGMENT_DIVERSITY_MIN",
                  "params": {
                    "min": 3
                  }
                },
                {
                  "id": "NO_ROOT_DUPLICATES",
                  "params": {
                    "enforced": true
                  }
                },
                {
                  "id": "NEGATIVE_TERMS",
                  "params": {
                    "terms": [
                      "DIY",
                      "free",
                      "tutorial",
                      "plated*",
                      "kit",
                      "supplies",
                      "raw*"
                    ]
                  }
                }
              ],
              "title": "SEO Package QC (Title + Description + Tags)",
              "upstream_signature": {
                "policy": "mark_stale_on_upstream_change"
              },
              "validations": {
                "present": true
              }
            }
          },
          "taken_at": "2025-09-09T18:01:21.649159Z"
        }
      ]
    },
    "backup": {
      "include_manifest": true,
      "manifest_fields": [
        "sha256",
        "file_size",
        "created_at_utc"
      ]
    },
    "baseline": {
      "current_final_path": "/mnt/data/1FINAL~2_FINAL_5of5_policy_csvsync_NETSOLUTION.json",
      "current_final_sha256": "94da454ff4a714c4dd85ebe73d64a2f9771df88c746c481bb916c1ae9e64b1cd",
      "require_final_set_for_patches": true,
      "treat_nonfinal_uploads_as": "staging_only"
    },
    "batch": {
      "max_updates": 5,
      "on_reach_max": "block_and_require_restore",
      "on_timeout": "ask_reupload_latest",
      "timeout_minutes": 60
    },
    "behavior_prefs": {
      "ask_only_if_blocking": true,
      "best_effort_default": true,
      "csv_conflict_policy": "report_only_no_merge_no_delete",
      "error_msg_style": [
        "what",
        "why",
        "next",
        "need_from_you"
      ],
      "five_of_five_template": "5/5 oldu: baseline JSON’u geri yükle.",
      "hourly_prompt_template": "1 saat doldu: baseline JSON’u geri yükle.",
      "incident_protocol": "Oturum kapandı: lütfen son indirdiğin baseline JSON’u yükle.",
      "long_details_to_zip": true,
      "on_guard_trigger": "halt_and_request_approval",
      "progress_counter": "show_x_of_5",
      "short_summary_screen_fields": [
        "file_name",
        "size_kb",
        "sha256",
        "counts"
      ],
      "tone": "professional_concise"
    },
    "change_log": [
      {
        "changes": [
          "Add execution_contract (onay_equals_write, deny_memory_only_claims, require_artifact_after_write, fail_if_not_in_file, post_write_audit)",
          "Enforce communication.error_format"
        ],
        "date": "2025-09-02",
        "version": "v1.14.9"
      },
      {
        "changes": [
          "Normalize and enforce approved policy blocks (reporting, safety, guards, data_management, communication, steps 5a/5b, user_expectations, market_restrictions, localization, completeness_contract)",
          "Set reporting.delivery_format='sha_kb_delta_link'"
        ],
        "date": "2025-09-02",
        "version": "v1.15.0"
      }
    ],
    "communication": {
      "default_crit_level": "medium",
      "error_format": "what-why-next-need_from_you",
      "first_message_template": "Baseline yükle (FINAL_LATEST.json) — (Sayaç: x/5). Yükleyince SHA/KB/kayıt doğrulayıp ‘devam noktası’ ve seçenekleri çıkaracağım.",
      "require_action_in_balance": true,
      "structure": "support-against-balance",
      "tone_rules": {
        "no_praise": true
      }
    },
    "completeness_contract": {
      "enforce": true,
      "required_blocks": [
        "step_flow_lock",
        "workflow",
        "data_management",
        "production_modes",
        "reporting",
        "safety",
        "communication",
        "integrity",
        "final_artifacts",
        "change_log",
        "localization",
        "market_restrictions",
        "user_expectations"
      ]
    },
    "control_commands": {
      "allow_semantic_consent": false,
      "consent_pattern": "^ONAY:\\s+(EKLE|GÜNCELLE|GERI-AL|KALICI-SIL)\\b.+",
      "deny_on_missing_consent": true,
      "language": "tr-TR",
      "require_explicit_consent": true
    },
    "critical": {
      "enforce_on_finalize": true,
      "enforce_on_pre_run": true,
      "required_paths": [
        "/workflow_patches/steps",
        "/_help/steps",
        "/_csv_rules/similar_keywords/headers",
        "/_csv_rules/popular_listings/headers",
        "/_csv_rules/competitor_csv/headers",
        "/_final_safety/schema_validation",
        "/_final_safety/sha256_lock",
        "/_policy/answering/source_of_truth",
        "/_bootstrap/on_load/banner_text",
        "/workflow_patches/steps/16",
        "/workflow_patches/steps/17",
        "/_policy/export",
        "/_policy/export/fallback",
        "/_policy/export/versioning",
        "/_policy/export/hash_policy",
        "/_policy/export/zip_distribution",
        "/_meta"
      ]
    },
    "csv_error_handling": {
      "max_attempts": 1,
      "on_failure": "block_and_request_user",
      "try_repair": true
    },
    "csv_ingest": {
      "bom": false,
      "common": {
        "allow_auto_nan": false,
        "bom": false,
        "converters": {
          "bool_yes_no": true,
          "date_to_iso": true,
          "float_locale_safe": true,
          "int_locale_safe": true,
          "money_to_float": true,
          "percent_to_ratio": true
        },
        "delimiter_candidates": [
          ",",
          ";",
          "\t",
          "|"
        ],
        "doublequote": true,
        "dtype": "str",
        "encodings_try": [
          "utf-8-sig",
          "utf-8",
          "cp1254",
          "iso-8859-9",
          "cp1252",
          "latin-1"
        ],
        "engine": "python",
        "escapechar": "\\",
        "halt_on_field_count_mismatch": true,
        "keep_default_na": false,
        "line_endings": "LF",
        "na_filter": false,
        "normalize": {
          "trim_whitespace": true,
          "unicode_nfkc": true
        },
        "on_bad_lines": "error",
        "quotechar": "\"",
        "respect_literal_NaN": true,
        "sep": ",",
        "ui_preview_enabled": false
      },
      "competitor_listings": {
        "bom": false,
        "dedupe_key": "URL",
        "expected_headers": [
          "Title",
          "Monthly sales",
          "Sales",
          "Monthly revenue",
          "Revenue",
          "LQS",
          "Price",
          "Category",
          "Shop",
          "BSR Category (%)",
          "BSR Category",
          "Conversion rate",
          "Creator",
          "Product creation era",
          "Views",
          "Video",
          "URL",
          "Tag count",
          "Tags",
          "Review rate",
          "Reviews",
          "Review score",
          "Production partners",
          "Processing time",
          "Min processing time",
          "Max processing time",
          "Personalization required",
          "Creation date",
          "Favorites",
          "Listing type",
          "Listing age (days)",
          "Vintage",
          "Supply item",
          "Personalizable",
          "Image count",
          "Free US shipping"
        ],
        "expected_headers_strict": true,
        "field_types": {
          "Conversion rate": "percent",
          "Monthly revenue": "money",
          "Monthly sales": "int",
          "Price": "money"
        },
        "line_endings": "LF_OR_CRLF",
        "negative_terms": [
          "diy",
          "tutorial",
          "free",
          "plated",
          "kit",
          "supplies",
          "raw",
          "pdf",
          "pattern"
        ],
        "require_shop_name_not_numeric": true,
        "ring_or_band_required": true,
        "shop_name_map_order": [
          "Shop Name",
          "Seller",
          "Store",
          "Store Name",
          "Seller Name",
          "Shop"
        ],
        "shop_name_not_numeric": true
      },
      "expected_headers_strict": true,
      "line_endings": "LF",
      "negative_terms": [
        "diy",
        "tutorial",
        "free",
        "plated",
        "kit",
        "supplies",
        "raw",
        "pdf",
        "pattern"
      ],
      "shopname_numeric_guard": {
        "on_numeric": "HALT: ShopName_NUMERIC_FORBIDDEN"
      },
      "similar_keywords": {
        "bom": false,
        "dedupe_key": "Keyword",
        "expected_headers": [
          "Keyword",
          "Search volume",
          "3mo. change",
          "Competition",
          "Sales",
          "Score",
          "undefined",
          "Search to competition ratio",
          "Google top of page bid (low range)",
          "Long-tail keyword",
          "Listing age",
          "Length",
          "Google top of page bid (high range)",
          "Google CPC",
          "Google competition level",
          "Google competition index",
          "Etsy tag",
          "Conversion rate",
          "Competition level",
          "Sales per listing",
          "Annual search trend"
        ],
        "expected_headers_strict": true,
        "filter": {
          "regex_exclude": null,
          "regex_include": null
        },
        "first_field_may_be_unquoted": true,
        "header_map": {
          "3mo. change": [
            "3mo change",
            "3 mo change",
            "3-month change"
          ]
        },
        "line_endings": "LF_OR_CRLF"
      },
      "top_listings": {
        "bom": false,
        "dedupe_key": "coalesce(URL,Title)",
        "expected_headers": [
          "Title",
          "Revenue",
          "LQS",
          "Price",
          "Category",
          "Shop",
          "Sales",
          "Monthly sales",
          "Creator",
          "Product creation era",
          "Views",
          "Video",
          "URL",
          "Tag count",
          "Tags",
          "Review rate",
          "Reviews",
          "Review score",
          "Production partners",
          "Processing time",
          "Min processing time",
          "Max processing time",
          "Favorites",
          "Listing age (days)",
          "Personalization required",
          "Creation date",
          "Listing type",
          "Vintage",
          "Supply item",
          "Personalizable",
          "Image count",
          "Free US shipping",
          "Conversion rate",
          "BSR Category",
          "BSR Category (%)",
          "Monthly revenue"
        ],
        "expected_headers_strict": true,
        "field_types": {
          "Conversion rate": "percent",
          "Monthly revenue": "money",
          "Monthly sales": "int",
          "Price": "money",
          "Revenue": "money",
          "Sales": "int"
        },
        "line_endings": "LF_OR_CRLF",
        "require_shop_name_not_numeric": true,
        "shop_name_map_order": [
          "Shop Name",
          "Seller",
          "Store",
          "Store Name",
          "Seller Name",
          "Shop"
        ]
      }
    },
    "csv_schema_locks": {
      "benzer_anahtar_kelime": {
        "column_count": 21,
        "headers_sha256": "399c1a8c2032da8d91a2689a130f563921a627100e6e27dc550df878ee89d934",
        "on_mismatch": "fail_fast"
      },
      "competitor_shops": {
        "column_count": 36,
        "headers_sha256": "04545a01b89b29e497238d3e711466e7e8bc391936d1115af99c91c25c68549f",
        "on_mismatch": "fail_fast"
      },
      "top_listings_dar": {
        "column_count": 36,
        "headers_sha256": "095c2cea1cffef4307501f10efafb4e8d7e425b894e5655cd9af238f22181098",
        "on_mismatch": "fail_fast"
      }
    },
    "cvs_pre_analysis": {
      "apply_scope": [
        "competitor_shops",
        "similar_keywords",
        "top_listings"
      ],
      "notes": "Bu adımlar analiz öncesi çalışır; JSON içeriğini değiştirmez, sadece rapor üretir.",
      "persist_transform": false,
      "steps": [
        {
          "case_insensitive": true,
          "name": "header_map",
          "punctuation_agnostic": true,
          "tolerance": "loose"
        },
        {
          "empty_keep_as_is": true,
          "name": "dtype_infer",
          "percent_currency_parse": "best_effort",
          "tolerance": "loose"
        },
        {
          "if_missing": "fallback_title_shop",
          "name": "url_key_detect"
        },
        {
          "action": "report_only",
          "name": "dup_preview"
        },
        {
          "accept_literals": [
            "",
            "nan",
            "NaN"
          ],
          "force_nan": false,
          "name": "nan_policy"
        }
      ],
      "strict": false
    },
    "data_freeze": {
      "on_violation": {
        "action": "block",
        "message": "Dondurulmuş veri alanında değişiklik tespit edildi."
      },
      "paths": [
        "/token_tracking",
        "/similar_keywords",
        "/top_listings"
      ]
    },
    "data_management": {
      "atomic_write": {
        "enabled": true,
        "strategy": "write_ahead_log"
      },
      "backups": {
        "enabled": true,
        "retention": 10,
        "versioning": "timestamped"
      },
      "pre_write_snapshot": {
        "artifact": "FINAL_LATEST.snapshot.json",
        "enabled": true
      },
      "update_mapping": {
        "conflict": "explicit_user_approval",
        "mode": "append_only"
      },
      "validation": {
        "lossless": true,
        "nan_forbidden": true,
        "strict_parse": true
      }
    },
    "deletion_policy": {
      "mode": "soft",
      "purge_after_days": 30,
      "purge_consent_pattern": "^ONAY:\\s+KALICI-SIL\\b.+",
      "purge_requires_explicit_consent": true,
      "recycle_bin_path": "/recycle_bin",
      "require_two_step_purge": true
    },
    "delivery_note_required": true,
    "description": {
      "enforce": true,
      "max_words": 180,
      "min_words": 140
    },
    "diff_report": {
      "include_sha": true,
      "include_size": true,
      "list_added_paths": true,
      "list_removed_paths": true,
      "sample_diff_lines": 50
    },
    "display": {
      "on_write_summary": [
        "download_link"
      ],
      "short_summary_fields": [
        "file_name",
        "size_kb",
        "sha256"
      ],
      "short_summary_mode": true
    },
    "dry_run_checks": {
      "enabled": true,
      "min_header_match_pct": 0.9
    },
    "enforcement_mode": "always_strict",
    "example_artifacts": {
      "historical": [],
      "primary": "EXAMPLE_LATEST.json"
    },
    "execution_contract": {
      "allowed_claims": [
        "changed_keys",
        "sha256",
        "size_kb",
        "delta_kb",
        "versioned_copy"
      ],
      "deny_memory_only_claims": true,
      "fail_if_not_in_file": true,
      "onay_equals_write": true,
      "post_write_audit": {
        "echo_changed_keys": true,
        "recalculate_sha": true
      },
      "require_artifact_after_write": true
    },
    "final_artifacts": {
      "historical": [
        {
          "file": "sistem_final_PENDING_FEATURES.PREFLIGHT_LOCKED_PLUS_GUARDED_DEV.json",
          "sha256": "eb510997d50fe096200db8195e2da1c219e32e52b15dd280efbfac430ea269cf"
        }
      ],
      "primary": "FINAL_LATEST.json",
      "receipt_optional": "FINAL_LATEST_RECEIPT.json"
    },
    "final_set_protocol": {
      "description": "Her patch sonrası kullanıcıdan FINAL-SET onayı alınmadan dosya staging kabul edilir. Final SHA sabitlenir.",
      "final_set_command": "KOMUT: FINAL-SET",
      "final_set_consent": "ONAY: FINAL-SET",
      "require_final_set_after_patch": true
    },
    "format_policy": {
      "no_forced_NaN": true,
      "percent_currency_tolerant": true,
      "preserve_input_strings": true
    },
    "governance": {
      "checkpoint": {
        "allow_rollback": true,
        "auto_create_on_critical_mutations": true,
        "enabled": true
      },
      "collision": {
        "block_on_conflict": true,
        "detect_same_json": true
      }
    },
    "gpt_profile": {
      "behavior": {
        "token_warn_pct_ref": 0.8,
        "warn_user_on_threshold": true
      }
    },
    "guards": {
      "no_ui_tables": {
        "enabled": true,
        "on_violation": "BLOCK",
        "type": "ui_policy",
        "ui_preview_enabled": false
      },
      "shop_name_presence": {
        "applies_to": [
          "top_listings",
          "competitor_listings"
        ],
        "enabled": true,
        "map_order_ref": "csv_ingest.*.shop_name_map_order",
        "on_fail": "HALT",
        "reason": "shop_name_missing_or_numeric",
        "require_shop_name_not_numeric": true,
        "type": "field_check"
      },
      "title_subtitle_template": {
        "applies_to": [
          "top_listings",
          "competitor_listings"
        ],
        "enabled": true,
        "on_fail": "HALT",
        "reason": "template_mismatch",
        "rules": {
          "forbid_gemstone_claim": true,
          "subtitle_requires_cues": [
            "business days",
            "tracked",
            "gift",
            "shipping",
            "Processing"
          ],
          "title_requires_tokens": [
            "10K",
            "14K",
            "18K",
            "Gold",
            "Yellow",
            "White",
            "Rose"
          ]
        },
        "type": "template_check"
      }
    },
    "handshake": {
      "accepted_filenames": [
        "FINALLOCK__CANONICAL.json",
        "FINALLOCK__WITH_TRIGGER__PATCHED_v8_relaxed.json"
      ],
      "accepted_globs": [
        "FINALLOCK__WITH_TRIGGER__PATCHED_v*_relaxed.json"
      ],
      "expected": {
        "filename": "FINALLOCK__WITH_TRIGGER__PATCHED_v7_relaxed.json"
      },
      "expected.filename": "FINALLOCK__WITH_TRIGGER__PATCHED_v8_relaxed.json",
      "mode": "relaxed",
      "on_fail": "HALT: JSON_MISSING_OR_MISMATCH",
      "on_filename_mismatch": "HALT: JSON_MISSING_OR_MISMATCH",
      "preferred_filename": "FINALLOCK__CANONICAL.json",
      "relaxed_note": "Relaxed filename is allowed only with active session_handshake PASS",
      "require_actor": "gpt_prod_executor_v1",
      "session_reminder": true
    },
    "hash_verification": {
      "export_hash_required": true,
      "publish_requires_hash_match": true
    },
    "ingest": {
      "datasets": {
        "competitor_listings": {
          "expected_headers": [
            "Title",
            "Monthly sales",
            "Sales",
            "Monthly revenue",
            "Revenue",
            "LQS",
            "Price",
            "Category",
            "Shop",
            "BSR Category (%)",
            "BSR Category",
            "Conversion rate",
            "Creator",
            "Product creation era",
            "Views",
            "Video",
            "URL",
            "Tag count",
            "Tags",
            "Review rate",
            "Reviews",
            "Review score",
            "Production partners",
            "Processing time",
            "Min processing time",
            "Max processing time",
            "Personalization required",
            "Creation date",
            "Favorites",
            "Listing type",
            "Listing age (days)",
            "Vintage",
            "Supply item",
            "Personalizable",
            "Image count",
            "Free US shipping"
          ],
          "step": "6a"
        },
        "similar_keywords": {
          "expected_headers": [
            "Keyword",
            "Search volume",
            "3mo. change",
            "Competition",
            "Sales",
            "Score",
            "Trend status",
            "Search to competition ratio",
            "Google top of page bid (low range)",
            "Long-tail keyword",
            "Listing age",
            "Length",
            "Google top of page bid (high range)",
            "Google CPC",
            "Google competition level",
            "Google competition index",
            "Etsy tag",
            "Conversion rate",
            "Competition level",
            "Sales per listing",
            "Annual search trend"
          ],
          "step": "3"
        },
        "top_listings": {
          "expected_headers": [
            "Title",
            "Revenue",
            "LQS",
            "Price",
            "Category",
            "Shop",
            "Sales",
            "Monthly sales",
            "Creator",
            "Product creation era",
            "Views",
            "Video",
            "URL",
            "Tag count",
            "Tags",
            "Review rate",
            "Reviews",
            "Review score",
            "Production partners",
            "Processing time",
            "Min processing time",
            "Max processing time",
            "Favorites",
            "Listing age (days)",
            "Personalization required",
            "Creation date",
            "Listing type",
            "Vintage",
            "Supply item",
            "Personalizable",
            "Image count",
            "Free US shipping",
            "Conversion rate",
            "BSR Category",
            "BSR Category (%)",
            "Monthly revenue"
          ],
          "step": "5"
        }
      },
      "last_updated_utc": "2025-09-10T18:24:28Z",
      "notes": "CSV ingest tolerant policy: Turkish/Office-2007 friendly; repairs only drop leading index col or trailing empty col; never invent NaN; preserve quotes; block on header length mismatch."
    },
    "integrity": {
      "on_mismatch": "FAIL_AND_REPORT",
      "section_hashes": {
        "csv_rules": "sha256:<auto>",
        "final_safety": "sha256:<auto>",
        "help_steps": "sha256:<auto>",
        "policy_core": "sha256:<auto>",
        "steps": "sha256:<auto>"
      },
      "verify_sections_on": [
        "pre_run",
        "finalize"
      ],
      "algorithm": "sha256",
      "mode": "auto",
      "on_missing": "compute_and_set",
      "section_targets": [
        "/workflow_patches/steps/16",
        "/workflow_patches/steps/17",
        "/_policy/export",
        "/_meta/export_log"
      ]
    },
    "language": {
      "default": "English",
      "tone": "neutral_clean"
    },
    "localization": {
      "language": "tr",
      "office_version": "Office 2007"
    },
    "log_append_only": true,
    "market_restrictions": {
      "alternatives": [
        "US",
        "UK",
        "DE",
        "FR",
        "NL"
      ],
      "closed_countries": [
        "PT",
        "IT",
        "ES",
        "GR"
      ]
    },
    "missing_field": {
      "action": "request_user",
      "severity": "block"
    },
    "modes": {
      "development": {
        "allow_json_updates": true,
        "read_only": false
      },
      "production": {
        "allow_json_updates": false,
        "note": "Üretimde JSON yazımı kapalı; yalnızca kayıt/audit yapılır.",
        "read_only": true
      }
    },
    "nlp": {
      "allow_paraphrase": false,
      "allow_synonyms": false,
      "interpretation_tolerance": "none",
      "require_verbatim_keywords": [
        "SIL",
        "EKLE",
        "GÜNCELLE",
        "GERI-AL"
      ]
    },
    "pack_guard": {
      "enforce": true,
      "max_updates_per_pack": 3,
      "mode": "micro",
      "on_violation": "FAIL_AND_REPORT"
    },
    "patch_cadence": {
      "day": "Monday",
      "hour": "09:00",
      "require_diff_report": true,
      "schedule": "weekly",
      "timezone": "Europe/Istanbul"
    },
    "preflight": {
      "checks": {
        "encodings_try": [
          "utf-8",
          "latin1",
          "windows-1254",
          "iso-8859-1"
        ],
        "sample_rows": 10,
        "verify_headers": true,
        "verify_primary_field": true
      },
      "enabled": true,
      "on_fail": "block",
      "report_path": "/reports/preflight/${RUN_ID}.json"
    },
    "pricing": {
      "discount_rule": {
        "apply_in": [
          "competitor_analysis",
          "popular_product_analysis",
          "internal_metrics",
          "decision_logic"
        ],
        "default": "apply_except_suppressed",
        "description": "Discount is applied in analyses but never appears in public texts.",
        "suppress_in": [
          "title",
          "description",
          "tags"
        ]
      }
    },
    "production_modes": {
      "default_mode": "preview",
      "non_write_aliases": [
        "preview",
        "test",
        "example"
      ],
      "require_step22_confirmation": true,
      "write_allowed": [
        "live",
        "etsy_listing"
      ]
    },
    "reasoning_framework": {
      "always_apply": true,
      "enabled": true,
      "notes": "Her durumda 3 adımlı çerçeve uygulanır; yanlışsa yanlış denir, abartı/oyalama yapılmaz.",
      "steps": [
        "destek",
        "karşı",
        "denge"
      ],
      "wrong_allowed": true
    },
    "records": {
      "aliases": {
        "example": "ornek",
        "örnek": "ornek"
      },
      "blocked": [],
      "canonical_types": [
        "final",
        "ornek"
      ]
    },
    "reminder_adjust": {
      "notes": "Prevents overlapping reminder noise",
      "offset_minutes": [
        0,
        30
      ],
      "suppress_duplicates": true
    },
    "reminder_meta": {
      "bi_daily": true,
      "bi_hourly": true,
      "hourly": true
    },
    "reporting": {
      "delivery_format": "sha_kb_delta_link",
      "delta_log": {
        "enabled": true,
        "fields": [
          "filename",
          "size_kb",
          "sha256",
          "prev_sha256",
          "delta_kb",
          "timestamp"
        ],
        "keep_last": 20
      },
      "progress_tracking": {
        "enabled": true,
        "milestones": [
          "3.b_draft_ready",
          "9_12_refined",
          "20_QA_passed",
          "22_user_approved"
        ]
      },
      "weekly_schedule": "WEEKLY SUN 19:00 Europe/Istanbul",
      "weekly_summary": true
    },
    "reproducibility": true,
    "rollback": {
      "one_click": {
        "atomically_restore": [
          "/_policy/handshake/expected.filename",
          "/_policy/audit/releases:last"
        ],
        "enable": true,
        "revert_to": "previous_release_id"
      }
    },
    "safety": {
      "block_on_synonym_or_paraphrase": true,
      "hard_block_on_ambiguous_intent": true,
      "hard_block_on_policy_violation": true,
      "min_confidence_for_intent": 1.0
    },
    "schema": {
      "change_allowed": false,
      "require_schema_phrase": "ONAY: ŞEMA <açıklama>"
    },
    "scope": {
      "apply_to": [
        "write_pipeline",
        "restore",
        "batch_enforcer",
        "dry_run_enforcer",
        "alert_router"
      ],
      "guards_scope": "json_updates_only"
    },
    "scope_note": "Sayaç/restore kuralları yalnızca JSON güncellemelerinde geçerlidir; üretim adımlarına uygulanmaz.",
    "scoring": {
      "enforce": true,
      "rank_formula": "(search_volume * score) / competition",
      "similarity_penalty_threshold": 0.8
    },
    "section_checksums": {
      "fields": [
        "competitor_shops",
        "similar_keywords",
        "top_listings"
      ],
      "include_in_json": true,
      "method": "sha8"
    },
    "security": {
      "block_dangerous_writes": true,
      "sandbox_only": true,
      "size_shrink_guard": {
        "compare_basis": "bytes",
        "description": "If returned JSON is smaller than the source by any amount, investigate and request user approval before delivering.",
        "investigation_requirements": [
          "List removed keys/paths with counts",
          "Show diff summary of arrays/strings trimmed",
          "Explain why shrink occurred (whitespace, normalization, data loss, etc.)",
          "Attach before/after SHA-256 and sizes"
        ],
        "message": "SIZE_GUARD: Output JSON shrank. Investigation + user approval required.",
        "on_violation": "block_and_request_approval",
        "threshold_bytes": 1,
        "threshold_percent": 0.0,
        "user_prompt_required": true
      }
    },
    "self_tests": {
      "block_on_any_shrink": false,
      "block_on_shrink_over_threshold": true,
      "deny_on_missing_exact_phrase": true,
      "enabled": true,
      "mode_on_restore": "paranoid",
      "quiet_mode": true,
      "require_alert_delivery_on_any_write": true,
      "require_audit_entry_on_any_write": true,
      "require_autofix_on_any_write": true,
      "require_manual_approval_on_shrink": true,
      "require_notice_on_any_write": true,
      "require_notice_on_size_change": true,
      "shrink_threshold_bytes": 0
    },
    "session": {
      "bootstrap": {
        "deny_memory_fallback": true,
        "require_final_upload": true,
        "source_of_truth_path": "/final_marker/sha256"
      },
      "lifecycle": {
        "on_close": {
          "ops": [
            {
              "op": "snapshot",
              "target": "/final/.snapshots"
            },
            {
              "key": "/runtime/last_session_closed_cleanly",
              "op": "mark",
              "value": true
            }
          ]
        },
        "on_commit": {
          "ops": [
            {
              "by": 1,
              "op": "inc",
              "path": "/token_tracking/update_counter"
            },
            {
              "key": "/runtime/last_write_at",
              "op": "mark",
              "value": "<ISO8601-now>"
            },
            {
              "op": "set",
              "path": "/runtime/last_write_at",
              "value": "${ISO8601}"
            }
          ]
        },
        "on_crash": {
          "ops": [
            {
              "dir": "/final/.snapshots",
              "op": "restore_last_consistent_snapshot"
            },
            {
              "op": "replay_wal",
              "path": "/final/.wal"
            }
          ]
        }
      },
      "restore": {
        "ack_phrase_pattern": "^ONAY:\\s+RESTORE-OK$",
        "enabled": true,
        "hooks": {
          "pre_unblock": [
            {
              "op": "set",
              "path": "/token_tracking/update_counter",
              "value": 0
            },
            {
              "op": "set",
              "path": "/token_tracking/reset_reason",
              "value": "restore_every_write"
            },
            {
              "op": "set",
              "path": "/token_tracking/reset_at",
              "value": "<ISO8601-now>"
            }
          ]
        },
        "report_format": "markdown",
        "report_target_dir": "/reports",
        "require_ack_after_restore": true
      }
    },
    "step_flow_lock": {
      "canonical_order": [
        "0 Başlangıç/Hazırlık",
        "1.a Görsel Analizi",
        "1.b Alura Arama Önerileri",
        "3 Similar Keywords Upload",
        "3.a Odak Anahtar Kelime + Türetilenler",
        "3.b Taslak Paket — DRAFT",
        "5 Top Listings Upload (Dar)",
        "7 Competitor Shops Upload",
        "5a Popüler Ürünler Analizi",
        "5b Rakip Mağaza Seçimi",
        "8 Market Aggregation & Ads Generation",
        "8A Aggregate",
        "8B Ads Keyword Generation",
        "9 SEO Keyword Refinement",
        "10 SEO Title Generation",
        "11 SEO Description Generation",
        "12 Tags Generation",
        "16 Görsel Analiz & SEO Uyumu",
        "17 İlk 5 + Uyumluluk",
        "18 Ads Keywords Integration",
        "19 Market Report",
        "20 Final SEO Review (QA)",
        "21 Export Draft Listing",
        "22 User Final Review",
        "23 Finalize/Publish"
      ],
      "display_name_lock": true,
      "lock": true
    },
    "step_params": {
      "1.a": {
        "confidence": {
          "stone_min": 0.9
        },
        "extract": [
          "product_type",
          "color",
          "stone",
          "metal",
          "finish",
          "style"
        ],
        "max_images": 8,
        "usage_scenarios": {
          "count": 6,
          "enabled": true,
          "max_words": 6,
          "min_words": 2
        }
      },
      "1.b": {
        "dedupe": true,
        "grouping": {
          "enabled": true,
          "max_groups": 4
        },
        "max_words": 2,
        "min_words": 2,
        "suggestion_count": 8
      }
    },
    "style": {
      "prohibited_phrases": [
        "Yardımcı olabileceğim başka bir şey var mı?"
      ]
    },
    "tags": {
      "enforce": true,
      "severity": "warn",
      "target_count": 13
    },
    "telemetry": {
      "final_sha_path": "/final_marker/sha256",
      "log_final_sha_on_run": true,
      "run_log_path": "/logs/runs/${ISO_DATE}.log"
    },
    "timezone": "Europe/Istanbul",
    "token_tracking": {
      "block_threshold_pct": 95,
      "warn_threshold_pct": 80
    },
    "top_level_meta": {
      "changes_history": false,
      "notes": "Top-level meta fields intentionally disabled; tracked via _policy and external log",
      "token_tracking_top": false
    },
    "ui_rules": {
      "default_render": "plain_text",
      "forbid_download_if_undefined": true,
      "forbid_excel": true
    },
    "user_expectations": {
      "consistency": "new session → first action = load FINAL_LATEST.json",
      "stop_condition": "Başarı sağlanamazsa kullanıcı platformu bırakır; üretim kanıtla ilerler."
    },
    "validation_checklist": [
      "explicit_user_approval alındı mı?",
      "pre_write_snapshot alındı mı?",
      "append_only modunda mı yazıldı?",
      "atomic_write tamamlandı mı?",
      "record_count azalmadı (no_data_loss) mı?",
      "5. güncelleme ise baseline geri yüklendi mi?",
      "1 saat dolduysa baseline geri yüklendi mi?"
    ],
    "version": "1.1.0",
    "versioning": {
      "append_only": true,
      "atomic_write": true,
      "checksum_required_on_write": true,
      "overwrite": false,
      "require_new_version_on_write": true,
      "restore": {
        "consent_pattern": "^ONAY:\\s+GERI-AL\\b.+",
        "enabled": true,
        "require_explicit_consent": true
      },
      "retention": {
        "keep_days": 30,
        "keep_last_versions": 30
      },
      "snapshot": {
        "dir": "/final/.snapshots",
        "keep_last": 10,
        "on_every_write": true
      },
      "soft_delete": true,
      "write_ahead_log": {
        "enabled": true,
        "fsync_on_commit": true,
        "path": "/final/.wal"
      }
    },
    "workflow": {
      "atomic_temp_path": "/tmp/json_write.tmp",
      "atomic_writes": true,
      "context_enforcement": {
        "carry_forward_all_outputs": true,
        "message": "STEP CONTEXT MISSING: Every step must consume all available outputs up to this point.",
        "severity": "block"
      },
      "diff_report_mandatory": true,
      "enforce_guard_chain": [
        "time_daemon_guard",
        "auto_backup",
        "drift_detector",
        "preflight_self_test",
        "batch_enforcer",
        "step_plan_enforcer",
        "update_batch_status",
        "token_limit_tracker",
        "size_change_notice",
        "size_shrink_guard"
      ],
      "fallback_focus_terms": {
        "allowed": false,
        "message": "FOCUS_FALLBACK_FORBIDDEN: If no candidates, stop and request input.",
        "severity": "block"
      },
      "guards": {
        "alert_router": {
          "attention_flag": "/final_marker/attention_required",
          "delivery": {
            "mirror_last_to_ui": true,
            "set_attention_flag": true
          },
          "enabled": true,
          "queue_path": "/runtime/alerts/pending",
          "rules": [
            {
              "message": "5 güncelleme tamam — lütfen 5. dosyayı geri yükleyin.",
              "severity": "warning",
              "when": "batch.reach_max"
            },
            {
              "message": "60 dakika doldu — lütfen son indirdiğiniz JSON’u yeniden yükleyin.",
              "severity": "warning",
              "when": "batch.timeout"
            },
            {
              "message": "Kalan süre ≤5 dk.",
              "severity": "info",
              "when": "status.warn_time"
            },
            {
              "message": "Token kullanımı %80’i geçti.",
              "severity": "info",
              "when": "token.warn_threshold"
            },
            {
              "message": "Token kullanımı %95 — yazım bloke edildi.",
              "severity": "error",
              "when": "token.block_threshold"
            }
          ],
          "sources": {
            "batch": "/_policy/workflow/guards/batch_enforcer",
            "status": "/_policy/workflow/guards/update_batch_status",
            "token": "/_policy/workflow/guards/token_limit_tracker"
          },
          "ui_mirror": "/workflow_patches/ui/system_prompt"
        },
        "auto_backup": {
          "enabled": true,
          "max_entries": 5,
          "target": "/__backups/rolling"
        },
        "batch_enforcer": {
          "action_on_violation": "block",
          "enabled": true,
          "max_updates": 5,
          "on_reach_max": "block_and_require_restore",
          "reset_counter_on_restore": true,
          "timeout_minutes": 60
        },
        "checklist_enforcer": {
          "enabled": true,
          "mode": "auto_fix_then_silent"
        },
        "competitor_selection_enforcer": {
          "action_on_violation": "block",
          "csv_rule_ref": "_csv_rules.csv_duzeltme_tanimlari.competitor_shops",
          "enabled": true,
          "max_selected": 4,
          "messages": {
            "missing_csv": "Seçilen mağaza(lar) için Competitor Shops CSV eksik veya hatalı.",
            "not_in_top8": "Seçilen mağaza öneri listesinden (Top8) değil.",
            "too_many": "En fazla 4 mağaza seçilebilir."
          },
          "require_csv_for_selected": true,
          "requires_from": "/runtime/recommendations/top8_shops",
          "type": "selection/competitors"
        },
        "csv_benzer_anahtar_kelime_check": {
          "action_on_violation": "block",
          "enabled": true,
          "note": "Kullanıcı CSV yüklemelerinde başlık/kural kontrolü",
          "rules_ref": "_csv_rules.csv_duzeltme_tanimlari.benzer_anahtar_kelime",
          "type": "csv_validation"
        },
        "csv_competitor_shops_check": {
          "action_on_violation": "block",
          "enabled": true,
          "note": "Rakip Mağaza CSV yüklemesi kontrolü",
          "rules_ref": "_csv_rules.csv_duzeltme_tanimlari.competitor_shops",
          "type": "csv_validation"
        },
        "csv_top_listings_dar_check": {
          "action_on_violation": "block",
          "enabled": true,
          "note": "Top Listings CSV yüklemesi kontrolü",
          "rules_ref": "_csv_rules.csv_duzeltme_tanimlari.top_listings_dar",
          "type": "csv_validation"
        },
        "drift_detector": {
          "action_on_drift": "block_and_prompt_restore",
          "digest_source_paths_ref": "/_policy/integrity/required_paths",
          "digest_target_path": "/final_marker/core_digest",
          "enabled": true
        },
        "dry_run_enforcer": {
          "enabled": true,
          "mode": "block_on_any_issue"
        },
        "enforce_ship_countries": {
          "allowed": [
            "CA",
            "US",
            "DE",
            "GB",
            "FR"
          ],
          "block_on_violation": true,
          "enabled": true
        },
        "explicit_command_enforcer": {
          "action_on_violation": "block",
          "enabled": true,
          "require_both_consent_and_command": true
        },
        "final_gate_enforcer": {
          "block_on_missing_required_inputs": true,
          "enabled": true,
          "step": "16"
        },
        "hide_discount_in_outputs": {
          "block_on_violation": true,
          "enabled": true,
          "paths": [
            "/_product_static/discount",
            "/workflow_patches/steps/*/outputs/discount"
          ]
        },
        "nonfinal_write_gate": {
          "action_on_violation": "block",
          "enabled": true,
          "rule": "write.target_path NOT UNDER /final/**"
        },
        "ornek_must_equal_final": {
          "action_on_violation": "block",
          "enabled": true
        },
        "popular_products_analysis": {
          "action_on_violation": "block",
          "enabled": true,
          "input_csv_ref": "_csv_rules.csv_duzeltme_tanimlari.top_listings_dar",
          "notes": "Top Listings (Dar) üzerinden mağaza skoru hesaplar ve en iyi 8 mağazayı önerir.",
          "output": {
            "dest_path": "/runtime/recommendations/top8_shops",
            "include_fields": [
              "Shop",
              "score",
              "Monthly revenue",
              "Monthly sales",
              "LQS",
              "Conversion rate",
              "Review score",
              "Favorites"
            ],
            "top_n": 8
          },
          "selection": {
            "group_by": "Shop",
            "metrics": [
              "Monthly revenue",
              "Monthly sales",
              "Revenue",
              "Sales",
              "LQS",
              "Conversion rate",
              "Reviews",
              "Review score",
              "Favorites",
              "Listing age (days)"
            ],
            "min_monthly_sales": 1,
            "min_samples_per_shop": 3,
            "normalize": true,
            "score_formula": "z(Monthly revenue)*0.35 + z(Monthly sales)*0.25 + z(LQS)*0.15 + z(Conversion rate)*0.1 + z(Review score)*0.1 + z(Favorites)*0.05"
          },
          "type": "analysis/top_listings"
        },
        "post_restore_self_audit": {
          "actions": {
            "on_failure": "block_and_prompt_reupload",
            "on_success": "require_ack_then_unblock"
          },
          "enabled": true,
          "lookback_writes": 5,
          "report": {
            "include": [
              "self_tests.results",
              "validation_checklist.status",
              "size_shrink_guard.events",
              "token_limit_tracker.events",
              "alerts.last_5_writes",
              "diff.core_digest",
              "batch.counter_and_reset_reason"
            ],
            "path_template": "/reports/restore_${ISO8601}.md"
          },
          "steps": [
            "run_self_tests_full",
            "recompute_core_digest",
            "verify_integrity_required_paths"
          ],
          "trigger": "on_restore"
        },
        "precommit_counter_gate": {
          "action_on_violation": "block",
          "deny_if_update_counter_ge": 5,
          "enabled": true
        },
        "preflight_diff": {
          "allowed_write_paths": [
            "/steps/*/title",
            "/steps/*/ui_directives",
            "/steps/*/validations",
            "/steps/*/outputs",
            "/steps/*/enforcement",
            "/_run_order/steps/*",
            "/_run_order/strict",
            "/_run_order/enforce_strict_sequence",
            "/_run_order/allow_skip",
            "/display_name_lock",
            "/step_title_lock"
          ],
          "compare_fingerprints": [
            "/token_tracking",
            "/similar_keywords",
            "/top_listings",
            "/_policy"
          ],
          "on_unexpected_diff": {
            "action": "block",
            "message": "Beklenmeyen değişiklik algılandı (örn. token_tracking/similar_keywords/top_listings/_policy). Üretim durduruldu."
          }
        },
        "preflight_self_test": {
          "enabled": true,
          "fail_if_step_name_missing": true,
          "fail_if_step_type_missing": true,
          "fail_on_missing_dependencies": true
        },
        "read_only_enforcer": {
          "enabled": true,
          "fail_on_write_attempt": true,
          "no_write_during_run": true
        },
        "render_banners": {
          "enabled": true,
          "sources": {
            "status_path": "/runtime/batch/status",
            "token_estimate_path": "/token_tracking/limit_estimate"
          },
          "targets": {
            "global": "/workflow_patches/ui/global_banner_rendered",
            "token": "/workflow_patches/ui/token_banner_rendered"
          },
          "templates": {
            "global": "/workflow_patches/ui/global_banner",
            "token": "/workflow_patches/ui/token_banner"
          }
        },
        "require_pre_start_confirmation": {
          "block_on_false": true,
          "enabled": true,
          "field": "/workflow_patches/steps/0/outputs/review_confirmed",
          "message": "Lütfen Step 0 ön incelemeyi onaylayın.",
          "step_id": "0"
        },
        "require_prices_at_step0": {
          "enabled": true,
          "mode": "prompt_and_continue",
          "paths_required": [
            "/_product_static/variation_prices/10K",
            "/_product_static/variation_prices/14K",
            "/_product_static/variation_prices/18K"
          ],
          "scope_step_id": "0"
        },
        "restore_on_every_write": {
          "action_on_violation": "block_and_require_restore",
          "enabled": true,
          "note": "Her yazmada restore zorunlu",
          "rule": "any_write",
          "trigger": "on_precommit"
        },
        "restore_on_ingest": {
          "action_on_violation": "block_and_require_restore",
          "enabled": true,
          "note": "CSV/görsel/pack/config her ingest’te restore",
          "rule": "ingest.type IN [csv,image,pack,config]",
          "trigger": "on_precommit"
        },
        "restore_on_new_link": {
          "action_on_violation": "block_and_require_restore",
          "enabled": true,
          "note": "Yeni URL/link görülürse restore zorunlu",
          "rule": "diff.added_urls > 0 OR sources.changed == true",
          "trigger": "on_precommit"
        },
        "restore_review_guard": {
          "actions": {
            "on_failure": "block_and_prompt_reupload",
            "on_success": "require_ack_then_unblock"
          },
          "checks": {
            "checksum_verification": true,
            "command_consent_regex": {
              "require_command_prefix": "KOMUT:",
              "require_consent_prefix": "ONAY:"
            },
            "csv_schema_revalidate": true,
            "final_only_paths": {
              "only_allow": [
                "/final/**"
              ]
            },
            "no_dryrun_issues": true
          },
          "enabled": true,
          "lookback_writes": 5,
          "messages": {
            "on_failure": "Restore sonrası son 5 yazımda ihlal bulundu — lütfen final JSON’u yeniden yükleyin.",
            "on_success": "Restore sonrası son 5 yazım denetimden geçti — ONAY: RESTORE-OK ile devam edin."
          },
          "scope_condition": "op_type == 'json_update'",
          "trigger": "on_restore"
        },
        "self_guard": {
          "abort_on_sha_mismatch": true,
          "enabled": true,
          "respect_read_only": true,
          "verify_on": [
            "run_start",
            "checkpoint",
            "run_end"
          ]
        },
        "size_change_notice": {
          "action": "log_only",
          "always_log": true,
          "enabled": true,
          "min_bytes": 0,
          "notify_on_growth": true,
          "notify_on_shrink": true,
          "observe_policy_writes": true,
          "threshold_pct": 0.001
        },
        "size_shrink_guard": {
          "action": "block",
          "block_on_unknown_reason": true,
          "enabled": true,
          "min_bytes": 4096,
          "require_reason": true,
          "strategy": "hybrid_pct_bytes",
          "threshold_pct": 0.005,
          "tiers": [
            {
              "max_size_bytes": 1000000,
              "min_bytes": 2048,
              "threshold_pct": 0.005
            },
            {
              "max_size_bytes": 5000000,
              "min_bytes": 4096,
              "threshold_pct": 0.003
            },
            {
              "max_size_bytes": 20000000,
              "min_bytes": 8192,
              "threshold_pct": 0.002
            },
            {
              "max_size_bytes": null,
              "min_bytes": 12288,
              "threshold_pct": 0.001
            }
          ],
          "whitelist_reasons": [
            "intentional_delete",
            "log_rotation",
            "artifact_prune",
            "deduplication",
            "normalization"
          ]
        },
        "step_plan_enforcer": {
          "action_on_violation": "block_and_report",
          "aliases_path": "/_policy/workflow/step_id_aliases",
          "allow": {
            "independent_tag": true,
            "rules_glob": "/workflow_patches/rules/*",
            "standalone_tasks_path": "/workflow_patches/standalone_tasks"
          },
          "enabled": true,
          "normalization": "/_policy/workflow/step_id_normalization",
          "run_order_path": "/_run_order/steps",
          "steps_def_path": "/workflow_patches/steps"
        },
        "time_daemon_guard": {
          "action_on_expire": "enqueue_alert_and_block",
          "deadline_field": "deadline_at",
          "enabled": true,
          "minutes_left_field": "minutes_left",
          "mode": "realtime_check",
          "source": "/runtime/batch/status"
        },
        "token_limit_tracker": {
          "block_threshold_pct": 95,
          "enabled": true,
          "warn_threshold_pct": 80
        },
        "update_batch_status": {
          "enabled": true,
          "warn_threshold_minutes": 5
        },
        "validation_checklist": {
          "block_on_invalid_publish_status": true,
          "block_on_missing_export": true,
          "block_on_missing_hash": true,
          "final_publish_checklist_required": true
        },
        "zero_acceptance_strategy": {
          "applies_to_steps": [
            "4",
            "5"
          ],
          "on_zero_acceptance": {
            "action": "propose_tiered_intake",
            "requires_confirmation_at": "5c"
          }
        },
        "required_stops": [
          "0",
          "1",
          "3",
          "6",
          "16"
        ]
      },
      "hitl_checkpoints": [
        "0a",
        "1",
        "3",
        "3a",
        "14",
        "16",
        "18"
      ],
      "no_mutation_during_run": {
        "allowed_phases": [
          "final_export",
          "reseal"
        ],
        "message": "NO_MUTATION: JSON cannot be written during production; only at final export/reseal.",
        "severity": "block",
        "write_lock": true
      },
      "no_reuse_previous_run": {
        "forbid_reuse": true,
        "message": "REUSE_FORBIDDEN: Each run must start clean; no previous staging/output allowed.",
        "severity": "block"
      },
      "notice_backfill": {
        "N": 3,
        "enabled": true
      },
      "observe_policy_writes": true,
      "read_only": true,
      "skip_forbidden": {
        "forbid_skip": true,
        "message": "SKIP_FORBIDDEN: No step/alt-step may be skipped.",
        "severity": "block"
      },
      "step_id_aliases": {
        "1.a": "1a",
        "1.b": "1b",
        "3.a": "3a",
        "3.b": "3b"
      },
      "step_id_normalization": {
        "lowercase": true,
        "strip_dots": true,
        "strip_spaces": true
      },
      "user_approval_required": true,
      "write_pipeline": {
        "check": [
          "step_plan_enforcer",
          "batch_enforcer",
          "size_change_notice",
          "size_shrink_guard",
          "update_batch_status",
          "token_limit_tracker",
          "alert_router",
          "render_banners"
        ],
        "commit": "if_all_pass",
        "dry_run": true,
        "post": [
          "alert_router",
          "render_banners"
        ],
        "pre": [
          "time_daemon_guard",
          "checklist_enforcer",
          "auto_backup",
          "drift_detector",
          "preflight_self_test"
        ]
      },
      "enforcement": {
        "fail_on_violation": true,
        "rollback_switch": false
      },
      "violation_report": {
        "include_path": true,
        "include_expected": true,
        "include_actual": true
      },
      "run_id.strategy": "uuidv4",
      "quarantine_on_fail": true
    },
    "write_pipeline": {
      "add_requires_phrase": "^ONAY:\\s+EKLE\\b.+",
      "allow_implied_write": false,
      "command_pattern": "^KOMUT:\\s+(EKLE|GÜNCELLE|SIL|GERI-AL)\\b.+",
      "delete_requires_phrase": "^ONAY:\\s+KALICI-SIL\\b.+",
      "precommit_checks": {
        "block_on_any_issue": true,
        "on_violation": "block",
        "only_allow_target_paths": [
          "/final/**"
        ],
        "update_counter_must_be_lt": 5
      },
      "require_command_prefix": "KOMUT:",
      "restore_requires_phrase": "^ONAY:\\s+GERI-AL\\b.+",
      "update_requires_phrase": "^ONAY:\\s+GÜNCELLE\\b.+"
    },
    "zip_distribution": {
      "enforce_zip": true,
      "hash_target": "zip",
      "note": "distribute and verify only zipped artefact",
      "enabled": true,
      "filename_pattern": "visible.v{N}.zip",
      "include": [
        "visible.v{N}.json"
      ],
      "hash_algorithm": "SHA256"
    },
    "export": {
      "naming": {
        "pattern": "{channel}.{version}.{date}_{time}.json",
        "defaults": {
          "channel": "strict",
          "version": "v{inc}"
        },
        "clock": {
          "tz": "Europe/Istanbul",
          "format": {
            "date": "yyyyMMdd",
            "time": "HHmm"
          }
        }
      },
      "github": {
        "user": "mertgs190500",
        "repo": "json-proje",
        "branch": "main",
        "raw_link": "https://raw.githubusercontent.com/{user}/{repo}/{branch}/{filename}"
      },
      "fallback": {
        "preferred_mode": "raw_link",
        "raw_link_template": "https://raw.githubusercontent.com/mertgs190500/json-proje/main/{filename}",
        "fallback_mode": "manual_upload",
        "constraints": {
          "must_confirm": true,
          "require_user_task": true,
          "note": "Eğer GPT raw linkten dosyayı çekemezse, kullanıcı aynı dosyayı buradan yüklemelidir. Yükleme yapıldıktan sonra pack üretimi garanti edilir."
        }
      },
      "versioning": {
        "mode": "auto_increment",
        "pattern": "visible.v{N}.json",
        "current": 5
      },
      "hash_policy": {
        "enabled": true,
        "source": "steps.17.export.sha256",
        "record_to": "/_meta/export_log[].export_sha256"
      },
      "zip_distribution": {
        "enabled": true,
        "filename_pattern": "visible.v{N}.zip",
        "include": [
          "{export.filename}"
        ]
      },
      "preflight": [
        "required_paths",
        "section_hashes",
        "zip_hash"
      ]
    },
    "hashes": {
      "steps": {
        "18": {
          "manifest_sha256": "5f5c8a8dd2264029fa3df12d1fd62503a84860b43baa437486e8817cbeb04c45"
        },
        "1a": {
          "manifest_sha256": "2fad853fb0228baf3f2a6341e2eb8f68c2b27fe026174daf78a71eef1ff1b85b"
        },
        "1b": {
          "manifest_sha256": "bc28be71b2979aee19ab107122f446a8f100232a998261599717dfb8ddaf22ab"
        },
        "3a": {
          "manifest_sha256": "eea774dacb2c4d87cbfae761e1b7409b91c50954c9c2fbdb2d763427b28ec275"
        },
        "5a": {
          "manifest_sha256": "92275838732ea0375ce5b8a3efdfe6b86efc11720396534a459ff6a6c73f219e"
        }
      }
    },
    "release": {
      "tag": "final-2025-09-22T20:18:08Z",
      "baseline_sha": "1cbab2e54e09a6851dc78ea710de3ae57ced03fa83b5178300af2f900b6d054c",
      "dt_utc": "2025-09-22T20:18:08Z",
      "by": {
        "name": "Mert Çınar",
        "handle": "@mcinar1905",
        "email": "mcinar1905@gmail.com"
      },
      "notes": "Accepted as final baseline; subsequent changes must be ADD-ONLY."
    },
    "rules_doc": {
      "runtime_refs_resolution": {
        "summary": "Require runtime __REF__ to resolve before advancing beyond current step.",
        "details": [
          "Counter at /_runtime/refs/unresolved_count must be 0.",
          "Global gate HALTs if > 0; boot step emits WARN.",
          "Scan config at /_runtime/refs/scan controls prefixes."
        ]
      }
    }
  },
  "_product_static": {
    "colors": [
      "Yellow Gold",
      "White Gold",
      "Rose Gold"
    ],
    "material": "Gold",
    "olculer": "US 4 – 14¾",
    "renkler": [
      "Yellow Gold",
      "White Gold",
      "Rose Gold"
    ],
    "variation_prices": {
      "10K": "650 USD",
      "14K": "780 USD",
      "18K": "1100 USD"
    }
  },
  "_profiles": {
    "gpt_prod_executor_v1": {
      "determinism": {
        "no_random_fallbacks": true,
        "seed_source": "RUN_ID",
        "stable_sort": true
      },
      "error_texts": {
        "guard_fail": "HALT: GUARD_FAIL",
        "json_missing": "HALT: JSON_MISSING_OR_MISMATCH",
        "session_handshake": "HALT: SESSION_JSON_MISMATCH"
      },
      "handshake_required": true,
      "io_policy": {
        "excel_or_table_preview": false,
        "output_mode": "digest_only",
        "ui_preview_enabled": false
      },
      "languages": {
        "allowed": [
          "en",
          "tr"
        ],
        "default": "en",
        "rules": {
          "listing_text": {
            "language": "en"
          },
          "search_suggestions_1b": {
            "language": "en",
            "token_limit": {
              "exact": 2,
              "type": "words"
            },
            "top_n": 8
          }
        }
      },
      "privacy": {
        "no_external_calls": true,
        "redact_pii": true
      },
      "rate_limits": {
        "max_steps_per_run": 200,
        "max_tokens_per_step_hint": 2000
      },
      "respect_guards": {
        "halt_on_fail": true,
        "no_auto_fix": true,
        "no_policy_additions_runtime": true
      },
      "roles": [
        "SEO_Specialist",
        "Data_Engineer",
        "Runtime_Orchestrator",
        "Compliance_Officer",
        "Copy_Crafter_EN"
      ],
      "summary": "Deterministik üretim yürütücüsü: SEO + veri/CSV işleme + içerik montajı. Sadece JSON’daki kuralları uygular, UI/tablo açmaz, guard fail olursa HALT eder."
    }
  },
  "_run_order": {
    "allow_skip": false,
    "apply_defaults_on_load": true,
    "enforce_strict_sequence": true,
    "labels": {
      "0": "Product Info (read-only)",
      "00": "Self-Check",
      "0a": "Pre-Run Prep (Light)",
      "1": "Görselleri Yükleme",
      "10": "Başlık (Title)",
      "11": "Açıklama (Description)",
      "12": "Etiketler (Tags)",
      "13": "Görsel Analiz & SEO Uyumu",
      "14": "Uyumluluk Kontrolü",
      "15": "Ads Entegrasyonu",
      "16": "Final Listing Assembly",
      "17": "Export CSV",
      "18": "Publish Checklist",
      "19": "Monitoring",
      "1a": "Görsel Analizi",
      "1b": "Alura Arama Önerileri",
      "20": "Audit",
      "21": "Spam Guard (Category + Product)",
      "3": "CSV Yükleme (Kullanıcı CSV)",
      "3a": "Odak Anahtar Kelime + Havuz",
      "3b": "Taslak Paket — DRAFT",
      "4": "Top Listings Upload (Dar)",
      "5a": "Popüler Ürünler Analizi",
      "5b": "Rakip Mağaza Seçimi",
      "7": "Market Aggregation & Ads Prep",
      "8A": "Aggregate",
      "8B": "Ads Keyword Generation",
      "9": "SEO Keyword Refinement",
      "seo_package": "SEO Package QC"
    },
    "source_of_truth": "user_defined",
    "step_defaults": {
      "enforcement": {
        "no_skip": true,
        "on_violation": "block"
      },
      "ui_directives": {
        "force_visible": true,
        "show": [
          "rule_check",
          "summary"
        ]
      },
      "validators_required": true
    },
    "steps": {
      "0": {
        "auto_continue": true,
        "await_user": false,
        "requires": [],
        "requires_context": true,
        "title": "Product Info (read-only) — Kullanıcı Onayı",
        "validators": [
          {
            "fn": "equals",
            "left": "outputs.step0_review_confirmed",
            "right": true
          },
          {
            "id": "require_verbatim_block",
            "message": "STEP0_REQUIRED: Verbatim Product/Store info must be present and shown before production starts.",
            "paths": [
              "/steps/0/product_info/logistics",
              "/steps/0/product_info/fixed_product",
              "/steps/0/summary"
            ],
            "severity": "block",
            "type": "presence_block"
          }
        ],
        "enabled": true,
        "purpose": "Product Info (read-only) — Kullanıcı Onayı",
        "description": "product_record kaydını ekranda gösterir; veri tek kaynaktan okunur.",
        "outputs_expected": [
          "outputs.review_confirmed"
        ],
        "outputs": [
          "outputs.review_confirmed"
        ],
        "inputs": {
          "product_info": "read-only özet",
          "user_confirmation": "true/false"
        },
        "checklist": [
          "Ürün adı/model doğru mu?",
          "Varyant/renk/doğru mu?",
          "Fiyat/vergi kontrol"
        ],
        "what_gpt_does": [
          "Ürün özetini gösterir",
          "Eksik alanları işaretler"
        ],
        "what_user_does": [
          "Onaylar veya düzeltir"
        ],
        "content_language": "en-US",
        "market_region": "US",
        "mapping": {
          "title_frontload": [
            "product_type",
            "metal_karat",
            "personalization",
            "final_focus_keyword"
          ],
          "description_first_sentence": [
            "final_focus_keyword",
            "product_type",
            "metal_karat",
            "personalization"
          ]
        },
        "product_info": {
          "fixed_product": {
            "colors": [
              "Yellow Gold",
              "White Gold",
              "Rose Gold"
            ],
            "discount_percent_hidden": 30,
            "sizes_us": "US 4–14¾",
            "stone_policy": {
              "provided_by_user": true,
              "use_gpt_visual_inference_if_confidence_gte": 0.9,
              "use_in_production": true
            },
            "variations": [
              {
                "karat": "10K",
                "price_usd": "450"
              },
              {
                "karat": "14K",
                "price_usd": "750"
              },
              {
                "karat": "18K",
                "price_usd": "1200"
              }
            ],
            "variant_pricing_usd": {
              "10K": "xxx USD",
              "14K": "xxx USD",
              "18K": "xxx USD"
            },
            "discount": {
              "rate": 0.3,
              "visible_in_outputs": false
            },
            "logistics": {
              "handling_time_business_days": "1–3",
              "shipping_fee": "free",
              "packaging": "Özel kutu + hediye notu",
              "customs_note": "Satıcı gümrük vergisini öder",
              "ship_to_countries": [
                "Canada",
                "United States",
                "Germany",
                "United Kingdom",
                "France"
              ],
              "delivery_time_business_days": "2–5",
              "tracking": true
            },
            "pricing": {
              "10K": "xxx USD",
              "14K": "xxx USD",
              "18K": "xxx USD"
            }
          },
          "logistics": {
            "customs_duties_payer": "seller",
            "delivery_estimate_business_days": {
              "max": 5,
              "min": 2
            },
            "destinations": [
              "Canada",
              "United States",
              "Germany",
              "United Kingdom",
              "France"
            ],
            "handling_time_business_days": {
              "max": 3,
              "min": 1
            },
            "origin_country": "Türkiye",
            "packaging": "Özel kutu + hediye notu eklenebilir.",
            "shipping_fee": "Ücretsiz kargo",
            "shipping_profile": "LUXURYJEWELERY",
            "tracking": true
          }
        },
        "artifacts": {
          "outputs_review_confirmed": {
            "__MIRRORED_PLACEHOLDER__": "outputs.review_confirmed"
          }
        },
        "shop_profile": {
          "handling_time_business_days": "1–3",
          "shipping_fee": "free",
          "packaging": "Özel kutu + hediye notu",
          "customs_note": "Satıcı gümrük vergisini öder",
          "ship_to_countries": [
            "Canada",
            "United States",
            "Germany",
            "United Kingdom",
            "France"
          ],
          "delivery_time_business_days": "2–5",
          "tracking": true
        },
        "market": {
          "target_countries": [
            "Canada",
            "United States",
            "Germany",
            "United Kingdom",
            "France"
          ]
        },
        "language": {
          "preferred": "en",
          "notes": "Preferred content language for listings/UI; change here to persist across sessions."
        },
        "currency": {
          "primary": "USD"
        },
        "units": {
          "size": "US"
        },
        "workflow_patches": {
          "governance": {
            "required_rule_ids": [],
            "required_requires": {}
          },
          "steps": {}
        },
        "user_upload": {
          "photos": [],
          "video": null
        },
        "name": "Product Info (read-only) — Kullanıcı Onayı",
        "authoritative_manifest_ref": {}
      },
      "00": {
        "auto_continue": true,
        "await_user": false,
        "requires_context": true,
        "title": "Sistem Başlatma / Ön Yük",
        "validators_required": false,
        "ui_output": {
          "force_plain_text": true,
          "disable_autonumbering": true,
          "disable_bullets": true
        },
        "enabled": true,
        "purpose": "Sistem Başlatma / Ön Yük",
        "description": "Patch sonrası otomatik doğrulama: required_rule_ids ve required_requires kontrolü. PASS değilse kritik akışlar durur.",
        "inputs": [
          "workflow_patches.steps{}",
          "workflow_patches.governance.required_rule_ids{}",
          "workflow_patches.governance.required_requires{}"
        ],
        "outputs": [
          "self_check.report{}",
          "self_check.missing[]",
          "self_check.status",
          "self_check.timestamp",
          "boot.session.fingerprint",
          "boot.session.profile{}",
          "boot.env.summary{}",
          "boot.sot.sources{}",
          "boot.hashes{}",
          "boot.id_aliases{}",
          "boot.enabled_steps{}",
          "boot.sequence[]",
          "boot.learned_prefs{}",
          "boot.health{}"
        ],
        "enforcement": {
          "on_violation": "warn"
        },
        "outputs_expected": {},
        "checklist": [],
        "what_gpt_does": [],
        "what_user_does": [],
        "rules": [
          {
            "id": "BLOCK_IF_GUARDS_FAILED",
            "assert": "ctx?.prev_passed === true",
            "on_fail": [
              "halt",
              "explain: '0a guardları PASS olmadan üretim başlatılamaz.'"
            ]
          }
        ],
        "mirror": {
          "workflow_patches": {
            "steps": {
              "0": {
                "constraints": {
                  "must_confirm": true,
                  "no_skip": true,
                  "require_gpt_task": false,
                  "require_user_task": true,
                  "require_validations_pass": false
                },
                "description": "product_record kaydını ekranda gösterir; veri tek kaynaktan okunur.",
                "display_contract": {
                  "block_until_user_ack": true,
                  "prompt_to_user": "Yukarıdaki Product Info tam görünümüdür. Değişiklik var mı? (EVET/HAYIR). EVET ise alan=değer biçiminde yazın.",
                  "render_full": true,
                  "show_paths": [
                    "/workflow_patches/steps/0/constraints",
                    "/workflow_patches/steps/0/description",
                    "/workflow_patches/steps/0/flow",
                    "/workflow_patches/steps/0/gates",
                    "/workflow_patches/steps/0/hitl_contract",
                    "/workflow_patches/steps/0/name",
                    "/workflow_patches/steps/0/next",
                    "/workflow_patches/steps/0/outputs",
                    "/workflow_patches/steps/0/preconditions",
                    "/workflow_patches/steps/0/product_info",
                    "/workflow_patches/steps/0/requires",
                    "/workflow_patches/steps/0/ruleset",
                    "/workflow_patches/steps/0/title",
                    "/workflow_patches/steps/0/ui",
                    "/workflow_patches/steps/0/upstream_signature",
                    "/workflow_patches/steps/0/user_task",
                    "/workflow_patches/steps/0/validations"
                  ],
                  "title": "STEP 0 — PRODUCT INFO (TAM GÖRÜNÜM)"
                },
                "flow": {
                  "guard": {
                    "advance_only_if": []
                  },
                  "on_success_next": "00"
                },
                "gates": {
                  "must": [
                    "validations_ok"
                  ],
                  "on_contract_violation": "halt_and_report",
                  "on_miss": "halt",
                  "on_missing_required_path": "halt_and_report",
                  "on_soft_misalignment": "warn_and_continue"
                },
                "hitl_contract": {
                  "gpt_tasks": [],
                  "user_tasks": []
                },
                "name": "Product Info (read-only) — Kullanıcı Onayı",
                "next": [
                  "00"
                ],
                "outputs": {
                  "review_confirmed": true
                },
                "preconditions": {
                  "critical_pass": {
                    "require_ancestors_done": [
                      "0",
                      "1",
                      "3",
                      "6",
                      "16"
                    ]
                  }
                },
                "product_info": {
                  "fixed_product": {
                    "colors": [
                      "Yellow Gold",
                      "White Gold",
                      "Rose Gold"
                    ],
                    "discount_percent_hidden": 30,
                    "sizes_us": "4–14¾",
                    "stone_policy": {
                      "provided_by_user": true,
                      "use_gpt_visual_inference_if_confidence_gte": 0.9
                    },
                    "variations": [
                      {
                        "karat": "10K",
                        "price_usd": "450"
                      },
                      {
                        "karat": "14K",
                        "price_usd": "750"
                      },
                      {
                        "karat": "18K",
                        "price_usd": "1200"
                      }
                    ]
                  },
                  "logistics": {
                    "customs_duties_payer": "seller",
                    "delivery_estimate_business_days": {
                      "max": 5,
                      "min": 2
                    },
                    "destinations": [
                      "Canada",
                      "United States",
                      "Germany",
                      "United Kingdom",
                      "France"
                    ],
                    "handling_time_business_days": {
                      "max": 3,
                      "min": 1
                    },
                    "origin_country": "Türkiye",
                    "packaging": "Özel kutu + hediye notu eklenebilir.",
                    "shipping_fee": "Ücretsiz kargo",
                    "shipping_profile": "LUXURYJEWELERY",
                    "tracking": true
                  },
                  "ads": {
                    "daily_budget_usd": 10,
                    "target_market": "US",
                    "target_locale": "en-US"
                  }
                },
                "requires": [],
                "ruleset": [
                  {
                    "id": "REQUIRE_PRODUCT_RECORD_PRESENT",
                    "params": {}
                  },
                  {
                    "id": "DISPLAY_PRODUCT_RECORD_SUMMARY",
                    "params": {
                      "source": "product_record"
                    }
                  },
                  {
                    "id": "BLOCK_IF_MISSING",
                    "params": {}
                  }
                ],
                "title": "Product Info (read-only) — Kullanıcı Onayı",
                "ui": {
                  "review_paths": [
                    "/_product_static/colors",
                    "/_product_static/discount",
                    "/_product_static/ring_sizes_us",
                    "/_product_static/stone_policy",
                    "/_product_static/variation_prices",
                    "/_store_profile/*"
                  ],
                  "title": "Ön İnceleme (Step 0)"
                },
                "upstream_signature": {
                  "policy": "mark_stale_on_upstream_change"
                },
                "user_task": {
                  "confirm": "review_confirmed",
                  "read": [
                    "product_info.logistics",
                    "product_info.fixed_product"
                  ]
                },
                "validations": {
                  "review_confirmed_is_true": {
                    "equals": true,
                    "field": "outputs.review_confirmed",
                    "__REF__": "/_run_order/steps/0/outputs/0"
                  }
                },
                "display": {
                  "render_full": true,
                  "sections_auto": [
                    {
                      "title": "Review Confirmed",
                      "bind": "review_confirmed"
                    }
                  ]
                },
                "label": "Product Info (read-only) — Kullanıcı Onayı",
                "await_user": true,
                "require_user_confirm": true,
                "no_skip": true
              },
              "00": {
                "constraints": {
                  "must_confirm": false,
                  "no_skip": true,
                  "require_gpt_task": true,
                  "require_user_task": false,
                  "require_validations_pass": true,
                  "status_values": [
                    "PASS",
                    "FAIL"
                  ]
                },
                "description": "Advisory; başarısızlıkta üretimi durdurmaz, uyarı üretir.",
                "flow": {
                  "guard": {
                    "advance_only_if": []
                  }
                },
                "gates": {
                  "must": [
                    "validations_ok"
                  ],
                  "on_contract_violation": "halt_and_report",
                  "on_miss": "halt",
                  "on_missing_required_path": "halt_and_report",
                  "on_soft_misalignment": "warn_and_continue",
                  "on_validation_fail": "halt_and_report"
                },
                "hitl_contract": {
                  "gpt_tasks": [],
                  "user_tasks": []
                },
                "inputs": {
                  "bootstrap_files": [
                    "keyword_maps",
                    "stopwords",
                    "negative_lists",
                    "template_outlines"
                  ],
                  "model_presets": {
                    "title_gen": "v1",
                    "desc_gen": "v1",
                    "tags_gen": "v1"
                  },
                  "cache": {
                    "warm": true
                  }
                },
                "name": "Sistem Başlatma / Ön Yük",
                "next": [
                  "0a"
                ],
                "notes": {
                  "hardened_at": "2025-09-08T20:59:54.302900Z",
                  "__REF__": "/_run_order/steps/5b/outputs/7"
                },
                "outputs": [
                  "self_check.report{}",
                  "self_check.missing[]",
                  "self_check.status",
                  "self_check.timestamp"
                ],
                "preconditions": {
                  "critical_pass": {
                    "require_ancestors_done": [
                      "0",
                      "1",
                      "3",
                      "6",
                      "16"
                    ]
                  }
                },
                "requires": [
                  "0"
                ],
                "rules": [
                  "validate each step has all required ruleset IDs",
                  "validate each step has required 'requires' deps (e.g., 0a for CSV-driven steps)",
                  "produce a detailed report of missing IDs/deps",
                  "self_check.status = PASS if no issues else FAIL"
                ],
                "ruleset": [
                  {
                    "id": "CHECK_REQUIRED_RULE_IDS",
                    "params": {
                      "source": "governance.required_rule_ids"
                    }
                  },
                  {
                    "id": "CHECK_REQUIRED_REQUIRES",
                    "params": {
                      "source": "governance.required_requires"
                    }
                  },
                  {
                    "id": "SELF_CHECK_STATUS_VALUES",
                    "params": {
                      "values": [
                        "PASS",
                        "FAIL"
                      ]
                    }
                  },
                  {
                    "id": "SAFE_COOLDOWN_ENFORCED",
                    "params": {}
                  },
                  {
                    "id": "SAFE_CHECKPOINT_ENFORCED",
                    "params": {}
                  },
                  {
                    "id": "SAFE_REQUIRE_FILENAME_SHA_MATCH",
                    "params": {}
                  },
                  {
                    "id": "SAFE_BLOCK_ON_SUSPECT",
                    "params": {}
                  },
                  {
                    "id": "MUTATION_POLICY_BLOCK",
                    "params": {}
                  },
                  {
                    "id": "MANIFEST_LOCK_ENFORCER",
                    "params": {}
                  },
                  {
                    "id": "INVARIANTS_ENFORCER",
                    "params": {}
                  },
                  {
                    "id": "APPROVAL_GUARD_ENFORCER",
                    "params": {}
                  },
                  {
                    "assert": [
                      "hard_locks.require_filename",
                      "hard_locks.require_sha256"
                    ],
                    "id": "FILE_LOCK_ENFORCED"
                  },
                  {
                    "assert": [
                      "hard_locks.bind_to_session",
                      "hard_locks.require_active_session"
                    ],
                    "id": "SESSION_BIND_ENFORCED"
                  }
                ],
                "title": "Sistem Başlatma / Ön Yük",
                "upstream_signature": {
                  "policy": "mark_stale_on_upstream_change"
                },
                "validations": {
                  "execution_order_defined": true,
                  "external_rules_forbidden": true,
                  "present": true,
                  "source_is_json_only": true
                },
                "display_contract": {
                  "render_full": true,
                  "block_until_user_ack": false
                },
                "stop_for_confirmation": false,
                "is_background": false,
                "label": "Sistem Başlatma / Ön Yük",
                "await_user": true,
                "require_user_confirm": true,
                "no_skip": true,
                "purpose": "Başlangıç servislerini ve ön-kütükleri doğrular; cache ısıtma, preset yükleme, sözlük/şablon önbellekleme.",
                "validators_required": false,
                "enforcement": {
                  "on_violation": "warn"
                },
                "outputs_expected": {
                  "init_ok": true,
                  "logs": []
                },
                "checklist": [
                  "Stopword/negative listeler yüklendi mi?",
                  "Şablonlar cache’e alındı mı?",
                  "Model preset’ler hazır mı?"
                ],
                "what_gpt_does": [
                  "bootstrap_files erişimini doğrular",
                  "cache durumunu kontrol eder",
                  "eksik preset/asset varsa raporlar"
                ],
                "what_user_does": [
                  "Eksik dosyaları yükler",
                  "Bozuk preset/sözlük varsa düzeltir"
                ]
              },
              "0a": {
                "constraints": {
                  "blocking": false,
                  "must_confirm": false,
                  "no_skip": true,
                  "require_gpt_task": true,
                  "require_user_task": false,
                  "require_validations_pass": true,
                  "status_values": [
                    "PASS",
                    "WARN",
                    "FAIL"
                  ]
                },
                "description": "Bloklamaz; uyarı üretir ve raporlar (advisory). 0 (Kullanıcı Onayı) tamamlanmadan 1’e geçilmez.",
                "flow": {
                  "guard": {
                    "advance_only_if": []
                  }
                },
                "gates": {
                  "must": [
                    "validations_ok"
                  ],
                  "on_contract_violation": "halt_and_report",
                  "on_miss": "halt",
                  "on_missing_required_field": "halt_and_request_fix",
                  "on_missing_required_path": "halt_and_report",
                  "on_soft_misalignment": "warn_and_continue",
                  "on_validation_fail": "halt_and_report"
                },
                "hitl_contract": {
                  "gpt_tasks": [],
                  "user_tasks": []
                },
                "inputs": {
                  "env_config": "Ortam ayarları (JSON/YAML)",
                  "runtime_info": "Tarayıcı/istemci sürümleri, saat, timezone",
                  "network_targets": [
                    "github_raw",
                    "cdn",
                    "image_store"
                  ],
                  "storage": {
                    "quota_min_mb": 50,
                    "available_mb": null
                  },
                  "credentials": {
                    "github": "optional",
                    "alura": "optional",
                    "gdrive": "optional"
                  }
                },
                "name": "Ortam Kontrolleri",
                "next": [
                  "1",
                  "3",
                  "6"
                ],
                "notes": {
                  "hardened_at": "2025-09-08T20:59:54.303204Z"
                },
                "outputs": [
                  "csv.prep.output",
                  "prep.report{}",
                  "prep.issues[]",
                  "prep.status",
                  "prep.stats{}"
                ],
                "preconditions": {
                  "critical_pass": {
                    "require_ancestors_done": [
                      "0",
                      "1",
                      "3",
                      "6",
                      "16"
                    ]
                  },
                  "parent_defined": {
                    "exists": true,
                    "path": "/workflow_patches/steps/0"
                  },
                  "step0_review_confirmed": {
                    "equals": true,
                    "path": "/workflow_patches/steps/0/outputs/review_confirmed"
                  }
                },
                "requires": [
                  "00"
                ],
                "rules": [
                  "always-run: true",
                  "non-blocking: true (only WARN, never BLOCK)",
                  "auto-fix encoding (UTF-8), newline normalize (\\n), trim",
                  "type-specific header/field mappers",
                  "dedupe (case/diacritics insensitive)",
                  "tags split normalize (',',';','|') -> ','",
                  "numeric normalize (comma as decimal)",
                  "warn on missing critical fields per type; auto-skip row but continue",
                  "produce prep.report{}, prep.issues[], prep.stats{rows_in, rows_out, skipped, fixed}"
                ],
                "ruleset": [
                  {
                    "id": "ALWAYS_RUN",
                    "params": {
                      "enforced": true
                    }
                  },
                  {
                    "id": "NON_BLOCKING",
                    "params": {
                      "warn_only": true
                    }
                  },
                  {
                    "id": "ENCODING_NORMALIZE",
                    "params": {
                      "encoding": "UTF-8",
                      "newline": "\\n"
                    }
                  },
                  {
                    "id": "TRIM_LOWER_PUNCT_NORMALIZE",
                    "params": {
                      "enabled": true
                    }
                  },
                  {
                    "id": "DEDUPE_POLICY",
                    "params": {
                      "case_insensitive": true,
                      "diacritics_insensitive": true
                    }
                  },
                  {
                    "id": "TAGS_SPLIT_NORMALIZE",
                    "params": {
                      "delims": [
                        ",",
                        ";",
                        "|"
                      ],
                      "target": ","
                    }
                  },
                  {
                    "id": "NUMERIC_NORMALIZE",
                    "params": {
                      "comma_as_decimal": true
                    }
                  },
                  {
                    "id": "WARN_MISSING_CRITICAL",
                    "params": {
                      "fields": {
                        "competitor": [
                          "shop_name",
                          "shop_url"
                        ],
                        "top_listings": [
                          "title",
                          "tags"
                        ]
                      }
                    }
                  },
                  {
                    "id": "REPORT_FIELDS",
                    "params": {
                      "include": [
                        "rows_in",
                        "rows_out",
                        "skipped",
                        "fixed"
                      ]
                    }
                  }
                ],
                "title": "Ortam Kontrolleri",
                "upstream_signature": {
                  "policy": "mark_stale_on_upstream_change"
                },
                "validations": {
                  "colors_defined": {
                    "min_len": 3,
                    "path": "/_product_static/colors"
                  },
                  "present": true,
                  "product_material_present": {
                    "path": "/_product_static/material",
                    "required": true
                  },
                  "variation_prices_complete": {
                    "paths": [
                      "/_product_static/variation_prices/10K",
                      "/_product_static/variation_prices/14K",
                      "/_product_static/variation_prices/18K"
                    ],
                    "required_all": true
                  }
                },
                "control_matrix": {
                  "meta": {
                    "generated_at": "2025-09-13T11:49:46.214728Z",
                    "author": "gpt",
                    "principle": "mirror-all-rules-here",
                    "on_violation": "RUN_FAIL",
                    "merged_at": "2025-09-13T11:55:15.465447Z"
                  },
                  "global": {
                    "digest_only_until_step": 16,
                    "export_policy": {
                      "prefer": "raw_link",
                      "fallback": "manual_upload"
                    },
                    "write_policy": {
                      "mode": "copy_only",
                      "allowed_root": "/final/**"
                    },
                    "required_stops": [
                      0,
                      1,
                      3,
                      4,
                      6,
                      16
                    ],
                    "integrity_checks": [
                      "/_policy/critical.required_paths",
                      "/_policy/integrity.section_hashes",
                      "workflow_patches.steps_registry_lock"
                    ]
                  },
                  "steps": {
                    "0": {
                      "must_confirm": true,
                      "outputs_expected": [
                        "outputs.review_confirmed"
                      ],
                      "show_paths_include": [
                        "/workflow_patches/steps/0/product_info",
                        "/_product_static/variation_prices"
                      ]
                    },
                    "00": {
                      "purpose": "pre-run self-check",
                      "must_confirm": false
                    },
                    "0a": {
                      "purpose": "policy_enforcement_and_integrity_gate",
                      "must_confirm": false,
                      "checks": [
                        "digest_only_enforced",
                        "export_policy_defined",
                        "write_policy_enforced",
                        "required_stops_present",
                        "integrity_checks_pass"
                      ]
                    },
                    "1": {
                      "purpose": "media_upload_qc",
                      "must_confirm": true,
                      "constraints": {
                        "min_images": 5,
                        "formats": [
                          "jpg",
                          "jpeg",
                          "png",
                          "webp"
                        ],
                        "min_short_edge_px": 2000
                      }
                    },
                    "1a": {
                      "purpose": "media_analysis_and_seo_alignment",
                      "must_confirm": false,
                      "outputs_expected": [
                        "media.checklist",
                        "media.issues[]",
                        "media.recommendations[]",
                        "media.qc_report"
                      ]
                    },
                    "1b": {
                      "purpose": "two-word_search_suggestions",
                      "must_confirm": false,
                      "constraints": {
                        "count": 8,
                        "two_word_each": true,
                        "dedupe": true
                      }
                    },
                    "3": {
                      "purpose": "similar_csv_ingestion",
                      "must_confirm": true,
                      "constraints": {
                        "files_required": 8,
                        "keyword_column": "Keyword"
                      }
                    },
                    "3a": {
                      "purpose": "focus_selection_and_pool_build",
                      "must_confirm": false,
                      "constraints": {
                        "min_pool_size": 300,
                        "max_same_root_in_top50": 3,
                        "semantic_similarity_threshold": 0.85,
                        "focus_keywords_count": 4,
                        "notes_required": true,
                        "tie_breakers": [
                          "higher conversion_rate",
                          "higher overall score",
                          "better segment diversification"
                        ],
                        "use_in_3b": 1,
                        "source_mix": {
                          "own_pool": {
                            "min": 0.5,
                            "max": 0.6
                          },
                          "top_products_csv": {
                            "min": 0.2,
                            "max": 0.3,
                            "__REF__": "/_run_order/steps/0a/outputs/0"
                          },
                          "competitors": {
                            "min": 0.1,
                            "max": 0.2,
                            "__REF__": "/_run_order/steps/6a/outputs/0"
                          },
                          "relevance_gate_required": true
                        },
                        "scoring": {
                          "weights": {
                            "volume": 1.0,
                            "competition": -1.0,
                            "ctr": 0.8,
                            "cr": 1.0,
                            "novelty_gain": 0.7,
                            "source_weight": 0.3,
                            "risk_flags": -2.0
                          },
                          "notes": "Normalize inputs to [0,1]; sum weights; higher is better; drop on risk."
                        }
                      },
                      "outputs_expected": [
                        "keywords.drop_log[]",
                        "keywords.focus[1..4].provisional",
                        "keywords.pool.ranked[]",
                        "keywords.pool.tier1.top50[]",
                        "keywords.pool.tier2.next150[]",
                        "keywords.pool.tier3.rest[]",
                        "keywords.segment_coverage",
                        "keywords.selection_notes"
                      ],
                      "seo_requirements": {
                        "search_volume": "required",
                        "competition": "required",
                        "ctr_or_conversion_rate": "required",
                        "long_tail": "required",
                        "title_desc_tag_alignment": "required",
                        "__REF__": "/_run_order/steps/9/outputs/1"
                      },
                      "enforce": {
                        "fail_on_violation": true,
                        "report_paths": [
                          "/workflow_patches/steps/0a/control_matrix/steps/3a/constraints"
                        ]
                      }
                    },
                    "3b": {
                      "purpose": "post-3a policy enforcement",
                      "must_confirm": false,
                      "ruleset_policy_keys_expected": [
                        "add_missing",
                        "keep_extras",
                        "mode",
                        "on_mismatch",
                        "reorder_known"
                      ],
                      "note": "No explicit outputs (title/desc/tags) in this step per final JSON.",
                      "constraints": {
                        "inputs_required": [
                          "3a.keywords.focus",
                          "3a.keywords.pool.ranked[]",
                          "3a.keywords.segment_coverage"
                        ]
                      },
                      "outputs_expected": [
                        "draft.seed.description_outline.p1_core",
                        "draft.seed.description_outline.p2_features",
                        "draft.seed.description_outline.p3_logistics_cta",
                        "draft.seed.tag_buckets.long_tail",
                        "draft.seed.tag_buckets.material_karat",
                        "draft.seed.tag_buckets.product",
                        "draft.seed.tag_buckets.recipient_or_occasion",
                        "draft.seed.tag_buckets.size_finish",
                        "draft.seed.tag_buckets.style",
                        "draft.seed.title_core_ngram",
                        "source_mix_log"
                      ],
                      "enforce": {
                        "fail_on_violation": true,
                        "report_paths": [
                          "/workflow_patches/steps/0a/control_matrix/steps/3b/constraints"
                        ]
                      }
                    },
                    "4": {
                      "purpose": "focus_selection_user_confirmation",
                      "must_confirm": true
                    },
                    "5": {
                      "purpose": "Top listings upload (narrow category focus)",
                      "must_confirm": false,
                      "constraints": {
                        "must_match": {
                          "product_type": true
                        },
                        "require_one_of": [
                          "metal_karat_match",
                          "style_or_motif_match"
                        ],
                        "min_recency_window_days": 60,
                        "price_band_tolerance": 0.3,
                        "similarity": {
                          "jaccard_min": 0.5,
                          "cosine_min": 0.6,
                          "__REF__": "/_run_order/steps/5b/outputs/4"
                        },
                        "forbidden": {
                          "brand_or_trademark": true,
                          "generic_spam_terms": [
                            "gift",
                            "gift idea",
                            "trending"
                          ]
                        },
                        "language": {
                          "locale": "en-US",
                          "prevent_all_caps": true
                        },
                        "per_shop_cap": 0.25
                      },
                      "outputs_expected": [
                        "top_products.narrow_raw[]"
                      ],
                      "enforce": {
                        "fail_on_violation": true,
                        "report_paths": [
                          "/workflow_patches/steps/0a/control_matrix/steps/5/constraints"
                        ]
                      }
                    },
                    "5a": {
                      "purpose": "ngrams_and_recombination",
                      "must_confirm": false
                    },
                    "5b": {
                      "purpose": "filtering_and_prioritization",
                      "must_confirm": false
                    },
                    "6": {
                      "purpose": "Competitor shops upload (raw intake with shop balancing)",
                      "must_confirm": true,
                      "outputs_expected": [
                        "competitors.raw[]"
                      ],
                      "constraints": {
                        "must_match": {
                          "product_type": true
                        },
                        "require_one_of": [
                          "metal_karat_match",
                          "style_or_motif_match"
                        ],
                        "similarity": {
                          "jaccard_min": 0.5,
                          "cosine_min": 0.6
                        },
                        "forbidden": {
                          "brand_or_trademark": true,
                          "generic_spam_terms": [
                            "gift",
                            "gift idea",
                            "trending"
                          ]
                        },
                        "language": {
                          "locale": "en-US",
                          "prevent_all_caps": true
                        },
                        "per_shop_cap": 0.25
                      },
                      "enforce": {
                        "fail_on_violation": true,
                        "report_paths": [
                          "/workflow_patches/steps/0a/control_matrix/steps/6/constraints"
                        ]
                      }
                    },
                    "16": {
                      "purpose": "export_and_hash",
                      "must_confirm": true,
                      "export_ui": [
                        "filename",
                        "github_raw_link"
                      ],
                      "post": [
                        "zip",
                        "hash"
                      ]
                    },
                    "10": {
                      "purpose": "Title quality & policy enforcement (mobile-first, relevance, coherence)",
                      "must_confirm": true,
                      "constraints": {
                        "front_load_max_chars": 40,
                        "max_length": 140,
                        "no_keyword_stuffing": true,
                        "trim_duplicates": true,
                        "coherence_with": [
                          "12.tags",
                          "11.description"
                        ],
                        "require_components": {
                          "step0_metal_and_karat": true,
                          "product_type": true,
                          "long_tail_variant": true
                        },
                        "conditional_components": {
                          "color_variant": "optional_if_multi_variant"
                        },
                        "forbidden_unless_true_in_step0": {
                          "personalized": "require: product_info.personalization == true",
                          "stone_type": "require: product_info.stone.type is known"
                        },
                        "unknown_stone_policy": "do_not_name_stone_in_title_when_unknown",
                        "language": {
                          "disallow_misleading_claims": true,
                          "prevent_all_caps": true
                        }
                      },
                      "outputs_expected": [
                        "draft.title"
                      ],
                      "enforce": {
                        "fail_on_violation": true,
                        "report_paths": [
                          "/workflow_patches/steps/0a/control_matrix/steps/10/constraints"
                        ]
                      }
                    },
                    "11": {
                      "purpose": "Description quality & policy enforcement (mobile-first, 3-paragraph, US English, alignment)",
                      "must_confirm": true,
                      "constraints": {
                        "length": {
                          "min_words": 250,
                          "max_words": 500
                        },
                        "paragraphs": {
                          "count": 3,
                          "p1_max_chars": 180,
                          "p1_must_contain": [
                            "step0_metal_and_karat",
                            "product_type",
                            "benefit_or_value"
                          ],
                          "p2_must_cover": [
                            "metal_karat_options",
                            "color_options_if_present",
                            "size_or_dimensions",
                            "comfort_or_finish",
                            "stone_policy"
                          ],
                          "p3_must_cover": [
                            "shipping_prep_time",
                            "origin_country",
                            "care_or_warranty",
                            "cta_message"
                          ]
                        },
                        "keyword_policy": {
                          "no_keyword_stuffing": true,
                          "long_tail_mentions": {
                            "min": 2,
                            "max": 4
                          },
                          "unique_root_repeat_limit": 1,
                          "coherence_with": [
                            "10.title",
                            "12.tags"
                          ]
                        },
                        "language": {
                          "locale": "en-US",
                          "spelling": "american",
                          "avoid_slang": true,
                          "prevent_all_caps": true
                        },
                        "truthfulness": {
                          "forbidden_unless_true_in_step0": {
                            "personalized": "require: product_info.personalization == true",
                            "stone_type": "require: product_info.stone.type is known"
                          },
                          "unknown_stone_policy": "must_include_neutral_statement_if_unknown"
                        },
                        "step0_binding": {
                          "require_metal_and_karat": true,
                          "require_product_type": true,
                          "require_shipping_prep_time": true,
                          "require_origin_country": true
                        }
                      },
                      "outputs_expected": [
                        "draft.description"
                      ],
                      "enforce": {
                        "fail_on_violation": true,
                        "report_paths": [
                          "/workflow_patches/steps/0a/control_matrix/steps/11/constraints"
                        ]
                      }
                    },
                    "12": {
                      "purpose": "Final tags quality & policy enforcement (uniqueness, diversity, alignment)",
                      "constraints": {
                        "counts": {
                          "exact_tags": 13,
                          "max_tag_length": 20
                        },
                        "dedupe": {
                          "unique_by_root": true,
                          "max_root_repeats": {
                            "default": 1,
                            "product_root": 2
                          },
                          "similarity_threshold": 0.7,
                          "lemmatization": "en"
                        },
                        "diversity_bucket_targets": {
                          "product": 1,
                          "material_karat": 1,
                          "long_tail": {
                            "min": 3,
                            "max": 5
                          },
                          "style": 2,
                          "recipient_or_occasion": {
                            "min": 1,
                            "max": 2
                          },
                          "size_finish": {
                            "min": 1,
                            "max": 2
                          }
                        },
                        "source_mix": {
                          "own_pool": {
                            "min": 0.5,
                            "max": 0.6
                          },
                          "top_products_csv": {
                            "min": 0.2,
                            "max": 0.3
                          },
                          "competitors": {
                            "min": 0.1,
                            "max": 0.2
                          },
                          "relevance_gate_required": true
                        },
                        "alignment": {
                          "must_align_with": [
                            "10.title",
                            "11.description"
                          ],
                          "require_core_ngram_from_title": true
                        },
                        "language": {
                          "locale": "en-US",
                          "prevent_all_caps": true
                        },
                        "truthfulness": {
                          "only_if_true_in_step0": {
                            "personalized": "require: product_info.personalization == true",
                            "stone_type": "require: product_info.stone.type is known"
                          }
                        },
                        "forbidden": {
                          "brand_or_trademark": true,
                          "generic_spam_terms": [
                            "gift",
                            "gift idea",
                            "trending"
                          ],
                          "non_us_spelling": [
                            "colour"
                          ],
                          "misleading_or_unverified": true
                        }
                      },
                      "outputs_expected": [
                        "draft.tags[13]"
                      ],
                      "enforce": {
                        "fail_on_violation": true,
                        "report_paths": [
                          "/workflow_patches/steps/0a/control_matrix/steps/12/constraints"
                        ],
                        "log": {
                          "source_mix_breakdown": true,
                          "dedupe_decisions": true,
                          "alignment_checks": true
                        }
                      }
                    },
                    "8": {
                      "purpose": "Ads campaign skeleton & theming (budget-aware grouping)",
                      "constraints": {
                        "inputs_required": [
                          "3a.keywords.focus",
                          "3a.keywords.selection_notes",
                          "12.tags",
                          "top_products.csv",
                          "competitors.csv"
                        ],
                        "ad_groups": {
                          "count": {
                            "min": 3,
                            "max": 4
                          },
                          "theme_overlap_allowed": false,
                          "us_locale_required": true
                        },
                        "forbidden": {
                          "brand_or_trademark": true,
                          "generic_spam_terms": [
                            "gift",
                            "gift idea",
                            "trending"
                          ]
                        },
                        "alignment": {
                          "must_carry_themes_from": [
                            "10.title",
                            "12.tags",
                            "3a.keywords.focus"
                          ]
                        },
                        "budget_binding": {
                          "budget_ref_path": "/workflow_patches/steps/0/product_info/ads/daily_budget_usd",
                          "assume_daily_budget_usd_max": 10
                        }
                      },
                      "outputs_expected": [
                        "ads.groups[3..4]"
                      ],
                      "enforce": {
                        "fail_on_violation": true,
                        "report_paths": [
                          "/workflow_patches/steps/0a/control_matrix/steps/8/constraints"
                        ]
                      }
                    },
                    "8a": {
                      "purpose": "Ads keyword generation (long-tail heavy, negatives, budget-aware)",
                      "constraints": {
                        "inputs_required": [
                          "ads.groups[]",
                          "3a.keywords.pool.ranked[]",
                          "12.tags"
                        ],
                        "per_group_keywords": {
                          "min": 8,
                          "max": 12,
                          "__REF__": "/_run_order/steps/5a/outputs/1"
                        },
                        "match_types_allowed": [
                          "exact",
                          "phrase"
                        ],
                        "disallow_broad": true,
                        "long_tail_ratio_min": 0.6,
                        "negatives_required": true,
                        "negatives": {
                          "generic": [
                            "gift",
                            "gift idea",
                            "trending"
                          ],
                          "brand_or_trademark": true,
                          "cross_negatives_between_groups": true
                        },
                        "alignment": {
                          "require_core_ngram_from_title": true
                        },
                        "dedupe_similarity_threshold": 0.7,
                        "language": {
                          "locale": "en-US",
                          "prevent_all_caps": true
                        },
                        "budget_binding": {
                          "budget_ref_path": "/workflow_patches/steps/0/product_info/ads/daily_budget_usd",
                          "assume_daily_budget_usd_max": 10
                        }
                      },
                      "outputs_expected": [
                        "ads.keywords[]",
                        "ads.negatives[]"
                      ],
                      "enforce": {
                        "fail_on_violation": true,
                        "report_paths": [
                          "/workflow_patches/steps/0a/control_matrix/steps/8a/constraints"
                        ],
                        "log": {
                          "source_mix_breakdown": true,
                          "alignment_checks": true,
                          "dedupe_decisions": true
                        }
                      }
                    },
                    "9": {
                      "purpose": "SEO keyword refinement (dedupe, alignment, Ads↔SEO consolidation)",
                      "constraints": {
                        "inputs_required": [
                          "10.title",
                          "11.description",
                          "12.tags",
                          "ads.keywords"
                        ],
                        "root_repeat_limit": {
                          "default": 1,
                          "product_root": 2
                        },
                        "similarity_drop_threshold": 0.7,
                        "long_tail_priority": true,
                        "alignment": {
                          "title_core_ngram_in_tags": true,
                          "title_core_ngram_in_ads_keywords": true
                        }
                      },
                      "outputs_expected": [
                        "seo.keywords.refined[]",
                        "seo.drop_log[]"
                      ],
                      "enforce": {
                        "fail_on_violation": true,
                        "report_paths": [
                          "/workflow_patches/steps/0a/control_matrix/steps/9/constraints"
                        ]
                      }
                    },
                    "4a": {
                      "purpose": "Top listings upload (raw intake with relevance gating)",
                      "constraints": {
                        "must_match": {
                          "product_type": true
                        },
                        "require_one_of": [
                          "metal_karat_match",
                          "style_or_motif_match"
                        ],
                        "min_recency_window_days": 90,
                        "price_band_tolerance": 0.3,
                        "similarity": {
                          "jaccard_min": 0.5,
                          "cosine_min": 0.6
                        },
                        "forbidden": {
                          "brand_or_trademark": true,
                          "generic_spam_terms": [
                            "gift",
                            "gift idea",
                            "trending"
                          ]
                        },
                        "language": {
                          "locale": "en-US",
                          "prevent_all_caps": true
                        },
                        "per_shop_cap": 0.25
                      },
                      "outputs_expected": [
                        "top_products.raw[]"
                      ],
                      "enforce": {
                        "fail_on_violation": true,
                        "report_paths": [
                          "/workflow_patches/steps/0a/control_matrix/steps/4a/constraints"
                        ]
                      }
                    },
                    "4b": {
                      "purpose": "Top listings clean (normalize + dedupe + relevance confirm)",
                      "constraints": {
                        "normalize": [
                          "lowercase",
                          "trim",
                          "collapse_spaces",
                          "strip_punctuation"
                        ],
                        "dedupe": {
                          "by_title_and_tags": true
                        },
                        "similarity": {
                          "jaccard_min": 0.5,
                          "cosine_min": 0.6
                        },
                        "forbidden": {
                          "brand_or_trademark": true,
                          "generic_spam_terms": [
                            "gift",
                            "gift idea",
                            "trending"
                          ]
                        },
                        "language": {
                          "locale": "en-US",
                          "prevent_all_caps": true
                        }
                      },
                      "outputs_expected": [
                        "top_products.clean[]"
                      ],
                      "enforce": {
                        "fail_on_violation": true,
                        "report_paths": [
                          "/workflow_patches/steps/0a/control_matrix/steps/4b/constraints"
                        ]
                      }
                    },
                    "6a": {
                      "purpose": "Competitor analysis (theme extraction + bias control)",
                      "constraints": {
                        "extract_themes": true,
                        "shop_bias_cap": 0.25,
                        "similarity": {
                          "jaccard_min": 0.5,
                          "cosine_min": 0.6
                        },
                        "forbidden": {
                          "brand_or_trademark": true,
                          "generic_spam_terms": [
                            "gift",
                            "gift idea",
                            "trending"
                          ]
                        }
                      },
                      "outputs_expected": [
                        "competitors.themes[]",
                        "competitors.bias_report"
                      ],
                      "enforce": {
                        "fail_on_violation": true,
                        "report_paths": [
                          "/workflow_patches/steps/0a/control_matrix/steps/6a/constraints"
                        ]
                      }
                    },
                    "6b": {
                      "purpose": "Competitor listings clean (normalize + dedupe + relevance confirm)",
                      "constraints": {
                        "normalize": [
                          "lowercase",
                          "trim",
                          "collapse_spaces",
                          "strip_punctuation"
                        ],
                        "dedupe": {
                          "by_title_and_tags": true
                        },
                        "similarity": {
                          "jaccard_min": 0.5,
                          "cosine_min": 0.6
                        },
                        "forbidden": {
                          "brand_or_trademark": true,
                          "generic_spam_terms": [
                            "gift",
                            "gift idea",
                            "trending"
                          ]
                        },
                        "language": {
                          "locale": "en-US",
                          "prevent_all_caps": true
                        }
                      },
                      "outputs_expected": [
                        "competitors.clean[]"
                      ],
                      "enforce": {
                        "fail_on_violation": true,
                        "report_paths": [
                          "/workflow_patches/steps/0a/control_matrix/steps/6b/constraints"
                        ]
                      }
                    },
                    "0a_checks_step0_shipping": {
                      "checks": [
                        {
                          "path": "context_info.basics.shipping.delivery_time",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "context_info.basics.shipping.free_shipping",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "context_info.basics.shipping.tracking",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "context_info.basics.shipping.packaging.gift_box",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "context_info.basics.shipping.packaging.gift_note",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "context_info.basics.shipping.customs.seller_pays_duties",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "context_info.basics.shipping.target_markets",
                          "required": true,
                          "fail_on_violation": true
                        }
                      ]
                    },
                    "0a_checks_intake_enforcement": {
                      "checks": [
                        {
                          "path": "workflow_patches.steps.4.constraints.require_csv",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "workflow_patches.steps.4.constraints.empty_intake",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "workflow_patches.steps.4a.constraints.require_csv",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "workflow_patches.steps.4a.constraints.empty_intake",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "workflow_patches.steps.4b.constraints.require_csv",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "workflow_patches.steps.4b.constraints.empty_intake",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "workflow_patches.steps.5.constraints.require_csv",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "workflow_patches.steps.5.constraints.empty_intake",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "workflow_patches.steps.5a.constraints.require_csv",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "workflow_patches.steps.5a.constraints.empty_intake",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "workflow_patches.steps.5b.constraints.require_csv",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "workflow_patches.steps.5b.constraints.empty_intake",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "workflow_patches.steps.6.constraints.require_csv",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "workflow_patches.steps.6.constraints.empty_intake",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "workflow_patches.steps.6a.constraints.require_csv",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "workflow_patches.steps.6a.constraints.empty_intake",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "workflow_patches.steps.6b.constraints.require_csv",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "workflow_patches.steps.6b.constraints.empty_intake",
                          "required": true,
                          "fail_on_violation": true
                        }
                      ]
                    },
                    "0a_checks_5c_presence": {
                      "checks": [
                        {
                          "path": "workflow_patches.steps.5c.title",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "workflow_patches.steps.5c.stop_for_confirmation",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "workflow_patches.steps.5c.constraints.requires_input_from",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "_run_order.steps.5c.display_contract",
                          "required": true,
                          "fail_on_violation": true
                        }
                      ]
                    },
                    "0a_checks_registry_lock": {
                      "checks": [
                        {
                          "path": "workflow_patches.steps_registry_lock",
                          "required": true,
                          "fail_on_violation": true
                        }
                      ]
                    },
                    "0a_checks_vision_schema": {
                      "checks": [
                        {
                          "path": "workflow_patches.steps.1.constraints.vision_extraction.enabled",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "workflow_patches.steps.1.constraints.vision_extraction.supported_fields",
                          "required": true,
                          "fail_on_violation": true
                        }
                      ]
                    },
                    "0a_checks_gift_rule_sync": {
                      "checks": [
                        {
                          "path": "workflow_patches.steps.4.forbidden",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "workflow_patches.steps.4a.forbidden",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "workflow_patches.steps.4b.forbidden",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "workflow_patches.steps.5.forbidden",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "workflow_patches.steps.5a.forbidden",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "workflow_patches.steps.5b.forbidden",
                          "required": true,
                          "fail_on_violation": true
                        }
                      ]
                    },
                    "0a_checks_ui_prefs": {
                      "checks": [
                        {
                          "path": "_run_order.settings.text_only_preview",
                          "required": true,
                          "fail_on_violation": true
                        }
                      ]
                    },
                    "0a_checks_zero_acceptance": {
                      "checks": [
                        {
                          "path": "_policy.workflow.guards.zero_acceptance_strategy",
                          "required": true,
                          "fail_on_violation": true
                        }
                      ]
                    },
                    "0a_checks_content_family": {
                      "checks": [
                        {
                          "path": "workflow_patches.steps.9",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "workflow_patches.steps.10",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "workflow_patches.steps.11",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "workflow_patches.steps.12",
                          "required": true,
                          "fail_on_violation": true
                        }
                      ]
                    },
                    "0a_checks_preview_settings": {
                      "checks": [
                        {
                          "path": "_run_order.settings.text_only_preview",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "_run_order.settings.preview_render.plain_text",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "_run_order.settings.preview_render.disable_autonumbering",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "_run_order.settings.preview_render.disable_bullets",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "_run_order.settings.deterministic_seed",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "_run_order.settings.session_variance",
                          "required": true,
                          "fail_on_violation": true
                        }
                      ]
                    },
                    "0a_checks_step_ui_plain": {
                      "checks": [
                        {
                          "path": "_run_order.steps.3a.ui_output.force_plain_text",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "_run_order.steps.3a.ui_output.disable_autonumbering",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "_run_order.steps.3a.display_contract",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "_run_order.steps.3b.ui_output.force_plain_text",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "_run_order.steps.3b.ui_output.disable_autonumbering",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "_run_order.steps.3b.display_contract",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "_run_order.steps.10.ui_output.force_plain_text",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "_run_order.steps.10.ui_output.disable_autonumbering",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "_run_order.steps.10.display_contract",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "_run_order.steps.11.ui_output.force_plain_text",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "_run_order.steps.11.ui_output.disable_autonumbering",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "_run_order.steps.11.display_contract",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "_run_order.steps.12.ui_output.force_plain_text",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "_run_order.steps.12.ui_output.disable_autonumbering",
                          "required": true,
                          "fail_on_violation": true
                        },
                        {
                          "path": "_run_order.steps.12.display_contract",
                          "required": true,
                          "fail_on_violation": true
                        }
                      ]
                    }
                  },
                  "enforcement": {
                    "fail_fast": true,
                    "report_paths": [
                      "/workflow_patches/steps/0a/control_matrix",
                      "/_policy/integrity"
                    ],
                    "require_all_steps_have_title": true
                  },
                  "hydration": {
                    "step_titles": "enforced",
                    "sources": [
                      "steps/*",
                      "_run_order/steps/*"
                    ]
                  }
                },
                "display_contract": {
                  "render_full": true,
                  "block_until_user_ack": false
                },
                "stop_for_confirmation": false,
                "is_background": false,
                "label": "Ortam Kontrolleri",
                "await_user": true,
                "require_user_confirm": true,
                "no_skip": true,
                "purpose": "Üretim başlamadan hemen önce çalışma ortamını kontrol eder; runtime, ağ, depolama ve kimlik doğrulamanın hazır olduğunu doğrular.",
                "validators_required": false,
                "enforcement": {
                  "on_violation": "warn"
                },
                "outputs_expected": {
                  "env_status": "OK | WARN",
                  "warnings": [],
                  "details": {
                    "clock_skew_ok": true,
                    "raw_access_ok": true,
                    "storage_ok": true,
                    "third_party_ok": true
                  }
                },
                "checklist": [
                  "Saat/timezone doğru mu (±2dk/±1 TZ)?",
                  "RAW linkine erişim test edildi mi?",
                  "Depolama kotası yeterli mi (>= 50MB)?",
                  "Opsiyonel kimlik bilgileri mevcutsa geçerli mi?"
                ],
                "what_gpt_does": [
                  "env_config ve runtime_info’yu konsolide eder",
                  "RAW erişimini dener; hata varsa uyarı oluşturur",
                  "Depolama ve ağ durumu için kısa rapor üretir"
                ],
                "what_user_does": [
                  "Eksik kimlik bilgilerini tamamlar",
                  "RAW link problemi varsa pinned commit kullanır",
                  "Saat/Timezone hatasını düzeltir (OS/Browser)"
                ]
              },
              "1": {
                "artifacts": [
                  "media.manifest.json",
                  "media.qc.report.json"
                ],
                "constraints": {
                  "must_confirm": true,
                  "no_skip": true,
                  "require_gpt_task": false,
                  "require_user_task": true,
                  "require_validations_pass": true,
                  "vision_extraction": {
                    "enabled": false,
                    "supported_fields": [
                      "stone.type",
                      "stone.cut",
                      "stone.shape",
                      "stone.setting"
                    ],
                    "notes": "When enabled, these fields are auto-extracted if vision_conf >= stone_info_policy.threshold; otherwise user_provided preferred."
                  }
                },
                "description": "Ürün fotoğrafları ve varsa ürün videosu sisteme yüklenir. Dosya tipleri, çözünürlük ve oran kontrolleri yapılır; başarılı olanlar ürün varlık deposuna kaydedilir.",
                "flow": {
                  "guard": {
                    "advance_only_if": []
                  },
                  "on_fail": "halt",
                  "on_success_next": "1a"
                },
                "gates": {
                  "must": [
                    "validations_ok"
                  ],
                  "on_contract_violation": "halt_and_report",
                  "on_miss": "halt",
                  "on_missing_required_path": "halt_and_report",
                  "on_soft_misalignment": "warn_and_continue"
                },
                "hitl_contract": {
                  "gpt_tasks": [
                    "EXIF ve boyut kontrolü yap; geçersizleri uyar."
                  ],
                  "user_tasks": [
                    "Görselleri (JPG/PNG/WEBP) yükle (1-20 adet)."
                  ]
                },
                "id": "1",
                "inputs": [
                  "user.upload.photos[]?",
                  "user.upload.video?"
                ],
                "name": "Görsel Yükleme",
                "next": [
                  "1a"
                ],
                "on_error": {
                  "fallback_next": [],
                  "policy": "fail-soft"
                },
                "outputs": [
                  "product.photos[]",
                  "product.video?"
                ],
                "preconditions": {
                  "critical_pass": {
                    "require_ancestors_done": [
                      "0",
                      "1",
                      "3",
                      "6",
                      "16"
                    ]
                  }
                },
                "requires": [
                  "0a"
                ],
                "title": "Görsel Yükleme",
                "type": "upload_images",
                "ui": {
                  "accept": [
                    ".jpg",
                    ".jpeg",
                    ".png",
                    ".webp"
                  ],
                  "help": "JPG, PNG veya WEBP yükleyin. En az 1, en fazla 20 görsel.",
                  "max_files": 20,
                  "max_size_mb": 25,
                  "min_files": 1,
                  "title": "Görselleri Yükle"
                },
                "upstream_signature": {
                  "policy": "mark_stale_on_upstream_change"
                },
                "validation": {
                  "required": true,
                  "rules": [
                    {
                      "id": "IMG_COUNT_MIN",
                      "params": {
                        "min": 1
                      }
                    },
                    {
                      "id": "IMG_DIM_MIN",
                      "params": {
                        "min_height": 512,
                        "min_width": 512
                      }
                    },
                    {
                      "id": "IMG_FORMAT",
                      "params": {
                        "allow": [
                          "jpg",
                          "jpeg",
                          "png",
                          "webp"
                        ]
                      }
                    }
                  ]
                },
                "validations": {
                  "photos.max_files": 10,
                  "photos.mime": [
                    "image/jpeg",
                    "image/png",
                    "image/webp"
                  ],
                  "photos.min_resolution": "1200x1200",
                  "video.max_duration_sec": 60,
                  "video.mime": [
                    "video/mp4",
                    "video/quicktime"
                  ]
                },
                "value_handling": {
                  "cast_all_as_text": true,
                  "normalize_yes_no": true,
                  "treat_empty_as_valid": true,
                  "treat_nan_as_empty": true
                },
                "label": "Görsel Yükleme",
                "await_user": true,
                "require_user_confirm": true,
                "no_skip": true
              },
              "10": {
                "constraints": {
                  "must_confirm": false,
                  "no_skip": true,
                  "require_gpt_task": false,
                  "require_user_task": false,
                  "require_validations_pass": false
                },
                "description": "Odak/support keywordler, ürün attribute'ları ve mağaza sesi ile SEO uyumlu başlık oluşturulur.",
                "flow": {
                  "guard": {
                    "advance_only_if": []
                  }
                },
                "gates": {
                  "must": [
                    "validations_ok"
                  ],
                  "on_contract_violation": "halt_and_report",
                  "on_miss": "halt",
                  "on_missing_required_path": "halt_and_report",
                  "on_soft_misalignment": "auto_fix_and_continue"
                },
                "guards": {
                  "title_repetition": {
                    "max_repeat": 2
                  }
                },
                "hitl_contract": {
                  "gpt_tasks": [],
                  "user_tasks": []
                },
                "inputs": [
                  "keywords.focus[1..4]",
                  "seo.keywords.supporting[]",
                  "product.info{}",
                  "shop.profile{}"
                ],
                "name": "SEO Title Generation",
                "outputs": [
                  "title.final"
                ],
                "preconditions": {
                  "critical_pass": {
                    "require_ancestors_done": [
                      "0",
                      "1",
                      "3",
                      "6",
                      "16"
                    ]
                  }
                },
                "requires": [
                  "7"
                ],
                "rules": [
                  "title length: 80-140 chars (optimum 110-130)",
                  "first 30-40 chars must include focus_1",
                  "slots: focus keyword, 1 product attribute, 1 occasion/audience, optional brand voice",
                  "no stuffing, no ALL CAPS",
                  "forbidden terms: ['Turkey','Istanbul']"
                ],
                "ruleset": {
                  "consistency_check": {
                    "against": "product_info",
                    "__REF__": "/_run_order/steps/00/outputs/3"
                  },
                  "enforce_from_step0": [
                    "karat",
                    "metal_color",
                    "variant_size_range"
                  ],
                  "forbid_terms": [
                    "personalized",
                    "custom",
                    "engraved",
                    "initial pendant"
                  ],
                  "frontload_focus": {
                    "first_chars": 35,
                    "__REF__": "/_run_order/steps/5a/outputs/3"
                  },
                  "guards": {
                    "require_user_ack": true
                  },
                  "max_len": 140,
                  "optional_input": [
                    "trending_keywords"
                  ],
                  "structure": "1_main + 2_variations + 1_niche",
                  "variants": 2
                },
                "title": "SEO Title Generation",
                "upstream_signature": {
                  "policy": "mark_stale_on_upstream_change"
                },
                "validations": {
                  "present": true
                },
                "validators": [
                  "mobile_first<=40",
                  "title_len<=55",
                  "no_markdown",
                  "lang==en-US"
                ],
                "label": "SEO Title Generation",
                "await_user": true,
                "require_user_confirm": true,
                "no_skip": true
              },
              "11": {
                "constraints": {
                  "must_confirm": false,
                  "no_skip": true,
                  "require_gpt_task": false,
                  "require_user_task": false,
                  "require_validations_pass": false
                },
                "description": "Ürün bilgileri ve mağaza sabitleriyle desteklenmiş, SEO uyumlu açıklama oluşturulur.",
                "flow": {
                  "guard": {
                    "advance_only_if": []
                  }
                },
                "gates": {
                  "must": [
                    "validations_ok"
                  ],
                  "on_contract_violation": "halt_and_report",
                  "on_miss": "halt",
                  "on_missing_required_path": "halt_and_report",
                  "on_soft_misalignment": "auto_fix_and_continue"
                },
                "guards": {
                  "desc_repetition": {
                    "global_max": 5,
                    "max_repeat": 3,
                    "window": 200
                  }
                },
                "hitl_contract": {
                  "gpt_tasks": [],
                  "user_tasks": []
                },
                "inputs": [
                  "draft.title",
                  "keywords.focus[]",
                  "keywords.supporting[]",
                  "product.info{}",
                  "shop.profile{}"
                ],
                "inputs_contract": {
                  "required_paths": [
                    "/workflow_patches/steps/10/outputs/title",
                    "/workflow_patches/steps/9/outputs/refined_keywords"
                  ],
                  "schema": {
                    "refined_keywords": {
                      "min_items": 10,
                      "type": "array"
                    },
                    "title": {
                      "max_len": 140,
                      "min_len": 20,
                      "type": "string"
                    }
                  }
                },
                "name": "SEO Description Generation",
                "outputs": [
                  "description.final"
                ],
                "preconditions": {
                  "critical_pass": {
                    "require_ancestors_done": [
                      "0",
                      "1",
                      "3",
                      "6",
                      "16"
                    ]
                  },
                  "title_required": "/workflow_patches/steps/10/outputs/title"
                },
                "requires": [
                  "10"
                ],
                "rules": [
                  "length: 300-500 words",
                  "paragraphs: 2-5",
                  "first sentence includes focus_1 naturally",
                  "structure: intro (focus+benefit) -> product details (material, stone, size, options) -> occasion/usage -> care/durability -> shipping/store trust",
                  "2-3 supporting keywords included naturally",
                  "no stuffing, no duplicate roots",
                  "forbidden terms: ['Turkey','Istanbul']"
                ],
                "ruleset": {
                  "audit": {
                    "log_source_for_each_tag": true,
                    "__REF__": "/_run_order/steps/20/outputs/2"
                  },
                  "composition": {
                    "competitor": {
                      "max": 3,
                      "min": 2,
                      "source": "competitor_listings.cleaned"
                    },
                    "focus": {
                      "max": 5,
                      "min": 4,
                      "source": "focus_keywords"
                    },
                    "longtail": {
                      "max": 3,
                      "min": 2,
                      "source": "similar_keywords.cleaned+search.suggestions"
                    },
                    "popular": {
                      "max": 4,
                      "min": 3,
                      "source": "top_listings.cleaned"
                    }
                  },
                  "consistency_check": {
                    "against": [
                      "title",
                      "description",
                      "product_info"
                    ]
                  },
                  "constraints": {
                    "count": 13,
                    "forbid_terms": [
                      "personalized",
                      "custom",
                      "engraved",
                      "initial pendant"
                    ],
                    "include_focus1": true,
                    "no_duplicates": true,
                    "segments_required": [
                      "material",
                      "product_type",
                      "occasion_or_use"
                    ],
                    "unique": true
                  },
                  "guards": {
                    "require_user_ack": true
                  },
                  "input_sources": [
                    "similar_keywords.cleaned",
                    "top_listings.cleaned",
                    "competitor_listings.cleaned",
                    "focus_keywords",
                    "draft.tags"
                  ],
                  "weighting": {
                    "focus": 0.4,
                    "longtail": 0.2,
                    "popular_competitor": 0.4
                  }
                },
                "title": "SEO Description Generation",
                "upstream_signature": {
                  "depends_on": [
                    "/workflow_patches/steps/10/outputs/title",
                    "/workflow_patches/steps/9/outputs/refined_keywords"
                  ],
                  "on_change": "invalidate_and_rerun"
                },
                "validations": {
                  "present": true
                },
                "validators": [
                  "paragraphs==3",
                  "plain_text",
                  "lang==en-US",
                  "no_turkish_chars"
                ],
                "label": "SEO Description Generation",
                "await_user": true,
                "require_user_confirm": true,
                "no_skip": true
              },
              "12": {
                "constraints": {
                  "must_confirm": false,
                  "no_skip": true,
                  "require_gpt_task": false,
                  "require_user_task": false,
                  "require_validations_pass": false
                },
                "description": "SEO, ürün attribute ve mağaza sesi yansıtan 13/13 benzersiz etiket seti oluşturulur.",
                "flow": {
                  "guard": {
                    "advance_only_if": []
                  }
                },
                "gates": {
                  "must": [
                    "validations_ok"
                  ],
                  "on_contract_violation": "halt_and_report",
                  "on_miss": "halt",
                  "on_missing_required_path": "halt_and_report",
                  "on_soft_misalignment": "auto_fix_and_continue"
                },
                "guards": {
                  "tags": {
                    "count": 13,
                    "no_duplicate_roots": true,
                    "unique": true
                  }
                },
                "hitl_contract": {
                  "gpt_tasks": [],
                  "user_tasks": []
                },
                "inputs": [
                  "keywords.focus[]",
                  "keywords.supporting[]",
                  "product.info{}",
                  "shop.profile{}"
                ],
                "inputs_contract": {
                  "required_paths": [
                    "/workflow_patches/steps/11/outputs/description",
                    "/workflow_patches/steps/9/outputs/refined_keywords"
                  ],
                  "schema": {
                    "tags": {
                      "min_items": 10,
                      "type": "array"
                    }
                  }
                },
                "name": "Tags Generation",
                "outputs": [
                  "tags.final[13]"
                ],
                "preconditions": {
                  "critical_pass": {
                    "require_ancestors_done": [
                      "0",
                      "1",
                      "3",
                      "6",
                      "16"
                    ]
                  },
                  "desc_required": "/workflow_patches/steps/11/outputs/description",
                  "title_required": "/workflow_patches/steps/10/outputs/title"
                },
                "requires": [
                  "11"
                ],
                "rules": [
                  "exactly 13 unique tags",
                  "distribution: 4-5 SEO/high-volume, 3-4 product attributes, 2-3 occasion/audience, 1-2 brand voice",
                  "no duplicate roots, no attr/category duplicates",
                  "negatives forbidden: ['DIY','free','tutorial','plated*','kit','supplies','raw*']",
                  "forbidden terms: ['Turkey','Istanbul']"
                ],
                "ruleset": {
                  "consistency_check": {
                    "against": [
                      "title",
                      "tags",
                      "product_info"
                    ]
                  },
                  "forbid_terms": [
                    "personalized",
                    "custom",
                    "engraved",
                    "initial pendant"
                  ],
                  "frontload_focus": {
                    "first_chars": 150
                  },
                  "guards": {
                    "require_user_ack": true
                  },
                  "include_from_step0": [
                    "karat",
                    "metal_color",
                    "variant_size_range",
                    "processing_time",
                    "packaging_note"
                  ],
                  "language_variant": "en-US",
                  "length": {
                    "max_words": 180,
                    "min_words": 120
                  },
                  "paragraphs": {
                    "count": 4,
                    "structure": [
                      "intro_focus",
                      "features_from_step0",
                      "benefits_gift_use",
                      "cta"
                    ]
                  },
                  "priority_order": [
                    "focus_keyword_frontload",
                    "product_info_integration",
                    "user_benefits",
                    "call_to_action"
                  ],
                  "style": {
                    "readability": "grade8",
                    "scan_friendly": true,
                    "tone": "professional_warm"
                  }
                },
                "soft_influences": {
                  "from": [
                    "/workflow_patches/steps/8a/outputs/ads_keywords"
                  ],
                  "policy": "warn_if_misaligned_topN",
                  "topN": 10
                },
                "title": "Tags Generation",
                "upstream_signature": {
                  "depends_on": [
                    "/workflow_patches/steps/11/outputs/description",
                    "/workflow_patches/steps/10/outputs/title",
                    "/workflow_patches/steps/9/outputs/refined_keywords",
                    "/workflow_patches/steps/8a/outputs/ads_keywords"
                  ],
                  "on_change": "invalidate_and_rerun"
                },
                "validations": {
                  "present": true
                },
                "validators": [
                  "count==13",
                  "unique==true",
                  "no_root_dup==true",
                  "no_attribute_only==true",
                  "forbidden_block",
                  "lang==en-US"
                ],
                "forbidden": [
                  "Turkey",
                  "Istanbul",
                  "gift idea",
                  "trending"
                ],
                "extra_rules": {
                  "attribute_only_regex": "^(10k|14k|18k|yellow|white|rose|gold|silver)$"
                },
                "label": "Tags Generation",
                "await_user": true,
                "require_user_confirm": true,
                "no_skip": true
              },
              "13": {
                "kind": "checkpoint",
                "name": "Checkpoint – Akış Kapıları (BG)",
                "ruleset": {
                  "note": "Tanım boştu; manifestte yer aldığı için placeholder eklendi."
                },
                "title": "Checkpoint – Akış Kapıları (BG)",
                "label": "Checkpoint – Akış Kapıları (BG)",
                "await_user": true,
                "require_user_confirm": true,
                "no_skip": true,
                "json_title": "Checkpoint – Akış Kapıları (BG)"
              },
              "14": {
                "constraints": {
                  "must_confirm": false,
                  "no_skip": true,
                  "require_gpt_task": false,
                  "require_user_task": false,
                  "require_validations_pass": false,
                  "status_values": [
                    "PASS",
                    "WARN",
                    "FAIL"
                  ]
                },
                "description": "Başlık, açıklama, etiketler ve görsellerin Etsy kuralları ve SEO/Ads stratejisi ile uyumunu denetler.",
                "flow": {
                  "guard": {
                    "advance_only_if": []
                  }
                },
                "gates": {
                  "must": [
                    "validations_ok"
                  ],
                  "on_contract_violation": "halt_and_report",
                  "on_miss": "halt",
                  "on_missing_required_path": "halt_and_report",
                  "on_soft_misalignment": "auto_fix_and_continue"
                },
                "hitl_contract": {
                  "gpt_tasks": [],
                  "user_tasks": []
                },
                "inputs": [
                  "title.final",
                  "description.final",
                  "tags.final[13]",
                  "media.checklist",
                  "media.issues[]",
                  "seo.keywords.focus[]",
                  "seo.keywords.supporting[]",
                  "ads.keywords.final[]"
                ],
                "name": "Ara Değerlendirme – SEO Uyum",
                "outputs": [
                  "compliance.report{}",
                  "compliance.issues[]",
                  "compliance.recommendations[]",
                  "compliance.status"
                ],
                "preconditions": {
                  "critical_pass": {
                    "require_ancestors_done": [
                      "0",
                      "1",
                      "3",
                      "6",
                      "16"
                    ]
                  }
                },
                "requires": [
                  "13"
                ],
                "rules": [
                  "no banned terms (e.g., brand infringement, Rolex, Disney, etc.)",
                  "no ALL CAPS, no spam, no misleading claims (e.g., 'free shipping')",
                  "etsy policy compliance: handmade/vintage/supplies classification",
                  "SEO-Ads consistency: no conflict between SEO focus/support and Ads plan",
                  "visuals must align with attributes and tags",
                  "negatives forbidden: ['DIY', 'free', 'tutorial', 'plated*', 'kit', 'supplies', 'raw*', 'Turkey', 'Istanbul']",
                  "self_check.status must be PASS"
                ],
                "ruleset": [
                  {
                    "id": "NO_BANNED_TERMS",
                    "params": {
                      "examples": [
                        "Rolex",
                        "Disney"
                      ]
                    }
                  },
                  {
                    "id": "NO_ALLCAPS_SPAM",
                    "params": {
                      "enforced": true
                    }
                  },
                  {
                    "id": "NO_MISLEADING_CLAIMS",
                    "params": {
                      "forbidden": [
                        "free shipping"
                      ]
                    }
                  },
                  {
                    "id": "ETSY_POLICY_COMPLIANCE",
                    "params": {
                      "required": true
                    }
                  },
                  {
                    "id": "SEO_ADS_CONSISTENCY",
                    "params": {
                      "required": true
                    }
                  },
                  {
                    "id": "VISUAL_ALIGNMENT",
                    "params": {
                      "required": true
                    }
                  },
                  {
                    "id": "NEGATIVE_TERMS",
                    "params": {
                      "terms": [
                        "DIY",
                        "free",
                        "tutorial",
                        "plated*",
                        "kit",
                        "supplies",
                        "raw*",
                        "Turkey",
                        "Istanbul"
                      ]
                    }
                  },
                  {
                    "id": "SPAM_BLOCKS_COMPLIANCE",
                    "params": {
                      "block_on": "BLOCK"
                    }
                  },
                  {
                    "id": "SELF_CHECK_PASS_REQUIRED",
                    "params": {
                      "status": "PASS"
                    }
                  },
                  {
                    "id": "PRODUCT_RECORD_CONFIRMED_REQUIRED",
                    "params": {
                      "source": "product_record",
                      "status": "CONFIRMED"
                    }
                  },
                  {
                    "id": "COUNTRY_POLICY_COMPLIANCE",
                    "params": {
                      "source": "governance.policy.country"
                    }
                  }
                ],
                "title": "Ara Değerlendirme – SEO Uyum",
                "upstream_signature": {
                  "policy": "mark_stale_on_upstream_change"
                },
                "validations": {
                  "present": true
                },
                "label": "Ara Değerlendirme – SEO Uyum",
                "await_user": true,
                "require_user_confirm": true,
                "no_skip": true,
                "json_title": "Ara Değerlendirme – SEO Uyum"
              },
              "15": {
                "kind": "qa",
                "name": "QA – Uyarı (Soft)",
                "ruleset": {
                  "guards": {
                    "halt_on_error": false
                  },
                  "mode": "warn",
                  "note": "QA sadece uyarı üretir, akışı durdurmaz"
                },
                "title": "QA – Uyarı (Soft)",
                "description": "SEO focus/support kelimeleri ile Ads pozitif/negatif setlerini senkronize eder, final seti üretir.",
                "label": "QA – Uyarı (Soft)",
                "await_user": true,
                "require_user_confirm": true,
                "no_skip": true,
                "json_title": "QA – Uyarı (Soft)"
              },
              "16": {
                "constraints": {
                  "must_confirm": false,
                  "no_skip": true,
                  "require_gpt_task": false,
                  "require_user_task": true,
                  "require_validations_pass": false,
                  "status_values": [
                    "PASS",
                    "WARN",
                    "FAIL"
                  ]
                },
                "description": "Önceki adımlardan gelen tüm çıktıları birleştirerek yayına hazır tam ürün listing paketi oluşturur.",
                "flow": {
                  "guard": {
                    "advance_only_if": []
                  }
                },
                "gates": {
                  "must": [
                    "validations_ok"
                  ],
                  "on_contract_violation": "halt_and_report",
                  "on_miss": "halt",
                  "on_missing_required_path": "halt_and_report",
                  "on_soft_misalignment": "auto_fix_and_continue",
                  "required_inputs": [
                    "title.final",
                    "description.final",
                    "tags.final[13]",
                    "media.checklist",
                    "compliance.status",
                    "ads_sync.status",
                    "seo.keywords.focus[]",
                    "seo.keywords.supporting[]",
                    "product.info{}",
                    "shop.profile{}"
                  ]
                },
                "guards": {
                  "final_check": "repetition_guard_enforced"
                },
                "hitl_contract": {
                  "gpt_tasks": [],
                  "user_tasks": []
                },
                "inputs": [
                  "title.final",
                  "description.final",
                  "tags.final[13]",
                  "media.checklist",
                  "media.qc_report",
                  "media.recommendations[]",
                  "compliance.status",
                  "compliance.issues[]",
                  "ads_sync.final_positive[]",
                  "ads_sync.final_negative[]",
                  "ads_sync.status",
                  "seo.keywords.focus[]",
                  "seo.keywords.supporting[]",
                  "product.info{}",
                  "shop.profile{}"
                ],
                "name": "Listing Assemble & Record-Type Select",
                "outputs": [
                  "listing.final{}",
                  "listing.issues[]",
                  "listing.status",
                  "listing.notes"
                ],
                "preconditions": {
                  "critical_pass": {
                    "require_ancestors_done": [
                      "0",
                      "1",
                      "3",
                      "6",
                      "16"
                    ]
                  }
                },
                "requires": [
                  "10",
                  "11",
                  "12",
                  "13",
                  "14",
                  "15"
                ],
                "rules": {
                  "allow_rollback": true
                },
                "ruleset": {
                  "downloads": {
                    "office_2007_tr": {
                      "bundle": true,
                      "formats": [
                        {
                          "file": "listing_final_en-US.docx",
                          "type": "docx"
                        },
                        {
                          "file": "listing_final_en-US.rtf",
                          "type": "rtf"
                        },
                        {
                          "delimiter": ";",
                          "encoding": "windows-1254",
                          "file": "tags_tr.csv",
                          "headers": [
                            "Tag"
                          ],
                          "type": "csv"
                        },
                        {
                          "encoding": "utf-16le",
                          "file": "listing_final_en-US.txt",
                          "line_separator": "\\r\\n",
                          "type": "txt"
                        }
                      ],
                      "include_from_steps": {
                        "description.final": true,
                        "product_info(core)": [
                          "karat",
                          "metal_color",
                          "variant_size_range",
                          "processing_time",
                          "packaging_note"
                        ],
                        "tags.final": true,
                        "title.final": true
                      }
                    }
                  }
                },
                "title": "Listing Assemble & Record-Type Select",
                "upstream_signature": {
                  "policy": "mark_stale_on_upstream_change"
                },
                "validations": {
                  "present": true
                },
                "export_contract": {
                  "emit_artifact": true,
                  "artifact_name_template": "{channel}.{version}.{date}_{time}.json",
                  "display": {
                    "render_full": true,
                    "sections": [
                      {
                        "title": "Oluşturulacak Dosya Adı",
                        "bind": "export.filename"
                      },
                      {
                        "title": "GitHub Raw Link",
                        "bind": "export.raw_link"
                      },
                      {
                        "title": "Yapılacak İşlem",
                        "static": "Dosyayı indir → Desktop/json-proje klasörüne koy → push-json.bat'ı çalıştırın → ardından Onay'a basın."
                      }
                    ]
                  },
                  "constraints": {
                    "must_confirm": true,
                    "require_user_task": true
                  },
                  "outputs": {
                    "export.filename": "{channel}.{version}.{date}_{time}.json",
                    "export.raw_link": "https://raw.githubusercontent.com/mertgs190500/json-proje/main/{channel}.{version}.{date}_{time}.json"
                  }
                },
                "tags": {
                  "channel": "strict"
                },
                "label": "Listing Assemble & Record-Type Select",
                "await_user": true,
                "require_user_confirm": true,
                "no_skip": true,
                "json_title": "Listing Assemble & Record-Type Select"
              },
              "17": {
                "name": "Export (CSV/XLSX/JSON)",
                "enabled": true,
                "auto": true,
                "inputs": {
                  "artifact_filename": "{channel}.{version}.{date}_{time}.json"
                },
                "actions": {
                  "compute_sha256": {
                    "fn": "sha256",
                    "file": "{export.filename}",
                    "out": "steps.17.export.sha256"
                  },
                  "emit_zip": {
                    "fn": "zip",
                    "files": [
                      "{export.filename}"
                    ],
                    "zip_name": "visible.v{N}.zip",
                    "out": "steps.17.export.zip_path"
                  },
                  "record_log": {
                    "fn": "append_log",
                    "target": "/_meta/export_log",
                    "entry": {
                      "event": "export",
                      "version": "{version}",
                      "filename": "{export.filename}",
                      "sha256": "{steps.17.export.sha256}",
                      "ts": "{now:Europe/Istanbul}"
                    }
                  }
                },
                "display": {
                  "render_full": true,
                  "sections": [
                    {
                      "title": "SHA256",
                      "bind": "steps.17.export.sha256"
                    },
                    {
                      "title": "ZIP adı",
                      "bind": "steps.17.export.zip_path"
                    }
                  ]
                },
                "constraints": {
                  "must_confirm": false,
                  "require_user_task": false
                },
                "title": "Export (CSV/XLSX/JSON)",
                "description": "Listing.final çıktısını Office 2007 uyumlu CSV formatına dönüştürür.",
                "label": "Export (CSV/XLSX/JSON)",
                "await_user": true,
                "require_user_confirm": true,
                "no_skip": true,
                "json_title": "Export (CSV/XLSX/JSON)"
              },
              "18": {
                "constraints": {
                  "must_confirm": false,
                  "no_skip": true,
                  "require_gpt_task": false,
                  "require_record_type": "publish",
                  "require_user_task": false,
                  "require_validations_pass": false,
                  "status_values": [
                    "READY",
                    "WARN",
                    "BLOCK"
                  ]
                },
                "description": "Etsy'ye yükleme öncesi go/no-go kontrol listesi ve son onay.",
                "flow": {
                  "guard": {
                    "advance_only_if": []
                  }
                },
                "gates": {
                  "must": [
                    "validations_ok"
                  ],
                  "on_contract_violation": "halt_and_report",
                  "on_manifest_mismatch": "halt_and_report",
                  "on_miss": "halt",
                  "on_missing_required_path": "halt_and_report",
                  "on_soft_misalignment": "auto_fix_and_continue"
                },
                "hitl_contract": {
                  "gpt_tasks": [],
                  "user_tasks": []
                },
                "inputs": [
                  "listing.final{}",
                  "listing.status",
                  "export.file_path",
                  "export.sha256",
                  "compliance.status",
                  "ads_sync.status"
                ],
                "inputs_contract": {
                  "required_paths": [
                    "/workflow_patches/steps/17/outputs/files"
                  ],
                  "schema": {
                    "files": {
                      "min_items": 1,
                      "type": "array"
                    }
                  }
                },
                "manifest": {
                  "policy": "hash_and_compare",
                  "required_paths": [
                    "/workflow_patches/steps/10/outputs/title",
                    "/workflow_patches/steps/11/outputs/description",
                    "/workflow_patches/steps/12/outputs/tags",
                    "/workflow_patches/steps/16/outputs/listing",
                    "/workflow_patches/steps/17/outputs/files"
                  ]
                },
                "name": "Pre-Publish Review (Checkpoint 18)",
                "outputs": [
                  "publish.checklist{}",
                  "publish.status",
                  "publish.notes"
                ],
                "preconditions": {
                  "critical_pass": {
                    "require_ancestors_done": [
                      "0",
                      "1",
                      "3",
                      "6",
                      "16"
                    ]
                  },
                  "export_files_exist": "/workflow_patches/steps/17/outputs/files"
                },
                "requires": [
                  "17"
                ],
                "rules": [
                  "listing.status must be PASS",
                  "export.file_path must exist and export.sha256 present",
                  "compliance.status must be PASS (else BLOCK)",
                  "ads_sync.status PASS preferred; if WARN -> checklist WARN, if FAIL -> BLOCK",
                  "self_check.status must be PASS"
                ],
                "ruleset": [
                  {
                    "id": "LISTING_PASS_REQUIRED",
                    "params": {
                      "status": "PASS"
                    }
                  },
                  {
                    "id": "EXPORT_FILE_AND_HASH_REQUIRED",
                    "params": {
                      "required": true
                    }
                  },
                  {
                    "id": "COMPLIANCE_PASS_REQUIRED",
                    "params": {
                      "status": "PASS"
                    }
                  },
                  {
                    "id": "ADS_SYNC_STATUS_POLICY",
                    "params": {
                      "fail": "BLOCK",
                      "pass": "READY",
                      "warn": "WARN"
                    }
                  },
                  {
                    "id": "PUBLISH_STATUS_VALUES",
                    "params": {
                      "values": [
                        "READY",
                        "WARN",
                        "BLOCK"
                      ]
                    }
                  },
                  {
                    "id": "SELF_CHECK_PASS_REQUIRED",
                    "params": {
                      "status": "PASS"
                    }
                  }
                ],
                "title": "Pre-Publish Review (Checkpoint 18)",
                "upstream_signature": {
                  "depends_on": [
                    "/workflow_patches/steps/17/outputs/files"
                  ],
                  "on_change": "recheck"
                },
                "validations": {
                  "present": true
                },
                "label": "Pre-Publish Review (Checkpoint 18)",
                "await_user": true,
                "require_user_confirm": true,
                "no_skip": true,
                "json_title": "Pre-Publish Review (Checkpoint 18)"
              },
              "18a": {
                "constraints": {
                  "must_confirm": true,
                  "no_skip": true
                },
                "enabled": false,
                "gates": {
                  "must": [
                    "validations_ok"
                  ],
                  "on_contract_violation": "halt_and_report",
                  "on_missing_required_path": "halt_and_report",
                  "on_soft_misalignment": "warn_and_continue"
                },
                "gpt_task": {
                  "check": [
                    "step14.pass==true",
                    "step16.ready==true",
                    "step17.files_ready==true",
                    "step18.checklist_pass==true"
                  ]
                },
                "id": "18a",
                "notes": {
                  "lifecycle": "manifest-disabled"
                },
                "outputs": {
                  "decision_at": null,
                  "decision_by": "",
                  "publish_go": false,
                  "reason_if_no_go": ""
                },
                "preconditions": {
                  "critical_pass": {
                    "require_ancestors_done": [
                      "0",
                      "1",
                      "3",
                      "6",
                      "16"
                    ]
                  },
                  "parent_defined": {
                    "exists": true,
                    "path": "/workflow_patches/steps/18"
                  }
                },
                "title": "Publish Go/No-Go (Disabled)",
                "ui": {
                  "hidden": true
                },
                "upstream_signature": {
                  "policy": "mark_stale_on_upstream_change"
                },
                "user_task": {
                  "confirm": "outputs.publish_go"
                },
                "validations": {
                  "all_prior_ok": true
                },
                "display": {
                  "render_full": true,
                  "sections_auto": [
                    {
                      "title": "Decision At",
                      "bind": "decision_at"
                    },
                    {
                      "title": "Decision By",
                      "bind": "decision_by"
                    },
                    {
                      "title": "Publish Go",
                      "bind": "publish_go"
                    },
                    {
                      "title": "Reason If No Go",
                      "bind": "reason_if_no_go"
                    }
                  ]
                },
                "name": "Publish Go/No-Go (Disabled)",
                "label": "Publish Go/No-Go (Disabled)",
                "await_user": true,
                "require_user_confirm": true,
                "no_skip": true,
                "json_title": "Publish Go/No-Go (Disabled)"
              },
              "19": {
                "constraints": {
                  "must_confirm": false,
                  "no_skip": true,
                  "require_gpt_task": false,
                  "require_user_task": false,
                  "require_validations_pass": false
                },
                "description": "Yayın sonrası 14–30 gün performans takibi ve aksiyon sinyalleri (Ads + SEO).",
                "flow": {
                  "guard": {
                    "advance_only_if": []
                  }
                },
                "gates": {
                  "must": [
                    "validations_ok"
                  ],
                  "on_contract_violation": "halt_and_report",
                  "on_miss": "halt",
                  "on_missing_required_path": "halt_and_report",
                  "on_soft_misalignment": "auto_fix_and_continue"
                },
                "hitl_contract": {
                  "gpt_tasks": [],
                  "user_tasks": []
                },
                "inputs": [
                  "metrics.ads{ctr,roas,orders,cpc,spend}",
                  "metrics.seo{impressions,visits,orders,conv_rate}",
                  "ab_test.plan",
                  "ads.plan{}",
                  "ads_sync.final_positive[]",
                  "ads_sync.final_negative[]"
                ],
                "name": "30-Day Listing Performance Report (+ Optimization)",
                "outputs": [
                  "monitoring.report{}",
                  "monitoring.issues[]",
                  "monitoring.recommendations[]"
                ],
                "preconditions": {
                  "critical_pass": {
                    "require_ancestors_done": [
                      "0",
                      "1",
                      "3",
                      "6",
                      "16"
                    ]
                  }
                },
                "requires": [
                  "18"
                ],
                "rules": [
                  "window_days: 14..30",
                  "warn if CTR < 1.0% or ROAS < 1.0",
                  "boost if Orders >= 3 and ROAS >= target",
                  "pause if Clicks >= 20 and ROAS < 1.0",
                  "produce actionable recommendations per AdGroup/keyword"
                ],
                "ruleset": [
                  {
                    "id": "MONITORING_WINDOW_DAYS",
                    "params": {
                      "max": 30,
                      "min": 14
                    }
                  },
                  {
                    "id": "WARN_THRESHOLDS",
                    "params": {
                      "ctr_lt": 0.01,
                      "roas_lt": 1.0
                    }
                  },
                  {
                    "id": "BOOST_RULE",
                    "params": {
                      "orders_gte": 3,
                      "roas_gte": "target"
                    }
                  },
                  {
                    "id": "PAUSE_RULE",
                    "params": {
                      "clicks_gte": 20,
                      "roas_lt": 1.0
                    }
                  },
                  {
                    "id": "ACTIONABLE_PER_GROUP",
                    "params": {
                      "required": true
                    }
                  }
                ],
                "title": "30-Day Listing Performance Report (+ Optimization)",
                "upstream_signature": {
                  "policy": "mark_stale_on_upstream_change"
                },
                "validations": {
                  "present": true
                },
                "label": "30-Day Listing Performance Report (+ Optimization)",
                "await_user": true,
                "require_user_confirm": true,
                "no_skip": true,
                "json_title": "30-Day Listing Performance Report (+ Optimization)"
              },
              "1a": {
                "advisory_pack": {
                  "hero_thumbnail": {
                    "block": false,
                    "rules": {
                      "no_text_overlay": true,
                      "plain_bg_preferred": true,
                      "subject_fill_min": 0.7
                    },
                    "severity": "advisory"
                  },
                  "metrics_binding": {
                    "block": false,
                    "capture": [
                      "ctr",
                      "engagement"
                    ],
                    "improvement_note_required": true,
                    "severity": "advisory"
                  },
                  "scale_photo": {
                    "block": false,
                    "rules": {
                      "must_include_scale_indicator": true
                    },
                    "severity": "advisory"
                  },
                  "seo_context_photo": {
                    "block": false,
                    "rules": {
                      "must_include_context": [
                        "wedding",
                        "gift",
                        "everyday"
                      ]
                    },
                    "severity": "advisory"
                  },
                  "video_quality": {
                    "block": false,
                    "rules": {
                      "duration_seconds": {
                        "max": 15,
                        "min": 5
                      },
                      "motion": "minimal",
                      "show_scale": true
                    },
                    "severity": "advisory"
                  }
                },
                "constraints": {
                  "must_confirm": false,
                  "no_skip": true,
                  "require_gpt_task": false,
                  "require_user_task": false,
                  "require_validations_pass": false
                },
                "description": "Ürün görselleri ve (varsa) video; kalite, set bütünlüğü ve SEO uyumu açısından kontrol edilir. Çıktı yalnızca rapordur; görseller otomatik değiştirilmez.",
                "flow": {
                  "guard": {
                    "advance_only_if": []
                  }
                },
                "gates": {
                  "must": [
                    "validations_ok"
                  ],
                  "on_contract_violation": "halt_and_report",
                  "on_miss": "halt",
                  "on_missing_required_path": "halt_and_report",
                  "on_soft_misalignment": "warn_and_continue"
                },
                "governance": {
                  "notes_required": true,
                  "qc_checklist": [
                    "has_studio",
                    "has_lifestyle",
                    "has_scale",
                    "has_detail",
                    "has_packaging",
                    "resolution_ok",
                    "background_ok",
                    "lighting_ok",
                    "set_consistent",
                    "seo_context_ok",
                    "attribute_truth_ok",
                    "no_watermark_or_heavy_text",
                    "no_blurry_lowres"
                  ]
                },
                "guards": {
                  "first_image_ctr_check": true,
                  "image_count": {
                    "block_on_fail": false,
                    "min_required": 8,
                    "note": "Üretim durmasın, sadece WARN verilsin",
                    "severity": "warn"
                  },
                  "image_variety": [
                    "closeup",
                    "usage",
                    "variations",
                    "packaging"
                  ],
                  "video_required": true
                },
                "hitl_contract": {
                  "gpt_tasks": [],
                  "user_tasks": []
                },
                "inputs": [
                  "product.photos[]",
                  "product.video?",
                  "draft.title",
                  "draft.description",
                  "draft.tags[13]",
                  "seo.keywords.focus[]",
                  "seo.keywords.supporting[]"
                ],
                "name": "Görsel Analizi",
                "outputs": [
                  "media.checklist",
                  "media.issues[]",
                  "media.recommendations[]",
                  "media.qc_report"
                ],
                "preconditions": {
                  "critical_pass": {
                    "require_ancestors_done": [
                      "0",
                      "1",
                      "3",
                      "6",
                      "16"
                    ]
                  },
                  "parent_defined": {
                    "exists": true,
                    "path": "/workflow_patches/steps/1"
                  }
                },
                "requires": [
                  "1"
                ],
                "rules": [
                  "required_photos: [studio, lifestyle, scale, detail, packaging]",
                  "optional_video: true (360° veya kullanım sahnesi)",
                  "min_resolution: 2000x2000 (kare tercih)",
                  "background: clean/consistent (white/soft preferred)",
                  "lighting: true colors, minimal harsh shadows",
                  "set_consistency: same tone/lighting across photos",
                  "seo_alignment: at least one image reflects focus_1 context (e.g., wedding, gift)",
                  "attribute_truth: images must reflect mentioned attributes (e.g., gemstone=color)",
                  "negatives_forbidden: [watermark, heavy text overlays, blurry/low-res]"
                ],
                "ruleset": [
                  {
                    "id": "PRODUCT_RECORD_CONFIRMED_REQUIRED",
                    "params": {
                      "source": "product_record",
                      "status": "CONFIRMED"
                    }
                  }
                ],
                "title": "Görsel Analizi",
                "upstream_signature": {
                  "policy": "mark_stale_on_upstream_change"
                },
                "validations": {
                  "present": true
                },
                "tags": {
                  "channel": "visible"
                },
                "label": "Görsel Analizi",
                "await_user": true,
                "require_user_confirm": true,
                "no_skip": true,
                "manifest": {
                  "transforms": [
                    "extract_exif_and_file_meta",
                    "segment_subject_and_bg",
                    "compute_quality_metrics(lapvar,noise,exposure,wb,blocking)",
                    "specular_glare_estimate",
                    "composition_metrics(thirds,deadspace,horizon)",
                    "phash_duplicates",
                    "skin_bodypart_detector",
                    "jewelry_material_tone_finish",
                    "gemstone_presence_color",
                    "scale_estimator(coin/ruler/hand)",
                    "vision_embedding_style_cluster"
                  ],
                  "outputs": {
                    "media.exif": "object",
                    "media.file": "object",
                    "media.derived": "object",
                    "media.usage": "object",
                    "media.video": "object",
                    "style": "object",
                    "media.qc_report": "object"
                  },
                  "rules": [
                    {
                      "id": "report_only",
                      "assert": "true",
                      "on_fail": "warn_and_continue"
                    }
                  ]
                }
              },
              "1b": {
                "constraints": {
                  "dedupe": {
                    "case_insensitive": true,
                    "exact_match": true,
                    "normalize_diacritics": true,
                    "semantic_diversity_required": true,
                    "semantic_similarity_threshold": 0.85
                  },
                  "exact_words_per_query": 2,
                  "min_segments": 3,
                  "must_confirm": false,
                  "no_skip": true,
                  "optional_segments": [
                    "gemstone",
                    "style_aesthetic",
                    "color_tone",
                    "price_intent"
                  ],
                  "require_gpt_task": false,
                  "require_user_task": false,
                  "require_validations_pass": false,
                  "required_segments": [
                    "material_finish",
                    "use_case_occasion",
                    "audience_gift"
                  ],
                  "total_queries": 10
                },
                "description": "Bu adım, Alura'dan indirilecek CSV'lerin kalitesini belirleyen 8 adet, her biri 2 kelimeden oluşan çekirdek sorguları üretir.",
                "examples": {
                  "invalid": [
                    "silver plated",
                    "free tutorial",
                    "bracelet bracelet",
                    "ring"
                  ],
                  "valid": [
                    "gold bracelet",
                    "dainty necklace",
                    "mom gift",
                    "wedding ring",
                    "opal ring",
                    "gothic jewelry",
                    "black earrings",
                    "luxury bracelet"
                  ]
                },
                "flow": {
                  "guard": {
                    "advance_only_if": []
                  }
                },
                "gates": {
                  "must": [
                    "validations_ok"
                  ],
                  "on_contract_violation": "halt_and_report",
                  "on_miss": "halt",
                  "on_missing_required_path": "halt_and_report",
                  "on_soft_misalignment": "warn_and_continue"
                },
                "hitl_contract": {
                  "gpt_tasks": [
                    "2 kelimelik 8 farklı arama önerisi üret, tür çeşitliliği koru."
                  ],
                  "user_tasks": []
                },
                "name": "Alura Arama Önerileri",
                "negative_filters": [
                  "DIY",
                  "free",
                  "tutorial",
                  "plated* (silver/gold plated/kf)",
                  "kit",
                  "supplies",
                  "raw*"
                ],
                "outputs": [
                  "alura.search_suggestions[8]",
                  "alura.segments_coverage",
                  "alura.rejection_reasons[]",
                  "alura.selection_notes"
                ],
                "policy_ref": "_profiles.gpt_prod_executor_v1.languages.rules.search_suggestions_1b",
                "preconditions": {
                  "critical_pass": {
                    "require_ancestors_done": [
                      "0",
                      "1",
                      "3",
                      "6",
                      "16"
                    ]
                  },
                  "parent_defined": {
                    "exists": true,
                    "path": "/workflow_patches/steps/1"
                  }
                },
                "quality_filters": {
                  "alura_score_min": 70,
                  "competition_max": "Medium",
                  "conversion_rate_min": 0.015,
                  "fallback_policy": "Eşik altı ama stratejik niş sorgular gerekçelendirilirse (notes.reason) en fazla 2 adet dahil edilebilir."
                },
                "requires": [
                  "1a"
                ],
                "ruleset": [
                  {
                    "id": "ALURA_TOTAL_QUERIES",
                    "params": {
                      "count": 10
                    }
                  },
                  {
                    "id": "ALURA_EXACT_WORDS_PER_QUERY",
                    "params": {
                      "count": 10
                    }
                  },
                  {
                    "id": "ALURA_MIN_SEGMENTS",
                    "params": {
                      "count": 10
                    }
                  },
                  {
                    "id": "ALURA_QUALITY_THRESHOLDS",
                    "params": {
                      "competition_max": "Medium",
                      "conv_min": 0.015,
                      "score_min": 70
                    }
                  },
                  {
                    "id": "ALURA_DEDUPE",
                    "params": {
                      "case_insensitive": true,
                      "normalize_diacritics": true,
                      "semantic_threshold": 0.85
                    }
                  },
                  {
                    "id": "ALURA_NEGATIVE_TERMS",
                    "params": {
                      "terms": [
                        "DIY",
                        "free",
                        "tutorial",
                        "plated*",
                        "kit",
                        "supplies",
                        "raw*"
                      ]
                    }
                  },
                  {
                    "id": "NO_DERIVATION",
                    "params": {
                      "enforced": true
                    }
                  },
                  {
                    "id": "PRODUCT_RECORD_CONFIRMED_REQUIRED",
                    "params": {
                      "source": "product_record",
                      "status": "CONFIRMED"
                    }
                  }
                ],
                "selection_policy": [
                  "Her segmentten en az 1 öneri; toplamda min 3 segment kapsanmalı.",
                  "1-2 öneri yüksek hacim (pop), 2-3 öneri long-tail; geri kalanı dengeli karma.",
                  "Aynı kökten gelen varyasyonlar (ör. gold bracelet ~ dainty gold bracelet) 1 öneriyle sınırlandırılır."
                ],
                "title": "Alura Arama Önerileri",
                "ui": {
                  "instructions": "8 öneri üret: her biri tam 2 kelime, tekrar yok, kategori çeşitliliği yüksek."
                },
                "upstream_signature": {
                  "policy": "mark_stale_on_upstream_change"
                },
                "uses": "suggestions/image",
                "validations": {
                  "present": true
                },
                "label": "Alura Arama Önerileri",
                "await_user": true,
                "require_user_confirm": true,
                "no_skip": true,
                "manifest": {
                  "description": "Generate exactly 10 two-word EN search suggestions for Alura CSV pulls. No source bias; diversity across segments; keyword-like POS.",
                  "transforms": [
                    "normalize_case_and_diacritics",
                    "romanize_tr_chars",
                    "language_detect_and_filter(target='en')",
                    "tokenize_and_pos_tag",
                    "ngram_enforcer(n=2)",
                    "ban_function_words_prepositions",
                    "dedupe_by_root_distance(levenshtein<=2)",
                    "mmr_diversify(beta=0.7, sim='cosine')"
                  ],
                  "rules": [
                    {
                      "id": "exact_count_10",
                      "assert": "len(suggestions)==10",
                      "on_fail": "auto_fix_and_continue"
                    },
                    {
                      "id": "two_word_only",
                      "assert": "all(tokens(s)==2 for s in suggestions)",
                      "on_fail": "auto_fix_and_continue"
                    },
                    {
                      "id": "english_only",
                      "assert": "all(lang(s)=='en' for s in suggestions)",
                      "on_fail": "auto_fix_and_continue"
                    },
                    {
                      "id": "pos_pattern",
                      "assert": "all(pos(s) in [('ADJ','NOUN'),('NOUN','NOUN')] for s in suggestions)",
                      "on_fail": "auto_fix_and_continue"
                    },
                    {
                      "id": "length_sane",
                      "assert": "all(3<=len(w)<=18 for s in suggestions for w in split(s))",
                      "on_fail": "auto_fix_and_continue"
                    },
                    {
                      "id": "no_negatives",
                      "assert": "exclude(suggestions, negatives)",
                      "on_fail": "auto_fix_and_continue"
                    },
                    {
                      "id": "diversity_segments_min4",
                      "assert": "segments_covered(suggestions)>=4",
                      "on_fail": "auto_fix_and_continue"
                    },
                    {
                      "id": "root_crowding_limit",
                      "assert": "max_per_root(suggestions)<=2",
                      "on_fail": "auto_fix_and_continue"
                    },
                    {
                      "id": "no_punct_or_symbols",
                      "assert": "all(is_alnum_space(s) for s in suggestions)",
                      "on_fail": "auto_fix_and_continue"
                    },
                    {
                      "id": "backup_fill",
                      "assert": "if len(suggestions)<10 then suggestions+=backup_candidates[:(10-len(suggestions))]",
                      "on_fail": "auto_fix_and_continue"
                    }
                  ],
                  "outputs": {
                    "suggestions": [
                      "string"
                    ],
                    "backup_candidates": [
                      "string"
                    ],
                    "diversity_report": {
                      "segments": [
                        "string"
                      ],
                      "per_segment_counts": {
                        "string": "integer"
                      },
                      "root_crowding_max": "integer",
                      "__REF__": "/_run_order/steps/0a/outputs/1"
                    }
                  },
                  "handoff": [
                    "3a"
                  ]
                }
              },
              "20": {
                "constraints": {
                  "must_confirm": false,
                  "no_skip": true,
                  "require_gpt_task": false,
                  "require_user_task": false,
                  "require_validations_pass": false
                },
                "description": "Sürüm geçmişi, onaylar, checkpointler ve rollback noktalarının denetimi.",
                "flow": {
                  "guard": {
                    "advance_only_if": []
                  }
                },
                "gates": {
                  "must": [
                    "validations_ok"
                  ],
                  "on_contract_violation": "halt_and_report",
                  "on_miss": "halt",
                  "on_missing_required_path": "halt_and_report",
                  "on_soft_misalignment": "auto_fix_and_continue"
                },
                "hitl_contract": {
                  "gpt_tasks": [],
                  "user_tasks": []
                },
                "inputs": [
                  "workflow_patches.metadata",
                  "workflow_patches.governance"
                ],
                "name": "Versioning & Rollback QA",
                "notes": {
                  "include": [
                    "_run.record_type"
                  ]
                },
                "outputs": [
                  "audit.report{}",
                  "audit.findings[]",
                  "audit.rollback_points[]"
                ],
                "preconditions": {
                  "critical_pass": {
                    "require_ancestors_done": [
                      "0",
                      "1",
                      "3",
                      "6",
                      "16"
                    ]
                  }
                },
                "requires": [
                  "19"
                ],
                "rules": [
                  "each patch must have patch_note_tr",
                  "every 5th patch must record a checkpoint in version history (if enabled)",
                  "ruleset_hash must be present and consistent",
                  "produce rollback points and audit findings"
                ],
                "ruleset": [
                  {
                    "id": "PATCH_NOTE_REQUIRED",
                    "params": {
                      "field": "patch_note_tr"
                    }
                  },
                  {
                    "id": "CHECKPOINT_EVERY_5",
                    "params": {
                      "enabled": true
                    }
                  },
                  {
                    "id": "RULESET_HASH_REQUIRED",
                    "params": {
                      "field": "ruleset_hash"
                    }
                  },
                  {
                    "id": "ROLLBACK_POINTS_PRODUCE",
                    "params": {
                      "required": true
                    }
                  }
                ],
                "title": "Versioning & Rollback QA",
                "upstream_signature": {
                  "policy": "mark_stale_on_upstream_change"
                },
                "validations": {
                  "present": true
                },
                "label": "Versioning & Rollback QA",
                "await_user": true,
                "require_user_confirm": true,
                "no_skip": true,
                "json_title": "Versioning & Rollback QA"
              },
              "3": {
                "artifacts": [
                  "alura.load.report.json"
                ],
                "constraints": {
                  "must_confirm": true,
                  "no_skip": true,
                  "require_gpt_task": false,
                  "require_user_task": true,
                  "require_validations_pass": true
                },
                "description": "Alura/benzeri kaynaklardan 8 adet CSV yüklenir. Kolon adları normalize edilir; satır ve dil filtreleri uygulanır; temel metrikler hesaplanır.",
                "example": {
                  "header": [
                    "Keyword",
                    "Search volume",
                    "3mo. change",
                    "Competition",
                    "Sales",
                    "Score",
                    "undefined",
                    "Search to competition ratio",
                    "Google top of page bid (low range)",
                    "Long-tail keyword",
                    "Listing age",
                    "Length",
                    "Google top of page bid (high range)",
                    "Google CPC",
                    "Google competition level",
                    "Google competition index",
                    "Etsy tag",
                    "Conversion rate",
                    "Competition level",
                    "Sales per listing",
                    "Annual search trend"
                  ],
                  "row": [
                    "promise ring",
                    "550000",
                    "-6%",
                    "626301",
                    "1201509",
                    "60",
                    "",
                    "0.88",
                    "34",
                    "Yes",
                    "334 days",
                    "12",
                    "153",
                    "94",
                    "Low",
                    "100",
                    "Yes",
                    "1.05%",
                    "Very high",
                    "48",
                    "-33%"
                  ]
                },
                "flow": {
                  "guard": {
                    "advance_only_if": []
                  },
                  "on_fail": "halt",
                  "on_success_next": "3a"
                },
                "gates": {
                  "must": [
                    "validations_ok"
                  ],
                  "on_contract_violation": "halt_and_report",
                  "on_miss": "halt",
                  "on_missing_required_path": "halt_and_report",
                  "on_soft_misalignment": "warn_and_continue"
                },
                "guards": {
                  "analysis_blocked_until": "pre.csv.report.status==PASS",
                  "require_preprocess_pass": true
                },
                "hitl_contract": {
                  "gpt_tasks": [],
                  "user_tasks": []
                },
                "id": "3",
                "input_prep": {
                  "apply_common": true,
                  "enabled": true,
                  "enforce": true,
                  "on_fail": "halt",
                  "profile_ref": "similar_keywords",
                  "__REF__": "/_run_order/steps/0a/outputs/3"
                },
                "inputs": [
                  "alura.csv[8]"
                ],
                "label": "Similar Keywords Upload",
                "name": "Similar Keywords Upload",
                "next": [
                  "3a"
                ],
                "on_error": {
                  "fallback_next": [],
                  "policy": "fail-fast"
                },
                "outputs": [
                  "alura.csv[8]",
                  "alura.metrics"
                ],
                "params": {
                  "allow_missing": false,
                  "expected_files": 8,
                  "language": "auto",
                  "normalize_columns": true
                },
                "parsing": {
                  "allow_extra_headers": true,
                  "cast_all_as_text": true,
                  "dedupe": {
                    "case_insensitive": true,
                    "diacritics_insensitive": true,
                    "enabled": true
                  },
                  "encodings_priority": [
                    "utf-8",
                    "ISO-8859-1",
                    "cp1254",
                    "cp1252"
                  ],
                  "header_aliases": [
                    "Keyword",
                    "query",
                    "search_term"
                  ],
                  "ignore_header_order": true,
                  "normalize": {
                    "case_insensitive": true,
                    "collapse_spaces": true,
                    "diacritics_insensitive": true,
                    "trim_whitespace": true
                  },
                  "primary_field": "query",
                  "quote_mode": "relaxed",
                  "value_handling": {
                    "cast_all_as_text": true,
                    "normalize_yes_no": true,
                    "treat_empty_as_valid": true,
                    "treat_nan_as_empty": true
                  }
                },
                "post": {
                  "only_signal_ready": true,
                  "signal": "similar_ready"
                },
                "post_upload_process": [
                  "apply:policy.csv_pipeline to profile similar_keywords_csv"
                ],
                "pre": {
                  "run_preprocessing": true,
                  "silent": true
                },
                "preconditions": {
                  "critical_pass": {
                    "require_ancestors_done": [
                      "0",
                      "1",
                      "3",
                      "6",
                      "16"
                    ]
                  }
                },
                "preprocess": {
                  "dialect": {
                    "delimiter": ",",
                    "doublequote": true,
                    "escapechar": null,
                    "lineterminator": "auto",
                    "quotechar": "\""
                  },
                  "encoding": [
                    "utf-8-sig",
                    "utf-8",
                    "latin1"
                  ],
                  "header_map": {
                    "3mo. change": [
                      "3mo change",
                      "3 mo change",
                      "3-month change"
                    ],
                    "__REF__": "/_run_order/steps/12a/outputs/1"
                  },
                  "id": "csv_normalize_v2",
                  "integrity": {
                    "header_strict": true,
                    "max_repaired_per_file": 50,
                    "reject_if_any_rowlen_mismatch_after_repair": true,
                    "repair_strategy": "merge_split_fields_if_quoted_else_reject",
                    "row_len_must_equal_header": true
                  },
                  "normalize": {
                    "cast_all_as_text": true,
                    "do_not_invent_nan": true,
                    "keep_default_na": false,
                    "na_filter": false,
                    "preserve_empty_strings": true,
                    "strip_bom": true,
                    "trim_whitespace": false
                  },
                  "outputs": {
                    "header": "pre.csv.header",
                    "report": "pre.csv.report",
                    "row_count": "pre.csv.rows",
                    "table": "pre.csv.table"
                  }
                },
                "requires": [
                  "0a"
                ],
                "suggestion_mode": "suppress",
                "title": "Similar Keywords Upload",
                "type": "upload_csv",
                "ui": {
                  "accept": [
                    ".csv"
                  ],
                  "help": "Header esnek: Keyword | query | search_term. Ek sütunlar serbest; NaN/boş/Yes/No kabul.",
                  "max_files": 10,
                  "min_files": 8,
                  "title": "Similar Keywords CSV"
                },
                "upstream_signature": {
                  "policy": "mark_stale_on_upstream_change"
                },
                "validations": {
                  "file_count": "=8",
                  "required_columns": [
                    "keyword",
                    "search_volume?"
                  ]
                },
                "value_handling": {
                  "cast_all_as_text": true,
                  "treat_empty_as_valid": false,
                  "treat_nan_as_empty": false
                },
                "await_user": true,
                "require_user_confirm": true,
                "no_skip": true
              },
              "3a": {
                "can_revise_after": [
                  "4",
                  "5a",
                  "5b"
                ],
                "constraints": {
                  "max_same_root_in_top50": 3,
                  "min_pool_size": 100,
                  "must_confirm": false,
                  "no_derivation": true,
                  "no_skip": true,
                  "require_gpt_task": false,
                  "require_user_task": false,
                  "require_validations_pass": false,
                  "semantic_similarity_threshold": 0.85
                },
                "description": "CSV’lerden geniş havuz kur; 1..6 odak kelimeyi seç; çeşitlilik ve kalite kuralları uygula. Kaynak farkı puanlamayı ETKİLEMEZ. + MMR çeşitlilik, EV skoru, TR-normalizasyon, konsensüs sıklığı, rol ataması, destek terimler ve neden günlüğü.",
                "display": {
                  "hide": [
                    "tables",
                    "raw_rows",
                    "excel_like"
                  ],
                  "show": [
                    "text_summary",
                    "key_metrics"
                  ]
                },
                "diversity": {
                  "root_crowding": {
                    "equivalence": "case_insensitive_exact",
                    "max_per_root_in_top100": 3
                  },
                  "segment_cover_min": 3,
                  "segments": {
                    "material": [
                      "gold",
                      "10k",
                      "14k",
                      "18k",
                      "yellow gold",
                      "white gold",
                      "rose gold"
                    ],
                    "setting": [
                      "bezel",
                      "flush",
                      "solitaire",
                      "channel",
                      "pavé",
                      "prong"
                    ],
                    "style": [
                      "minimalist",
                      "dainty",
                      "simple",
                      "thin",
                      "delicate",
                      "everyday"
                    ],
                    "usage": [
                      "wedding",
                      "promise",
                      "bridal",
                      "engagement",
                      "stacking",
                      "anniversary"
                    ],
                    "__REF__": "/_run_order/steps/1b/outputs/1"
                  }
                },
                "flow": {
                  "guard": {
                    "advance_only_if": []
                  }
                },
                "gates": {
                  "must": [
                    "validations_ok"
                  ],
                  "on_contract_violation": "halt_and_report",
                  "on_miss": "halt",
                  "on_missing_required_path": "halt_and_report",
                  "on_soft_misalignment": "warn_and_continue"
                },
                "governance": {
                  "audit_fields": [
                    "source_csv_id",
                    "original_query",
                    "metrics_at_selection_time"
                  ],
                  "reproducibility": "store seeds and weights for ranking formula (w1..w5)"
                },
                "guards": {
                  "keyword_pool": {
                    "criteria": [
                      "relevance",
                      "volume",
                      "competition"
                    ],
                    "max_size": 50,
                    "min_size": 30,
                    "note": "Odak seçimi için geniş çeşit havuzu",
                    "require_types": [
                      "short",
                      "mid",
                      "long_tail"
                    ]
                  }
                },
                "hitl_contract": {
                  "gpt_tasks": [],
                  "user_tasks": []
                },
                "inputs": [
                  "alura.csv[8]",
                  "alura.metrics",
                  "context.product_category",
                  "prior.signals"
                ],
                "label": "Odak Anahtar Kelime + Türetilenler",
                "name": "Odak Anahtar Kelime + Türetilenler",
                "operations": [
                  "concat -> dedupe (case-insensitive, diacritics normalized)",
                  "filter by quality thresholds (score>=70, conv>=0.015, competition<=Medium) with fallback allowance<=10%",
                  "segment_coverage ensure >=3 segments (material/use_case/audience + optional gemstone/style/color/price)",
                  "normalize & canonicalize keywords (singular/plural, common misspellings) without creating new derivatives",
                  "rank by multi-score: w1*score + w2*conv + w3*ctr + w4*volume - w5*competition_penalty",
                  "diversity re-ranking: penalize near-duplicates (semantic_sim>=0.85) and same-root crowding",
                  "produce ranked pool and pick provisional focus_keywords[1..4]"
                ],
                "outputs": [
                  "keywords.pool.ranked[]",
                  "keywords.focus[1..4].provisional",
                  "keywords.selection_notes",
                  "keywords.segment_coverage"
                ],
                "pool_policy": {
                  "allowed_fields": {
                    "competitor_listings": [
                      "Title",
                      "Tags",
                      "Sales",
                      "Revenue",
                      "Conversion rate"
                    ],
                    "similar_keywords": [
                      "Keyword",
                      "Score",
                      "Search volume",
                      "3mo. change",
                      "Competition",
                      "Conversion rate"
                    ],
                    "top_listings": [
                      "Title",
                      "Tags",
                      "Sales",
                      "Revenue",
                      "Conversion rate"
                    ]
                  },
                  "dedupe": {
                    "mode": "case_insensitive_exact"
                  },
                  "negatives_ref": "global_negatives",
                  "normalization": {
                    "case_preserve": true,
                    "no_lemmatize_stem_synonym": true,
                    "single_space_only": true,
                    "trim_whitespace": true
                  },
                  "pool_limits": {
                    "allow_less": true,
                    "max": 100,
                    "target_min": 100
                  },
                  "source": "csv_only"
                },
                "preconditions": {
                  "critical_pass": {
                    "require_ancestors_done": [
                      "0",
                      "1",
                      "3",
                      "6",
                      "16"
                    ]
                  },
                  "parent_defined": {
                    "exists": true,
                    "path": "/workflow_patches/steps/3"
                  }
                },
                "requires": [
                  "3"
                ],
                "ruleset": {
                  "column_map_extra": {
                    "Long-tail keyword|Long tail": "Long-tail keyword",
                    "Search Keyword|Keyword": "Search Keyword",
                    "Search volume|Search Volume": "Search volume"
                  },
                  "filters": {
                    "alpha_ratio_min": 0.6,
                    "min_keyword_len": 3
                  }
                },
                "scoring": {
                  "combine": [
                    {
                      "take": "similar",
                      "weight": 0.6
                    },
                    {
                      "take": "market",
                      "weight": 0.4
                    }
                  ],
                  "features": {
                    "market": {
                      "revenue_signal": {
                        "agg": "sum_norm",
                        "any_of": [
                          "Revenue",
                          "Monthly revenue"
                        ],
                        "weight": 0.15
                      },
                      "sales_signal": {
                        "agg": "sum_norm",
                        "any_of": [
                          "Sales",
                          "Monthly sales"
                        ],
                        "weight": 0.15
                      },
                      "tag_hits_comp": {
                        "count": true,
                        "field": "Tags",
                        "source": "competitor_listings",
                        "weight": 0.2
                      },
                      "tag_hits_top": {
                        "count": true,
                        "field": "Tags",
                        "source": "top_listings",
                        "weight": 0.2
                      },
                      "title_hits_comp": {
                        "count": true,
                        "field": "Title",
                        "source": "competitor_listings",
                        "weight": 0.15
                      },
                      "title_hits_top": {
                        "count": true,
                        "field": "Title",
                        "source": "top_listings",
                        "weight": 0.15
                      }
                    },
                    "similar": {
                      "competition": {
                        "field": "Competition",
                        "norm": "inv",
                        "weight": 0.1
                      },
                      "conv": {
                        "field": "Conversion rate",
                        "norm": "pct",
                        "weight": 0.2
                      },
                      "score": {
                        "field": "Score",
                        "norm": "minmax",
                        "weight": 0.45
                      },
                      "trend_3mo": {
                        "field": "3mo. change",
                        "norm": "pct",
                        "weight": 0.05
                      },
                      "volume": {
                        "field": "Search volume",
                        "norm": "log1p",
                        "weight": 0.2
                      }
                    }
                  },
                  "missing_values": {
                    "no_imputation": true,
                    "skip_feature_if_missing": true
                  }
                },
                "selection": {
                  "allow_focus_lt_4_if_pool_lt_4": true,
                  "focus_count": 4,
                  "outputs": {
                    "focus_keywords": "outputs.focus_keywords",
                    "pool": "outputs.pool",
                    "selection_notes": "outputs.selection_notes"
                  },
                  "tie_breakers": [
                    "conversion_rate",
                    "title_tag_occurrence",
                    "similar_score"
                  ],
                  "validations": {
                    "halt_on_fail": true,
                    "require": [
                      "len(outputs.pool) >= 1",
                      "len(outputs.focus_keywords) >= (outputs.pool.length < 4 ? outputs.pool.length : 4)"
                    ]
                  }
                },
                "selection_policy": {
                  "focus_keywords_count": 4,
                  "notes_required": true,
                  "tie_breakers": [
                    "higher conversion_rate",
                    "higher overall score",
                    "better segment diversification"
                  ],
                  "use_in_3b": 1
                },
                "title": "Odak Anahtar Kelime + Türetilenler",
                "upstream_signature": {
                  "policy": "mark_stale_on_upstream_change"
                },
                "validations": {
                  "present": true
                },
                "await_user": true,
                "require_user_confirm": true,
                "no_skip": true,
                "manifest": {
                  "inputs": {
                    "csv_pools": [
                      {
                        "path": "*/alura_*.csv"
                      },
                      {
                        "path": "*/top_listings*.csv"
                      },
                      {
                        "path": "*/competitors*.csv"
                      }
                    ],
                    "negatives": [
                      "string"
                    ],
                    "product": {
                      "category": "string",
                      "attributes": [
                        "string"
                      ]
                    },
                    "metrics": {
                      "volume?": "number",
                      "competition?": "number",
                      "ctr?": "number",
                      "cvr?": "number",
                      "trend?": "number"
                    },
                    "ads_feedback?": [
                      {
                        "term": "string",
                        "cvr": "number",
                        "ctr": "number"
                      }
                    ],
                    "market?": {
                      "top_competitors_share?": "number"
                    },
                    "locale?": "string"
                  },
                  "transforms": [
                    "normalize_case_and_diacritics",
                    "unify_delimiters",
                    "dedupe_by_root_distance(levenshtein<=2)",
                    "locale_tr_casefold_I_dots",
                    "split_compound_terms",
                    "tag_long_tail_short_mid_labels",
                    "mmr_prepare_embeddings(corpus=keyword_pool)"
                  ],
                  "rules": [
                    {
                      "id": "pool_min",
                      "assert": "len(keyword_pool) >= 30",
                      "on_fail": "warn_and_report"
                    },
                    {
                      "id": "neg_filter",
                      "assert": "exclude(keyword_pool, negatives)",
                      "on_fail": "auto_fix_and_continue"
                    },
                    {
                      "id": "diversity_segments",
                      "assert": "segments_covered(keyword_pool) >= 3",
                      "on_fail": "warn_and_continue"
                    },
                    {
                      "id": "root_crowding",
                      "assert": "max_per_root(keyword_pool) <= 2",
                      "on_fail": "auto_fix_and_continue"
                    },
                    {
                      "id": "score_compute",
                      "assert": "score = w1*relevance + w2*volume - w3*competition + w4*cvr_proxy + w5*trend + w6*entropy - w7*crowding - w8*neg_flag",
                      "on_fail": "warn_and_continue"
                    },
                    {
                      "id": "no_source_bias",
                      "assert": "score_does_not_reference(source)",
                      "on_fail": "warn_and_report"
                    },
                    {
                      "id": "ads_uplift_optional",
                      "assert": "if ads_feedback then score += uplift(ads_feedback)",
                      "on_fail": "warn_and_continue"
                    },
                    {
                      "id": "select_focus_1_6",
                      "assert": "focus_keywords = select_top_diverse(keyword_pool, 6)",
                      "on_fail": "warn_and_report"
                    },
                    {
                      "id": "ensure_long_tail_mix",
                      "assert": "count(label=='long_tail' for term in keyword_pool) >= 10",
                      "on_fail": "warn_and_continue"
                    },
                    {
                      "id": "segment_coverage_focus",
                      "assert": "segments_covered(focus_keywords)>=3",
                      "on_fail": "auto_fix_and_continue"
                    },
                    {
                      "id": "min_long_tail_in_focus",
                      "assert": "count(label=='long_tail' for term in focus_keywords) >= 3",
                      "on_fail": "auto_fix_and_continue"
                    },
                    {
                      "id": "mmr_diversity",
                      "assert": "focus_candidates = mmr_select(keyword_pool, score, k=24, beta=0.6, sim='cosine')",
                      "on_fail": "warn_and_continue"
                    },
                    {
                      "id": "ev_expected_value_score",
                      "assert": "ev = volume * conv_prob(competition, ctr, cvr); score += ev_weight*normalize(ev)",
                      "on_fail": "warn_and_continue"
                    },
                    {
                      "id": "dominant_competitor_penalty",
                      "assert": "if market.top_competitors_share>0.6 then score -= dominance_penalty",
                      "on_fail": "warn_and_continue"
                    },
                    {
                      "id": "consensus_frequency_boost",
                      "assert": "freq = frequency_across_sources(source_map); score += freq_weight*normalize(freq)",
                      "on_fail": "warn_and_continue"
                    },
                    {
                      "id": "assign_focus_roles",
                      "assert": "focus_roles = {'focus_1':'highest_ev','focus_2':'alt_segment_high_ev','focus_3':'long_tail_1','focus_4':'season_niche','focus_5':'attribute_match','focus_6':'low_competition_discovery'}",
                      "on_fail": "warn_and_continue"
                    },
                    {
                      "id": "support_terms_build",
                      "assert": "support_terms = build_support_terms(focus_keywords, keyword_pool, per_focus=2..3, different_segments=true)",
                      "on_fail": "warn_and_continue"
                    },
                    {
                      "id": "language_map_build",
                      "assert": "language_map = build_language_map(keyword_pool, locale='tr', target='en')",
                      "on_fail": "warn_and_continue"
                    },
                    {
                      "id": "why_log_build",
                      "assert": "why_log = [{'term':t,'ev':ev(t),'diversity':div(t),'trend':trend(t),'reason':explain(t)} for t in focus_keywords]",
                      "on_fail": "warn_and_continue"
                    }
                  ],
                  "outputs": {
                    "focus_keywords": [
                      "string"
                    ],
                    "keyword_pool": [
                      "string"
                    ],
                    "title_seed": "string",
                    "desc_seeds": [
                      "string"
                    ],
                    "tags_seed": [
                      "string"
                    ],
                    "negatives_used": [
                      "string"
                    ],
                    "source_map": {
                      "term": [
                        "alura",
                        "top",
                        "competitors",
                        "ads?"
                      ]
                    },
                    "focus_roles": {
                      "focus_1": "string",
                      "focus_2": "string",
                      "focus_3": "string",
                      "focus_4": "string",
                      "focus_5": "string",
                      "focus_6": "string"
                    },
                    "support_terms": [
                      {
                        "focus": "string",
                        "terms": [
                          "string"
                        ]
                      }
                    ],
                    "language_map?": [
                      {
                        "term": "string",
                        "tr": "string",
                        "en": "string"
                      }
                    ],
                    "why_log": [
                      {
                        "term": "string",
                        "ev": "number",
                        "diversity": "number",
                        "trend": "number",
                        "reason": "string"
                      }
                    ]
                  },
                  "handoff": [
                    "3b",
                    "10",
                    "11",
                    "12"
                  ]
                }
              },
              "3b": {
                "kind": "csv_clean:similar",
                "name": "Taslak Paket — DRAFT",
                "ruleset": {
                  "policy": {
                    "add_missing": false,
                    "keep_extras": true,
                    "mode": "forgiving",
                    "on_mismatch": "silent",
                    "reorder_known": true
                  }
                },
                "title": "Taslak Paket — DRAFT",
                "description": "3.a’daki havuz ve odak #1 (varsayılan) kullanılarak taslak başlık, açıklama ve 13 etiket oluşturulur. Nihai SEO adımlarına geçmeden önce kullanıcı gözden geçirmesi içindir.",
                "output_format": {
                  "title_core_ngram": "string",
                  "description_outline": "plain_text_lines",
                  "tag_buckets": "json_object",
                  "render_preview_hint": "plain_text"
                },
                "label": "Taslak Paket — DRAFT",
                "await_user": true,
                "require_user_confirm": true,
                "no_skip": true
              },
              "3c": {
                "name": "Taslak Zenginleştirme",
                "ruleset": {
                  "filters": {
                    "alpha_ratio_min": 0.6,
                    "drop_zero_volume": true,
                    "min_length": 3
                  }
                },
                "title": "Odak Anahtar Kelime Seçimi & Havuz",
                "await_user": true,
                "require_user_confirm": true,
                "no_skip": true
              },
              "4": {
                "_original_snapshot": {
                  "had_keys": [
                    "constraints",
                    "description",
                    "flow",
                    "gates",
                    "governance",
                    "hitl_contract",
                    "ingest_policy_ref",
                    "input_prep",
                    "inputs",
                    "label",
                    "name",
                    "operations",
                    "outputs",
                    "post",
                    "pre",
                    "preconditions",
                    "preprocess",
                    "relations",
                    "requires",
                    "ruleset",
                    "suggestion_mode",
                    "title",
                    "upstream_signature",
                    "validations"
                  ]
                },
                "enabled": false,
                "locked": true,
                "name": "Top Listings (Genel)",
                "reactivation_protection": {
                  "allowed_fields": [
                    "notes"
                  ],
                  "fingerprint": "sha256:fd97e833d794ae372cebc4d8b540607287d867411e05c4380fccb87f8483158f",
                  "fingerprint_algo": "sha256"
                },
                "removed_at": "2025-09-12T07:25:50.861753",
                "removed_by": "user",
                "removed_reason": "decommissioned by user request",
                "status": "active",
                "tombstone": false,
                "visible": false,
                "constraints": {
                  "require_user_task": true,
                  "must_confirm": true,
                  "require_validations_pass": true,
                  "require_csv": false,
                  "empty_intake": "SKIP"
                },
                "ui": {
                  "min_files": 1
                },
                "title": "Top Listings (Genel)",
                "description": "Kullanıcıdan gelen 4 dar Top Listings CSV (focus_1..4’e denk gelen, her biri ≈200 ürün) temizlenir, normalize edilir ve konsolide edilir. 3.a odak kelime sırasının revizyonuna dair sinyaller üretilir.",
                "stop_for_confirmation": false,
                "label": "Top Listings (Genel)",
                "await_user": true,
                "require_user_confirm": true,
                "no_skip": true
              },
              "4a": {
                "name": "Top Listings Upload",
                "ruleset": {
                  "realign": {
                    "if_currency_in_title": true,
                    "if_url_in_video_false": "move_to_URL",
                    "trim_percent_signs": [
                      "Conversion rate",
                      "BSR Category (%)"
                    ]
                  }
                },
                "status": "active",
                "tombstone": false,
                "title": "Top Listings Upload",
                "constraints": {
                  "require_csv": false,
                  "empty_intake": "SKIP"
                },
                "stop_for_confirmation": false,
                "label": "Top Listings Upload",
                "await_user": true,
                "require_user_confirm": true,
                "no_skip": true
              },
              "4b": {
                "kind": "csv_clean:top",
                "name": "Top Listings Clean (csv_clean:top)",
                "ruleset": {
                  "policy": {
                    "add_missing": false,
                    "keep_extras": true,
                    "mode": "forgiving",
                    "on_mismatch": "silent",
                    "reorder_known": true
                  }
                },
                "status": "active",
                "tombstone": false,
                "title": "Top Listings Clean (csv_clean:top)",
                "constraints": {
                  "require_csv": false,
                  "empty_intake": "SKIP"
                },
                "stop_for_confirmation": false,
                "label": "Top Listings Clean (csv_clean:top)",
                "await_user": true,
                "require_user_confirm": true,
                "no_skip": true
              },
              "5": {
                "advisory_pack_similarity": {
                  "advisory_signals": {
                    "favorites_views": true,
                    "listing_age": true,
                    "review_count": true
                  },
                  "block": false,
                  "notes": "Top Listings analizinde ekstra sütunlar (Favorites, Reviews, Age) küçük ağırlıklarla puana katkı yapar.",
                  "severity": "advisory",
                  "similarity_score": {
                    "enabled": true,
                    "factors": {
                      "category_match": 0.2,
                      "price_band_match": 0.1,
                      "tags_keyword_match": 0.2,
                      "title_keyword_match": 0.5
                    },
                    "normalization": "0_to_1",
                    "note": "Benzerlik puanı 0–1; Title/Tags/Category/Fiyat uyumu ile hesaplanır.",
                    "__REF__": "/_run_order/steps/5b/outputs/5"
                  },
                  "title": "Similarity & Extra Signals for Top Listings"
                },
                "constraints": {
                  "must_confirm": false,
                  "no_skip": true,
                  "require_gpt_task": false,
                  "require_user_task": false,
                  "require_validations_pass": false,
                  "require_csv": true,
                  "empty_intake": "RUN FAIL"
                },
                "display": {
                  "hide": [
                    "tables",
                    "raw_rows",
                    "excel_like"
                  ],
                  "show": [
                    "text_summary",
                    "key_metrics"
                  ]
                },
                "flow": {
                  "guard": {
                    "advance_only_if": []
                  }
                },
                "gates": {
                  "must": [
                    "validations_ok"
                  ],
                  "on_contract_violation": "halt_and_report",
                  "on_miss": "halt",
                  "on_missing_required_path": "halt_and_report",
                  "on_soft_misalignment": "auto_fix_and_continue"
                },
                "hitl_contract": {
                  "gpt_tasks": [],
                  "user_tasks": []
                },
                "label": "Top Listings Upload (Dar)",
                "name": "Top Listings Upload (Dar)",
                "output": {
                  "digest_only": true,
                  "ui_table": false
                },
                "preconditions": {
                  "critical_pass": {
                    "require_ancestors_done": [
                      "0",
                      "1",
                      "3",
                      "6",
                      "16"
                    ]
                  }
                },
                "requires": [],
                "upstream_signature": {
                  "policy": "mark_stale_on_upstream_change"
                },
                "uses": "analysis/top_listings",
                "validations": {
                  "present": true
                },
                "title": "Top Listings Upload (Dar)",
                "await_user": true,
                "require_user_confirm": true,
                "no_skip": true
              },
              "5a": {
                "can_revise": [
                  "keywords.focus[1..4]"
                ],
                "constraints": {
                  "min_total_rows_warning": 600,
                  "must_confirm": false,
                  "negatives": [
                    "DIY",
                    "supplies",
                    "kit",
                    "raw",
                    "tutorial",
                    "plated*"
                  ],
                  "no_skip": true,
                  "require_gpt_task": false,
                  "require_user_task": false,
                  "require_validations_pass": false,
                  "require_csv": true,
                  "empty_intake": "RUN FAIL"
                },
                "description": "Top listings verisinden ürün/anahtar kelime performans içgörüleri çıkarılır; niş fırsatlar ve doygun alanlar işaretlenir; odak sıralaması için sinyal üretilir.",
                "flow": {
                  "guard": {
                    "advance_only_if": []
                  }
                },
                "gates": {
                  "must": [],
                  "on_contract_violation": "halt_and_report",
                  "on_miss": "halt",
                  "on_missing_required_path": "halt_and_report",
                  "on_soft_misalignment": "auto_fix_and_continue"
                },
                "governance": {
                  "notes_required": true
                },
                "guards": {
                  "analysis": {
                    "include_metrics": [
                      "conversion_rate",
                      "listing_age"
                    ],
                    "note": "Popüler ürün analizinde satış dışında metrikler de hesaba katılmalı"
                  }
                },
                "hitl_contract": {
                  "gpt_tasks": [],
                  "user_tasks": []
                },
                "inputs": [
                  "top_listings.cleaned.*",
                  "top_listings.merged",
                  "top_listings.keyword_metrics{}",
                  "top_listings.keyword_overlap[]",
                  "keywords.pool.ranked[]",
                  "keywords.focus[1..4].provisional",
                  "draft.title",
                  "draft.tags[13]"
                ],
                "min_samples_per_shop": 1,
                "name": "Popüler Ürünler Analizi",
                "output": {
                  "digest_only": true,
                  "top_n": 8,
                  "ui_table": false
                },
                "outputs": [
                  "popular.products.top[]",
                  "popular.keywords.top[]",
                  "popular.segments.summary{}",
                  "popular.focus_signals{}",
                  "popular.notes",
                  "similarity.report{}",
                  "similarity.score",
                  "similarity.label",
                  "similarity.notes"
                ],
                "pre": [
                  {
                    "args": {
                      "mode": "auto_fix_warn",
                      "rules_ref": "_csv_rules.competitor_csv",
                      "write_outputs": true
                    },
                    "name": "csv_preprocess.competitor_csv"
                  }
                ],
                "preconditions": {
                  "critical_pass": {
                    "require_ancestors_done": [
                      "0",
                      "1",
                      "3",
                      "6",
                      "16"
                    ]
                  },
                  "parent_defined": {
                    "exists": true,
                    "path": "/workflow_patches/steps/5"
                  }
                },
                "requires": [],
                "rules": [
                  "normalize product metrics (views, favorites, orders, conversion_rate) -> z-scores -> product_score",
                  "aggregate keyword occurrences across products -> keyword_score",
                  "dedupe near-duplicate products (semantic_sim>=0.85)",
                  "analyze segment coverage (material/use_case/audience + optional gemstone/style/color/price)",
                  "flag opportunities (high-conv/low-comp) and risks (high-comp/low-conv)",
                  "produce focus support/oppose signals for focus_1..4",
                  "Compute similarity between our listing and each row (title/desc embeddings; tag overlap; attribute match).",
                  "Attach similarity.score (0–1) and similarity.label (LOW/MEDIUM/HIGH) per row.",
                  "Emit similarity.report and notes; use in later steps (ads/seo/spam guard)."
                ],
                "ruleset": {
                  "keep_original": true,
                  "locale_auto": true,
                  "parse_price": "smart"
                },
                "suggestion_mode": "suppress",
                "title": "Popüler Ürünler Analizi",
                "upstream_signature": {
                  "policy": "mark_stale_on_upstream_change"
                },
                "uses": "selection/top8_by_shop",
                "label": "Popüler Ürünler Analizi",
                "await_user": true,
                "require_user_confirm": true,
                "no_skip": true,
                "manifest": {
                  "inputs": {
                    "alura": {
                      "score": "number",
                      "ctr": "number",
                      "conv": "number",
                      "competition": "number",
                      "__REF__": "/_run_order/steps/1b/outputs/2"
                    },
                    "competitors": [
                      {
                        "title": "string",
                        "tags": [
                          "string"
                        ],
                        "price": "number",
                        "free_shipping": "boolean",
                        "bestseller": "boolean",
                        "photos": "integer",
                        "video": "boolean"
                      }
                    ],
                    "trends": {
                      "season": "string",
                      "trend_ok": "boolean"
                    }
                  },
                  "rules": [
                    {
                      "id": "alura_score_min",
                      "assert": "alura.score >= 60",
                      "on_fail": "warn_and_continue"
                    },
                    {
                      "id": "kw_set_13_unique",
                      "assert": "len(output.tags)==13 && len(set(output.tags))==13",
                      "on_fail": "auto_fix_and_continue"
                    },
                    {
                      "id": "dedupe_vs_attributes",
                      "assert": "no_overlap(output.tags, product.attributes)",
                      "on_fail": "auto_fix_and_continue"
                    },
                    {
                      "id": "price_within_norm",
                      "assert": "price >= stats.avg_price*0.90 && price <= stats.avg_price*1.10",
                      "on_fail": "warn_and_continue"
                    },
                    {
                      "id": "free_shipping_if_norm",
                      "assert": "stats.free_shipping_ratio >= 0.60 -> shipping.free==true",
                      "on_fail": "warn_and_continue"
                    },
                    {
                      "id": "photos_minimum",
                      "assert": "stats.photos_count >= 5",
                      "on_fail": "warn_and_continue"
                    },
                    {
                      "id": "video_recommend",
                      "assert": "stats.video_present == true",
                      "on_fail": "warn_and_continue"
                    },
                    {
                      "id": "trend_validation",
                      "assert": "trends.trend_ok == true",
                      "on_fail": "warn_and_continue"
                    }
                  ],
                  "outputs": {
                    "keyword_set": {
                      "primary": "string",
                      "variants": [
                        "string"
                      ]
                    },
                    "pricing_norm": {
                      "min": "number",
                      "avg": "number",
                      "max": "number",
                      "free_shipping_ratio": "number"
                    },
                    "visual_standard": {
                      "min_photos": 5,
                      "video": "recommended"
                    },
                    "trend_notes": "string"
                  },
                  "handoff": [
                    "5b",
                    "5c",
                    "10",
                    "11",
                    "12"
                  ]
                }
              },
              "5b": {
                "constraints": {
                  "coverage": "multiple segments must be represented",
                  "exclusions": [
                    "brand infringement",
                    "supplies/DIY heavy presence"
                  ],
                  "must_confirm": false,
                  "no_skip": true,
                  "quality": ">=50% of selected shops have multi-match in popular.products.top[]",
                  "require_gpt_task": false,
                  "require_user_task": false,
                  "require_validations_pass": false,
                  "require_csv": true,
                  "empty_intake": "RUN FAIL"
                },
                "description": "5a ve 4 çıktıları üzerinden hedef rakip mağazalar belirlenir; ileride Ads ve SEO karşılaştırmaları için çekirdek set oluşturulur.",
                "enabled": false,
                "flow": {
                  "guard": {
                    "advance_only_if": []
                  }
                },
                "gates": {
                  "must": [],
                  "on_contract_violation": "halt_and_report",
                  "on_miss": "halt",
                  "on_missing_required_path": "halt_and_report",
                  "on_soft_misalignment": "warn_and_continue"
                },
                "governance": {
                  "notes_required": true
                },
                "guards": {
                  "competitor_selection": {
                    "feedback_to": "3b",
                    "pattern_extraction": [
                      "titles",
                      "tags"
                    ],
                    "require_category_match": true
                  }
                },
                "hitl_contract": {
                  "gpt_tasks": [],
                  "user_tasks": []
                },
                "inputs": [
                  "popular.products.top[]",
                  "popular.keywords.top[]",
                  "top_listings.merged",
                  "competitor_shops.csv?"
                ],
                "name": "Rakip Mağaza Seçimi",
                "notes": {
                  "lifecycle": "manifest-disabled"
                },
                "outputs": [
                  "competitors.candidates[]",
                  "competitors.selected[]",
                  "competitors.profiles{}",
                  "competitors.notes",
                  "similarity.report{}",
                  "similarity.score",
                  "similarity.label",
                  "similarity.notes"
                ],
                "preconditions": {
                  "critical_pass": {
                    "require_ancestors_done": [
                      "0",
                      "1",
                      "3",
                      "6",
                      "16"
                    ]
                  },
                  "parent_defined": {
                    "exists": true,
                    "path": "/workflow_patches/steps/5"
                  }
                },
                "requires": [
                  "5a"
                ],
                "rules": [
                  "extract shop_candidates from ownership of top products",
                  "if competitor_shops.csv present: clean/normalize and merge with candidates",
                  "score shops by product_score_topK, keyword_overlap_quality, category_fit, diversity_contrib",
                  "select 4–8 diverse shops; demote near-duplicate or same-root brands",
                  "Compute similarity between our listing and each row (title/desc embeddings; tag overlap; attribute match).",
                  "Attach similarity.score (0–1) and similarity.label (LOW/MEDIUM/HIGH) per row.",
                  "Emit similarity.report and notes; use in later steps (ads/seo/spam guard)."
                ],
                "ruleset": [
                  {
                    "id": "SHOP_SELECTION_COUNT_RANGE",
                    "params": {
                      "max": 8,
                      "min": 4
                    }
                  },
                  {
                    "id": "COVERAGE_MULTIPLE_SEGMENTS",
                    "params": {
                      "required": true
                    }
                  },
                  {
                    "id": "QUALITY_MIN_RATIO_TOP_MATCH",
                    "params": {
                      "ratio": 0.5
                    }
                  },
                  {
                    "id": "EXCLUSIONS",
                    "params": {
                      "terms": [
                        "brand infringement",
                        "supplies/DIY heavy"
                      ]
                    }
                  },
                  {
                    "id": "SIMILARITY_TITLE_DESC_CHECK",
                    "params": {}
                  },
                  {
                    "id": "SIMILARITY_TAGS_OVERLAP",
                    "params": {}
                  },
                  {
                    "id": "SIMILARITY_ATTRIBUTES_MATCH",
                    "params": {}
                  },
                  {
                    "id": "SIMILARITY_SCORE_COMPUTE",
                    "params": {}
                  },
                  {
                    "id": "PRODUCT_RECORD_CONFIRMED_REQUIRED",
                    "params": {
                      "source": "product_record",
                      "status": "CONFIRMED"
                    }
                  }
                ],
                "suggestion_mode": "suppress",
                "title": "Rakip Mağaza Seçimi",
                "ui": {
                  "hidden": true
                },
                "upstream_signature": {
                  "policy": "mark_stale_on_upstream_change"
                },
                "label": "Rakip Mağaza Seçimi",
                "await_user": true,
                "require_user_confirm": true,
                "no_skip": true
              },
              "6": {
                "artifacts": [
                  "competitors.load.report.json"
                ],
                "constraints": {
                  "must_confirm": true,
                  "no_skip": true,
                  "require_gpt_task": false,
                  "require_user_task": true,
                  "require_validations_pass": true,
                  "require_csv": true,
                  "empty_intake": "RUN FAIL"
                },
                "description": "Rakip mağaza listesi CSV’si (örn. competitor_shops.csv) yüklenir; mağaza URL/ID doğrulamaları ve temel temizlik yapılır.",
                "flow": {
                  "guard": {
                    "advance_only_if": []
                  }
                },
                "gates": {
                  "must": [
                    "validations_ok"
                  ],
                  "on_contract_violation": "halt_and_report",
                  "on_miss": "halt",
                  "on_missing_required_path": "halt_and_report",
                  "on_soft_misalignment": "warn_and_continue"
                },
                "input_prep": {
                  "apply_common": true,
                  "enabled": true,
                  "enforce": true,
                  "on_fail": "halt",
                  "profile_ref": "competitor_listings"
                },
                "inputs": [
                  "competitor_shops.csv"
                ],
                "label": "Competitor Listings (Genel)",
                "name": "Competitor Listings (Genel)",
                "next": [
                  "6a"
                ],
                "on_error": {
                  "fallback_next": [],
                  "policy": "fail-soft"
                },
                "outputs": [
                  "competitors.shops[]"
                ],
                "params": {
                  "required_columns": [
                    "shop_name",
                    "shop_url?"
                  ]
                },
                "post": {
                  "only_signal_ready": true,
                  "signal": "competitor_ready"
                },
                "post_upload_process": [
                  "apply:policy.csv_pipeline to profile competitor_shops_csv"
                ],
                "pre": {
                  "run_preprocessing": true,
                  "silent": true
                },
                "preconditions": {
                  "critical_pass": {
                    "require_ancestors_done": [
                      "0",
                      "1",
                      "3",
                      "6",
                      "16"
                    ]
                  }
                },
                "preprocess": {
                  "dialect": {
                    "lineterminator": "auto"
                  },
                  "normalize": {
                    "strip_bom": true
                  }
                },
                "requires": [
                  "0a"
                ],
                "title": "Competitor Listings (Genel)",
                "upstream_signature": {
                  "policy": "mark_stale_on_upstream_change"
                },
                "validations": {
                  "row_min": 1
                },
                "ui": {
                  "min_files": 1
                },
                "await_user": true,
                "require_user_confirm": true,
                "no_skip": true
              },
              "6a": {
                "advisory_pack_similarity": {
                  "advisory_signals": {
                    "review_rate": true,
                    "review_score": true,
                    "shop_level_aggregation": {
                      "enabled": true,
                      "metrics": [
                        "avg_price",
                        "avg_conversion_rate",
                        "avg_review_score",
                        "total_listings"
                      ]
                    }
                  },
                  "block": false,
                  "notes": "Rakip mağaza analizi shop-level özetler (ortalama fiyat, conversion, review) ile desteklenir.",
                  "severity": "advisory",
                  "similarity_score": {
                    "enabled": true,
                    "factors": {
                      "category_match": 0.2,
                      "price_band_match": 0.2,
                      "tags_keyword_match": 0.2,
                      "title_keyword_match": 0.4
                    },
                    "normalization": "0_to_1",
                    "note": "Rakip ürün benzerlik puanı; Title/Tags/Category/Fiyat üzerinden hesaplanır."
                  },
                  "title": "Similarity & Shop-Level Signals for Competitors"
                },
                "artifacts": [
                  "competitors.analysis.report.json",
                  "competitors.keywords.csv"
                ],
                "constraints": {
                  "must_confirm": false,
                  "no_skip": true,
                  "require_gpt_task": false,
                  "require_user_task": false,
                  "require_validations_pass": true,
                  "require_csv": true,
                  "empty_intake": "RUN FAIL"
                },
                "description": "Yüklenen rakip mağazalar üzerinden ürün/etiket/başlık ve fiyat dağılımı analiz edilir; kampanya/SEO için özet sinyaller üretilir.",
                "display": {
                  "hide": [
                    "tables",
                    "raw_rows",
                    "excel_like"
                  ],
                  "show": [
                    "text_summary",
                    "key_metrics"
                  ]
                },
                "flow": {
                  "guard": {
                    "advance_only_if": []
                  }
                },
                "gates": {
                  "must": [
                    "validations_ok"
                  ],
                  "on_contract_violation": "halt_and_report",
                  "on_miss": "halt",
                  "on_missing_required_path": "halt_and_report",
                  "on_soft_misalignment": "auto_fix_and_continue"
                },
                "inputs": [
                  "competitors.shops[]"
                ],
                "label": "Competitor Listings Upload",
                "name": "Competitor Listings Upload",
                "next": [
                  "7",
                  "8A",
                  "8B"
                ],
                "on_error": {
                  "fallback_next": [
                    "7"
                  ],
                  "policy": "fail-soft"
                },
                "outputs": [
                  "competitors.products[]",
                  "competitors.keywords[]",
                  "competitors.signals{}",
                  "competitors.*"
                ],
                "params": {
                  "extract_fields": [
                    "title",
                    "tags",
                    "price",
                    "category",
                    "reviews",
                    "sales?"
                  ],
                  "fetch_products": true,
                  "max_products_per_shop": 200
                },
                "preconditions": {
                  "critical_pass": {
                    "require_ancestors_done": [
                      "0",
                      "1",
                      "3",
                      "6",
                      "16"
                    ]
                  },
                  "parent_defined": {
                    "exists": true,
                    "path": "/workflow_patches/steps/6"
                  }
                },
                "requires": [
                  "6"
                ],
                "ruleset": {
                  "column_map": {
                    "Shop|Shop name|Seller": "shop",
                    "Tags|Tag list|Keywords": "tags",
                    "Title|Listing title": "title"
                  },
                  "dedup": {
                    "by": [
                      "listing_id",
                      "shop"
                    ],
                    "only_if_listing_id_present": true
                  },
                  "derive_listing_id": {
                    "from_url": {
                      "candidates": [
                        "URL",
                        "Url",
                        "listing_url",
                        "Listing URL",
                        "link"
                      ],
                      "regex": "/listing/(\\d+)"
                    },
                    "prefer": [
                      "listing_id",
                      "Listing ID",
                      "id"
                    ]
                  },
                  "realign": {
                    "if_currency_in_title": true
                  }
                },
                "title": "Competitor Listings Upload",
                "upstream_signature": {
                  "policy": "mark_stale_on_upstream_change"
                },
                "validations": {
                  "signals.non_empty": true
                },
                "await_user": true,
                "require_user_confirm": true,
                "no_skip": true
              },
              "6b": {
                "kind": "csv_clean:competitor",
                "name": "6b",
                "ruleset": {
                  "dedup": {
                    "approx_by": [
                      "shop",
                      "title"
                    ],
                    "by": [
                      "listing_id",
                      "shop"
                    ],
                    "threshold": 0.92
                  },
                  "policy": {
                    "add_missing": false,
                    "keep_extras": true,
                    "mode": "forgiving",
                    "on_mismatch": "silent",
                    "reorder_known": true
                  }
                },
                "title": "Competitor Listings Clean (Dedup + Normalize)",
                "constraints": {
                  "require_csv": true,
                  "empty_intake": "RUN FAIL"
                },
                "await_user": true,
                "require_user_confirm": true,
                "no_skip": true
              },
              "7": {
                "constraints": {
                  "bias_correction": "penalize single-shop dominance",
                  "min_segments": 3,
                  "must_confirm": false,
                  "no_derivation": true,
                  "no_skip": true,
                  "require_gpt_task": false,
                  "require_user_task": false,
                  "require_validations_pass": false
                },
                "description": "Rakip mağaza ve liste analizleri; anahtar kelimeleri materyal/kullanım/kitle temalarında kümeler; arz–talep boşluklarını çıkarır; Ads için pozitif/negatif çekirdek setini üretir. Girdiler: 5a (pazar+trend), 6/6a (CSV/sinyaller). Çıkış: 8 ve 18’e handoff.",
                "flow": {
                  "guard": {
                    "advance_only_if": []
                  }
                },
                "gates": {
                  "must": [
                    "validations_ok"
                  ],
                  "on_contract_violation": "halt_and_report",
                  "on_miss": "halt",
                  "on_missing_required_path": "halt_and_report",
                  "on_soft_misalignment": "auto_fix_and_continue"
                },
                "guards": {
                  "market_aggregation": {
                    "include_negative_keywords": true,
                    "__REF__": "/_run_order/steps/7/outputs/4"
                  }
                },
                "hitl_contract": {
                  "gpt_tasks": [],
                  "user_tasks": []
                },
                "inputs": [
                  "keywords.pool.ranked[]",
                  "keywords.focus[1..4].provisional",
                  "draft.title",
                  "draft.tags[13]",
                  "top_listings.merged",
                  "top_listings.keyword_metrics{}",
                  "focus.reorder_suggestion",
                  "popular.products.top[]",
                  "popular.keywords.top[]",
                  "popular.segments.summary{}",
                  "competitors.selected[]",
                  "competitors.profiles{}",
                  "alura.metrics"
                ],
                "name": "Rakip Analizi & Ads Çekirdeği",
                "outputs": [
                  "market.snapshot{}",
                  "ads.seed.positive[]",
                  "ads.seed.negative[]",
                  "market.notes"
                ],
                "preconditions": {
                  "critical_pass": {
                    "require_ancestors_done": [
                      "0",
                      "1",
                      "3",
                      "6",
                      "16"
                    ]
                  }
                },
                "requires": [
                  "5b"
                ],
                "rules": [
                  "cluster keywords into themes by material/use_case/audience (+gemstone/style/color/price)",
                  "analyze demand-supply gaps: pool vs. popular",
                  "ads.seed.positive = high score/conv, pazar uyumlu, rakiplerde kanıtlı",
                  "ads.seed.negative = ['DIY','free','tutorial','plated*','kit','supplies','raw*'] + rakip gürültü",
                  "prioritize intents: Purchase > Occasion > Material/Style"
                ],
                "ruleset": {
                  "missing_metric_policy": {
                    "missing_as_zero": true,
                    "renormalize_weights": true,
                    "warn_only": true
                  },
                  "weights": {
                    "monthly_sales": 0.0
                  }
                },
                "title": "Rakip Analizi & Ads Çekirdeği",
                "upstream_signature": {
                  "policy": "mark_stale_on_upstream_change"
                },
                "validations": {
                  "present": true
                },
                "label": "Rakip Analizi & Ads Çekirdeği",
                "await_user": true,
                "require_user_confirm": true,
                "no_skip": true,
                "json_title": "Rakip Analizi & Ads Çekirdeği"
              },
              "8": {
                "constraints": {
                  "must_confirm": false,
                  "no_skip": true,
                  "require_gpt_task": false,
                  "require_user_task": false,
                  "require_validations_pass": false
                },
                "description": "5a/5b ve 7 çıktılarından kampanya/ad group planını oluşturur; 8B'ye temiz, onaylı plan sağlar.",
                "flow": {
                  "guard": {
                    "advance_only_if": []
                  }
                },
                "gates": {
                  "must": [
                    "validations_ok"
                  ],
                  "on_contract_violation": "halt_and_report",
                  "on_miss": "halt",
                  "on_missing_required_path": "halt_and_report",
                  "on_soft_misalignment": "auto_fix_and_continue"
                },
                "hitl_contract": {
                  "gpt_tasks": [],
                  "user_tasks": []
                },
                "inputs": [
                  "popular.products.top[]",
                  "popular.keywords.top[]",
                  "market.aggregation{}",
                  "seed.terms[]",
                  "negative_terms.base[]"
                ],
                "name": "Market Aggregation & Ads Generation",
                "outputs": [
                  "ads_plan.csv",
                  "negative_keywords.csv",
                  "campaign_settings.json",
                  "ads_plan.status"
                ],
                "preconditions": {
                  "critical_pass": {
                    "require_ancestors_done": [
                      "0",
                      "1",
                      "3",
                      "6",
                      "16"
                    ]
                  }
                },
                "requires": [
                  "7"
                ],
                "rules": [
                  {
                    "id": "8A_GROUPING",
                    "title": "Ürün→Campaign/AdGroup eşleme; çeşitlilik koru"
                  },
                  {
                    "id": "8A_SEED_MATCHTYPES",
                    "title": "Seed'leri phrase/exact dağıt; genişleme yok"
                  },
                  {
                    "id": "8A_NEGATIVES",
                    "title": "Negatif liste uygula (marka/düşük niyet)"
                  },
                  {
                    "id": "8A_BUDGET_GEO",
                    "title": "Bütçe & lokasyon öner; onay şart"
                  },
                  {
                    "id": "8A_DUPE_CLEAN",
                    "title": "Çift/benzer seed temizliği (exact+semantic)"
                  }
                ],
                "ruleset": {
                  "missing_metric_policy": {
                    "missing_as_zero": true,
                    "renormalize_weights": true,
                    "warn_only": true
                  }
                },
                "title": "Market Aggregation & Ads Generation",
                "upstream_signature": {
                  "policy": "mark_stale_on_upstream_change"
                },
                "validations": {
                  "present": true
                },
                "label": "Market Aggregation & Ads Generation",
                "await_user": true,
                "require_user_confirm": true,
                "no_skip": true
              },
              "8a": {
                "constraints": {
                  "min_segments_per_group": 1,
                  "must_confirm": false,
                  "near_duplicate_limit": 1,
                  "no_derivation": true,
                  "no_skip": true,
                  "require_gpt_task": false,
                  "require_user_task": false,
                  "require_validations_pass": false
                },
                "description": "7. adımdaki çekirdek setlerden Etsy Ads için plan üretilir.",
                "flow": {
                  "guard": {
                    "advance_only_if": []
                  }
                },
                "gates": {
                  "must": [
                    "validations_ok"
                  ],
                  "on_contract_violation": "halt_and_report",
                  "on_miss": "halt",
                  "on_missing_required_path": "halt_and_report",
                  "on_soft_misalignment": "auto_fix_and_continue"
                },
                "guards": {
                  "ads_keywords": {
                    "ctr_check": true,
                    "relevance_check": true
                  }
                },
                "hitl_contract": {
                  "gpt_tasks": [],
                  "user_tasks": []
                },
                "inputs": [
                  "ads.seed.positive[]",
                  "ads.seed.negative[]",
                  "popular.products.top[]",
                  "popular.keywords.top[]",
                  "top_listings.*",
                  "competitors.*",
                  "keywords.pool.ranked[]",
                  "keywords.focus[1..4]"
                ],
                "name": "Ads Keyword Generation (Plan + Anahtarlar)",
                "outputs": [
                  "ads.plan{}",
                  "ads.keywords.final[]",
                  "ads.negative_terms[]",
                  "ab_test.plan",
                  "ads.governance.notes"
                ],
                "preconditions": {
                  "critical_pass": {
                    "require_ancestors_done": [
                      "0",
                      "1",
                      "3",
                      "6",
                      "16"
                    ]
                  },
                  "parent_defined": {
                    "exists": true,
                    "path": "/workflow_patches/steps/8"
                  }
                },
                "requires": [
                  "8A"
                ],
                "rules": [
                  "map segments to AdGroups (Purchase/Occasion/Material-Style/Audience)",
                  "select high conv/score, non-duplicate keywords per group",
                  "ads.negative_terms = seed + competitor noise terms",
                  "ab_test.window_days in [14,30]; single_variable = true",
                  "pause if ROAS<1.0 and Clicks>=20",
                  "boost if ROAS>=target and Orders>=3"
                ],
                "ruleset": [
                  {
                    "id": "ADGROUP_SEGMENT_MAPPING",
                    "params": {
                      "groups": [
                        "Purchase",
                        "Occasion",
                        "Material-Style",
                        "Audience"
                      ]
                    }
                  },
                  {
                    "id": "AB_TEST_WINDOW_DAYS",
                    "params": {
                      "max": 30,
                      "min": 14
                    }
                  },
                  {
                    "id": "PAUSE_RULE",
                    "params": {
                      "clicks_gte": 20,
                      "roas_lt": 1.0
                    }
                  },
                  {
                    "id": "BOOST_RULE",
                    "params": {
                      "orders_gte": 3,
                      "roas_gte": "target"
                    }
                  },
                  {
                    "id": "NO_DERIVATION",
                    "params": {
                      "enforced": true
                    }
                  },
                  {
                    "id": "NEAR_DUP_LIMIT",
                    "params": {
                      "max_per_group": 1
                    }
                  },
                  {
                    "id": "PRODUCT_RECORD_CONFIRMED_REQUIRED",
                    "params": {
                      "source": "product_record",
                      "status": "CONFIRMED"
                    }
                  }
                ],
                "title": "Ads Keyword Generation (Plan + Anahtarlar)",
                "upstream_signature": {
                  "policy": "mark_stale_on_upstream_change"
                },
                "validations": {
                  "present": true
                },
                "label": "Ads Keyword Generation (Plan + Anahtarlar)",
                "await_user": true,
                "require_user_confirm": true,
                "no_skip": true
              },
              "9": {
                "constraints": {
                  "min_segments": 3,
                  "must_confirm": false,
                  "near_duplicate_limit": 1,
                  "negatives": [
                    "DIY",
                    "free",
                    "tutorial",
                    "plated*",
                    "kit",
                    "supplies",
                    "raw*"
                  ],
                  "no_derivation": true,
                  "no_skip": true,
                  "require_gpt_task": false,
                  "require_user_task": false,
                  "require_validations_pass": false
                },
                "description": "SEO için odak ve destek anahtar setleri kesinleştirilir; başlık/etiket uyumu sağlanır.",
                "flow": {
                  "guard": {
                    "advance_only_if": []
                  }
                },
                "gates": {
                  "must": [
                    "validations_ok"
                  ],
                  "on_contract_violation": "halt_and_report",
                  "on_miss": "halt",
                  "on_missing_required_path": "halt_and_report",
                  "on_soft_misalignment": "auto_fix_and_continue"
                },
                "guards": {
                  "seo_refinement": {
                    "balance": [
                      "focus",
                      "support",
                      "long_tail"
                    ],
                    "diversity_required": true
                  }
                },
                "hitl_contract": {
                  "gpt_tasks": [],
                  "user_tasks": []
                },
                "inputs": [
                  "keywords.pool.ranked[]",
                  "keywords.focus[1..4]",
                  "draft.title",
                  "draft.tags[13]",
                  "market.snapshot{}",
                  "ads.keywords.final[]",
                  "popular.keywords.top[]",
                  "top_listings.keyword_metrics{}",
                  "alura.metrics"
                ],
                "kind": "meta_enrich",
                "name": "SEO Keyword Refinement",
                "outputs": [
                  "seo.keywords.focus[]",
                  "seo.keywords.supporting[]",
                  "seo.rejected[]",
                  "seo.notes"
                ],
                "preconditions": {
                  "critical_pass": {
                    "require_ancestors_done": [
                      "0",
                      "1",
                      "3",
                      "6",
                      "16"
                    ]
                  }
                },
                "requires": [
                  "8B"
                ],
                "rules": [
                  "validate focus_1..4 with market/performance overlap",
                  "construct supporting set from long-tail/niche keywords",
                  "avoid duplication: no repeated roots across title/tags",
                  "no duplicates with category attributes",
                  "record rationale for each acceptance/rejection"
                ],
                "ruleset": {
                  "noop_if_missing": true,
                  "normalize": {
                    "strip_extra_spaces": true,
                    "unicode_nfc": true
                  },
                  "note": "Light metadata enrichment; does not block flow."
                },
                "title": "SEO Keyword Refinement",
                "upstream_signature": {
                  "policy": "mark_stale_on_upstream_change"
                },
                "validations": {
                  "present": true
                },
                "label": "SEO Keyword Refinement",
                "await_user": true,
                "require_user_confirm": true,
                "no_skip": true
              },
              "ab.1": {
                "enabled": false,
                "gates": {
                  "on_soft_misalignment": "auto_fix_and_continue"
                },
                "kind": "analyze_market",
                "label": "Experiment: A/B Titles & Tags",
                "name": "ab_testing_titles_tags",
                "notes": {
                  "origin": "workshop",
                  "promoted_at": "2025-09-09T18:11:47.783512Z",
                  "source": "workshop/promotion"
                },
                "output": {
                  "digest_only": true
                },
                "requires": [],
                "ruleset": {
                  "NO_FABRICATION": true,
                  "method": "clone_listing",
                  "single_variable": true,
                  "test_window_days": 14
                },
                "status": "draft",
                "ui": {
                  "hidden": true
                },
                "await_user": true,
                "require_user_confirm": true,
                "no_skip": true
              },
              "ads.1": {
                "enabled": false,
                "gates": {
                  "on_soft_misalignment": "auto_fix_and_continue"
                },
                "kind": "analyze_market",
                "label": "Optimize: Etsy Ads ROAS Loop",
                "name": "etsy_ads_roas_loop",
                "notes": {
                  "origin": "workshop",
                  "promoted_at": "2025-09-09T18:11:47.783512Z",
                  "source": "workshop/promotion"
                },
                "output": {
                  "digest_only": true
                },
                "requires": [],
                "ruleset": {
                  "NO_FABRICATION": true,
                  "budget_focus": "top_converting_listings",
                  "data_window_days": 14,
                  "kpis": [
                    "Impressions",
                    "CTR",
                    "CPC",
                    "Orders",
                    "ROAS"
                  ],
                  "negative_terms_action": "turn_off_low_quality_queries"
                },
                "status": "draft",
                "ui": {
                  "hidden": true
                },
                "await_user": true,
                "require_user_confirm": true,
                "no_skip": true
              },
              "kw.1": {
                "enabled": false,
                "gates": {
                  "on_soft_misalignment": "auto_fix_and_continue"
                },
                "kind": "analyze_market",
                "label": "Learn/Discover: Alura-driven Keyword Set",
                "name": "keyword_research_alura",
                "notes": {
                  "origin": "workshop",
                  "promoted_at": "2025-09-09T18:11:47.783512Z",
                  "source": "workshop/promotion"
                },
                "output": {
                  "digest_only": true
                },
                "requires": [],
                "ruleset": {
                  "NO_FABRICATION": true,
                  "quality": {
                    "avoid_cannibalization": true,
                    "long_tail_bias": true
                  },
                  "selection": {
                    "max_competition": "<= medium",
                    "min_search_volume": ">= medium",
                    "prefer_high_conversion": true,
                    "require_relevance": true
                  }
                },
                "status": "draft",
                "ui": {
                  "hidden": true
                },
                "await_user": true,
                "require_user_confirm": true,
                "no_skip": true
              },
              "media.1": {
                "enabled": false,
                "gates": {
                  "hi_res_required": true,
                  "lifestyle_or_scale_shot": true,
                  "min_images": 5,
                  "on_soft_misalignment": "auto_fix_and_continue",
                  "short_video_recommended": true
                },
                "kind": "compliance_check",
                "label": "Gate: Image/Video Quality for CTR",
                "name": "imagery_quality_gate",
                "notes": {
                  "origin": "workshop",
                  "promoted_at": "2025-09-09T18:11:47.783512Z",
                  "source": "workshop/promotion"
                },
                "output": {
                  "digest_only": true
                },
                "requires": [],
                "ruleset": {
                  "NO_MISLEADING": true
                },
                "status": "draft",
                "ui": {
                  "hidden": true
                },
                "await_user": true,
                "require_user_confirm": true,
                "no_skip": true
              },
              "seo.1": {
                "enabled": false,
                "gates": {
                  "on_soft_misalignment": "auto_fix_and_continue"
                },
                "kind": "generate_title",
                "label": "Apply: Title/Tags/Attributes Harmony",
                "name": "title_tags_attributes_hard_rules",
                "notes": {
                  "origin": "workshop",
                  "promoted_at": "2025-09-09T18:11:47.783512Z",
                  "source": "workshop/promotion"
                },
                "output": {
                  "digest_only": true
                },
                "requires": [],
                "ruleset": {
                  "NO_STUFFING": true,
                  "TITLE_LENGTH": [
                    80,
                    140
                  ],
                  "attributes": {
                    "no_attr_dup_in_tags": true,
                    "treat_as_bonus_tags": true
                  },
                  "tags": {
                    "no_duplicates": true,
                    "use_all_13": true,
                    "variety_over_repetition": true
                  },
                  "title": {
                    "front_load": true,
                    "mobile_first_40chars": true
                  }
                },
                "status": "draft",
                "ui": {
                  "hidden": true
                },
                "await_user": true,
                "require_user_confirm": true,
                "no_skip": true
              },
              "seo_package": {
                "constraints": {
                  "desc_word_count_max": 500,
                  "desc_word_count_min": 300,
                  "must_confirm": false,
                  "no_derivation": true,
                  "no_skip": true,
                  "par_max": 5,
                  "par_min": 2,
                  "require_gpt_task": false,
                  "require_user_task": false,
                  "require_validations_pass": false,
                  "title_max_chars": 140,
                  "title_min_chars": 80
                },
                "description": "Başlık (10), Açıklama (11) ve Etiketler (12) çıktılarının birlikte kalite kontrolü yapılır.",
                "flow": {
                  "guard": {
                    "advance_only_if": []
                  }
                },
                "gates": {
                  "must": [
                    "validations_ok"
                  ],
                  "on_contract_violation": "halt_and_report",
                  "on_miss": "halt",
                  "on_missing_required_path": "halt_and_report",
                  "on_soft_misalignment": "warn_and_continue"
                },
                "governance": {
                  "notes_required": true,
                  "qc_checklist": [
                    "title_frontload_focus",
                    "title_length_ok",
                    "desc_paragraphs_ok",
                    "desc_word_count_ok",
                    "tags_13_unique",
                    "tags_segment_diversity",
                    "no_root_duplicates",
                    "no_negatives"
                  ]
                },
                "inputs": [
                  "draft.title",
                  "draft.description",
                  "draft.tags[13]",
                  "seo.keywords.focus[]",
                  "seo.keywords.supporting[]",
                  "alura.metrics",
                  "popular.keywords.top[]",
                  "top_listings.keyword_metrics{}"
                ],
                "name": "SEO Package QC",
                "outputs": [
                  "seo_package.qc_report",
                  "seo_package.issues[]",
                  "seo_package.recommendations[]"
                ],
                "preconditions": {
                  "critical_pass": {
                    "require_ancestors_done": [
                      "0",
                      "1",
                      "3",
                      "6",
                      "16"
                    ]
                  }
                },
                "rules": [
                  "title: 80-140 chars, front-load focus_1, no stuffing, no ALL CAPS",
                  "description: 300-500 words, 2-5 paragraphs, first sentence includes focus_1, scannable (short paragraphs, bullets)",
                  "tags: 13 unique, >=3 segments (material/use_case/audience), no duplicates with category attributes, max 1 same-root",
                  "all three outputs aligned thematically",
                  "exclude negatives: ['DIY','free','tutorial','plated*','kit','supplies','raw*']"
                ],
                "ruleset": [
                  {
                    "id": "TITLE_LENGTH_RANGE",
                    "params": {
                      "max": 140,
                      "min": 80
                    }
                  },
                  {
                    "id": "DESC_WORDCOUNT_RANGE",
                    "params": {
                      "max": 500,
                      "min": 300
                    }
                  },
                  {
                    "id": "DESC_PARAGRAPHS_RANGE",
                    "params": {
                      "max": 5,
                      "min": 2
                    }
                  },
                  {
                    "id": "TAGS_COUNT_13",
                    "params": {
                      "count": 13
                    }
                  },
                  {
                    "id": "SEGMENT_DIVERSITY_MIN",
                    "params": {
                      "min": 3
                    }
                  },
                  {
                    "id": "NO_ROOT_DUPLICATES",
                    "params": {
                      "enforced": true
                    }
                  },
                  {
                    "id": "NEGATIVE_TERMS",
                    "params": {
                      "terms": [
                        "DIY",
                        "free",
                        "tutorial",
                        "plated*",
                        "kit",
                        "supplies",
                        "raw*"
                      ]
                    }
                  }
                ],
                "title": "SEO Package QC (Title + Description + Tags)",
                "upstream_signature": {
                  "policy": "mark_stale_on_upstream_change"
                },
                "validations": {
                  "present": true
                },
                "await_user": true,
                "require_user_confirm": true,
                "no_skip": true
              },
              "trend.1": {
                "enabled": false,
                "gates": {
                  "on_soft_misalignment": "auto_fix_and_continue"
                },
                "kind": "analyze_market",
                "label": "Discover: Seasonal & Niche Trends",
                "name": "seasonal_niche_scanner",
                "notes": {
                  "origin": "workshop",
                  "promoted_at": "2025-09-09T18:11:47.783512Z",
                  "source": "workshop/promotion"
                },
                "output": {
                  "digest_only": true
                },
                "requires": [],
                "ruleset": {
                  "NO_FABRICATION": true,
                  "history_graph_check": true,
                  "preload_keywords_by_season": true
                },
                "status": "draft",
                "ui": {
                  "hidden": true
                },
                "await_user": true,
                "require_user_confirm": true,
                "no_skip": true
              },
              "5c": {
                "title": "Rakip Mağaza Önerileri (8)",
                "description": "Top Listings çıktılarına göre mağaza öneri havuzu (strict/medium/loose).",
                "stop_for_confirmation": true,
                "constraints": {
                  "requires_input_from": [
                    "5",
                    "5a",
                    "5b"
                  ]
                },
                "name": "Rakip Mağaza Önerileri (8)",
                "label": "Rakip Mağaza Önerileri (8)",
                "await_user": true,
                "require_user_confirm": true,
                "no_skip": true
              }
            },
            "governance": {
              "required_rule_ids": {
                "0": [
                  "REQUIRE_PRODUCT_RECORD_PRESENT",
                  "DISPLAY_PRODUCT_RECORD_SUMMARY",
                  "BLOCK_IF_MISSING"
                ],
                "00": [
                  "SAFE_COOLDOWN_ENFORCED",
                  "SAFE_CHECKPOINT_ENFORCED",
                  "SAFE_REQUIRE_FILENAME_SHA_MATCH",
                  "SAFE_BLOCK_ON_SUSPECT",
                  "MUTATION_POLICY_BLOCK",
                  "MANIFEST_LOCK_ENFORCER",
                  "INVARIANTS_ENFORCER",
                  "APPROVAL_GUARD_ENFORCER",
                  "FILE_LOCK_ENFORCED",
                  "SESSION_BIND_ENFORCED"
                ],
                "0a": [
                  "ALWAYS_RUN",
                  "NON_BLOCKING",
                  "ENCODING_NORMALIZE",
                  "TRIM_LOWER_PUNCT_NORMALIZE",
                  "HEADER_AUTO_MAP",
                  "DEDUPE_POLICY",
                  "TAGS_SPLIT_NORMALIZE",
                  "NUMERIC_NORMALIZE",
                  "WARN_MISSING_CRITICAL",
                  "REPORT_FIELDS"
                ],
                "10": [
                  "TITLE_FRONTLOAD",
                  "TITLE_LENGTH_RANGE",
                  "TITLE_REQUIRE_ATTRIBUTE",
                  "TITLE_REQUIRE_OCCASION_OR_AUDIENCE",
                  "TITLE_FORBIDDEN_TERMS",
                  "TITLE_NO_STUFFING_ALLCAPS"
                ],
                "11": [
                  "DESC_WORDCOUNT_RANGE",
                  "DESC_PARAGRAPHS_RANGE",
                  "DESC_OPENING_HAS_FOCUS",
                  "DESC_SUPPORTS_USED_RANGE",
                  "DESC_FORBIDDEN_TERMS",
                  "DESC_NO_STUFFING_ROOTDUP"
                ],
                "12": [
                  "TAGS_COUNT_13",
                  "TAGS_UNIQUE",
                  "SEGMENT_DIVERSITY_MIN",
                  "NO_ATTR_DUPLICATES",
                  "SAME_ROOT_LIMIT",
                  "TAGS_FORBIDDEN_TERMS",
                  "NEGATIVE_TERMS"
                ],
                "13": [
                  "REQUIRED_PHOTO_TYPES",
                  "MIN_RESOLUTION",
                  "FORBID_WATERMARK_BLUR",
                  "SEO_CONTEXT_IMAGE_REQUIRED"
                ],
                "14": [
                  "NO_BANNED_TERMS",
                  "NO_ALLCAPS_SPAM",
                  "NO_MISLEADING_CLAIMS",
                  "ETSY_POLICY_COMPLIANCE",
                  "SEO_ADS_CONSISTENCY",
                  "VISUAL_ALIGNMENT",
                  "NEGATIVE_TERMS",
                  "SPAM_BLOCKS_COMPLIANCE",
                  "COUNTRY_POLICY_COMPLIANCE"
                ],
                "15": [
                  "SEO_ADS_INTERSECTION_CHECK",
                  "REMOVE_SEO_IF_IN_NEGATIVES",
                  "FOCUS1_MUST_IN_ADS_POSITIVE",
                  "NO_TITLE_TAGS_IN_ADS_NEGATIVES",
                  "ADS_SYNC_STATUS_VALUES"
                ],
                "16": [
                  "TITLE_LENGTH_RANGE",
                  "DESC_WORDCOUNT_RANGE",
                  "DESC_PARAGRAPHS_RANGE",
                  "TAGS_COUNT_13",
                  "MEDIA_REQUIRED_TYPES",
                  "COMPLIANCE_PASS_REQUIRED",
                  "ADS_SYNC_PASS_REQUIRED",
                  "ATTRIBUTES_MUST_MATCH",
                  "SHOP_PROFILE_INTEGRATION",
                  "SPAM_BLOCKS_ASSEMBLY"
                ],
                "17": [
                  "EXPORT_FORMAT",
                  "ROW_PER_PRODUCT",
                  "EXPORT_COLUMNS",
                  "NO_EMPTY_REQUIRED_FIELDS",
                  "FILENAME_PATTERN",
                  "COMPUTE_SHA256",
                  "EXPORT_REQUIRED_COLUMNS",
                  "EXPORT_MIN_ATTRIBUTES",
                  "TAGS_COUNT_EXACT_13",
                  "MEDIA_MIN_COUNT_5",
                  "DESCRIPTION_WORDCOUNT_RANGE",
                  "CSV_QUOTING_ESCAPING_STRICT",
                  "SPLIT_TAGS_MEDIA_COLUMNS",
                  "EXPORT_REPORT_SUMMARY",
                  "EXPORT_FALLBACK_LAST_PASS",
                  "EXPORT_SPAM_STATUS_POLICY"
                ],
                "18": [
                  "LISTING_PASS_REQUIRED",
                  "EXPORT_FILE_AND_HASH_REQUIRED",
                  "COMPLIANCE_PASS_REQUIRED",
                  "ADS_SYNC_STATUS_POLICY",
                  "PUBLISH_STATUS_VALUES"
                ],
                "19": [
                  "MONITORING_WINDOW_DAYS",
                  "WARN_THRESHOLDS",
                  "BOOST_RULE",
                  "PAUSE_RULE",
                  "ACTIONABLE_PER_GROUP"
                ],
                "1b": [
                  "ALURA_TOTAL_QUERIES",
                  "ALURA_EXACT_WORDS_PER_QUERY",
                  "ALURA_MIN_SEGMENTS",
                  "ALURA_QUALITY_THRESHOLDS",
                  "ALURA_DEDUPE",
                  "NO_DERIVATION"
                ],
                "20": [
                  "PATCH_NOTE_REQUIRED",
                  "CHECKPOINT_EVERY_5",
                  "RULESET_HASH_REQUIRED",
                  "ROLLBACK_POINTS_PRODUCE"
                ],
                "21": [
                  "SPAM_STATUS_VALUES",
                  "CAT_POLICY_MAP",
                  "TITLE_PATTERN_REUSE_DETECT",
                  "DESC_PATTERN_REUSE_DETECT",
                  "MEDIA_NEAR_DUP",
                  "DESC_CONTACT_LINK_FORBIDDEN",
                  "EMOJI_OVERUSE_LIMIT",
                  "TAG_ATTRIBUTE_CONSISTENCY",
                  "COUNTRY_POLICY_SPAM_MAP"
                ],
                "3a": [
                  "NO_DERIVATION",
                  "POOL_MIN_SIZE",
                  "SEMANTIC_DIVERSITY_THRESHOLD",
                  "FOCUS_KEYWORDS_COUNT",
                  "DIVERSITY_RE_RANK"
                ],
                "3b": [
                  "USE_FOCUS1_BY_DEFAULT",
                  "TITLE_FRONTLOAD",
                  "TITLE_MAX_LEN",
                  "TAGS_COUNT_13",
                  "TAGS_UNIQUE",
                  "MAX_SAME_ROOT_IN_TAGS",
                  "NEGATIVE_TERMS",
                  "NO_DERIVATION"
                ],
                "4": [
                  "TOPLISTINGS_MIN_PER_CSV",
                  "TOPLISTINGS_EXPECTED_PER_CSV",
                  "EXCLUDE_NEGATIVE_TERMS",
                  "DEDUP_NEAR_DUPLICATES"
                ],
                "5a": [
                  "NEGATIVE_TERMS",
                  "MIN_TOTAL_ROWS_WARNING",
                  "DEDUP_NEAR_DUPLICATES",
                  "FOCUS_SUPPORT_SIGNALS",
                  "SIMILARITY_TITLE_DESC_CHECK",
                  "SIMILARITY_TAGS_OVERLAP",
                  "SIMILARITY_ATTRIBUTES_MATCH",
                  "SIMILARITY_SCORE_COMPUTE"
                ],
                "5b": [
                  "SHOP_SELECTION_COUNT_RANGE",
                  "COVERAGE_MULTIPLE_SEGMENTS",
                  "QUALITY_MIN_RATIO_TOP_MATCH",
                  "EXCLUSIONS",
                  "SIMILARITY_TITLE_DESC_CHECK",
                  "SIMILARITY_TAGS_OVERLAP",
                  "SIMILARITY_ATTRIBUTES_MATCH",
                  "SIMILARITY_SCORE_COMPUTE"
                ],
                "7": [
                  "NO_DERIVATION",
                  "MIN_SEGMENTS",
                  "ADS_SEED_NEGATIVE_TERMS",
                  "BIAS_CORRECTION_SINGLE_SHOP"
                ],
                "8B": [
                  "ADGROUP_SEGMENT_MAPPING",
                  "AB_TEST_WINDOW_DAYS",
                  "PAUSE_RULE",
                  "BOOST_RULE",
                  "NO_DERIVATION",
                  "NEAR_DUP_LIMIT"
                ],
                "9": [
                  "NO_DERIVATION",
                  "MIN_SEGMENTS",
                  "NEAR_DUP_LIMIT",
                  "NEGATIVE_TERMS",
                  "RECORD_RATIONALE"
                ],
                "seo_package": [
                  "TITLE_LENGTH_RANGE",
                  "DESC_WORDCOUNT_RANGE",
                  "DESC_PARAGRAPHS_RANGE",
                  "TAGS_COUNT_13",
                  "SEGMENT_DIVERSITY_MIN",
                  "NO_ROOT_DUPLICATES",
                  "NEGATIVE_TERMS"
                ]
              },
              "required_requires": {
                "1a": [
                  "0"
                ],
                "3a": [
                  "0a"
                ],
                "4": [
                  "0a"
                ],
                "5a": [
                  "0a"
                ],
                "5b": [
                  "0a"
                ]
              }
            }
          },
          "workflow_patches.steps{}": {
            "__MIRRORED_PLACEHOLDER__": "workflow_patches.steps{}",
            "__LOCKED__": true
          },
          "workflow_patches.governance.required_rule_ids{}": {
            "__MIRRORED_PLACEHOLDER__": "workflow_patches.governance.required_rule_ids{}",
            "__LOCKED__": true
          },
          "workflow_patches.governance.required_requires{}": {
            "__MIRRORED_PLACEHOLDER__": "workflow_patches.governance.required_requires{}",
            "__LOCKED__": true
          },
          "boot.sot.sources{}": {
            "__REF__": "/governance/step_sot/sources"
          },
          "boot.hashes{}": {
            "__REF__": "/_policy/hashes/steps"
          },
          "boot.id_aliases{}": {
            "__REF__": "/governance/id_aliases"
          },
          "boot.enabled_steps{}": {
            "__REF__": "/_run_order/steps"
          },
          "boot.sequence[]": {
            "__REF__": "/step_flow_lock/canonical_order"
          },
          "boot.session.profile{}": {
            "__REF__": "/_run_order/steps/0/shop_profile"
          },
          "boot.learned_prefs.language.preferred": {
            "__REF__": "/_run_order/steps/0/language/preferred"
          },
          "boot.learned_prefs.market.target_countries[]": {
            "__REF__": "/_run_order/steps/0/market/target_countries"
          },
          "boot.learned_prefs.market.first_country": {
            "__REF__": "/_run_order/steps/0/market/target_countries/0"
          }
        },
        "artifacts": {
          "self_check_report": {
            "__MIRRORED_PLACEHOLDER__": "self_check.report{}"
          },
          "self_check_missing": {
            "__MIRRORED_PLACEHOLDER__": "self_check.missing[]"
          },
          "self_check_status": {
            "__MIRRORED_PLACEHOLDER__": "self_check.status"
          },
          "self_check_timestamp": {
            "__MIRRORED_PLACEHOLDER__": "self_check.timestamp"
          }
        },
        "mirrors": {
          "cache": {
            "enabled": true,
            "stores": {
              "github_raw": {
                "origin": "https://raw.githubusercontent.com/<owner>/<repo>/<ref>/<path>.json",
                "mirror_dir": "sandbox:/mnt/data/_mirror_cache/github_raw",
                "etag": null,
                "last_modified": null,
                "strategy": "prefer_mirror_on_429_5xx",
                "notes": "Placeholder config; runtime fills etag/last_modified when syncing."
              }
            },
            "notes": "Local mirror for remote JSON sources; avoids 429/5xx and network jitter."
          },
          "sources_ref": {
            "__REF__": "/_runtime/remote_sources"
          }
        },
        "name": "Sistem Başlatma / Ön Yük",
        "authoritative_manifest_ref": {},
        "validators": [
          {
            "id": "forbid_csv_dependency_in_00",
            "type": "forbid_input_pattern",
            "severity": "block",
            "message": "Step 00 must not depend on CSV inputs; discovery may occur later (5/6).",
            "pattern": "csv"
          },
          {
            "id": "exists__boot.sot.sources{}",
            "fn": "exists",
            "target": "mirror.boot.sot.sources{}"
          },
          {
            "id": "exists__boot.hashes{}",
            "fn": "exists",
            "target": "mirror.boot.hashes{}"
          },
          {
            "id": "exists__boot.id_aliases{}",
            "fn": "exists",
            "target": "mirror.boot.id_aliases{}"
          },
          {
            "id": "exists__boot.enabled_steps{}",
            "fn": "exists",
            "target": "mirror.boot.enabled_steps{}"
          },
          {
            "id": "exists__boot.sequence[]",
            "fn": "exists",
            "target": "mirror.boot.sequence[]"
          },
          {
            "id": "profile_missing_warn",
            "type": "exists_warn",
            "severity": "warn",
            "message": "Shop profile is missing; proceeding with defaults.",
            "target": "mirror.boot.session.profile{}"
          },
          {
            "id": "exists__boot.session.profile{}",
            "fn": "exists",
            "target": "mirror.boot.session.profile{}"
          },
          {
            "id": "exists__boot.learned_prefs.language.preferred",
            "fn": "exists",
            "target": "mirror.boot.learned_prefs.language.preferred"
          },
          {
            "id": "exists__boot.learned_prefs.market.target_countries[]",
            "fn": "exists",
            "target": "mirror.boot.learned_prefs.market.target_countries[]"
          }
        ],
        "ui_directives": {
          "hide_csv_mentions": true,
          "subtitle": "Professional Boot: Session/Env/Knowledge snapshot (CSV-agnostic)",
          "summary_cards": {
            "health": {
              "bindings": {
                "broken_refs": {
                  "__REF__": "/_runtime/boot/health/broken_refs"
                },
                "alias_conflicts": {
                  "__REF__": "/_runtime/boot/health/alias_conflicts"
                },
                "manifest_drift": {
                  "__REF__": "/_runtime/boot/health/manifest_drift"
                }
              },
              "thresholds": {
                "ok": 0,
                "warn": 1
              }
            },
            "session": {
              "bindings": {
                "language": {
                  "__REF__": "/_run_order/steps/00/mirror/boot.learned_prefs.language.preferred"
                },
                "market_first": {
                  "__REF__": "/_run_order/steps/00/mirror/boot.learned_prefs.market.first_country"
                }
              }
            }
          }
        },
        "health_scan_plan": {
          "metrics": {
            "broken_refs": {
              "read": "scan_refs_broken_count",
              "write_to": "/_runtime/boot/health/broken_refs"
            },
            "alias_conflicts": {
              "read": "scan_alias_conflicts_count",
              "write_to": "/_runtime/boot/health/alias_conflicts"
            },
            "manifest_drift": {
              "read": "scan_manifest_drift_count",
              "write_to": "/_runtime/boot/health/manifest_drift"
            }
          },
          "schedule": {
            "when": "on_boot"
          },
          "notes": "Engine fills runtime health counts at boot per plan."
        },
        "params": {
          "preference_merge_order": [
            {
              "__REF__": "/_runtime/boot/learned_prefs"
            },
            {
              "__REF__": "/_run_order/steps/00/mirror/boot.session.profile{}"
            },
            {
              "__REF__": "/_run_order/steps/0"
            }
          ]
        }
      },
      "0a": {
        "auto_continue": true,
        "await_user": false,
        "requires": [],
        "requires_context": true,
        "title": "Ortam Kontrolleri",
        "validators_required": false,
        "ui_output": {
          "force_plain_text": true,
          "disable_autonumbering": true,
          "disable_bullets": true
        },
        "enabled": true,
        "purpose": "Ortam Kontrolleri",
        "description": "Her CSV türü için analizden önce daima çalışan, bloklamayan temizlik ve standardizasyon.",
        "inputs": [
          "csv.input"
        ],
        "outputs": [
          "csv.prep.output",
          "prep.report{}",
          "prep.issues[]",
          "prep.status",
          "prep.stats{}"
        ],
        "enforcement": {
          "on_violation": "warn"
        },
        "outputs_expected": {},
        "checklist": [],
        "what_gpt_does": [],
        "what_user_does": [],
        "rules": [
          {
            "id": "RUN_ORDER_ONLY",
            "assert": "Array.isArray(ctx?.read_paths) && ctx.read_paths.length>0 && ctx.read_paths.every(p => p.startsWith('_run_order.steps'))",
            "on_fail": [
              "halt",
              "explain: 'Sadece `_run_order.steps` kaynağından oku. snapshot/policy yasak.'"
            ]
          },
          {
            "id": "EXEC_ORDER_LOCK",
            "assert": "ctx?.exec && Array.isArray(ctx.exec.order) && Number.isInteger(ctx.exec.index) && ctx.exec.order[ctx.exec.index] === ctx.exec.next_step",
            "on_fail": [
              "halt",
              "explain: 'Sırayı `workflow_enforcement.execution_order` ile birebir uygula. Atlama yok.'"
            ]
          }
        ],
        "mirror": {
          "csv.input": {
            "__REF__": "/_run_order/steps/3/outputs/2"
          }
        },
        "artifacts": {
          "csv_prep_output": {
            "__MIRRORED_PLACEHOLDER__": "csv.prep.output"
          },
          "prep_report": {
            "__MIRRORED_PLACEHOLDER__": "prep.report{}"
          },
          "prep_issues": {
            "__MIRRORED_PLACEHOLDER__": "prep.issues[]"
          },
          "prep_status": {
            "__MIRRORED_PLACEHOLDER__": "prep.status"
          },
          "prep_stats": {
            "__MIRRORED_PLACEHOLDER__": "prep.stats{}"
          }
        },
        "name": "Ortam Kontrolleri",
        "authoritative_manifest_ref": {}
      },
      "1": {
        "auto_continue": true,
        "await_user": false,
        "preconditions": [
          {
            "equals": true,
            "on_fail": {
              "action": "block",
              "message": "Lütfen Step 0 (Product Info) onayını verin."
            },
            "path": "/steps/0/outputs/step0_review_confirmed"
          },
          {
            "guard": "preflight_diff"
          }
        ],
        "requires": [
          "0"
        ],
        "requires_context": true,
        "title": "Görsel Yükleme",
        "validators_required": false,
        "enabled": true,
        "purpose": "media_upload_qc",
        "description": "Ürün fotoğrafları ve varsa ürün videosu sisteme yüklenir. Dosya tipleri, çözünürlük ve oran kontrolleri yapılır; başarılı olanlar ürün varlık deposuna kaydedilir.",
        "inputs": [
          "user.upload.photos[]?",
          "user.upload.video?"
        ],
        "outputs": [
          "product.photos[]",
          "product.video?"
        ],
        "outputs_expected": {
          "images_ok": true,
          "normalized": true,
          "issues": []
        },
        "checklist": [
          "Min çözünürlük",
          "Oran/kenar boşluğu",
          "Arka plan temizliği"
        ],
        "what_gpt_does": [
          "Hatalı görseli raporlar",
          "Öneri verir"
        ],
        "what_user_does": [
          "Eksik/hatalı görselleri yeniler"
        ],
        "mirror": {
          "user.upload.photos[]?": {
            "__MIRRORED_PLACEHOLDER__": "user.upload.photos[]?",
            "__LOCKED__": true
          },
          "user.upload.video?": {
            "__MIRRORED_PLACEHOLDER__": "user.upload.video?",
            "__LOCKED__": true
          }
        },
        "artifacts": {
          "product_photos": {
            "__MIRRORED_PLACEHOLDER__": "product.photos[]"
          },
          "product_video?": {
            "__MIRRORED_PLACEHOLDER__": "product.video?"
          }
        },
        "name": "Görsel Yükleme",
        "authoritative_manifest_ref": {}
      },
      "10": {
        "auto_continue": true,
        "await_user": false,
        "enforcement": {
          "no_skip": false,
          "on_violation": "warn"
        },
        "generator": "passthrough",
        "outputs": {
          "title.final": {
            "max_len": 140,
            "type": "string"
          }
        },
        "requires": [
          "3b"
        ],
        "requires_context": true,
        "title": "SEO Title Generation",
        "ui_directives": {
          "force_visible": true,
          "readonly": true,
          "show": [
            "rule_check",
            "summary"
          ]
        },
        "validators": [
          {
            "fn": "equals",
            "left": "outputs.title",
            "right": "@steps.3b.outputs.title"
          },
          {
            "id": "no_discount_mentions_text",
            "message": "DISCOUNT_MENTION_FORBIDDEN: Public text must not mention discounts.",
            "patterns": [
              "\\b%?\\s?\\d{1,2}\\s?%?\\s?(off|sale|discount|save)\\b",
              "\\bdiscount(ed)?\\b",
              "\\bsale\\b",
              "\\bsave\\b",
              "\\bcoupon\\b",
              "\\bpromo(code)?\\b",
              "\\bdeal\\b",
              "\\bindirim\\b",
              "\\byüzde\\s?\\d{1,2}\\b",
              "\\bkampanya\\b"
            ],
            "severity": "block",
            "type": "content_regex_forbid"
          },
          {
            "id": "no_percent_price_math",
            "message": "PERCENT_PRICE_FORBIDDEN: Do not include discounted percentages or price math.",
            "patterns": [
              "\\b\\d{2,}\\s*(USD|TL|\\$|€)\\s*(instead of|was)\\s*\\d{2,}",
              "%\\s?\\d{1,2}",
              "\\b\\d{1,2}\\s?%"
            ],
            "severity": "block",
            "type": "content_regex_forbid"
          }
        ],
        "validators_required": false,
        "display_contract": "render_full",
        "ui_output": {
          "force_plain_text": true,
          "disable_autonumbering": true,
          "disable_bullets": true
        },
        "enabled": true,
        "purpose": "Title quality & policy enforcement (mobile-first, relevance, coherence)",
        "description": "Odak/support keywordler, ürün attribute'ları ve mağaza sesi ile SEO uyumlu başlık oluşturulur.",
        "inputs": [
          "keywords.focus[1..4]",
          "seo.keywords.supporting[]",
          "product.info{}",
          "shop.profile{}"
        ],
        "outputs_expected": [
          "draft.title"
        ],
        "checklist": [
          "Karakter limiti",
          "Anahtar en başta"
        ],
        "what_gpt_does": [
          "Başlık üretir"
        ],
        "what_user_does": [
          "Revize eder"
        ],
        "constraints": {
          "title_max_chars": 140,
          "frontload_critical_chars": 40,
          "disallow_keyword_stuffing": true,
          "disallow_duplicate_words": true,
          "casing_policy": "sentence",
          "punctuation_rules": {
            "allow_comma": true,
            "allow_pipe": true,
            "max_exclamation": 0
          },
          "require_alignment_with": [
            "11",
            "12"
          ],
          "frontload_window_chars": 40,
          "final_focus_keyword_mandatory_frontload": true,
          "require_terms_frontloaded": [
            "final_focus_keyword",
            "product_type",
            "metal_karat",
            "personalization"
          ],
          "min_frontloaded_matches": 2,
          "required_order_hint": [
            "product_type",
            "metal_karat",
            "personalization",
            "final_focus_keyword"
          ]
        },
        "mirror": {
          "keywords.focus[1..4]": {
            "__MIRRORED_PLACEHOLDER__": "keywords.focus[1..4]",
            "__LOCKED__": true,
            "__REF__": "/_run_order/steps/19/outputs/3"
          },
          "seo.keywords.supporting[]": {
            "__MIRRORED_PLACEHOLDER__": "seo.keywords.supporting[]",
            "__LOCKED__": true,
            "__REF__": "/_run_order/steps/9/outputs/0"
          },
          "product.info{}": {
            "__REF__": "/_run_order/steps/0/product_info",
            "__LIVE__": true
          },
          "shop.profile{}": {
            "__REF__": "/_run_order/steps/0/shop_profile",
            "__LIVE__": true
          }
        },
        "artifacts": {
          "title": {
            "__MIRRORED_PLACEHOLDER__": "title"
          },
          "title.final": {
            "__ALIAS_OF__": "title.final"
          }
        },
        "params": {
          "deterministic": true,
          "seed": 0,
          "temperature": 0,
          "top_p": 0,
          "shuffle": false
        },
        "name": "SEO Title Generation",
        "authoritative_manifest_ref": {}
      },
      "11": {
        "auto_continue": true,
        "await_user": false,
        "enforcement": {
          "no_skip": false,
          "on_violation": "warn"
        },
        "generator": "passthrough",
        "outputs": {
          "description.final": {
            "max_len": 3000,
            "min_len": 200,
            "type": "string"
          }
        },
        "requires": [
          "3b"
        ],
        "requires_context": true,
        "title": "SEO Description Generation",
        "ui_directives": {
          "force_visible": true,
          "readonly": true,
          "show": [
            "rule_check",
            "summary"
          ]
        },
        "validators": [
          {
            "fn": "equals",
            "left": "outputs.description",
            "right": "@steps.3b.outputs.description"
          },
          {
            "id": "no_discount_mentions_text",
            "message": "DISCOUNT_MENTION_FORBIDDEN: Public text must not mention discounts.",
            "patterns": [
              "\\b%?\\s?\\d{1,2}\\s?%?\\s?(off|sale|discount|save)\\b",
              "\\bdiscount(ed)?\\b",
              "\\bsale\\b",
              "\\bsave\\b",
              "\\bcoupon\\b",
              "\\bpromo(code)?\\b",
              "\\bdeal\\b",
              "\\bindirim\\b",
              "\\byüzde\\s?\\d{1,2}\\b",
              "\\bkampanya\\b"
            ],
            "severity": "block",
            "type": "content_regex_forbid"
          },
          {
            "id": "no_percent_price_math",
            "message": "PERCENT_PRICE_FORBIDDEN: Do not include discounted percentages or price math.",
            "patterns": [
              "\\b\\d{2,}\\s*(USD|TL|\\$|€)\\s*(instead of|was)\\s*\\d{2,}",
              "%\\s?\\d{1,2}",
              "\\b\\d{1,2}\\s?%"
            ],
            "severity": "block",
            "type": "content_regex_forbid"
          }
        ],
        "validators_required": false,
        "display_contract": "render_full",
        "ui_output": {
          "force_plain_text": true,
          "disable_autonumbering": true,
          "disable_bullets": true
        },
        "enabled": true,
        "purpose": "Description quality & policy enforcement (mobile-first, 3-paragraph, US English, alignment)",
        "description": "Ürün bilgileri ve mağaza sabitleriyle desteklenmiş, SEO uyumlu açıklama oluşturulur.",
        "inputs": [
          "draft.title",
          "keywords.focus[1..4]",
          "seo.keywords.supporting[]",
          "product.info{}",
          "shop.profile{}"
        ],
        "outputs_expected": [
          "draft.description"
        ],
        "checklist": [],
        "what_gpt_does": [
          "Açıklama üretir"
        ],
        "what_user_does": [
          "Revize eder"
        ],
        "constraints": {
          "must_include_focus_in_first_sentence": true,
          "structure_required_sections": [
            "Malzeme",
            "Ölçü/Boyut",
            "Kişiselleştirme",
            "Bakım",
            "Kargo/Süre"
          ],
          "description_min_chars": 200,
          "description_max_chars": 3000,
          "forbidden_terms_always": [
            "free",
            "bedava",
            "DIY",
            "takı yapımı",
            "imitation",
            "bijuteri"
          ],
          "forbidden_terms_if_solid_gold": [
            "gold plated",
            "gold filled",
            "kaplama"
          ],
          "forbidden_terms_if_plated": [
            "solid gold"
          ]
        },
        "mirror": {
          "draft.title": {
            "__REF__": "/_run_order/steps/3b/outputs/draft.title"
          },
          "keywords.focus[]": {
            "__MIRRORED_PLACEHOLDER__": "keywords.focus[]",
            "__REF__": "/_run_order/steps/19/outputs/4"
          },
          "keywords.supporting[]": {
            "__MIRRORED_PLACEHOLDER__": "keywords.supporting[]"
          },
          "product.info{}": {
            "__REF__": "/_run_order/steps/0/product_info",
            "__LIVE__": true
          },
          "shop.profile{}": {
            "__REF__": "/_run_order/steps/0/shop_profile",
            "__LIVE__": true
          },
          "keywords.focus[1..4]": {
            "__MIRRORED_PLACEHOLDER__": "keywords.focus[1..4]",
            "__LOCKED__": true
          },
          "seo.keywords.supporting[]": {
            "__MIRRORED_PLACEHOLDER__": "seo.keywords.supporting[]",
            "__LOCKED__": true,
            "__REF__": "/_run_order/steps/9/outputs/2"
          }
        },
        "artifacts": {
          "description": {
            "__MIRRORED_PLACEHOLDER__": "description"
          },
          "description.final": {
            "__ALIAS_OF__": "description.final"
          }
        },
        "params": {
          "deterministic": true,
          "seed": 0,
          "temperature": 0,
          "top_p": 0,
          "shuffle": false
        },
        "name": "SEO Description Generation",
        "authoritative_manifest_ref": {}
      },
      "12": {
        "auto_continue": true,
        "await_user": false,
        "enforcement": {
          "no_skip": false,
          "on_violation": "warn"
        },
        "generator": "passthrough",
        "outputs": {
          "tags.final[13]": {
            "count": 13,
            "items": {
              "max_len": 20,
              "type": "string"
            },
            "type": "array"
          }
        },
        "requires": [
          "3b"
        ],
        "requires_context": true,
        "title": "Tags Generation",
        "ui_directives": {
          "force_visible": true,
          "readonly": true,
          "show": [
            "rule_check",
            "summary"
          ]
        },
        "validators": [
          {
            "fn": "equals",
            "left": "outputs.tags",
            "right": "@steps.3b.outputs.tags"
          },
          {
            "fn": "count_equals",
            "target": "outputs.tags",
            "value": 13
          },
          {
            "id": "no_discount_mentions_text",
            "message": "DISCOUNT_MENTION_FORBIDDEN: Public text must not mention discounts.",
            "patterns": [
              "\\b%?\\s?\\d{1,2}\\s?%?\\s?(off|sale|discount|save)\\b",
              "\\bdiscount(ed)?\\b",
              "\\bsale\\b",
              "\\bsave\\b",
              "\\bcoupon\\b",
              "\\bpromo(code)?\\b",
              "\\bdeal\\b",
              "\\bindirim\\b",
              "\\byüzde\\s?\\d{1,2}\\b",
              "\\bkampanya\\b"
            ],
            "severity": "block",
            "type": "content_regex_forbid"
          },
          {
            "id": "no_percent_price_math",
            "message": "PERCENT_PRICE_FORBIDDEN: Do not include discounted percentages or price math.",
            "patterns": [
              "\\b\\d{2,}\\s*(USD|TL|\\$|€)\\s*(instead of|was)\\s*\\d{2,}",
              "%\\s?\\d{1,2}",
              "\\b\\d{1,2}\\s?%"
            ],
            "severity": "block",
            "type": "content_regex_forbid"
          }
        ],
        "validators_required": false,
        "display_contract": "render_full",
        "ui_output": {
          "force_plain_text": true,
          "disable_autonumbering": true,
          "disable_bullets": true
        },
        "enabled": true,
        "purpose": "Final tags quality & policy enforcement (uniqueness, diversity, alignment)",
        "description": "SEO, ürün attribute ve mağaza sesi yansıtan 13/13 benzersiz etiket seti oluşturulur.",
        "inputs": [
          "keywords.focus[1..4]",
          "seo.keywords.supporting[]",
          "product.info{}",
          "shop.profile{}"
        ],
        "outputs_expected": [
          "draft.tags[13]"
        ],
        "checklist": [],
        "what_gpt_does": [
          "Etiket üretir"
        ],
        "what_user_does": [
          "Seçer"
        ],
        "mirror": {
          "keywords.focus[]": {
            "__MIRRORED_PLACEHOLDER__": "keywords.focus[]"
          },
          "keywords.supporting[]": {
            "__MIRRORED_PLACEHOLDER__": "keywords.supporting[]"
          },
          "product.info{}": {
            "__REF__": "/_run_order/steps/0/product_info",
            "__LIVE__": true
          },
          "shop.profile{}": {
            "__REF__": "/_run_order/steps/0/shop_profile",
            "__LIVE__": true
          },
          "keywords.focus[1..4]": {
            "__MIRRORED_PLACEHOLDER__": "keywords.focus[1..4]",
            "__LOCKED__": true
          },
          "seo.keywords.supporting[]": {
            "__MIRRORED_PLACEHOLDER__": "seo.keywords.supporting[]",
            "__LOCKED__": true
          }
        },
        "artifacts": {
          "tags": {
            "__MIRRORED_PLACEHOLDER__": "tags"
          },
          "tags.final[13]": {
            "__ALIAS_OF__": "tags.final[13]"
          }
        },
        "params": {
          "deterministic": true,
          "seed": 0,
          "temperature": 0,
          "top_p": 0,
          "shuffle": false
        },
        "name": "Tags Generation",
        "authoritative_manifest_ref": {}
      },
      "13": {
        "auto_continue": true,
        "await_user": false,
        "requires": [
          "12"
        ],
        "requires_context": true,
        "title": "Checkpoint – Akış Kapıları (BG)",
        "validators_required": false,
        "enabled": true,
        "purpose": "Checkpoint – Akış Kapıları (BG)",
        "description": "Checkpoint – Akış Kapıları (BG)",
        "inputs": {
          "state": {}
        },
        "outputs_expected": {
          "gate_pass": true,
          "notes": []
        },
        "checklist": [],
        "what_gpt_does": [
          "Geçit kurallarını kontrol eder"
        ],
        "what_user_does": [
          "Uyarı varsa düzeltir"
        ],
        "outputs": [],
        "name": "Checkpoint – Akış Kapıları (BG)",
        "authoritative_manifest_ref": {}
      },
      "14": {
        "auto_continue": true,
        "await_user": false,
        "requires": [
          "13"
        ],
        "requires_context": true,
        "title": "Ara Değerlendirme – SEO Uyum",
        "validators_required": false,
        "enabled": true,
        "purpose": "Ara Değerlendirme – SEO Uyum",
        "description": "Başlık, açıklama, etiketler ve görsellerin Etsy kuralları ve SEO/Ads stratejisi ile uyumunu denetler.",
        "inputs": [
          "title.final",
          "description.final",
          "tags.final[13]",
          "media.checklist",
          "media.issues[]",
          "seo.keywords.focus[]",
          "seo.keywords.supporting[]",
          "ads.keywords.final[]",
          "attributes.selected{}"
        ],
        "outputs": [
          "compliance.report{}",
          "compliance.issues[]",
          "compliance.recommendations[]",
          "compliance.status"
        ],
        "outputs_expected": {
          "seo_score": 0,
          "issues": []
        },
        "checklist": [
          "10: Başlık ≤140 ve kritik anahtar ilk 40 karakterde mi?",
          "10: Keyword stuffing / mükerrer kelime / all-caps yok mu?",
          "10↔11↔12: Başlık, açıklama ve etiketler arasında anahtar uyumu var mı?",
          "11: İlk cümlede odak anahtar geçiyor mu?",
          "11: Yapı: Malzeme / Ölçü-Boyut / Kişiselleştirme / Bakım / Kargo sırası korundu mu?",
          "11: Yasaklı terimler (always/plated/solid) ihlal edilmiyor mu?",
          "11: Açıklama uzunluğu 200–3000 karakter aralığında mı?",
          "10: İlk 40 karakterde final_focus_keyword geçiyor mu?",
          "10: İlk 40 karakter içinde Step 0'dan en az 2 bileşen var mı? (product_type, metal_karat, personalization)",
          "10: Sıra önerisi (product_type → metal_karat → personalization → focus) korunmuş mu? (ihlal soft uyarı)"
        ],
        "what_gpt_does": [
          "Skor ve öneri verir",
          "Step 10 ve 11 'constraints' alanlarına göre SEO uyum denetimi yapar",
          "Uyum hatalarını listeler ve düzeltme önerir",
          "Step 0 'mapping.title_frontload' ve Step 10 'constraints' bağlarına göre front-load doğrulaması yapar"
        ],
        "what_user_does": [
          "Düzeltir"
        ],
        "mirror": {
          "title.final": {
            "__REF__": "/_run_order/steps/10/outputs/title.final"
          },
          "description.final": {
            "__REF__": "/_run_order/steps/11/outputs/description.final"
          },
          "tags.final[13]": {
            "__REF__": "/_run_order/steps/12/outputs/tags.final[13]"
          },
          "media.checklist": {
            "__MIRRORED_PLACEHOLDER__": "media.checklist",
            "__LOCKED__": true,
            "__REF__": "/_run_order/steps/18/outputs/0"
          },
          "media.issues[]": {
            "__MIRRORED_PLACEHOLDER__": "media.issues[]",
            "__LOCKED__": true,
            "__REF__": "/_run_order/steps/19/outputs/1"
          },
          "seo.keywords.focus[]": {
            "__REF__": "/_run_order/steps/3c/outputs/0"
          },
          "seo.keywords.supporting[]": {
            "__MIRRORED_PLACEHOLDER__": "seo.keywords.supporting[]",
            "__LOCKED__": true,
            "__REF__": "/_run_order/steps/14/outputs/0"
          },
          "ads.keywords.final[]": {
            "__MIRRORED_PLACEHOLDER__": "ads.keywords.final[]",
            "__LOCKED__": true
          },
          "attributes.selected{}": {
            "__MIRRORED_PLACEHOLDER__": "attributes.selected{}",
            "__LOCKED__": true,
            "__REF__": "/_run_order/steps/12a/outputs/0"
          },
          "__REF__": "/_run_order/steps/14/outputs/3"
        },
        "artifacts": {
          "compliance_report": {
            "__MIRRORED_PLACEHOLDER__": "compliance.report{}"
          },
          "compliance_issues": {
            "__MIRRORED_PLACEHOLDER__": "compliance.issues[]"
          },
          "compliance_recommendations": {
            "__MIRRORED_PLACEHOLDER__": "compliance.recommendations[]"
          },
          "compliance_status": {
            "__MIRRORED_PLACEHOLDER__": "compliance.status"
          }
        },
        "params": {
          "deterministic": true,
          "seed": 0,
          "temperature": 0,
          "top_p": 0
        },
        "name": "Ara Değerlendirme – SEO Uyum",
        "authoritative_manifest_ref": {}
      },
      "15": {
        "auto_continue": true,
        "await_user": false,
        "enforcement": {
          "no_skip": true,
          "on_violation": "block"
        },
        "requires": [
          "14"
        ],
        "requires_context": true,
        "title": "QA – Uyarı (Soft)",
        "ui_directives": {
          "force_visible": true
        },
        "validators": [
          {
            "id": "require_context_all",
            "message": "CONTEXT_REQUIRED: This step must consume all prior outputs per policy.",
            "severity": "block",
            "type": "require_context_all"
          }
        ],
        "validators_required": false,
        "enabled": true,
        "purpose": "QA – Uyarı (Soft)",
        "description": "SEO focus/support kelimeleri ile Ads pozitif/negatif setlerini senkronize eder, final seti üretir.",
        "inputs": {
          "artifacts": {}
        },
        "outputs_expected": {
          "warnings": []
        },
        "checklist": [
          "Başlık ve açıklamada akıcılık/okunabilirlik uyarıları",
          "Noktalama / büyük-küçük harf tutarlılığı",
          "Keyword yoğunluğu aşırı ise uyar (stuffing)",
          "Açıklama iskeletinde eksik bölüm var ise uyar"
        ],
        "what_gpt_does": [
          "QA uyarılarını çıkarır",
          "10/11 constraints sonrası yumuşak QA uyarıları üretir",
          "Uygulanabilir mikro-düzeltmeler önerir"
        ],
        "what_user_does": [
          "Gereken düzeltmeleri yapar"
        ],
        "outputs": [],
        "name": "QA – Uyarı (Soft)",
        "authoritative_manifest_ref": {}
      },
      "16": {
        "auto_continue": true,
        "await_user": false,
        "requires": [
          "15"
        ],
        "requires_context": true,
        "title": "Listing Assemble & Record-Type Select",
        "validators_required": false,
        "enabled": true,
        "purpose": "export_and_hash",
        "description": "Önceki adımlardan gelen tüm çıktıları birleştirerek yayına hazır tam ürün listing paketi oluşturur.",
        "inputs": [
          "title.final",
          "description.final",
          "tags.final[13]",
          "media.checklist",
          "media.qc_report",
          "media.recommendations[]",
          "compliance.status",
          "compliance.issues[]",
          "ads_sync.final_positive[]",
          "ads_sync.final_negative[]",
          "ads_sync.status",
          "seo.keywords.focus[]",
          "seo.keywords.supporting[]",
          "product.info{}",
          "shop.profile{}"
        ],
        "outputs": [
          "listing.final{}",
          "listing.issues[]",
          "listing.status",
          "listing.notes"
        ],
        "outputs_expected": {
          "listing_record": {}
        },
        "checklist": [],
        "what_gpt_does": [
          "Kaydı oluşturur"
        ],
        "what_user_does": [
          "Göz atar"
        ],
        "mirror": {
          "title.final": {
            "__REF__": "/_run_order/steps/10/outputs/title.final"
          },
          "description.final": {
            "__REF__": "/_run_order/steps/11/outputs/description.final"
          },
          "tags.final[13]": {
            "__REF__": "/_run_order/steps/12/outputs/tags.final[13]"
          },
          "media.checklist": {
            "__MIRRORED_PLACEHOLDER__": "media.checklist",
            "__LOCKED__": true,
            "__REF__": "/_run_order/steps/16/outputs/2"
          },
          "media.qc_report": {
            "__MIRRORED_PLACEHOLDER__": "media.qc_report",
            "__LOCKED__": true,
            "__REF__": "/_run_order/steps/1a/outputs/3"
          },
          "media.recommendations[]": {
            "__MIRRORED_PLACEHOLDER__": "media.recommendations[]",
            "__LOCKED__": true,
            "__REF__": "/_run_order/steps/19/outputs/2"
          },
          "compliance.status": {
            "__MIRRORED_PLACEHOLDER__": "compliance.status",
            "__LOCKED__": true,
            "__REF__": "/_run_order/steps/18/outputs/1"
          },
          "compliance.issues[]": {
            "__MIRRORED_PLACEHOLDER__": "compliance.issues[]",
            "__LOCKED__": true,
            "__REF__": "/_run_order/steps/16/outputs/1"
          },
          "ads_sync.final_positive[]": {
            "__MIRRORED_PLACEHOLDER__": "ads_sync.final_positive[]",
            "__LOCKED__": true,
            "__REF__": "/_run_order/steps/16/outputs/0"
          },
          "ads_sync.final_negative[]": {
            "__MIRRORED_PLACEHOLDER__": "ads_sync.final_negative[]",
            "__LOCKED__": true,
            "__REF__": "/_run_order/steps/7/outputs/6"
          },
          "ads_sync.status": {
            "__MIRRORED_PLACEHOLDER__": "ads_sync.status",
            "__LOCKED__": true,
            "__REF__": "/_run_order/steps/8C/outputs/3"
          },
          "seo.keywords.focus[]": {
            "__REF__": "/_run_order/steps/3c/outputs/0"
          },
          "seo.keywords.supporting[]": {
            "__MIRRORED_PLACEHOLDER__": "seo.keywords.supporting[]",
            "__LOCKED__": true
          },
          "product.info{}": {
            "__REF__": "/_run_order/steps/0/product_info",
            "__LIVE__": true
          },
          "shop.profile{}": {
            "__REF__": "/_run_order/steps/0/shop_profile",
            "__LIVE__": true
          },
          "__REF__": "/_run_order/steps/6_top_listings.aggregate/outputs/0",
          "attributes.selected{}": {
            "__REF__": "/_run_order/steps/12a/outputs/0"
          }
        },
        "artifacts": {
          "listing_final": {
            "__MIRRORED_PLACEHOLDER__": "listing.final{}"
          },
          "listing_issues": {
            "__MIRRORED_PLACEHOLDER__": "listing.issues[]"
          },
          "listing_status": {
            "__MIRRORED_PLACEHOLDER__": "listing.status"
          },
          "listing_notes": {
            "__MIRRORED_PLACEHOLDER__": "listing.notes"
          }
        },
        "name": "Listing Assemble & Record-Type Select",
        "authoritative_manifest_ref": {}
      },
      "17": {
        "auto_continue": true,
        "await_user": false,
        "requires": [
          "16"
        ],
        "requires_context": true,
        "title": "Export (CSV/XLSX/JSON)",
        "validators_required": false,
        "enabled": true,
        "purpose": "Export (CSV/XLSX/JSON)",
        "description": "Listing.final çıktısını Office 2007 uyumlu CSV formatına dönüştürür.",
        "inputs": {
          "artifact_filename": "{channel}.{version}.{date}_{time}.json"
        },
        "outputs_expected": {
          "files": [
            "csv",
            "xlsx",
            "json"
          ]
        },
        "checklist": [],
        "what_gpt_does": [
          "Dışa aktarır"
        ],
        "what_user_does": [
          "İndirir/yükler"
        ],
        "outputs": [
          "export.file_path"
        ],
        "artifacts": {
          "export.file_path": {
            "__ALIAS_OF__": "export.file_path"
          }
        },
        "name": "Export (CSV/XLSX/JSON)",
        "authoritative_manifest_ref": {}
      },
      "18": {
        "auto_continue": true,
        "await_user": false,
        "requires": [
          "17"
        ],
        "requires_context": true,
        "title": "Pre-Publish Review (Checkpoint 18)",
        "validators_required": false,
        "enabled": true,
        "purpose": "Pre-Publish Review (Checkpoint 18)",
        "description": "Etsy'ye yükleme öncesi go/no-go kontrol listesi ve son onay.",
        "inputs": [
          "listing.final{}",
          "listing.status",
          "export.file_path",
          "export.sha256",
          "compliance.status",
          "ads_sync.status"
        ],
        "outputs": [
          "publish.checklist{}",
          "publish.status",
          "publish.notes"
        ],
        "outputs_expected": {
          "ready_to_publish": true,
          "issues": []
        },
        "checklist": [],
        "what_gpt_does": [
          "Eksikleri işaretler"
        ],
        "what_user_does": [
          "Düzeltir/onaylar"
        ],
        "mirror": {
          "listing.final{}": {
            "__MIRRORED_PLACEHOLDER__": "listing.final{}",
            "__LOCKED__": true
          },
          "listing.status": {
            "__MIRRORED_PLACEHOLDER__": "listing.status",
            "__LOCKED__": true
          },
          "export.file_path": {
            "__REF__": "/_run_order/steps/17/outputs/0"
          },
          "export.sha256": {
            "__MIRRORED_PLACEHOLDER__": "export.sha256",
            "__LOCKED__": true
          },
          "compliance.status": {
            "__MIRRORED_PLACEHOLDER__": "compliance.status",
            "__LOCKED__": true
          },
          "ads_sync.status": {
            "__MIRRORED_PLACEHOLDER__": "ads_sync.status",
            "__LOCKED__": true
          }
        },
        "artifacts": {
          "publish_checklist": {
            "__MIRRORED_PLACEHOLDER__": "publish.checklist{}"
          },
          "publish_status": {
            "__MIRRORED_PLACEHOLDER__": "publish.status"
          },
          "publish_notes": {
            "__MIRRORED_PLACEHOLDER__": "publish.notes"
          }
        },
        "name": "Pre-Publish Review (Checkpoint 18)",
        "authoritative_manifest_ref": {
          "__REF__": "/workflow_patches/steps/18/manifest"
        }
      },
      "19": {
        "auto_continue": true,
        "await_user": false,
        "requires": [
          "18"
        ],
        "requires_context": true,
        "title": "30-Day Listing Performance Report (+ Optimization)",
        "validators": [
          {
            "id": "require_context_all",
            "message": "CONTEXT_REQUIRED: This step must consume all prior outputs per policy.",
            "severity": "block",
            "type": "require_context_all"
          }
        ],
        "validators_required": false,
        "enabled": true,
        "purpose": "30-Day Listing Performance Report (+ Optimization)",
        "description": "Yayın sonrası 14–30 gün performans takibi ve aksiyon sinyalleri (Ads + SEO).",
        "inputs": [
          "metrics.ads{ctr,roas,orders,cpc,spend}",
          "metrics.seo{impressions,visits,orders,conv_rate}",
          "ab_test.plan",
          "ads.plan{}",
          "ads_sync.final_positive[]",
          "ads_sync.final_negative[]",
          "metrics.window.fixed_range{start:2025-08-20,end:2025-09-03}"
        ],
        "outputs": [
          "monitoring.report{}",
          "monitoring.issues[]",
          "monitoring.recommendations[]",
          "keywords.focus.updated[]",
          "focus.reweighting.log"
        ],
        "outputs_expected": {
          "report": {},
          "optimizations": []
        },
        "checklist": [],
        "what_gpt_does": [
          "Raporlar/önerir"
        ],
        "what_user_does": [
          "Uygular"
        ],
        "mirror": {
          "metrics.ads{ctr,roas,orders,cpc,spend}": {
            "__MIRRORED_PLACEHOLDER__": "metrics.ads{ctr,roas,orders,cpc,spend}",
            "__LOCKED__": true
          },
          "metrics.seo{impressions,visits,orders,conv_rate}": {
            "__MIRRORED_PLACEHOLDER__": "metrics.seo{impressions,visits,orders,conv_rate}",
            "__LOCKED__": true
          },
          "ab_test.plan": {
            "__MIRRORED_PLACEHOLDER__": "ab_test.plan",
            "__LOCKED__": true,
            "__REF__": "/_run_order/steps/18a/outputs/0"
          },
          "ads.plan{}": {
            "__MIRRORED_PLACEHOLDER__": "ads.plan{}",
            "__LOCKED__": true,
            "__REF__": "/_run_order/steps/18a/outputs/0"
          },
          "ads_sync.final_positive[]": {
            "__MIRRORED_PLACEHOLDER__": "ads_sync.final_positive[]",
            "__LOCKED__": true,
            "__REF__": "/_run_order/steps/8C/outputs/1"
          },
          "ads_sync.final_negative[]": {
            "__MIRRORED_PLACEHOLDER__": "ads_sync.final_negative[]",
            "__LOCKED__": true,
            "__REF__": "/_run_order/steps/8C/outputs/2"
          },
          "metrics.window.fixed_range{start:2025-08-20,end:2025-09-03}": {
            "__MIRRORED_PLACEHOLDER__": "metrics.window.fixed_range{start:2025-08-20,end:2025-09-03}",
            "__LOCKED__": true
          }
        },
        "artifacts": {
          "monitoring_report": {
            "__MIRRORED_PLACEHOLDER__": "monitoring.report{}"
          },
          "monitoring_issues": {
            "__MIRRORED_PLACEHOLDER__": "monitoring.issues[]"
          },
          "monitoring_recommendations": {
            "__MIRRORED_PLACEHOLDER__": "monitoring.recommendations[]"
          }
        },
        "params": {
          "metrics_window": {
            "start": "2025-08-20",
            "end": "2025-09-03"
          }
        },
        "name": "30-Day Listing Performance Report (+ Optimization)",
        "authoritative_manifest_ref": {}
      },
      "1a": {
        "auto_continue": true,
        "await_user": false,
        "requires": [
          "1"
        ],
        "requires_context": true,
        "title": "Görsel Analizi",
        "ui_output": {
          "checklist": {
            "hero_plain_bg": {
              "severity": "warn"
            },
            "image_count_min": {
              "severity": "warn",
              "threshold": 8
            },
            "lifestyle_photo": {
              "severity": "warn"
            },
            "scale_indicator": {
              "severity": "warn"
            },
            "video_count_min": {
              "duration": "5-15s",
              "severity": "warn",
              "threshold": 1
            }
          }
        },
        "validators_required": false,
        "enabled": true,
        "purpose": "media_analysis_and_seo_alignment",
        "description": "Ürün görselleri ve (varsa) video; kalite, set bütünlüğü ve SEO uyumu açısından kontrol edilir. Çıktı yalnızca rapordur; görseller otomatik değiştirilmez.",
        "inputs": [
          "product.photos[]",
          "product.video?",
          "draft.title",
          "draft.description",
          "draft.tags[13]",
          "seo.keywords.focus[]",
          "seo.keywords.supporting[]"
        ],
        "outputs_expected": [
          "media.checklist",
          "media.issues[]",
          "media.recommendations[]",
          "media.qc_report"
        ],
        "outputs": [
          "media.checklist",
          "media.issues[]",
          "media.recommendations[]",
          "media.qc_report"
        ],
        "checklist": [
          "Tema çıkarımı",
          "Anlamsız görselleri ele"
        ],
        "what_gpt_does": [
          "Özellik çıkarır"
        ],
        "what_user_does": [
          "Gereksiz görselleri kaldırır"
        ],
        "mirror": {
          "product.photos[]": {
            "__MIRRORED_PLACEHOLDER__": "product.photos[]",
            "__LOCKED__": true,
            "__REF__": "/_run_order/steps/1/outputs/0"
          },
          "product.video?": {
            "__MIRRORED_PLACEHOLDER__": "product.video?",
            "__LOCKED__": true,
            "__REF__": "/_run_order/steps/1/outputs/1"
          },
          "draft.title": {
            "__MIRRORED_PLACEHOLDER__": "draft.title",
            "__LOCKED__": true
          },
          "draft.description": {
            "__MIRRORED_PLACEHOLDER__": "draft.description",
            "__LOCKED__": true
          },
          "draft.tags[13]": {
            "__MIRRORED_PLACEHOLDER__": "draft.tags[13]",
            "__LOCKED__": true
          },
          "seo.keywords.focus[]": {
            "__MIRRORED_PLACEHOLDER__": "seo.keywords.focus[]",
            "__LOCKED__": true
          },
          "seo.keywords.supporting[]": {
            "__MIRRORED_PLACEHOLDER__": "seo.keywords.supporting[]",
            "__LOCKED__": true
          }
        },
        "artifacts": {
          "media_checklist": {
            "__MIRRORED_PLACEHOLDER__": "media.checklist"
          },
          "media_issues": {
            "__MIRRORED_PLACEHOLDER__": "media.issues[]"
          },
          "media_recommendations": {
            "__MIRRORED_PLACEHOLDER__": "media.recommendations[]"
          },
          "media_qc_report": {
            "__MIRRORED_PLACEHOLDER__": "media.qc_report"
          }
        },
        "name": "Görsel Analizi",
        "authoritative_manifest_ref": {
          "__REF__": "/workflow_patches/steps/1a/manifest"
        }
      },
      "1b": {
        "auto_continue": false,
        "await_user": true,
        "enforcement": {
          "no_skip": false
        },
        "requires": [
          "1a"
        ],
        "requires_context": true,
        "title": "Alura Arama Önerileri",
        "ui_directives": {
          "readonly": true,
          "table": false,
          "text_list_numbered": true
        },
        "validators_required": false,
        "enabled": true,
        "purpose": "two-word_search_suggestions",
        "description": "Bu adım, Alura'dan indirilecek CSV'lerin kalitesini belirleyen 8 adet, her biri 2 kelimeden oluşan çekirdek sorguları üretir.",
        "outputs": [
          "alura.search_suggestions[8]",
          "alura.segments_coverage",
          "alura.rejection_reasons[]",
          "alura.selection_notes"
        ],
        "inputs": {
          "seed_terms": []
        },
        "outputs_expected": {
          "suggestions": []
        },
        "checklist": [
          "Dil/locale uygunluğu",
          "Spam/marka ihlali yok"
        ],
        "what_gpt_does": [
          "Önerileri listeler"
        ],
        "what_user_does": [
          "Gereksizleri eler"
        ],
        "artifacts": {
          "alura_search_suggestions[8]": {
            "__MIRRORED_PLACEHOLDER__": "alura.search_suggestions[8]"
          },
          "alura_segments_coverage": {
            "__MIRRORED_PLACEHOLDER__": "alura.segments_coverage"
          },
          "alura_rejection_reasons": {
            "__MIRRORED_PLACEHOLDER__": "alura.rejection_reasons[]"
          },
          "alura_selection_notes": {
            "__MIRRORED_PLACEHOLDER__": "alura.selection_notes"
          }
        },
        "name": "Alura Arama Önerileri",
        "preconditions_soft_disabled": true,
        "early_run_if": [
          "1a"
        ],
        "authoritative_manifest_ref": {
          "__REF__": "/workflow_patches/steps/1b/manifest"
        }
      },
      "2": {
        "auto_continue": true,
        "await_user": false,
        "requires": [
          "1b"
        ],
        "requires_context": true,
        "title": "Keyword Pool (Görsel + Arama + CSV)",
        "validators": [
          {
            "id": "require_context_all",
            "message": "CONTEXT_REQUIRED: This step must consume all prior outputs per policy.",
            "severity": "block",
            "type": "require_context_all"
          }
        ],
        "validators_required": false,
        "enabled": false,
        "archived": true,
        "inputs": [],
        "outputs": []
      },
      "20": {
        "auto_continue": true,
        "await_user": false,
        "preconditions": [
          {
            "guard": "preflight_diff"
          }
        ],
        "requires": [
          "19"
        ],
        "requires_context": true,
        "title": "Versioning & Rollback QA",
        "validators_required": false,
        "enabled": true,
        "purpose": "Versioning & Rollback QA",
        "description": "Sürüm geçmişi, onaylar, checkpointler ve rollback noktalarının denetimi.",
        "inputs": [
          "workflow_patches.metadata",
          "workflow_patches.governance"
        ],
        "outputs": [
          "audit.report{}",
          "audit.findings[]",
          "audit.rollback_points[]"
        ],
        "outputs_expected": {
          "current_version": "",
          "rollback_point": ""
        },
        "checklist": [],
        "what_gpt_does": [
          "Sürüm planını çıkarır"
        ],
        "what_user_does": [
          "Onaylar"
        ],
        "mirror": {
          "workflow_patches.metadata": {
            "__MIRRORED_PLACEHOLDER__": "workflow_patches.metadata",
            "__LOCKED__": true
          },
          "workflow_patches.governance": {
            "__MIRRORED_PLACEHOLDER__": "workflow_patches.governance",
            "__LOCKED__": true
          }
        },
        "artifacts": {
          "audit_report": {
            "__MIRRORED_PLACEHOLDER__": "audit.report{}"
          },
          "audit_findings": {
            "__MIRRORED_PLACEHOLDER__": "audit.findings[]"
          },
          "audit_rollback_points": {
            "__MIRRORED_PLACEHOLDER__": "audit.rollback_points[]"
          }
        },
        "name": "Versioning & Rollback QA",
        "authoritative_manifest_ref": {}
      },
      "21": {
        "auto_continue": true,
        "await_user": false,
        "preconditions": [
          {
            "guard": "preflight_diff"
          }
        ],
        "requires": [
          "20"
        ],
        "requires_context": true,
        "title": "Export Draft Listing",
        "validators_required": false,
        "enabled": true,
        "purpose": "Export Draft Listing.",
        "description": "Taslak çıktısı.",
        "inputs": {
          "listing_record": {}
        },
        "outputs_expected": {
          "draft_files": []
        },
        "checklist": [],
        "what_gpt_does": [
          "Taslak üretir"
        ],
        "what_user_does": [
          "Kontrol eder"
        ],
        "outputs": []
      },
      "22": {
        "auto_continue": true,
        "await_user": false,
        "preconditions": [
          {
            "guard": "preflight_diff"
          }
        ],
        "requires": [
          "21"
        ],
        "requires_context": true,
        "title": "User Final Review",
        "validators_required": false,
        "enabled": true,
        "purpose": "User Final Review.",
        "description": "Kullanıcı tarafından son gözden geçirme.",
        "inputs": {
          "draft_files": []
        },
        "outputs_expected": {
          "final_approval": true,
          "notes": []
        },
        "checklist": [],
        "what_gpt_does": [
          "Kontrol listesi sunar"
        ],
        "what_user_does": [
          "Son onayı verir"
        ],
        "outputs": []
      },
      "23": {
        "auto_continue": true,
        "await_user": false,
        "preconditions": [
          {
            "guard": "preflight_diff"
          }
        ],
        "requires": [
          "22"
        ],
        "requires_context": true,
        "title": "Finalize / Publish",
        "validators_required": false,
        "enabled": true,
        "purpose": "Finalize / Publish.",
        "description": "Yayınlama ve kapanış.",
        "inputs": {
          "listing_record": {},
          "final_approval": true
        },
        "outputs_expected": {
          "published": true,
          "url": ""
        },
        "checklist": [],
        "what_gpt_does": [
          "Yayın sürecini tamamlar"
        ],
        "what_user_does": [
          "Yayın sonrası kontrol"
        ],
        "outputs": []
      },
      "2a": {
        "auto_continue": true,
        "await_user": false,
        "requires": [],
        "requires_context": true,
        "title": "Keyword Pool — Görsel Tabanlı",
        "validators_required": false,
        "enabled": false,
        "archived": true,
        "inputs": [],
        "outputs": []
      },
      "2b": {
        "auto_continue": true,
        "await_user": false,
        "requires": [],
        "requires_context": true,
        "title": "Keyword Pool — Arama & CSV Tabanlı",
        "validators_required": false,
        "enabled": false,
        "archived": true,
        "inputs": [],
        "outputs": []
      },
      "3": {
        "auto_continue": true,
        "await_user": false,
        "preconditions": [
          {
            "guard": "preflight_diff"
          },
          {
            "guard": "preflight_diff"
          },
          {
            "equals": true,
            "on_fail": {
              "action": "block",
              "message": "Similar Keywords: Satır alan sayısı başlıkla eşleşmiyor."
            },
            "path": "/steps/3/validations/csv/require_field_count_equals_header"
          }
        ],
        "requires": [],
        "requires_context": true,
        "title": "Similar Keywords Upload",
        "validators": [
          {
            "fn": "exists",
            "target": "csv_outputs.clean_csv_path"
          },
          {
            "fn": "count_equals",
            "target": "csv.headers",
            "value_ref": "@steps.3.csv_ingest.expected_headers|len"
          },
          {
            "id": "require_context_all",
            "message": "CONTEXT_REQUIRED: This step must consume all prior outputs per policy.",
            "severity": "block",
            "type": "require_context_all"
          },
          {
            "id": "csv_ready_similar",
            "message": "CSV_SIMILAR_NOT_READY: Similar Keywords CSV not validated through pipeline.",
            "severity": "block",
            "target": "similar_keywords",
            "type": "csv_ready"
          }
        ],
        "enabled": true,
        "purpose": "similar_csv_ingestion",
        "description": "Alura/benzeri kaynaklardan 8 adet CSV yüklenir. Kolon adları normalize edilir; satır ve dil filtreleri uygulanır; temel metrikler hesaplanır.",
        "inputs": [
          "alura.csv[8]"
        ],
        "outputs": [
          "alura.csv[8]",
          "alura.metrics",
          "csv.input"
        ],
        "outputs_expected": {
          "rows": "int",
          "headers_ok": true
        },
        "checklist": [
          "Başlıklar uyumlu",
          "Boş satır yok"
        ],
        "what_gpt_does": [
          "CSV yapısını kontrol eder"
        ],
        "what_user_does": [
          "CSV sağlar"
        ],
        "mirror": {
          "alura.csv[8]": {
            "__LOCKED__": true,
            "header": [
              "term",
              "volume",
              "competition",
              "conversion",
              "trend",
              "cpc",
              "clicks",
              "orders"
            ],
            "rows": [
              [
                "gold ring",
                1200,
                "medium",
                0.025,
                "flat",
                0.45,
                1000,
                25
              ],
              [
                "14k gold ring",
                850,
                "medium",
                0.028,
                "rising",
                0.52,
                800,
                22
              ],
              [
                "dainty gold ring",
                620,
                "low",
                0.031,
                "rising",
                0.38,
                600,
                19
              ]
            ],
            "__REF__": "/_run_order/steps/1b/outputs/0"
          }
        },
        "artifacts": {
          "alura_csv[8]": {
            "__MIRRORED_PLACEHOLDER__": "alura.csv[8]"
          },
          "alura_metrics": {
            "__MIRRORED_PLACEHOLDER__": "alura.metrics"
          },
          "csv.input": {
            "__ALIAS_OF__": "csv.input"
          }
        },
        "name": "Similar Keywords Upload",
        "authoritative_manifest_ref": {}
      },
      "3a": {
        "auto_continue": true,
        "await_user": false,
        "enforcement": {
          "no_skip": false,
          "on_violation": "warn"
        },
        "input_strategy": "prefer_3p_else_raw",
        "outputs": {
          "focus_candidates": {
            "items": {
              "properties": {
                "rank": {
                  "min": 1,
                  "type": "integer"
                },
                "rationale": {
                  "items": {
                    "type": "string"
                  },
                  "type": "array"
                },
                "score": {
                  "type": "number"
                },
                "source": {
                  "properties": {
                    "file": {
                      "type": "string"
                    },
                    "row": {
                      "type": "integer"
                    }
                  },
                  "type": "object"
                },
                "term": {
                  "max_len": 60,
                  "type": "string"
                }
              },
              "required": [
                "term",
                "score",
                "rank",
                "source"
              ],
              "type": "object"
            },
            "min_count": 4,
            "type": "array"
          },
          "pools": {
            "properties": {
              "bigrams": {
                "items": {
                  "type": "string"
                },
                "min_count": 20,
                "type": "array"
              },
              "intents": {
                "items": {
                  "type": "string"
                },
                "min_count": 5,
                "type": "array"
              },
              "keywords": {
                "items": {
                  "type": "string"
                },
                "min_count": 20,
                "type": "array"
              },
              "modifiers": {
                "items": {
                  "type": "string"
                },
                "min_count": 10,
                "type": "array"
              },
              "trigrams": {
                "items": {
                  "type": "string"
                },
                "min_count": 20,
                "type": "array"
              }
            },
            "required": [
              "keywords",
              "bigrams",
              "trigrams",
              "modifiers",
              "intents"
            ],
            "type": "object"
          },
          "primary_focus_index": {
            "default": 1,
            "type": "integer"
          }
        },
        "requires": [
          "3"
        ],
        "requires_context": true,
        "title": "Odak Anahtar Kelime + Türetilenler",
        "ui_directives": {
          "force_visible": true,
          "readonly": true,
          "show": [
            "rule_check",
            "summary"
          ]
        },
        "validators": [
          {
            "fn": "count_at_least",
            "target": "outputs.focus_candidates",
            "value": 4
          },
          {
            "fn": "equals",
            "left": "outputs.primary_focus_index",
            "right": 1
          },
          {
            "fn": "count_at_least",
            "target": "outputs.pools.keywords",
            "value": 20
          },
          {
            "fn": "count_at_least",
            "target": "outputs.pools.bigrams",
            "value": 20
          },
          {
            "fn": "count_at_least",
            "target": "outputs.pools.trigrams",
            "value": 20
          },
          {
            "fn": "count_at_least",
            "target": "outputs.pools.modifiers",
            "value": 10
          },
          {
            "fn": "count_at_least",
            "target": "outputs.pools.intents",
            "value": 5
          },
          {
            "fn": "unique",
            "target": "outputs.pools.keywords[*]"
          },
          {
            "fn": "unique",
            "target": "outputs.pools.bigrams[*]"
          },
          {
            "fn": "unique",
            "target": "outputs.pools.trigrams[*]"
          },
          {
            "fn": "unique",
            "target": "outputs.pools.modifiers[*]"
          },
          {
            "fn": "unique",
            "target": "outputs.pools.intents[*]"
          },
          {
            "id": "product_intent_include",
            "message": "FOCUS_INTENT: Product-intent keyword required.",
            "patterns": [
              "ring",
              "band",
              "solitaire",
              "moissanite",
              "marquise",
              "eternity",
              "stacking"
            ],
            "severity": "block",
            "type": "content_regex_require"
          },
          {
            "id": "promo_brand_exclude",
            "message": "FOCUS_PROMO_FORBIDDEN: Promo/brand/event terms are not allowed.",
            "patterns": [
              "black friday",
              "\\bbf\\b",
              "sale",
              "discount",
              "coupon",
              "deal",
              "promo(?:code)?",
              "company",
              "price",
              "nose ring",
              "toe ring",
              "gift guide"
            ],
            "severity": "block",
            "type": "content_regex_forbid"
          },
          {
            "id": "category_alignment",
            "message": "FOCUS_CATEGORY_MISMATCH: Focus must align with product category.",
            "rule": "if source in ['Jewelry','Ring'] then target must match /(ring|band|solitaire|moissanite|marquise|eternity|stack)/i",
            "severity": "block",
            "source": "/steps/0/product_info/category",
            "target": "/steps/3a/candidates[*].keyword",
            "type": "crossfield_assert"
          },
          {
            "id": "focus_similarity_cap",
            "message": "FOCUS_SIMILARITY: Selected focus terms are too similar.",
            "scope": "selected_focus_set",
            "severity": "block",
            "threshold": 0.8,
            "type": "similarity_cap"
          }
        ],
        "validators_required": false,
        "display_contract": "render_full",
        "ui_output": {
          "force_plain_text": true,
          "disable_autonumbering": true,
          "disable_bullets": true
        },
        "enabled": true,
        "purpose": "focus_selection_and_pool_build",
        "description": "CSV’lerden geniş havuz kur; 1..6 odak kelimeyi seç; çeşitlilik ve kalite kuralları uygula. Kaynak farkı puanlamayı ETKİLEMEZ. + MMR çeşitlilik, EV skoru, TR-normalizasyon, konsensüs sıklığı, rol ataması, destek terimler ve neden günlüğü.",
        "inputs": [
          "alura.csv[8]",
          "alura.metrics",
          "context.product_category",
          "prior.signals"
        ],
        "outputs_expected": [
          "keywords.drop_log[]",
          "keywords.focus[1..4].provisional",
          "keywords.pool.ranked[]",
          "keywords.pool.tier1.top50[]",
          "keywords.pool.tier2.next150[]",
          "keywords.pool.tier3.rest[]",
          "keywords.segment_coverage",
          "keywords.selection_notes"
        ],
        "checklist": [
          "Arama hacmi/rekabet",
          "Marka ihlali yok"
        ],
        "what_gpt_does": [
          "Adayları sıralar"
        ],
        "what_user_does": [
          "Seçimi onaylar"
        ],
        "mirror": {
          "alura.csv[8]": {
            "__LOCKED__": true,
            "header": [
              "term",
              "volume",
              "competition",
              "conversion",
              "trend",
              "cpc",
              "clicks",
              "orders"
            ],
            "rows": [
              [
                "gold ring",
                1200,
                "medium",
                0.025,
                "flat",
                0.45,
                1000,
                25
              ],
              [
                "14k gold ring",
                850,
                "medium",
                0.028,
                "rising",
                0.52,
                800,
                22
              ],
              [
                "dainty gold ring",
                620,
                "low",
                0.031,
                "rising",
                0.38,
                600,
                19
              ]
            ],
            "__REF__": "/_run_order/steps/3/outputs/0"
          },
          "alura.metrics": {
            "__LOCKED__": true,
            "keywords": [
              {
                "term": "gold ring",
                "volume": 1200,
                "competition": "medium",
                "conversion": 0.025
              },
              {
                "term": "14k gold ring",
                "volume": 850,
                "competition": "medium",
                "conversion": 0.028
              },
              {
                "term": "dainty gold ring",
                "volume": 620,
                "competition": "low",
                "conversion": 0.031
              }
            ],
            "last_update": "2025-09-01",
            "__REF__": "/_run_order/steps/3/outputs/1"
          },
          "context.product_category": {
            "__MIRRORED_PLACEHOLDER__": "context.product_category",
            "__LOCKED__": true
          },
          "prior.signals": {
            "__MIRRORED_PLACEHOLDER__": "prior.signals",
            "__LOCKED__": true
          }
        },
        "artifacts": {
          "focus_candidates": {
            "__MIRRORED_PLACEHOLDER__": "focus_candidates"
          },
          "pools": {
            "__MIRRORED_PLACEHOLDER__": "pools"
          },
          "primary_focus_index": {
            "__MIRRORED_PLACEHOLDER__": "primary_focus_index"
          },
          "keywords.pool.ranked[]": {
            "__ALIAS_OF__": "focus_candidates"
          }
        },
        "params": {
          "deterministic": true,
          "seed": 0,
          "temperature": 0,
          "top_p": 0
        },
        "name": "Odak Anahtar Kelime + Türetilenler",
        "authoritative_manifest_ref": {
          "__REF__": "/workflow_patches/steps/3a/manifest"
        }
      },
      "3b": {
        "auto_continue": true,
        "await_user": false,
        "enforcement": {
          "no_skip": true,
          "on_violation": "block"
        },
        "inputs": {
          "clean_csv_path_ref": "/steps/3/csv_outputs/clean_csv_path",
          "from_step": "3"
        },
        "outputs": {
          "description": {
            "max_len": 3000,
            "min_len": 200,
            "type": "string"
          },
          "primary_focus": {
            "max_len": 60,
            "type": "string"
          },
          "source_map": {
            "items": {
              "properties": {
                "from_pool": {
                  "type": "string"
                },
                "value": {
                  "type": "string"
                }
              },
              "type": "object"
            },
            "type": "array"
          },
          "status": {
            "default": "DRAFT",
            "enum": [
              "DRAFT"
            ],
            "type": "string"
          },
          "tags": {
            "count": 13,
            "items": {
              "max_len": 20,
              "type": "string"
            },
            "type": "array"
          },
          "title": {
            "max_len": 140,
            "type": "string"
          },
          "draft.title": {
            "__ALIAS_OF__": "title"
          },
          "draft.tags[13]": {
            "__ALIAS_OF__": "tags"
          },
          "draft.description": {
            "__ALIAS_OF__": "description"
          }
        },
        "requires": [
          "1b",
          "3a",
          "3"
        ],
        "requires_context": true,
        "title": "Taslak Paket — DRAFT",
        "ui_directives": {
          "force_visible": true,
          "show": [
            "rule_check",
            "summary"
          ],
          "show_focus_candidates_top6": true
        },
        "validators": [
          {
            "fn": "equals",
            "left": "outputs.primary_focus",
            "right": "@steps.3a.outputs.focus_candidates[0].term"
          },
          {
            "fn": "exists",
            "target": "outputs.title"
          },
          {
            "fn": "exists",
            "target": "outputs.description"
          },
          {
            "fn": "count_equals",
            "target": "outputs.tags",
            "value": 13
          },
          {
            "fn": "contains",
            "target": "outputs.title",
            "value_ref": "@steps.3a.outputs.focus_candidates[0].term"
          },
          {
            "fn": "contains",
            "range": {
              "end": 160
            },
            "target": "outputs.description",
            "value_ref": "@steps.3a.outputs.focus_candidates[0].term"
          },
          {
            "fn": "unique",
            "target": "outputs.tags[*]"
          },
          {
            "fn": "min_pairwise_distance",
            "metric": "levenshtein",
            "min": 3,
            "target": "outputs.tags[*]"
          },
          {
            "fn": "equals",
            "left": "outputs.status",
            "right": "DRAFT"
          }
        ],
        "display_contract": "render_full",
        "ui_output": {
          "force_plain_text": true,
          "disable_autonumbering": true,
          "disable_bullets": true
        },
        "enabled": true,
        "purpose": "post-3a policy enforcement",
        "description": "3.a’daki havuz ve odak #1 (varsayılan) kullanılarak taslak başlık, açıklama ve 13 etiket oluşturulur. Nihai SEO adımlarına geçmeden önce kullanıcı gözden geçirmesi içindir.",
        "outputs_expected": [
          "draft.seed.description_outline.p1_core",
          "draft.seed.description_outline.p2_features",
          "draft.seed.description_outline.p3_logistics_cta",
          "draft.seed.tag_buckets.long_tail",
          "draft.seed.tag_buckets.material_karat",
          "draft.seed.tag_buckets.product",
          "draft.seed.tag_buckets.recipient_or_occasion",
          "draft.seed.tag_buckets.size_finish",
          "draft.seed.tag_buckets.style",
          "draft.seed.title_core_ngram",
          "source_mix_log"
        ],
        "checklist": [
          "Dil uyumu",
          "Uzunluk limitleri"
        ],
        "what_gpt_does": [
          "İlk taslağı hazırlar"
        ],
        "what_user_does": [
          "Taslağı gözden geçirir"
        ],
        "artifacts": {
          "description": {
            "__MIRRORED_PLACEHOLDER__": "description"
          },
          "primary_focus": {
            "__MIRRORED_PLACEHOLDER__": "primary_focus"
          },
          "source_map": {
            "__MIRRORED_PLACEHOLDER__": "source_map"
          },
          "status": {
            "__MIRRORED_PLACEHOLDER__": "status"
          },
          "tags": {
            "__MIRRORED_PLACEHOLDER__": "tags"
          },
          "title": {
            "__MIRRORED_PLACEHOLDER__": "title"
          },
          "draft.title": {
            "__ALIAS_OF__": "title"
          },
          "draft.tags[13]": {
            "__ALIAS_OF__": "tags"
          },
          "draft.description": {
            "__ALIAS_OF__": "description"
          }
        },
        "params": {
          "deterministic": true,
          "seed": 0,
          "temperature": 0,
          "top_p": 0
        },
        "name": "Taslak Paket — DRAFT",
        "authoritative_manifest_ref": {},
        "mirror": {
          "focus_candidates{}": {
            "__REF__": "/governance/step_sot/sources/focus_candidates"
          }
        }
      },
      "3c": {
        "auto_continue": true,
        "await_user": false,
        "requires": [
          "3b"
        ],
        "requires_context": true,
        "title": "Focus Normalize",
        "validators_required": false,
        "enabled": true,
        "purpose": "Normalize primary focus and canonicalize focus list (1..4).",
        "description": "Consolidates 3b.primary_focus with 3a focus_candidates into canonical keywords.focus[1..4].",
        "inputs": [
          "draft.primary_focus",
          "focus_candidates{}",
          "alura.metrics"
        ],
        "outputs_expected": {
          "final_focus_keyword": ""
        },
        "checklist": [
          "İlgililik",
          "Rekabet/performans"
        ],
        "what_gpt_does": [
          "Skorlar"
        ],
        "what_user_does": [
          "Onaylar"
        ],
        "outputs": [
          "keywords.focus[1..4]",
          "keywords.focus.primary",
          "draft.title",
          "draft.description",
          "draft.tags[13]"
        ],
        "mirror": {
          "draft.primary_focus": {
            "__MIRRORED_PLACEHOLDER__": "draft.primary_focus",
            "__LOCKED__": true
          },
          "focus_candidates{}": {
            "__MIRRORED_PLACEHOLDER__": "focus_candidates{}",
            "__LOCKED__": true
          },
          "alura.metrics": {
            "__LOCKED__": true,
            "keywords": [
              {
                "term": "gold ring",
                "volume": 1200,
                "competition": "medium",
                "conversion": 0.025
              },
              {
                "term": "14k gold ring",
                "volume": 850,
                "competition": "medium",
                "conversion": 0.028
              },
              {
                "term": "dainty gold ring",
                "volume": 620,
                "competition": "low",
                "conversion": 0.031
              }
            ],
            "last_update": "2025-09-01"
          },
          "draft.title": {
            "__REF__": "/_run_order/steps/3b/outputs/draft.title"
          },
          "draft.description": {
            "__REF__": "/_run_order/steps/3b/outputs/draft.description"
          },
          "draft.tags[13]": {
            "__REF__": "/_run_order/steps/3b/outputs/draft.tags[13]"
          }
        },
        "name": "Taslak Zenginleştirme",
        "authoritative_manifest_ref": {},
        "validators": [
          {
            "fn": "equals",
            "id": "eq_draft_title_3b",
            "left": "outputs.draft.title",
            "right": "@steps.3b.outputs.draft.title"
          },
          {
            "fn": "equals",
            "id": "eq_draft_desc_3b",
            "left": "outputs.draft.description",
            "right": "@steps.3b.outputs.draft.description"
          },
          {
            "fn": "equals",
            "id": "eq_draft_tags_3b",
            "left": "outputs.draft.tags",
            "right": "@steps.3b.outputs.draft.tags"
          },
          {
            "fn": "count_equals",
            "id": "draft_tags_len_13",
            "target": "outputs.draft.tags",
            "value": 13
          },
          {
            "id": "no_discount_mentions_text__outputs.draft.title",
            "message": "DISCOUNT_MENTION_FORBIDDEN: Public text must not mention discounts.",
            "patterns": [
              "\\b%?\\s?\\d{1,2}\\s?%?\\s?(off|sale|discount|save)\\b",
              "\\bdiscount(ed)?\\b",
              "\\bsale\\b",
              "\\bsave\\b",
              "\\bcoupon\\b",
              "\\bpromo(code)?\\b",
              "\\bdeal\\b",
              "\\bindirim\\b",
              "\\byüzde\\s?\\d{1,2}\\b",
              "\\bkampanya\\b"
            ],
            "severity": "block",
            "type": "content_regex_forbid",
            "target": "outputs.draft.title"
          },
          {
            "id": "no_percent_price_math__outputs.draft.title",
            "message": "PERCENT_PRICE_FORBIDDEN: Do not include discounted percentages or price math.",
            "patterns": [
              "\\b\\d{2,}\\s*(USD|TL|\\$|€)\\s*(instead of|was)\\s*\\d{2,}",
              "%\\s?\\d{1,2}",
              "\\b\\d{1,2}\\s?%"
            ],
            "severity": "block",
            "type": "content_regex_forbid",
            "target": "outputs.draft.title"
          },
          {
            "id": "no_discount_mentions_text__outputs.draft.description",
            "message": "DISCOUNT_MENTION_FORBIDDEN: Public text must not mention discounts.",
            "patterns": [
              "\\b%?\\s?\\d{1,2}\\s?%?\\s?(off|sale|discount|save)\\b",
              "\\bdiscount(ed)?\\b",
              "\\bsale\\b",
              "\\bsave\\b",
              "\\bcoupon\\b",
              "\\bpromo(code)?\\b",
              "\\bdeal\\b",
              "\\bindirim\\b",
              "\\byüzde\\s?\\d{1,2}\\b",
              "\\bkampanya\\b"
            ],
            "severity": "block",
            "type": "content_regex_forbid",
            "target": "outputs.draft.description"
          },
          {
            "id": "no_percent_price_math__outputs.draft.description",
            "message": "PERCENT_PRICE_FORBIDDEN: Do not include discounted percentages or price math.",
            "patterns": [
              "\\b\\d{2,}\\s*(USD|TL|\\$|€)\\s*(instead of|was)\\s*\\d{2,}",
              "%\\s?\\d{1,2}",
              "\\b\\d{1,2}\\s?%"
            ],
            "severity": "block",
            "type": "content_regex_forbid",
            "target": "outputs.draft.description"
          },
          {
            "id": "no_discount_mentions_text__outputs.draft.tags[*]",
            "message": "DISCOUNT_MENTION_FORBIDDEN: Public text must not mention discounts.",
            "patterns": [
              "\\b%?\\s?\\d{1,2}\\s?%?\\s?(off|sale|discount|save)\\b",
              "\\bdiscount(ed)?\\b",
              "\\bsale\\b",
              "\\bsave\\b",
              "\\bcoupon\\b",
              "\\bpromo(code)?\\b",
              "\\bdeal\\b",
              "\\bindirim\\b",
              "\\byüzde\\s?\\d{1,2}\\b",
              "\\bkampanya\\b"
            ],
            "severity": "block",
            "type": "content_regex_forbid",
            "target": "outputs.draft.tags[*]"
          },
          {
            "id": "no_percent_price_math__outputs.draft.tags[*]",
            "message": "PERCENT_PRICE_FORBIDDEN: Do not include discounted percentages or price math.",
            "patterns": [
              "\\b\\d{2,}\\s*(USD|TL|\\$|€)\\s*(instead of|was)\\s*\\d{2,}",
              "%\\s?\\d{1,2}",
              "\\b\\d{1,2}\\s?%"
            ],
            "severity": "block",
            "type": "content_regex_forbid",
            "target": "outputs.draft.tags[*]"
          },
          {
            "id": "primary_not_in_top6_warn",
            "type": "set_membership",
            "severity": "warn",
            "message": "Primary focus not in top-6 candidates; allowed, but review.",
            "left": "outputs.keywords.focus.primary",
            "right_ref": "/governance/step_sot/views/focus_candidates_top6",
            "fn": "in"
          }
        ],
        "params": {
          "default_primary_order": [
            "@steps.3b.outputs.primary_focus",
            "@steps.3a.outputs.focus_candidates[rank=1].term"
          ]
        }
      },
      "3d": {
        "auto_continue": true,
        "await_user": false,
        "requires": [
          "3c"
        ],
        "requires_context": true,
        "title": "Taslak Üretimi (Başlık / Açıklama / Etiketler)",
        "validators_required": false,
        "enabled": true,
        "purpose": "Taslak üretimi (başlık/açıklama/etiketler).",
        "description": "Kural uyumlu içerik üretimi.",
        "inputs": {
          "final_focus_keyword": "",
          "constraints": {}
        },
        "outputs_expected": {
          "title": "",
          "description": "",
          "tags": []
        },
        "checklist": [
          "Karakter limitleri",
          "Yasak ifade yok",
          "Dil imla"
        ],
        "what_gpt_does": [
          "Metin üretir"
        ],
        "what_user_does": [
          "Revize eder"
        ],
        "outputs": []
      },
      "3p": {
        "auto_continue": true,
        "await_user": false,
        "enforcement": {
          "no_skip": true,
          "on_failure_prompt": "3p WARN: Normalize raporlandı; analiz devam ediyor.",
          "on_violation": "warn"
        },
        "notes": "Pseudo step; validators not required.",
        "outputs": {
          "header_map": {
            "type": "object"
          },
          "issues": {
            "items": {
              "type": "string"
            },
            "type": "array"
          },
          "sample": {
            "items": {
              "type": "object"
            },
            "type": "array"
          },
          "stats": {
            "properties": {
              "empty_ratio": {
                "type": "number"
              },
              "rows": {
                "type": "integer"
              },
              "unique_keywords": {
                "type": "integer"
              }
            },
            "type": "object"
          }
        },
        "pipeline_ref": "csv_pipelines.similar_keywords",
        "requires": [
          "3"
        ],
        "requires_context": true,
        "title": "Similar Keywords Normalize",
        "ui_directives": {
          "force_visible": true,
          "show": [
            "rule_check",
            "summary"
          ]
        },
        "validators": [
          {
            "fn": "exists",
            "target": "outputs.header_map.keyword"
          },
          {
            "fn": "type_is",
            "target": "outputs.header_map.keyword",
            "value": "string"
          },
          {
            "fn": "count_at_least",
            "target": "outputs.stats.unique_keywords",
            "value": 20
          },
          {
            "fn": "lte",
            "left": "outputs.stats.empty_ratio",
            "right": 0.02
          }
        ],
        "validators_required": false,
        "enabled": true,
        "purpose": "CSV normalize & rapor (Similar Keywords)",
        "description": "CSV normalize & rapor (Similar Keywords)",
        "inputs": {
          "csv": "similar_keywords.csv"
        },
        "outputs_expected": {
          "stats": {},
          "issues": [],
          "header_map": {}
        },
        "checklist": [],
        "what_gpt_does": [
          "Raporlar"
        ],
        "what_user_does": [
          "Gerekirse CSV’yi düzeltir"
        ],
        "artifacts": {
          "header_map": {
            "__MIRRORED_PLACEHOLDER__": "header_map"
          },
          "issues": {
            "__MIRRORED_PLACEHOLDER__": "issues"
          },
          "sample": {
            "__MIRRORED_PLACEHOLDER__": "sample"
          },
          "stats": {
            "__MIRRORED_PLACEHOLDER__": "stats"
          }
        }
      },
      "4": {
        "archived": true,
        "auto_continue": true,
        "await_user": false,
        "enabled": false,
        "requires": [
          "3d"
        ],
        "requires_context": true,
        "title": "Top Listings (Genel)",
        "ui_directives": {
          "hidden": true
        },
        "validators": [
          {
            "id": "require_context_all",
            "message": "CONTEXT_REQUIRED: This step must consume all prior outputs per policy.",
            "severity": "block",
            "type": "require_context_all"
          },
          {
            "id": "csv_ready_top",
            "message": "CSV_TOP_NOT_READY: Top Listings CSV not validated through pipeline.",
            "severity": "block",
            "target": "top_listings",
            "type": "csv_ready"
          }
        ],
        "validators_required": false,
        "inputs": [],
        "outputs": []
      },
      "4a": {
        "archived": true,
        "auto_continue": true,
        "await_user": false,
        "enabled": false,
        "requires": [],
        "requires_context": true,
        "title": "Top Listings Upload",
        "ui_directives": {
          "hidden": true
        },
        "validators_required": false,
        "inputs": [],
        "outputs": []
      },
      "4b": {
        "archived": true,
        "auto_continue": true,
        "await_user": false,
        "deprecated": true,
        "enabled": false,
        "requires": [],
        "requires_context": true,
        "title": "Top Listings Clean (csv_clean:top)",
        "ui_directives": {
          "hidden": true
        },
        "validators_required": false,
        "inputs": [],
        "outputs": []
      },
      "4p": {
        "archived": true,
        "auto_continue": true,
        "await_user": false,
        "enabled": false,
        "enforcement": {
          "no_skip": true,
          "on_failure_prompt": "4p WARN: Top Listings normalize raporu üretildi; analiz devam ediyor.",
          "on_violation": "warn"
        },
        "notes": "Pseudo step; validators not required.",
        "outputs": {
          "header_map": {
            "type": "object"
          },
          "issues": {
            "items": {
              "type": "string"
            },
            "type": "array"
          },
          "sample": {
            "items": {
              "type": "object"
            },
            "type": "array"
          },
          "stats": {
            "properties": {
              "empty_ratio": {
                "type": "number"
              },
              "rows": {
                "type": "integer"
              },
              "unique_primary": {
                "type": "integer"
              }
            },
            "type": "object"
          }
        },
        "pipeline_ref": "csv_pipelines.top_listings_dar",
        "requires": [],
        "requires_context": true,
        "title": "Top Listings Normalize",
        "ui_directives": {
          "force_visible": true,
          "hidden": true,
          "show": [
            "rule_check",
            "summary"
          ]
        },
        "validators_required": false,
        "artifacts": {
          "header_map": {
            "__MIRRORED_PLACEHOLDER__": "header_map"
          },
          "issues": {
            "__MIRRORED_PLACEHOLDER__": "issues"
          },
          "sample": {
            "__MIRRORED_PLACEHOLDER__": "sample"
          },
          "stats": {
            "__MIRRORED_PLACEHOLDER__": "stats"
          }
        },
        "inputs": []
      },
      "5": {
        "auto_continue": true,
        "await_user": false,
        "enabled": true,
        "preconditions": [
          {
            "guard": "preflight_diff"
          },
          {
            "equals": true,
            "on_fail": {
              "action": "block",
              "message": "Top Listings (Dar): Satır alan sayısı başlıkla eşleşmiyor."
            },
            "path": "/steps/5/validations/csv/require_field_count_equals_header"
          }
        ],
        "requires": [
          "3d"
        ],
        "requires_context": true,
        "title": "Top Listings Upload (Dar)",
        "ui_directives": {
          "hidden": false
        },
        "validators": [
          {
            "fn": "exists",
            "target": "csv_outputs.clean_csv_path"
          },
          {
            "fn": "count_equals",
            "target": "csv.headers",
            "value_ref": "@steps.5.csv_ingest.expected_headers|len"
          },
          {
            "id": "require_context_all",
            "message": "CONTEXT_REQUIRED: This step must consume all prior outputs per policy.",
            "severity": "block",
            "type": "require_context_all"
          }
        ],
        "purpose": "Top listings upload (narrow category focus)",
        "description": "Top listings upload (narrow category focus)",
        "outputs_expected": [
          "top_products.narrow_raw[]"
        ],
        "outputs": [
          "top_products.narrow_raw[]"
        ],
        "inputs": {
          "csv": "top_listings.csv"
        },
        "checklist": [
          "Başlıklar uyumlu",
          "Boş satır yok"
        ],
        "what_gpt_does": [
          "CSV kontrol"
        ],
        "what_user_does": [
          "CSV sağlar"
        ],
        "artifacts": {
          "top_products_narrow_raw": {
            "__MIRRORED_PLACEHOLDER__": "top_products.narrow_raw[]"
          }
        },
        "name": "Top Listings Upload (Dar)",
        "authoritative_manifest_ref": {},
        "mirror": {
          "focus_candidates[1..6]": {
            "__REF__": "/governance/step_sot/views/focus_candidates_top6"
          }
        }
      },
      "5a": {
        "auto_continue": true,
        "await_user": false,
        "enabled": true,
        "inputs": {
          "clean_csv_path_ref": "/steps/5/csv_outputs/clean_csv_path",
          "from_step": "5"
        },
        "requires": [
          "5"
        ],
        "requires_context": true,
        "title": "Popüler Ürünler Analizi",
        "ui_directives": {
          "hidden": false
        },
        "validators_required": false,
        "purpose": "ngrams_and_recombination",
        "description": "Top listings verisinden ürün/anahtar kelime performans içgörüleri çıkarılır; niş fırsatlar ve doygun alanlar işaretlenir; odak sıralaması için sinyal üretilir.",
        "outputs": [
          "popular.products.top[]",
          "popular.keywords.top[]",
          "popular.segments.summary{}",
          "popular.focus_signals{}",
          "popular.notes",
          "similarity.report{}",
          "similarity.score",
          "similarity.label",
          "similarity.notes",
          "ads.seed.positive[]"
        ],
        "outputs_expected": {
          "popular_attributes": [],
          "price_bands": []
        },
        "checklist": [
          "Trend/seasonal kontrol"
        ],
        "what_gpt_does": [
          "Analiz ve özet"
        ],
        "what_user_does": [
          "Onay/veri düzeltme"
        ],
        "artifacts": {
          "popular_products_top": {
            "__MIRRORED_PLACEHOLDER__": "popular.products.top[]"
          },
          "popular_keywords_top": {
            "__MIRRORED_PLACEHOLDER__": "popular.keywords.top[]"
          },
          "popular_segments_summary": {
            "__MIRRORED_PLACEHOLDER__": "popular.segments.summary{}"
          },
          "popular_focus_signals": {
            "__MIRRORED_PLACEHOLDER__": "popular.focus_signals{}"
          },
          "popular_notes": {
            "__MIRRORED_PLACEHOLDER__": "popular.notes"
          },
          "similarity_report": {
            "__MIRRORED_PLACEHOLDER__": "similarity.report{}"
          },
          "similarity_score": {
            "__MIRRORED_PLACEHOLDER__": "similarity.score"
          },
          "similarity_label": {
            "__MIRRORED_PLACEHOLDER__": "similarity.label"
          },
          "similarity_notes": {
            "__MIRRORED_PLACEHOLDER__": "similarity.notes"
          },
          "ads.seed.positive[]": {
            "__ALIAS_OF__": "ads.seed.positive[]"
          }
        },
        "name": "Popüler Ürünler Analizi",
        "authoritative_manifest_ref": {
          "__REF__": "/workflow_patches/steps/5a/manifest"
        },
        "mirror": {
          "focus_candidates[1..6]": {
            "__REF__": "/governance/step_sot/views/focus_candidates_top6"
          }
        }
      },
      "5b": {
        "auto_continue": true,
        "await_user": false,
        "enabled": true,
        "requires": [
          "5a"
        ],
        "requires_context": true,
        "title": "Rakip Mağaza Seçimi",
        "ui_directives": {
          "hidden": false
        },
        "validators_required": false,
        "purpose": "filtering_and_prioritization",
        "description": "5a ve 4 çıktıları üzerinden hedef rakip mağazalar belirlenir; ileride Ads ve SEO karşılaştırmaları için çekirdek set oluşturulur.",
        "inputs": [
          "popular.products.top[]",
          "popular.keywords.top[]",
          "top_listings.merged",
          "competitor_shops.csv?"
        ],
        "outputs": [
          "competitors.candidates[]",
          "competitors.selected[]",
          "competitors.profiles{}",
          "competitors.notes",
          "similarity.report{}",
          "similarity.score",
          "similarity.label",
          "similarity.notes",
          "ads.seed.negative[]"
        ],
        "outputs_expected": {
          "selected_shops": []
        },
        "checklist": [
          "Kategori benzerliği",
          "Sahte/boş mağaza eleme"
        ],
        "what_gpt_does": [
          "Skorlama"
        ],
        "what_user_does": [
          "Seçimi onaylar"
        ],
        "mirror": {
          "popular.products.top[]": {
            "__MIRRORED_PLACEHOLDER__": "popular.products.top[]",
            "__LOCKED__": true
          },
          "popular.keywords.top[]": [
            "gold ring",
            "14k gold ring",
            "dainty gold ring",
            "stackable ring"
          ],
          "top_listings.merged": {
            "__MIRRORED_PLACEHOLDER__": "top_listings.merged",
            "__LOCKED__": true
          },
          "competitor_shops.csv?": {
            "__MIRRORED_PLACEHOLDER__": "competitor_shops.csv?",
            "__LOCKED__": true
          }
        },
        "artifacts": {
          "competitors_candidates": {
            "__MIRRORED_PLACEHOLDER__": "competitors.candidates[]"
          },
          "competitors_selected": {
            "__MIRRORED_PLACEHOLDER__": "competitors.selected[]"
          },
          "competitors_profiles": {
            "__MIRRORED_PLACEHOLDER__": "competitors.profiles{}"
          },
          "competitors_notes": {
            "__MIRRORED_PLACEHOLDER__": "competitors.notes"
          },
          "similarity_report": {
            "__MIRRORED_PLACEHOLDER__": "similarity.report{}"
          },
          "similarity_score": {
            "__MIRRORED_PLACEHOLDER__": "similarity.score"
          },
          "similarity_label": {
            "__MIRRORED_PLACEHOLDER__": "similarity.label"
          },
          "similarity_notes": {
            "__MIRRORED_PLACEHOLDER__": "similarity.notes"
          },
          "ads.seed.negative[]": {
            "__ALIAS_OF__": "ads.seed.negative[]"
          }
        },
        "name": "Rakip Mağaza Seçimi",
        "authoritative_manifest_ref": {}
      },
      "5c": {
        "auto_continue": true,
        "await_user": false,
        "enabled": true,
        "requires": [
          "5b"
        ],
        "requires_context": true,
        "title": "Rakip Mağaza Önerileri (8)",
        "ui_directives": {
          "hidden": false
        },
        "validators_required": false,
        "display_contract": "render_full",
        "ui_output": {
          "summary": "Top8 competitor shop suggestions; select up to 4 to proceed to Step 6."
        },
        "purpose": "Rakip Mağaza Önerileri (8)",
        "description": "Top Listings çıktılarına göre mağaza öneri havuzu (strict/medium/loose).",
        "inputs": {
          "seed_shops": []
        },
        "outputs_expected": {
          "suggested_shops": []
        },
        "checklist": [
          "İlgililik",
          "Kapsam"
        ],
        "what_gpt_does": [
          "Öneri üretir"
        ],
        "what_user_does": [
          "Eler/ekler"
        ],
        "outputs": [],
        "name": "Rakip Mağaza Önerileri (8)",
        "authoritative_manifest_ref": {}
      },
      "5p": {
        "auto_continue": true,
        "await_user": false,
        "enforcement": {
          "no_skip": true,
          "on_failure_prompt": "5p WARN: Competitor Shops normalize raporu üretildi; analiz devam ediyor.",
          "on_violation": "warn"
        },
        "notes": "Pseudo step; validators not required.",
        "outputs": {
          "header_map": {
            "type": "object"
          },
          "issues": {
            "items": {
              "type": "string"
            },
            "type": "array"
          },
          "sample": {
            "items": {
              "type": "object"
            },
            "type": "array"
          },
          "stats": {
            "properties": {
              "empty_ratio": {
                "type": "number"
              },
              "rows": {
                "type": "integer"
              },
              "unique_primary": {
                "type": "integer"
              }
            },
            "type": "object"
          }
        },
        "pipeline_ref": "csv_pipelines.competitor_shops",
        "requires": [
          "5"
        ],
        "requires_context": true,
        "title": "Competitor Shops Normalize",
        "ui_directives": {
          "force_visible": true,
          "show": [
            "rule_check",
            "summary"
          ]
        },
        "validators_required": false,
        "enabled": true,
        "purpose": "CSV normalize & rapor (Competitor Shops)",
        "description": "CSV normalize & rapor (Competitor Shops)",
        "inputs": {
          "csv": "competitor_shops.csv"
        },
        "outputs_expected": {
          "stats": {},
          "issues": [],
          "header_map": {}
        },
        "checklist": [],
        "what_gpt_does": [
          "Raporlar"
        ],
        "what_user_does": [
          "Düzeltme yapar"
        ],
        "artifacts": {
          "header_map": {
            "__MIRRORED_PLACEHOLDER__": "header_map"
          },
          "issues": {
            "__MIRRORED_PLACEHOLDER__": "issues"
          },
          "sample": {
            "__MIRRORED_PLACEHOLDER__": "sample"
          },
          "stats": {
            "__MIRRORED_PLACEHOLDER__": "stats"
          }
        }
      },
      "6": {
        "auto_continue": true,
        "await_user": false,
        "requires": [
          "3d"
        ],
        "requires_context": true,
        "title": "Competitor Listings (Genel)",
        "validators": [
          {
            "id": "require_context_all",
            "message": "CONTEXT_REQUIRED: This step must consume all prior outputs per policy.",
            "severity": "block",
            "type": "require_context_all"
          },
          {
            "id": "csv_ready_competitor",
            "message": "CSV_COMP_NOT_READY: Competitor Listings CSV not validated through pipeline.",
            "severity": "block",
            "target": "competitor_listings",
            "type": "csv_ready"
          }
        ],
        "validators_required": false,
        "enabled": true,
        "purpose": "Competitor shops upload (raw intake with shop balancing)",
        "description": "Rakip mağaza listesi CSV’si (örn. competitor_shops.csv) yüklenir; mağaza URL/ID doğrulamaları ve temel temizlik yapılır.",
        "inputs": [
          "competitor_shops.csv"
        ],
        "outputs_expected": [
          "competitors.raw[]"
        ],
        "outputs": [
          "competitors.raw[]",
          "competitors.clean[]"
        ],
        "checklist": [],
        "what_gpt_does": [
          "Kaynakları listeler"
        ],
        "what_user_does": [
          "Erişim sağlar"
        ],
        "mirror": {
          "competitor_shops.csv": {
            "__MIRRORED_PLACEHOLDER__": "competitor_shops.csv",
            "__LOCKED__": true
          },
          "competitors.clean[]": {
            "__REF__": "/_run_order/steps/6b/outputs/0"
          }
        },
        "artifacts": {
          "competitors_raw": {
            "__MIRRORED_PLACEHOLDER__": "competitors.raw[]"
          }
        },
        "name": "Competitor Listings (Genel)",
        "authoritative_manifest_ref": {},
        "ui_directives": {
          "subtitle": "Upload + Normalize + Dedupe (Unified surface)"
        }
      },
      "6a": {
        "auto_continue": true,
        "await_user": false,
        "preconditions": [
          {
            "guard": "preflight_diff"
          },
          {
            "guard": "preflight_diff"
          },
          {
            "equals": true,
            "on_fail": {
              "action": "block",
              "message": "Competitor Listings: Satır alan sayısı başlıkla eşleşmiyor."
            },
            "path": "/steps/6a/validations/csv/require_field_count_equals_header"
          }
        ],
        "requires": [
          "6"
        ],
        "requires_context": true,
        "title": "Competitor Listings Upload",
        "validators": [
          {
            "fn": "exists",
            "target": "csv_outputs.clean_csv_path"
          },
          {
            "fn": "count_equals",
            "target": "csv.headers",
            "value_ref": "@steps.6a.csv_ingest.expected_headers|len"
          }
        ],
        "enabled": true,
        "purpose": "Competitor analysis (theme extraction + bias control)",
        "description": "Yüklenen rakip mağazalar üzerinden ürün/etiket/başlık ve fiyat dağılımı analiz edilir; kampanya/SEO için özet sinyaller üretilir.",
        "inputs": [
          "competitors.shops[]"
        ],
        "outputs_expected": [
          "competitors.themes[]",
          "competitors.bias_report"
        ],
        "outputs": [
          "competitors.themes[]",
          "competitors.bias_report"
        ],
        "checklist": [
          "Eksik alan kontrolü"
        ],
        "what_gpt_does": [
          "CSV doğrulama"
        ],
        "what_user_does": [
          "CSV sağlar"
        ],
        "mirror": {
          "competitors.shops[]": {
            "__MIRRORED_PLACEHOLDER__": "competitors.shops[]",
            "__LOCKED__": true
          }
        },
        "artifacts": {
          "competitors_themes": {
            "__MIRRORED_PLACEHOLDER__": "competitors.themes[]"
          },
          "competitors_bias_report": {
            "__MIRRORED_PLACEHOLDER__": "competitors.bias_report"
          }
        },
        "name": "Competitor Listings Upload",
        "authoritative_manifest_ref": {}
      },
      "6b": {
        "auto_continue": true,
        "await_user": false,
        "inputs": {
          "clean_csv_path_ref": "/steps/6a/csv_outputs/clean_csv_path",
          "from_step": "6a"
        },
        "requires": [
          "6a"
        ],
        "requires_context": true,
        "title": "Competitor Listings Clean (Dedup + Normalize)",
        "validators_required": false,
        "enabled": true,
        "purpose": "Competitor listings clean (normalize + dedupe + relevance confirm)",
        "description": "Competitor listings clean (normalize + dedupe + relevance confirm)",
        "outputs_expected": [
          "competitors.clean[]"
        ],
        "outputs": [
          "competitors.clean[]"
        ],
        "checklist": [
          "Aynı ürün/başlık temizliği",
          "Fiyat uçları"
        ],
        "what_gpt_does": [
          "Temizlik kurallarını uygular"
        ],
        "what_user_does": [
          "Şüpheli kayıtları kontrol"
        ],
        "artifacts": {
          "competitors_clean": {
            "__MIRRORED_PLACEHOLDER__": "competitors.clean[]"
          }
        },
        "name": "6b",
        "authoritative_manifest_ref": {}
      },
      "7": {
        "analysis_rules": {
          "note": "Discount may be used in competitive/popular product analyses; it remains suppressed in public texts per policy.pricing.discount_rule.",
          "use_discount_in_metrics": true
        },
        "auto_continue": true,
        "await_user": false,
        "preconditions": [
          {
            "guard": "preflight_diff"
          }
        ],
        "requires": [
          "6b"
        ],
        "requires_context": true,
        "title": "Rakip Analizi & Ads Çekirdeği",
        "validators": [
          {
            "id": "require_context_all",
            "message": "CONTEXT_REQUIRED: This step must consume all prior outputs per policy.",
            "severity": "block",
            "type": "require_context_all"
          }
        ],
        "validators_required": false,
        "enabled": true,
        "purpose": "Rakip Analizi & Ads Çekirdeği",
        "description": "Rakip mağaza ve liste analizleri; anahtar kelimeleri materyal/kullanım/kitle temalarında kümeler; arz–talep boşluklarını çıkarır; Ads için pozitif/negatif çekirdek setini üretir. Girdiler: 5a (pazar+trend), 6/6a (CSV/sinyaller). Çıkış: 8 ve 18’e handoff.",
        "inputs": [
          "keywords.pool.ranked[]",
          "keywords.focus[1..4].provisional",
          "draft.title",
          "draft.tags[13]",
          "top_listings.merged",
          "top_listings.keyword_metrics{}",
          "focus.reorder_suggestion",
          "popular.products.top[]",
          "popular.keywords.top[]",
          "popular.segments.summary{}",
          "competitors.selected[]",
          "competitors.profiles{}",
          "alura.metrics"
        ],
        "outputs": [
          "market.snapshot{}",
          "ads.seed.positive[]",
          "ads.seed.negative[]",
          "market.notes",
          "market.aggregation{}",
          "seed.terms[]",
          "negative_terms.base[]"
        ],
        "outputs_expected": {
          "ads_core": {
            "terms": [],
            "negatives": []
          }
        },
        "checklist": [
          "Marka/ihlal filtreleri"
        ],
        "what_gpt_does": [
          "Çekirdek anahtarlar üretir"
        ],
        "what_user_does": [
          "Hassas kelimeleri onaylar"
        ],
        "mirror": {
          "keywords.pool.ranked[]": {
            "__MIRRORED_PLACEHOLDER__": "keywords.pool.ranked[]",
            "__LOCKED__": true
          },
          "keywords.focus[1..4].provisional": {
            "__MIRRORED_PLACEHOLDER__": "keywords.focus[1..4].provisional",
            "__LOCKED__": true
          },
          "draft.title": {
            "__MIRRORED_PLACEHOLDER__": "draft.title",
            "__LOCKED__": true
          },
          "draft.tags[13]": {
            "__MIRRORED_PLACEHOLDER__": "draft.tags[13]",
            "__LOCKED__": true
          },
          "top_listings.merged": {
            "__MIRRORED_PLACEHOLDER__": "top_listings.merged",
            "__LOCKED__": true
          },
          "top_listings.keyword_metrics{}": {
            "__LOCKED__": true,
            "gold ring": {
              "ctr": 0.041,
              "conv_rate": 0.022,
              "avg_price": 128
            },
            "14k gold ring": {
              "ctr": 0.039,
              "conv_rate": 0.021,
              "avg_price": 149
            },
            "dainty gold ring": {
              "ctr": 0.047,
              "conv_rate": 0.026,
              "avg_price": 109
            },
            "__REF__": "/_run_order/steps/6_top_listings.aggregate/outputs/1"
          },
          "focus.reorder_suggestion": {
            "__MIRRORED_PLACEHOLDER__": "focus.reorder_suggestion",
            "__LOCKED__": true
          },
          "popular.products.top[]": {
            "__REF__": "/_run_order/steps/5a/outputs/0"
          },
          "popular.keywords.top[]": [
            "gold ring",
            "14k gold ring",
            "dainty gold ring",
            "stackable ring"
          ],
          "popular.segments.summary{}": {
            "__LOCKED__": true,
            "segments": [
              {
                "name": "minimalist",
                "share": 0.42
              },
              {
                "name": "boho",
                "share": 0.25
              },
              {
                "name": "classic",
                "share": 0.18
              }
            ],
            "notes": "locked stub",
            "__REF__": "/_run_order/steps/5a/outputs/2"
          },
          "competitors.selected[]": [
            "ShopAlpha",
            "ShopBeta",
            "ShopGamma"
          ],
          "competitors.profiles{}": {
            "__LOCKED__": true,
            "ShopAlpha": {
              "reviews": 3200,
              "avg_price": 135,
              "style": "minimalist"
            },
            "ShopBeta": {
              "reviews": 2100,
              "avg_price": 155,
              "style": "classic"
            },
            "ShopGamma": {
              "reviews": 1800,
              "avg_price": 98,
              "style": "boho"
            },
            "__REF__": "/_run_order/steps/5b/outputs/2"
          },
          "alura.metrics": {
            "__LOCKED__": true,
            "keywords": [
              {
                "term": "gold ring",
                "volume": 1200,
                "competition": "medium",
                "conversion": 0.025
              },
              {
                "term": "14k gold ring",
                "volume": 850,
                "competition": "medium",
                "conversion": 0.028
              },
              {
                "term": "dainty gold ring",
                "volume": 620,
                "competition": "low",
                "conversion": 0.031
              }
            ],
            "last_update": "2025-09-01"
          },
          "ads.seed.positive[]": {
            "__REF__": "/_run_order/steps/5a/outputs/9"
          },
          "ads.seed.negative[]": {
            "__REF__": "/_run_order/steps/5b/outputs/8"
          },
          "market.notes": {
            "__REF__": "/_run_order/steps/6_top_listings.aggregate/outputs/2"
          },
          "competitors.clean[]": {
            "__REF__": "/governance/step_sot/sources/competitors_clean"
          }
        },
        "artifacts": {
          "market_snapshot": {
            "__MIRRORED_PLACEHOLDER__": "market.snapshot{}"
          },
          "ads_seed_positive": {
            "__MIRRORED_PLACEHOLDER__": "ads.seed.positive[]"
          },
          "ads_seed_negative": {
            "__MIRRORED_PLACEHOLDER__": "ads.seed.negative[]"
          },
          "market_notes": {
            "__MIRRORED_PLACEHOLDER__": "market.notes"
          },
          "market.aggregation{}": {
            "__ALIAS_OF__": "market.snapshot{}"
          },
          "seed.terms[]": {
            "__ALIAS_OF__": "ads.seed.positive[]"
          },
          "negative_terms.base[]": {
            "__ALIAS_OF__": "ads.seed.negative[]"
          }
        },
        "params": {
          "deterministic": true,
          "seed": 0,
          "temperature": 0,
          "top_p": 0,
          "re_rank": {
            "randomize": false
          }
        },
        "name": "Rakip Analizi & Ads Çekirdeği",
        "authoritative_manifest_ref": {}
      },
      "8": {
        "analysis_rules": {
          "note": "Discount may be used in competitive/popular product analyses; it remains suppressed in public texts per policy.pricing.discount_rule.",
          "use_discount_in_metrics": true
        },
        "auto_continue": true,
        "await_user": false,
        "requires": [
          "7"
        ],
        "requires_context": true,
        "title": "Market Aggregation & Ads Generation",
        "validators": [
          {
            "id": "require_context_all",
            "message": "CONTEXT_REQUIRED: This step must consume all prior outputs per policy.",
            "severity": "block",
            "type": "require_context_all"
          }
        ],
        "validators_required": false,
        "enabled": true,
        "purpose": "Ads campaign skeleton & theming (budget-aware grouping)",
        "description": "5a/5b ve 7 çıktılarından kampanya/ad group planını oluşturur; 8B'ye temiz, onaylı plan sağlar.",
        "inputs": [
          "popular.products.top[]",
          "popular.keywords.top[]",
          "market.aggregation{}",
          "seed.terms[]",
          "negative_terms.base[]"
        ],
        "outputs_expected": [
          "ads.groups[3..4]"
        ],
        "outputs": [
          "ads.groups[3..4]"
        ],
        "checklist": [],
        "what_gpt_does": [
          "Plan taslağı oluşturur"
        ],
        "what_user_does": [
          "Planı onaylar"
        ],
        "mirror": {
          "popular.products.top[]": {
            "__REF__": "/_run_order/steps/5a/outputs/0"
          },
          "popular.keywords.top[]": [
            "gold ring",
            "14k gold ring",
            "dainty gold ring",
            "stackable ring"
          ],
          "market.aggregation{}": {
            "__REF__": "/_run_order/steps/7/outputs/0"
          },
          "seed.terms[]": {
            "__REF__": "/_run_order/steps/7/outputs/1"
          },
          "negative_terms.base[]": {
            "__REF__": "/_run_order/steps/7/outputs/2"
          }
        },
        "artifacts": {
          "ads_groups[3__4]": {
            "__MIRRORED_PLACEHOLDER__": "ads.groups[3..4]"
          }
        },
        "name": "Market Aggregation & Ads Generation",
        "authoritative_manifest_ref": {}
      },
      "8A": {
        "auto_continue": true,
        "await_user": false,
        "requires": [
          "8"
        ],
        "requires_context": true,
        "title": "Ads Keyword Generation (Plan + Anahtarlar)",
        "validators_required": false,
        "enabled": false,
        "purpose": "Ads Keyword Generation (Plan + Anahtarlar).",
        "description": "Plan’a göre anahtar kelime seti üretimi.",
        "inputs": {
          "ads_plan": {}
        },
        "outputs_expected": {
          "ads_keywords": []
        },
        "checklist": [
          "Negatives dahil mi?",
          "Bölge/dil uyumu"
        ],
        "what_gpt_does": [
          "Anahtar setini yazar"
        ],
        "what_user_does": [
          "Düzenler/onaylar"
        ],
        "outputs": []
      },
      "8B": {
        "auto_continue": true,
        "await_user": false,
        "requires": [
          "8A"
        ],
        "requires_context": true,
        "title": "Ads Keyword Generation (Plan + Anahtarlar)",
        "validators_required": false,
        "enabled": true,
        "purpose": "Ads Keyword Generation (Plan + Anahtarlar) — varyant.",
        "description": "Alternatif set/ varyasyon üretimi.",
        "inputs": {
          "ads_plan": {},
          "ads_keywords": []
        },
        "outputs_expected": {
          "ads_keywords_alt": []
        },
        "checklist": [],
        "what_gpt_does": [
          "Alternatif varyasyon üretir"
        ],
        "what_user_does": [
          "Karşılaştırıp seçer"
        ],
        "outputs": [
          {
            "__REF__": "/_run_order/steps/8B/mirror/ads.seed.positive[]"
          }
        ],
        "name": "Ads Sync – Positive Set",
        "mirror": {
          "ads.seed.positive[]": {
            "__REF__": "/_run_order/steps/5a/outputs/9"
          }
        },
        "authoritative_manifest_ref": {}
      },
      "9": {
        "auto_continue": true,
        "await_user": false,
        "requires": [
          "8B"
        ],
        "requires_context": true,
        "title": "SEO Keyword Refinement",
        "validators_required": false,
        "enabled": true,
        "purpose": "SEO keyword refinement (dedupe, alignment, Ads↔SEO consolidation)",
        "description": "SEO için odak ve destek anahtar setleri kesinleştirilir; başlık/etiket uyumu sağlanır.",
        "inputs": [
          "keywords.pool.ranked[]",
          "keywords.focus[1..4]",
          "draft.title",
          "draft.tags[13]",
          "market.snapshot{}",
          "ads.keywords.final[]",
          "popular.keywords.top[]",
          "top_listings.keyword_metrics{}",
          "alura.metrics"
        ],
        "outputs_expected": [
          "seo.keywords.refined[]",
          "seo.drop_log[]"
        ],
        "outputs": [
          "seo.keywords.refined[]",
          "seo.drop_log[]",
          "seo.keywords.supporting[]"
        ],
        "checklist": [],
        "what_gpt_does": [
          "Listeyi filtreler/skorlar"
        ],
        "what_user_does": [
          "Onaylar"
        ],
        "mirror": {
          "keywords.pool.ranked[]": {
            "__REF__": "/_run_order/steps/3a/outputs/focus_candidates"
          },
          "keywords.focus[1..4]": {
            "__REF__": "/_run_order/steps/3c/outputs/0"
          },
          "draft.title": {
            "__REF__": "/_run_order/steps/3b/outputs/draft.title"
          },
          "draft.tags[13]": {
            "__REF__": "/_run_order/steps/3b/outputs/draft.tags[13]"
          },
          "market.snapshot{}": {
            "__LOCKED__": true,
            "date": "2025-09-01",
            "trend": "stable",
            "seasonality": "pre-fall",
            "notes": "locked stub snapshot"
          },
          "ads.keywords.final[]": {
            "__REF__": "/_run_order/steps/8C/outputs/0"
          },
          "popular.keywords.top[]": [
            "gold ring",
            "14k gold ring",
            "dainty gold ring",
            "stackable ring"
          ],
          "top_listings.keyword_metrics{}": {
            "__LOCKED__": true,
            "gold ring": {
              "ctr": 0.041,
              "conv_rate": 0.022,
              "avg_price": 128
            },
            "14k gold ring": {
              "ctr": 0.039,
              "conv_rate": 0.021,
              "avg_price": 149
            },
            "dainty gold ring": {
              "ctr": 0.047,
              "conv_rate": 0.026,
              "avg_price": 109
            }
          },
          "alura.metrics": {
            "__LOCKED__": true,
            "keywords": [
              {
                "term": "gold ring",
                "volume": 1200,
                "competition": "medium",
                "conversion": 0.025,
                "__REF__": "/_run_order/steps/8a/outputs/0"
              },
              {
                "term": "14k gold ring",
                "volume": 850,
                "competition": "medium",
                "conversion": 0.028
              },
              {
                "term": "dainty gold ring",
                "volume": 620,
                "competition": "low",
                "conversion": 0.031
              }
            ],
            "last_update": "2025-09-01"
          },
          "__REF__": "/_run_order/steps/8a/outputs/1",
          "ads.seed.positive[]": {
            "__REF__": "/_run_order/steps/8B/outputs/0"
          },
          "ads.seed.negative[]": {
            "__REF__": "/_run_order/steps/8C/outputs/0"
          }
        },
        "artifacts": {
          "seo_keywords_refined": {
            "__MIRRORED_PLACEHOLDER__": "seo.keywords.refined[]"
          },
          "seo_drop_log": {
            "__MIRRORED_PLACEHOLDER__": "seo.drop_log[]"
          }
        },
        "params": {
          "deterministic": true,
          "seed": 0,
          "temperature": 0,
          "top_p": 0,
          "shuffle": false
        },
        "name": "SEO Keyword Refinement",
        "authoritative_manifest_ref": {}
      },
      "18a": {
        "title": "A/B Test Plan",
        "purpose": "Prepare AB test plan for title/image/price/shipping messaging variations.",
        "requires": [
          "18"
        ],
        "inputs": [
          "title.final",
          "media.checklist",
          "pricing{}",
          "product.info{}",
          "keywords.focus[1..4]"
        ],
        "outputs": [
          "ab_test.plan"
        ],
        "description": "Defines variants and KPIs to be consumed by step 19.",
        "mirror": {
          "title.final": {
            "__REF__": "/_run_order/steps/10/outputs/title.final"
          },
          "media.checklist": {
            "__REF__": "/_run_order/steps/1a/outputs/0"
          },
          "pricing{}": {
            "__REF__": "/_run_order/steps/0/product_info/fixed_product/pricing"
          },
          "product.info{}": {
            "__REF__": "/_run_order/steps/0/product_info",
            "__LIVE__": true
          },
          "keywords.focus[1..4]": {
            "__REF__": "/_run_order/steps/3c/outputs/0"
          }
        },
        "await_user": false,
        "auto_continue": true,
        "enabled": true,
        "name": "Publish Go/No-Go (Disabled)",
        "authoritative_manifest_ref": {}
      },
      "8a": {
        "title": "Ads Keyword Expansion (Branded/Negative Prep)",
        "purpose": "Genişletilmiş reklam anahtar kelimelerini üretir, negatif adayları hazırlar.",
        "enabled": true,
        "await_user": false,
        "auto_continue": true,
        "requires_context": true,
        "inputs": [
          "ads_plan{}",
          "popular.keywords.top[]",
          "keywords.focus[1..4]"
        ],
        "outputs": [
          "ads_keywords_expanded[]",
          "ads_negative_candidates[]"
        ],
        "description": "8. adımdan gelen plan ve popüler anahtar kelimeleri kullanarak genişletilmiş kelime setleri oluşturur, negatif adayları listeler.",
        "mirror": {
          "ads_plan{}": {
            "__REF__": "/_run_order/steps/8/outputs/0"
          }
        },
        "name": "Ads Keyword Generation (Plan + Anahtarlar)",
        "authoritative_manifest_ref": {}
      },
      "seo_package": {
        "inputs": [],
        "outputs": [],
        "await_user": false,
        "auto_continue": true,
        "name": "SEO Package QC",
        "enabled": true,
        "authoritative_manifest_ref": {}
      },
      "6_top_listings.aggregate": {
        "enabled": true,
        "await_user": false,
        "auto_continue": true,
        "requires_context": true,
        "title": "Top Listings Aggregate",
        "purpose": "Aggregate and compute keyword metrics from normalized top listings.",
        "requires": [
          "4p"
        ],
        "inputs": [
          "top_listings.clean[]",
          "top_listings.normalized{}"
        ],
        "outputs": [
          "top_listings.merged",
          "top_listings.keyword_metrics{}",
          "market.notes"
        ],
        "description": "Merges cleaned listings data and computes per-keyword metrics for steps 7 and 9.",
        "mirror": {
          "top_listings.clean[]": [
            {
              "id": "L1",
              "title": "14K Solid Gold Dainty Ring",
              "price": 129.0,
              "reviews": 245,
              "tags": [
                "dainty gold ring",
                "stackable",
                "minimalist"
              ]
            },
            {
              "id": "L2",
              "title": "Gold Ring 14K Minimal Band",
              "price": 149.0,
              "reviews": 181,
              "tags": [
                "gold ring",
                "14k",
                "band",
                "minimal"
              ]
            },
            {
              "id": "L3",
              "title": "Thin Gold Stacking Ring",
              "price": 99.0,
              "reviews": 312,
              "tags": [
                "stacking ring",
                "gold",
                "thin"
              ]
            }
          ],
          "top_listings.normalized{}": {
            "__LOCKED__": true,
            "schema_version": 1,
            "items": [
              {
                "id": "L1",
                "term_hits": {
                  "dainty gold ring": 12,
                  "stackable": 7
                },
                "ctr": 0.045,
                "conv_rate": 0.021
              },
              {
                "id": "L2",
                "term_hits": {
                  "gold ring": 15,
                  "14k": 9
                },
                "ctr": 0.038,
                "conv_rate": 0.018
              },
              {
                "id": "L3",
                "term_hits": {
                  "stacking ring": 17,
                  "thin": 8
                },
                "ctr": 0.051,
                "conv_rate": 0.024
              }
            ]
          }
        },
        "artifacts": {
          "market.notes": {
            "__ALIAS_OF__": "market.notes"
          }
        }
      },
      "8C": {
        "enabled": true,
        "await_user": false,
        "auto_continue": true,
        "requires_context": true,
        "title": "Ads Finalize (Keywords + Sync Lists)",
        "purpose": "Finalize ads keywords and produce sync positive/negative sets.",
        "requires": [
          "8B"
        ],
        "inputs": [
          "ads_plan{}",
          "ads_keywords[]",
          "ads_keywords_alt[]",
          "market.snapshot{}",
          "popular.keywords.top[]"
        ],
        "outputs": [
          {
            "__REF__": "/_run_order/steps/8C/mirror/ads.seed.negative[]"
          },
          "ads_sync.final_positive[]",
          "ads_sync.final_negative[]",
          "ads_sync.status"
        ],
        "description": "Consolidates 8A/8B outputs into a final ads keyword set and sync lists for steps 9, 16, 19.",
        "mirror": {
          "ads_plan{}": {
            "__LOCKED__": true,
            "budget_daily": 10,
            "bid_strategy": "manual",
            "notes": "locked stub"
          },
          "ads_keywords[]": [
            "gold ring",
            "14k ring",
            "dainty gold ring",
            "stackable ring"
          ],
          "ads_keywords_alt[]": [
            "minimalist ring",
            "thin gold ring",
            "women gold ring"
          ],
          "market.snapshot{}": {
            "__LOCKED__": true,
            "date": "2025-09-01",
            "trend": "stable",
            "seasonality": "pre-fall",
            "notes": "locked stub snapshot"
          },
          "popular.keywords.top[]": [
            "gold ring",
            "14k gold ring",
            "dainty gold ring",
            "stackable ring"
          ],
          "ads.seed.negative[]": {
            "__REF__": "/_run_order/steps/5b/outputs/8"
          }
        },
        "params": {
          "deterministic": true,
          "seed": 0,
          "temperature": 0,
          "top_p": 0
        },
        "name": "Ads Sync – Negative Set",
        "authoritative_manifest_ref": {}
      },
      "12a": {
        "enabled": true,
        "await_user": false,
        "auto_continue": true,
        "requires_context": true,
        "title": "Attributes Selection",
        "purpose": "Select category attributes that act as 'bonus tags' and prevent tag duplication.",
        "requires": [
          "12"
        ],
        "inputs": [
          "product.info{}",
          "keywords.focus[1..4]",
          "popular.segments.summary{}"
        ],
        "outputs": [
          "attributes.selected{}",
          "attribute_to_tag_saving.map{}"
        ],
        "description": "Maps attributes to covered keywords to save tag slots and improve coverage.",
        "mirror": {
          "product.info{}": {
            "__REF__": "/_run_order/steps/0/product_info",
            "__LIVE__": true
          },
          "keywords.focus[1..4]": {
            "__REF__": "/_run_order/steps/3c/outputs/0"
          },
          "popular.segments.summary{}": {
            "__LOCKED__": true,
            "segments": [
              {
                "name": "minimalist",
                "share": 0.42
              },
              {
                "name": "boho",
                "share": 0.25
              },
              {
                "name": "classic",
                "share": 0.18
              }
            ],
            "notes": "locked stub"
          },
          "__REF__": "/_run_order/steps/12a/outputs/0"
        },
        "name": "Nitelik Seçimi & Bonus Etiket Eşleme",
        "authoritative_manifest_ref": {}
      },
      "00_profile.hydrate": {
        "title": "Profile Hydrate (Step 0 → Mirrors)",
        "purpose": "Document that mirrors for canonical tokens resolve to Step 0 live refs.",
        "enabled": true,
        "await_user": false,
        "auto_continue": true,
        "requires_context": true,
        "inputs": [
          "product.info{}",
          "shop.profile{}",
          "market.target_countries[]",
          "language.preferred"
        ],
        "outputs": [],
        "description": "No-op: indicates that mirrors of these tokens are __REF__ links to Step 0.",
        "mirror": {
          "product.info{}": {
            "__REF__": "/_run_order/steps/0/product_info"
          },
          "shop.profile{}": {
            "__REF__": "/_run_order/steps/0/shop_profile"
          },
          "market.target_countries[]": {
            "__REF__": "/_run_order/steps/0/market/target_countries"
          },
          "language.preferred": {
            "__REF__": "/_run_order/steps/0/language/preferred"
          }
        }
      }
    },
    "strict": true,
    "settings": {
      "text_only_preview": true,
      "preview_render": {
        "markdown": false,
        "plain_text": true,
        "disable_autonumbering": true,
        "disable_bullets": true,
        "collapse_whitespace": false
      },
      "deterministic_seed": 42,
      "session_variance": 0,
      "run_isolation": "ON",
      "allowed_steps_to_render": [
        "9",
        "10",
        "11",
        "12",
        "16"
      ]
    },
    "repro_mode": true,
    "mirror_policy": {
      "source_of_truth": "_run_order/steps/0",
      "link_symbol": "__REF__",
      "live_link": true,
      "override_locked_for": [
        "product.info{}",
        "shop.profile{}",
        "market.target_countries[]",
        "language.preferred"
      ]
    },
    "source": "/workflow_patches/steps",
    "notes": "This run_order is a pointer list; authoritative definitions live under /workflow_patches/steps/*",
    "steps_list_snapshot": [
      {
        "id": "0a",
        "ref": "/workflow_patches/steps/0a",
        "name": "Ortam Kontrolleri"
      },
      {
        "id": "00",
        "ref": "/workflow_patches/steps/00",
        "name": "Sistem Başlatma / Ön Yük"
      },
      {
        "id": "0",
        "ref": "/workflow_patches/steps/0",
        "name": "Product Info (read-only) — Kullanıcı Onayı"
      },
      {
        "id": "1",
        "ref": "/workflow_patches/steps/1",
        "name": "Görsel Yükleme"
      },
      {
        "id": "1a",
        "ref": "/workflow_patches/steps/1a",
        "name": "Görsel Analizi"
      },
      {
        "id": "1b",
        "ref": "/workflow_patches/steps/1b",
        "name": "Alura Arama Önerileri"
      },
      {
        "id": "3",
        "ref": "/workflow_patches/steps/3",
        "name": "Similar Keywords Upload"
      },
      {
        "id": "3a",
        "ref": "/workflow_patches/steps/3a",
        "name": "Odak Anahtar Kelime + Türetilenler"
      },
      {
        "id": "3b",
        "ref": "/workflow_patches/steps/3b",
        "name": "Taslak Paket — DRAFT"
      },
      {
        "id": "3c",
        "ref": "/workflow_patches/steps/3c",
        "name": "Taslak Zenginleştirme"
      },
      {
        "id": "4a",
        "ref": "/workflow_patches/steps/4a",
        "name": "Top Listings Upload"
      },
      {
        "id": "4b",
        "ref": "/workflow_patches/steps/4b",
        "name": "Top Listings Clean (csv_clean:top)"
      },
      {
        "id": "5",
        "ref": "/workflow_patches/steps/5",
        "name": "Top Listings Upload (Dar)"
      },
      {
        "id": "5a",
        "ref": "/workflow_patches/steps/5a",
        "name": "Popüler Ürünler Analizi"
      },
      {
        "id": "5c",
        "ref": "/workflow_patches/steps/5c",
        "name": "Rakip Mağaza Önerileri (8)"
      },
      {
        "id": "6",
        "ref": "/workflow_patches/steps/6",
        "name": "Competitor Listings (Genel)"
      },
      {
        "id": "6a",
        "ref": "/workflow_patches/steps/6a",
        "name": "Competitor Listings Upload"
      },
      {
        "id": "6b",
        "ref": "/workflow_patches/steps/6b",
        "name": "6b"
      },
      {
        "id": "7",
        "ref": "/workflow_patches/steps/7",
        "name": "Rakip Analizi & Ads Çekirdeği"
      },
      {
        "id": "8",
        "ref": "/workflow_patches/steps/8",
        "name": "Market Aggregation & Ads Generation"
      },
      {
        "id": "8a",
        "ref": "/workflow_patches/steps/8a",
        "name": "Ads Keyword Generation (Plan + Anahtarlar)"
      },
      {
        "id": "9",
        "ref": "/workflow_patches/steps/9",
        "name": "SEO Keyword Refinement"
      },
      {
        "id": "10",
        "ref": "/workflow_patches/steps/10",
        "name": "SEO Title Generation"
      },
      {
        "id": "11",
        "ref": "/workflow_patches/steps/11",
        "name": "SEO Description Generation"
      },
      {
        "id": "12",
        "ref": "/workflow_patches/steps/12",
        "name": "Tags Generation"
      },
      {
        "id": "13",
        "ref": "/workflow_patches/steps/13",
        "name": "Checkpoint – Akış Kapıları (BG)"
      },
      {
        "id": "14",
        "ref": "/workflow_patches/steps/14",
        "name": "Ara Değerlendirme – SEO Uyum"
      },
      {
        "id": "15",
        "ref": "/workflow_patches/steps/15",
        "name": "QA – Uyarı (Soft)"
      },
      {
        "id": "16",
        "ref": "/workflow_patches/steps/16",
        "name": "Listing Assemble & Record-Type Select"
      },
      {
        "id": "17",
        "ref": "/workflow_patches/steps/17",
        "name": "Export (CSV/XLSX/JSON)"
      },
      {
        "id": "18",
        "ref": "/workflow_patches/steps/18",
        "name": "Pre-Publish Review (Checkpoint 18)"
      },
      {
        "id": "19",
        "ref": "/workflow_patches/steps/19",
        "name": "30-Day Listing Performance Report (+ Optimization)"
      },
      {
        "id": "20",
        "ref": "/workflow_patches/steps/20",
        "name": "Versioning & Rollback QA"
      },
      {
        "id": "seo_package",
        "ref": "/workflow_patches/steps/seo_package",
        "name": "SEO Package QC"
      }
    ]
  },
  "_self_guard": {
    "abort_on_sha_mismatch": true,
    "expected_sha256": "c3011327b8d7bee52ad00b2066a483e7f551f01ec25260b526f59cc58b450e47",
    "hitl_checkpoints": [
      "0a",
      "1",
      "3",
      "3a",
      "14",
      "16",
      "18"
    ],
    "read_only": true,
    "verify_on": [
      "run_start",
      "checkpoint",
      "run_end"
    ]
  },
  "_store_profile": {
    "cikis_yeri": "Türkiye",
    "islem_suresi": "1–3 iş günü",
    "kargo_profili": "LUXURYJEWELERY",
    "ucret": "Ücretsiz kargo",
    "returns": {
      "policy_days": 15,
      "window_text": "15 gün",
      "personalized_exception": true,
      "restocking_fee": false,
      "notes": "Genel iade 15 gün; kişiselleştirilmiş siparişlerde istisna uygulanabilir."
    },
    "shipping": {
      "ddp_enabled": true,
      "tariff_inclusive_pricing": true
    }
  },
  "_workflow_patches": {
    "governance": {
      "dry_run": {
        "abort_on_diff": true,
        "compare_digests": true,
        "parallel_canary": true
      },
      "sim_gate": {
        "must_pass_canary": true
      }
    },
    "guards": {
      "actor_check": {
        "allowed": [
          "gpt_prod_executor_v1"
        ]
      },
      "session_handshake": {
        "hash_bytes_mode": "raw-bytes",
        "min_prefix_len": 16,
        "required_fields": [
          "filename",
          "size_bytes",
          "sha256_prefix"
        ]
      }
    }
  },
  "advisory_guides": {
    "7": {
      "constraints": {
        "duplicate_root_penalty": true,
        "forbidden_patterns": [
          "{FREE SHIPPING}",
          "ALL CAPS+",
          "🔥",
          "💯"
        ],
        "length_chars_max": 140
      },
      "example": "Moissanite Eternity Band – Marquise Cut Stackable Ring in 14K Gold",
      "inputs_required": [
        "3a.focus_keywords_pool",
        "0.product_info.confirmed"
      ],
      "name": "Title Draft",
      "objectives": [
        "Mobile-first: first ~40 chars carry the core phrase.",
        "Readable, non-spammy; avoid all-caps & symbol stuffing.",
        "Use 1–2 focus keywords from Step 3a pool; no root-word repetition >1×."
      ],
      "validation": [
        "≤140 chars",
        "Contains ≤2 repeated root words",
        "Contains 1–2 focus keywords from pool",
        "No forbidden patterns"
      ]
    },
    "8": {
      "constraints": {
        "avoid_root_repetition": true,
        "focus_keywords_unique_max": 6,
        "focus_keywords_unique_min": 4,
        "mobile_first": true,
        "paragraph_max_lines": 3
      },
      "example": "Elegant marquise-cut moissanite eternity band crafted in solid 14K gold...",
      "inputs_required": [
        "3a.focus_keywords_pool",
        "0.product_info.confirmed"
      ],
      "must_include_from_product_info": [
        "Processing time 1–3 business days",
        "Free shipping, tracking provided",
        "Seller pays customs",
        "Ships from Turkey to: Canada/USA/Germany/UK/France",
        "Estimated delivery 2–5 business days"
      ],
      "name": "Description Draft",
      "sections": [
        "Hook (≤160 chars, benefits + core keyword once)",
        "Specs bullets (metal, width, stones, sizes, finish)",
        "Craft story / materials",
        "Shipping & processing (from Step 0 Product Info)",
        "Care & returns"
      ],
      "validation": [
        "4–6 unique focus keywords used naturally",
        "≤3 lines per paragraph",
        "Shipping block matches Product Info",
        "No keyword stuffing"
      ]
    },
    "8a": {
      "example_tags": [
        "marquise eternity",
        "stackable ring",
        "14k gold band",
        "moissanite wedding"
      ],
      "inputs_required": [
        "3a.focus_keywords_pool",
        "4.top_listings.analysis?",
        "6a.competitor.analysis?"
      ],
      "name": "Attributes & Tags",
      "rules": [
        "Up to 13 tags; diversify roots; avoid duplicate stems.",
        "Prefer pool keywords & real buyer terms from Top Listings/Competitors.",
        "Each tag concise; natural language; no comma-separated multi-tags."
      ],
      "validation": [
        "No duplicate roots across tags",
        "≥8 distinct tags from pool/market data",
        "Attributes consistent with materials, color, size"
      ]
    },
    "9": {
      "checks": [
        "Neutral background; consistent lighting",
        "No heavy filters; true-to-color",
        "Aspect fits Etsy crop; important detail centered"
      ],
      "name": "Photo Plan (Advisory-Only Visual QC)",
      "order": [
        "Hero on-model or macro",
        "Profile view",
        "Stack/scale with ruler/hand",
        "Variations (yellow/white/rose)",
        "Packaging & gift note",
        "Process/craft shot"
      ],
      "validation": [
        "Min 5 distinct angles",
        "Variations visible",
        "No watermark/overlays"
      ]
    }
  },
  "anomaly_detection": {
    "notify": {
      "include_examples": 3,
      "mode": "brief"
    },
    "rules": {
      "currency_parse_fail_ratio_gt": {
        "severity": "warn",
        "threshold": 0.1
      },
      "empty_but_required_field_ratio_gt": {
        "severity": "fatal",
        "threshold": 0.15
      },
      "missing_required_headers": {
        "severity": "fatal"
      },
      "non_numeric_in_numeric_fields": {
        "severity": "warn"
      },
      "row_length_mismatch": {
        "severity": "fatal"
      }
    }
  },
  "commentary": {
    "mode": {
      "label": "Notlar",
      "optional": true,
      "position": "after_output"
    }
  },
  "content_hash": "sha256:4be7ddc8e09be40a072100288bd3491868e178ce808e3d433c6d4c93200fac91",
  "context_info": {
    "basics": {
      "core_markets": [
        {
          "code": "US",
          "name": "United States"
        },
        {
          "code": "GB",
          "name": "United Kingdom"
        },
        {
          "code": "DE",
          "name": "Germany"
        },
        {
          "code": "FR",
          "name": "France"
        },
        {
          "code": "NL",
          "name": "Netherlands"
        }
      ],
      "product_fixed": {
        "colors": [
          "Yellow Gold",
          "White Gold",
          "Rose Gold"
        ],
        "discount": {
          "percent": 30,
          "visible_in_outputs": false
        },
        "sizes_us": "4–14¾",
        "stone_info_policy": {
          "use_if_confidence_met": true,
          "user_provided_preferred": true,
          "visual_analysis_threshold": 0.9
        },
        "variation_prices_usd": {
          "10K": "xxx USD",
          "14K": "xxx USD",
          "18K": "xxx USD"
        },
        "color_display": [
          "Yellow Gold",
          "White Gold",
          "Rose Gold"
        ]
      },
      "store_logistics": {
        "customs_note": "Satıcı gümrük vergisini öder",
        "delivery_window_business_days": {
          "max": 5,
          "min": 2
        },
        "origin_country": "Türkiye",
        "packaging": "Özel kutu + hediye notu eklenebilir",
        "processing_time_business_days": {
          "max": 3,
          "min": 1
        },
        "ship_to_countries": [
          "CA",
          "US",
          "DE",
          "GB",
          "FR"
        ],
        "shipping_cost": "Ücretsiz kargo",
        "shipping_profile": "LUXURYJEWELERY",
        "tracking": true
      },
      "shipping": {
        "target_markets": [
          "CA",
          "US",
          "DE",
          "UK",
          "FR"
        ],
        "processing_time": "1–3 business days",
        "free_shipping": true,
        "packaging": {
          "gift_box": true,
          "gift_note": true
        },
        "customs": {
          "seller_pays_duties": true
        },
        "delivery_time": "2–5 business days",
        "tracking": true
      },
      "returns": {
        "policy_days": 15,
        "window_text": "15 gün",
        "personalized_exception": true
      }
    },
    "product": {
      "discount_percent": 30,
      "gold_colors": [
        "Yellow",
        "White",
        "Rose"
      ],
      "origin_country": "Turkey",
      "processing_time_business_days": "1–3",
      "ring_sizes": "US 4 – 14 ¾",
      "stone": {
        "note": "minimalist / type unknown",
        "present": true,
        "type": null
      },
      "variations": [
        {
          "karat": "10K",
          "price_usd": 450
        },
        {
          "karat": "14K",
          "price_usd": 650
        },
        {
          "karat": "18K",
          "price_usd": 900
        }
      ]
    },
    "shop": {
      "compliance_notes": [
        "EU countries may require Tax ID"
      ],
      "free_shipping": true,
      "methods": [
        {
          "carrier": "PTT",
          "region": "TR (domestic)"
        },
        {
          "carrier": "ShipEntegra Express",
          "region": "US/EU/CA",
          "transit": "2–5 business days"
        }
      ],
      "packaging": [
        "Gift box",
        "Gift note"
      ],
      "shipping_profile": "LUXURYJEWELERY"
    },
    "user_actions": []
  },
  "csv_pipelines": {
    "competitor_listings": [
      "schema_validate",
      "normalize_headers",
      "sanitize_rows",
      "deduplicate",
      "analyze_ready"
    ],
    "similar_keywords": [
      "schema_validate",
      "normalize_headers",
      "sanitize_rows",
      "deduplicate",
      "analyze_ready"
    ],
    "top_listings": [
      "schema_validate",
      "normalize_headers",
      "sanitize_rows",
      "deduplicate",
      "analyze_ready"
    ]
  },
  "csv_prep_common": {
    "allow_mixed_case_headers": true,
    "empty_string_stays_empty": true,
    "keep_original_dollar_signs": true,
    "log": {
      "on_alignment_fix": "warn",
      "sample_first_bad_row": true
    },
    "never_invent_nan": true,
    "no_header_renaming": true
  },
  "csv_prep_profiles": {
    "competitor_listings": {
      "alignment": {
        "drop_leading_empty_column_if_all_empty": true,
        "drop_trailing_comma_column_if_empty": true,
        "fix_consistent_off_by_one": {
          "enabled": true,
          "only_if_all_rows": true,
          "strategy": "drop_leading_or_trailing_empty"
        },
        "require_header_row": true
      },
      "cleaning": {
        "no_type_casting": true,
        "preserve_empty_as_empty_string": true,
        "preserve_literal_nan": true,
        "trim_whitespace": true
      },
      "detect": {
        "delimiter": ",",
        "must_contain_headers_any": [
          "Title",
          "Monthly sales",
          "Sales",
          "Monthly revenue",
          "Revenue",
          "Shop"
        ],
        "quotechar": "\""
      },
      "normalization": {
        "currency_fields_keep_raw": [
          "Monthly revenue",
          "Revenue",
          "Price"
        ],
        "do_not_rename_headers": true,
        "percent_fields_keep_raw": [
          "Conversion rate",
          "Review rate",
          "BSR Category (%)"
        ],
        "preserve_column_order": true
      },
      "read_options": {
        "encoding": [
          "utf-8",
          "cp1254",
          "iso-8859-9"
        ],
        "keep_quoting": true,
        "newline_normalize": true,
        "strip_bom": true
      },
      "validate": {
        "header_equals_row_length": "warn_if_fail",
        "min_rows": 1
      }
    },
    "similar_keywords": {
      "alignment": {
        "drop_leading_empty_column_if_all_empty": true,
        "drop_trailing_comma_column_if_empty": true,
        "fix_consistent_off_by_one": {
          "enabled": true,
          "only_if_all_rows": true,
          "strategy": "drop_leading_or_trailing_empty"
        },
        "require_header_row": true
      },
      "cleaning": {
        "no_type_casting": true,
        "preserve_empty_as_empty_string": true,
        "preserve_literal_nan": true,
        "trim_whitespace": true
      },
      "detect": {
        "delimiter": ",",
        "must_contain_headers_any": [
          "Keyword",
          "Search volume",
          "Competition",
          "Sales",
          "Score"
        ],
        "quotechar": "\""
      },
      "normalization": {
        "currency_fields_keep_raw": [
          "Google top of page bid (low range)",
          "Google top of page bid (high range)",
          "Google CPC"
        ],
        "do_not_rename_headers": true,
        "percent_fields_keep_raw": [
          "3mo. change",
          "Conversion rate",
          "Annual search trend"
        ],
        "preserve_column_order": true
      },
      "read_options": {
        "encoding": [
          "utf-8",
          "cp1254",
          "iso-8859-9"
        ],
        "keep_quoting": true,
        "newline_normalize": true,
        "strip_bom": true
      },
      "validate": {
        "header_equals_row_length": "warn_if_fail",
        "min_rows": 1
      }
    },
    "top_listings": {
      "alignment": {
        "drop_leading_empty_column_if_all_empty": true,
        "drop_trailing_comma_column_if_empty": true,
        "fix_consistent_off_by_one": {
          "enabled": true,
          "only_if_all_rows": true,
          "strategy": "drop_leading_or_trailing_empty"
        },
        "require_header_row": true
      },
      "cleaning": {
        "no_type_casting": true,
        "preserve_empty_as_empty_string": true,
        "preserve_literal_nan": true,
        "trim_whitespace": true
      },
      "detect": {
        "delimiter": ",",
        "must_contain_headers_any": [
          "Title",
          "Revenue",
          "LQS",
          "Price",
          "Category",
          "Shop"
        ],
        "quotechar": "\""
      },
      "normalization": {
        "currency_fields_keep_raw": [
          "Revenue",
          "Price",
          "Monthly revenue"
        ],
        "date_fields_keep_raw": [
          "Creation date"
        ],
        "do_not_rename_headers": true,
        "percent_fields_keep_raw": [
          "Review rate",
          "Conversion rate",
          "BSR Category (%)"
        ],
        "preserve_column_order": true
      },
      "read_options": {
        "encoding": [
          "utf-8",
          "cp1254",
          "iso-8859-9"
        ],
        "keep_quoting": true,
        "newline_normalize": true,
        "strip_bom": true
      },
      "validate": {
        "header_equals_row_length": "warn_if_fail",
        "min_rows": 1
      }
    }
  },
  "csv_schemas": {
    "competitor_listings": {
      "headers": [
        "Title",
        "Monthly sales",
        "Sales",
        "Monthly revenue",
        "Revenue",
        "LQS",
        "Price",
        "Category",
        "Shop",
        "BSR Category (%)",
        "BSR Category",
        "Conversion rate",
        "Creator",
        "Product creation era",
        "Views",
        "Video",
        "URL",
        "Tag count",
        "Tags",
        "Review rate",
        "Reviews",
        "Review score",
        "Production partners",
        "Processing time",
        "Min processing time",
        "Max processing time",
        "Personalization required",
        "Creation date",
        "Favorites",
        "Listing type",
        "Listing age (days)",
        "Vintage",
        "Supply item",
        "Personalizable",
        "Image count",
        "Free US shipping"
      ],
      "quote_all": true,
      "treat_empty_as_empty_string": true
    },
    "similar_keywords": {
      "allow_first_cell_unquoted": true,
      "bom_tolerant": true,
      "headers": [
        "Keyword",
        "Search volume",
        "3mo. change",
        "Competition",
        "Sales",
        "Score",
        "Trend status",
        "Search to competition ratio",
        "Google top of page bid (low range)",
        "Long-tail keyword",
        "Listing age",
        "Length",
        "Google top of page bid (high range)",
        "Google CPC",
        "Google competition level",
        "Google competition index",
        "Etsy tag",
        "Conversion rate",
        "Competition level",
        "Sales per listing",
        "Annual search trend"
      ],
      "normalize_headers": true,
      "quote_all": true,
      "regional_separators": [
        ";",
        ","
      ],
      "strip_whitespace": true,
      "treat_empty_as_empty_string": true
    },
    "top_listings": {
      "headers": [
        "Title",
        "Revenue",
        "LQS",
        "Price",
        "Category",
        "Shop",
        "Sales",
        "Monthly sales",
        "Creator",
        "Product creation era",
        "Views",
        "Video",
        "URL",
        "Tag count",
        "Tags",
        "Review rate",
        "Reviews",
        "Review score",
        "Production partners",
        "Processing time",
        "Min processing time",
        "Max processing time",
        "Favorites",
        "Listing age (days)",
        "Personalization required",
        "Creation date",
        "Listing type",
        "Vintage",
        "Supply item",
        "Personalizable",
        "Image count",
        "Free US shipping",
        "Conversion rate",
        "BSR Category",
        "BSR Category (%)",
        "Monthly revenue"
      ],
      "quote_all": true,
      "treat_empty_as_empty_string": true
    }
  },
  "data_protection": {
    "audit_log": {
      "emit_checksums": true,
      "enabled": true,
      "log_fields": [
        "record_id",
        "op_type",
        "source",
        "source_updated_at",
        "ingest_ts",
        "hash"
      ],
      "log_level": "info"
    },
    "backup": {
      "enabled": true,
      "format": "jsonl",
      "frequency": "hourly",
      "post_sync_snapshot": true,
      "pre_sync_snapshot": true,
      "retention_days": 30,
      "target": "s3://your-bucket/exports/competitor_shops/"
    },
    "conflict_resolution": {
      "source_priority": [
        "primary",
        "secondary",
        "tertiary"
      ],
      "strategy": "newest_wins",
      "tiebreaker_order": [
        "source_priority",
        "hash"
      ]
    },
    "safety": {
      "abort_on_schema_violation": true,
      "checksum_algorithm": "sha256",
      "dry_run": false,
      "idempotency_key_template": "job_id:{job_id}|batch:{batch_no}"
    },
    "versioning": {
      "conflict_compare_by": [
        "source_updated_at",
        "ingest_ts"
      ],
      "enabled": true,
      "keep_history": true,
      "max_history_versions": 50,
      "record_identity_keys": [
        "record_id"
      ]
    }
  },
  "display_name_lock": true,
  "enforcement_profile": {
    "block_on_warning": true,
    "deny_parallel_auto_start": true,
    "fail_closed": true,
    "one_step_per_turn": true,
    "strict_step_completion": true,
    "strict_substep_completion": true
  },
  "evolution_policy": {
    "delta_threshold": 0.15,
    "enabled": true,
    "proposal_schema": {
      "properties": {
        "diff": {
          "type": "object"
        },
        "rationale": {
          "items": {
            "type": "string"
          },
          "type": "array"
        },
        "scores_before_after": {
          "properties": {
            "new": {
              "type": "number"
            },
            "old": {
              "type": "number"
            }
          },
          "type": "object"
        },
        "type": {
          "enum": [
            "focus_swap",
            "tag_refine",
            "title_tune"
          ],
          "type": "string"
        }
      },
      "required": [
        "type",
        "rationale",
        "scores_before_after"
      ],
      "type": "object"
    },
    "proposal_types": [
      "focus_swap",
      "tag_refine",
      "title_tune"
    ],
    "sources": [
      "4",
      "5"
    ],
    "ui_directives": {
      "actions": [
        "ACCEPT",
        "REJECT"
      ],
      "default": "REJECT"
    }
  },
  "example_artifacts": {
    "notes": "Examples must equal final artifacts exactly"
  },
  "examples": {
    "competitor_listings": {
      "header_example": "Title,Monthly sales,Sales,Monthly revenue,Revenue,LQS,Price,Category,Shop,BSR Category (%),BSR Category,Conversion rate,Creator,Product creation era,Views,Video,URL,Tag count,Tags,Review rate,Reviews,Review score,Production partners,Processing time,Min processing time,Max processing time,Personalization required,Creation date,Favorites,Listing type,Listing age (days),Vintage,Supply item,Personalizable,Image count,Free US shipping",
      "notes": "Shop alanı metin (ör: Aquamarise). Boşsa boş kalır; sayı görülmesi parsing hatasıdır.",
      "row_example": "Petite Twisted Vine Diamond Wedding Band in Sterling Silver Engagement Ring for Women Dainty Promise Ring- Anniversary Birthday Gift For Her,\"14\",\"626\",\"$1105\",\"$49454\",\"63\",\"$79.00\",\"Jewelry\",\"Aquamarise\",\"0.0\",\"NaN\",\"0.91%\",\"Shop owner\",\"Made to Order\",\"68711\",\"Yes\",\"https://www.etsy.com/listing/1135807985/petite-twisted-vine-diamond-wedding-band\",\"13\",\"Twisted Wedding Band,Anniversary Gift,Gift For Her,Dainty promise ring,STACKABLE RING,Women silver ring,ANNIVERSARY RING,PERSONALIZED JEWELRY,GIFTS FOR HER,PROMISE RING FOR HER,infinity ring,vow renewal ring,silver wedding band\",\"30.83%\",\"193\",\"4.90\",\"None\",\"4.00 days\",\"3 days\",\"5 days\",\"No\",\"07 Ara, 2021\",\"3924\",\"Physical\",\"1342\",\"No\",\"No\",\"Yes\",\"6\",\"Yes\","
    },
    "csv_headers": {
      "competitor_listings": "Title,Monthly sales,Sales,Monthly revenue,Revenue,LQS,Price,Category,Shop,BSR Category (%),BSR Category,Conversion rate,Creator,Product creation era,Views,Video,URL,Tag count,Tags,Review rate,Reviews,Review score,Production partners,Processing time,Min processing time,Max processing time,Personalization required,Creation date,Favorites,Listing type,Listing age (days),Vintage,Supply item,Personalizable,Image count,Free US shipping",
      "similar_keywords": "Keyword,Search volume,3mo. change,Competition,Sales,Score,Trend status,Search to competition ratio,Google top of page bid (low range),Long-tail keyword,Listing age,Length,Google top of page bid (high range),Google CPC,Google competition level,Google competition index,Etsy tag,Conversion rate,Competition level,Sales per listing,Annual search trend",
      "top_listings": "Title,Revenue,LQS,Price,Category,Shop,Sales,Monthly sales,Creator,Product creation era,Views,Video,URL,Tag count,Tags,Review rate,Reviews,Review score,Production partners,Processing time,Min processing time,Max processing time,Favorites,Listing age (days),Personalization required,Creation date,Listing type,Vintage,Supply item,Personalizable,Image count,Free US shipping,Conversion rate,BSR Category,BSR Category (%),Monthly revenue"
    },
    "csv_sample_rows": {
      "competitor_listings": "Petite Twisted Vine Diamond Wedding Band in Sterling Silver Engagement Ring for Women Dainty Promise Ring- Anniversary Birthday Gift For Her,\"14\",\"626\",\"$1105\",\"$49454\",\"63\",\"$79.00\",\"Jewelry\",\"Aquamarise\",\"0.0\",\"NaN\",\"0.91%\",\"Shop owner\",\"Made to Order\",\"68711\",\"Yes\",\"https://www.etsy.com/listing/1135807985/petite-twisted-vine-diamond-wedding-band\",\"13\",\"Twisted Wedding Band,Anniversary Gift,Gift For Her,Dainty promise ring,STACKABLE RING,Women silver ring,ANNIVERSARY RING,PERSONALIZED JEWELRY,GIFTS FOR HER,PROMISE RING FOR HER,infinity ring,vow renewal ring,silver wedding band\",\"30.83%\",\"193\",\"4.90\",\"None\",\"4.00 days\",\"3 days\",\"5 days\",\"No\",\"07 Ara, 2021\",\"3924\",\"Physical\",\"1342\",\"No\",\"No\",\"Yes\",\"6\",\"Yes\",",
      "similar_keywords": "modern gold band,\"10\",\"0%\",\"24018\",\"962401\",\"37\",\"Stable\",\"0.00\",\"87\",\"Yes\",\"1747 days\",\"16\",\"295\",\"191\",\"High\",\"96\",\"Yes\",\"1.00%\",\"Low\",\"40\",\"0%\",",
      "top_listings": "Rose gold wedding band Moissanite wedding band Marquise cut Diamond stacking matching Unique Full eternity Ring Vintage Wedding Promise gift,\"$752131\",\"53\",\"$293.00\",\"Jewelry\",\"CoolRingJewelry\",\"2567\",\"34\",\"Shop owner\",\"Made to Order\",\"824029\",\"Yes\",\"https://www.etsy.com/listing/708009353/rose-gold-wedding-band-moissanite\",\"13\",\"Moissanite ring,rose gold ring,Full eternity ring,diamond ring,art deco,wedding band women,vintage ring,stacking ring,Custom Jewelry,Birthstone Jewelry,Personalized Gift,Marquise cut ring,solid gold ring\",\"29.37%\",\"754\",\"4.93\",\"None\",\"14.00 days\",\"14 days\",\"14 days\",\"38681\",\"2300\",\"Yes\",\"21 May, 2019\",\"Physical\",\"No\",\"No\",\"Yes\",\"8\",\"Yes\",\"0.31%\",\"NaN\",\"0.0\",\"$9828\","
    },
    "similar_keywords": {
      "header_example": "Keyword,Search volume,3mo. change,Competition,Sales,Score,Trend status,Search to competition ratio,Google top of page bid (low range),Long-tail keyword,Listing age,Length,Google top of page bid (high range),Google CPC,Google competition level,Google competition index,Etsy tag,Conversion rate,Competition level,Sales per listing,Annual search trend",
      "notes": "İlk alan (Keyword) bazı dosyalarda tırnaksız gelebilir; diğer tüm alanlar çift tırnak içinde kalmalıdır.",
      "row_example": "modern gold band,\"10\",\"0%\",\"24018\",\"962401\",\"37\",\"Stable\",\"0.00\",\"87\",\"Yes\",\"1747 days\",\"16\",\"295\",\"191\",\"High\",\"96\",\"Yes\",\"1.00%\",\"Low\",\"40\",\"0%\","
    },
    "top_listings": {
      "header_example": "Title,Revenue,LQS,Price,Category,Shop,Sales,Monthly sales,Creator,Product creation era,Views,Video,URL,Tag count,Tags,Review rate,Reviews,Review score,Production partners,Processing time,Min processing time,Max processing time,Favorites,Listing age (days),Personalization required,Creation date,Listing type,Vintage,Supply item,Personalizable,Image count,Free US shipping,Conversion rate,BSR Category,BSR Category (%),Monthly revenue",
      "notes": "Title alanı iç virgül barındırabilir; doğru ayrım için Title bitişindeki ,\" işaretine kadar tek alan sayılır.",
      "row_example": "Rose gold wedding band Moissanite wedding band Marquise cut Diamond stacking matching Unique Full eternity Ring Vintage Wedding Promise gift,\"$752131\",\"53\",\"$293.00\",\"Jewelry\",\"CoolRingJewelry\",\"2567\",\"34\",\"Shop owner\",\"Made to Order\",\"824029\",\"Yes\",\"https://www.etsy.com/listing/708009353/rose-gold-wedding-band-moissanite\",\"13\",\"Moissanite ring,rose gold ring,Full eternity ring,diamond ring,art deco,wedding band women,vintage ring,stacking ring,Custom Jewelry,Birthstone Jewelry,Personalized Gift,Marquise cut ring,solid gold ring\",\"29.37%\",\"754\",\"4.93\",\"None\",\"14.00 days\",\"14 days\",\"14 days\",\"38681\",\"2300\",\"Yes\",\"21 May, 2019\",\"Physical\",\"No\",\"No\",\"Yes\",\"8\",\"Yes\",\"0.31%\",\"NaN\",\"0.0\",\"$9828\","
    }
  },
  "explicit_command_enforcer": {
    "command_pattern": "^KOMUT:\\s+(EKLE|GÜNCELLE|SIL|GERI-AL|FINAL-SET|URETIMI-(?:BAŞLAT|BASLAT))\\b.+",
    "commands": [
      {
        "command_regex": "^KOMUT:\\s*URETIMI-(?:BAŞLAT|BASLAT)\\s*\\{\\s*\\\"env\\\"\\s*:\\s*\\\"(prod|staging)\\\"\\s*,\\s*\\\"run_id\\\"\\s*:\\s*\\\"([A-Za-z0-9_-]{8,})\\\"\\s*(,\\s*\\\"publish_mode\\\"\\s*:\\s*\\\"(queued|immediate)\\\")?\\s*(,\\s*\\\"dry_run\\\"\\s*:\\s*(true|false))?\\s*\\}$",
        "confirmation_regex": "^ONAY:\\s*EVET\\s*URETIMI-(?:BAŞLAT|BASLAT)\\s*RUN_ID:\\s*\\2$",
        "description": "Üretim pipeline başlatma isteği (queue + gate kontrollü)",
        "effects": {
          "on_accept": [
            {
              "action": "counter.increment",
              "key": "commands.URETIMI_BASLAT"
            },
            {
              "action": "audit.append",
              "record": {
                "at": "$$now",
                "by": "$$actor",
                "env": "$1",
                "op": "URETIMI_BASLAT_ISTENDI",
                "params": {
                  "dry_run": "$6",
                  "publish_mode": "$4"
                },
                "run_id": "$2"
              }
            },
            {
              "action": "runtime.queue.push",
              "payload": {
                "dry_run": "$6",
                "env": "$1",
                "publish_mode": "$4",
                "requested_at": "$$now",
                "requested_by": "$$actor",
                "run_id": "$2",
                "type": "URETIMI_BASLAT"
              },
              "queue": "production_runs"
            },
            {
              "action": "digest.emit",
              "level": "info",
              "message": "URETIMI-BAŞLAT kuyruğa alındı: RUN_ID=$2, env=$1"
            }
          ],
          "on_reject": [
            {
              "action": "audit.append",
              "record": {
                "at": "$$now",
                "by": "$$actor",
                "op": "URETIMI_BASLAT_REJECT",
                "reason": "$$reason"
              }
            },
            {
              "action": "digest.emit",
              "level": "warn",
              "message": "URETIMI-BAŞLAT reddedildi: $$reason"
            }
          ]
        },
        "id": "URETIMI-BAŞLAT",
        "preconditions": {
          "allow_when_production_readonly": true,
          "notes": "production_readonly=true iken sadece kuyruğa alınır; tetikleme queue worker tarafından yapılır.",
          "require_compliance_pass": true,
          "require_current_step_pass": [
            13,
            16
          ]
        }
      }
    ],
    "enabled": true,
    "require_both_consent_and_command": true
  },
  "fallbacks": {
    "step_3p": {
      "consent_required": true,
      "enabled": true,
      "mark_provenance": "gpt_generated",
      "mode": "gpt_pool_with_consent",
      "prompt_once": true
    }
  },
  "final_marker": {
    "approved_at": "2025-09-04T18:29:55Z",
    "approved_by": "mcinar1905",
    "attention_required": false,
    "core_digest": "542915b16f0766c92fd057b43b5dbc2ab0f28ce3d22034304c5afd54b965ece7",
    "is_final": true,
    "sha256": "be80f5e1cb8529caf64df459ce1f834cddaf8a2909a663a12891648d8aa1e7af",
    "strict_source_of_truth": true
  },
  "governance": {
    "enforcement": {
      "gates": {
        "7": {
          "requires": [
            "1b.search_suggestions_done",
            "3a.pool_ready"
          ]
        },
        "8": {
          "requires": [
            "0.product_info_confirmed",
            "7.title_done"
          ]
        },
        "8a": {
          "requires": [
            "8.description_done"
          ]
        },
        "9": {
          "requires": [
            "1.images_uploaded",
            "1b.search_suggestions_done"
          ]
        }
      },
      "must_follow_run_policy": true,
      "must_follow_step_rules": true,
      "no_autocomplete_or_assumptions": true,
      "no_skip_steps": [
        "7",
        "8",
        "9",
        "8a"
      ]
    },
    "notes": "Üretim sırasında tek kaynak bu JSON'dur. JSON dışında yorum, kural uydurma, otomatik atlama, excel/indirme vb. davranışlar yasaktır.",
    "outside_generation": "forbidden",
    "outside_rules_allowed": false,
    "source_of_truth": "THIS_JSON_ONLY",
    "id_aliases": {
      "8A": {
        "alias_of": "8a"
      }
    },
    "step_sot": {
      "sources": {
        "sequence": {
          "__REF__": "/step_flow_lock/canonical_order"
        },
        "manifests": {
          "__REF__": "/workflow_patches/steps"
        },
        "enabled_runtime": {
          "__REF__": "/_run_order/steps"
        },
        "policies": {
          "__REF__": "/workflow_patches/steps"
        },
        "draft_bundle": {
          "__REF__": "/_run_order/steps/3c/outputs"
        },
        "competitors_clean": {
          "__REF__": "/_run_order/steps/6/mirror/competitors.clean[]"
        },
        "focus_candidates": {
          "__REF__": "/_run_order/steps/3a/outputs/focus_candidates"
        }
      },
      "views": {
        "focus_candidates_top6": {
          "source": {
            "__REF__": "/governance/step_sot/sources/focus_candidates"
          },
          "constraints": {
            "top_n": 6,
            "order_by": "rank:asc"
          },
          "note": "Runtime/UI should render first 6 by rank."
        }
      }
    },
    "releases": {
      "current": {
        "__REF__": "/_policy/release"
      }
    }
  },
  "integrity": {
    "arrays": {
      "similar_keywords_len": 49,
      "top_listings_len": 194
    },
    "byte_size": 1037139,
    "char_count": 1034447,
    "content_hash": "sha256:4be7ddc8e09be40a072100288bd3491868e178ce808e3d433c6d4c93200fac91",
    "hash_algo": "sha256",
    "parent_hash": "sha256:69736e5bd050643cbb82a2e80a6e6daf24b06b684fe5bb05ef7e5c3e74a72849",
    "top_level_keys_len": 76
  },
  "lineage": {
    "chain_id": "470343de-8403-4748-91a1-94bb5991a25e",
    "parent_hash": "sha256:c5f938d607433530dc1ab0e33b199a84a770ba66b091cdce5cbff2ed3ee30434"
  },
  "meta": {
    "patch_history": [
      {
        "notes": "Non-destructive: added advisory_guides[7,8,8a,9], governance.enforcement.no_skip_steps += {7,8,8a,9}, gates for dependencies, validations entries. Data arrays untouched.",
        "patch": "apply_advisory_7_9_and_enforcement",
        "timestamp": "2025-09-08T16:14:43.903016Z"
      }
    ]
  },
  "packs": {
    "CSV_STRICT_SAFETY_v1": {
      "applies_to": [
        "similar_keywords",
        "top_listings",
        "competitor_listings"
      ],
      "description": "Sıkı CSV başlık-satır eşleşmesi, alıntı/virgül güvenliği, otomatik NaN üretmeme.",
      "name": "CSV_STRICT_SAFETY_v1",
      "rules": {
        "alignment": {
          "drop_leading_empty_column_if_all_empty": false,
          "drop_trailing_comma_column_if_empty": false,
          "fix_consistent_off_by_one": {
            "enabled": false
          },
          "require_header_row": true
        },
        "cleaning": {
          "trim_whitespace": true
        },
        "normalization_overrides": {
          "do_not_rename_headers": true,
          "preserve_column_order": true
        },
        "nulls_nans": {
          "no_type_casting": true,
          "preserve_empty_as_empty_string": true,
          "preserve_literal_nan": true
        },
        "quoting_commas": {
          "allow_commas_in_first_field": true,
          "delimiter": ",",
          "doublequote": true,
          "escapechar": null,
          "quotechar": "\"",
          "require_proper_quotes": true
        },
        "read_options": {
          "encoding": [
            "utf-8",
            "cp1254",
            "iso-8859-9"
          ],
          "keep_quoting": true,
          "newline_normalize": true,
          "strip_bom": true
        },
        "row_length": {
          "header_equals_row_length": "error",
          "on_row_length_mismatch": "error",
          "strict_row_length_check": true
        }
      }
    },
    "JSON_GENERAL_SAFETY_v1": {
      "description": "Genel güvenlik/istikrar kuralları (CSV hariç). Veri kaybı = 0, deterministik akış, sürümleme, audit.",
      "excludes": [
        "csv_prep_profiles"
      ],
      "name": "JSON_GENERAL_SAFETY_v1",
      "rules": {
        "audit_trail": {
          "changelog_required": true,
          "log_fields": [
            "input_sha256",
            "output_sha256",
            "duration_ms",
            "hostname",
            "pid"
          ],
          "write_field_origin": true,
          "write_step_log": true
        },
        "autosave_restore": {
          "enabled": true,
          "path": [
            "autosave",
            "state.json"
          ],
          "write_after_steps": [
            "00",
            "0",
            "0a",
            "1",
            "1a",
            "1b",
            "3",
            "3a",
            "3b",
            "4",
            "5",
            "5a",
            "6",
            "6a",
            "7",
            "8",
            "8a",
            "9",
            "10",
            "11",
            "12",
            "13",
            "14",
            "15",
            "16",
            "17",
            "18",
            "19",
            "20",
            "21"
          ]
        },
        "config_lock": {
          "__locked__": true,
          "unlock_token_required": true
        },
        "destructive_ops": {
          "delete": false,
          "impute": false,
          "require_user_consent_flag": true,
          "rewrite_existing_fields": false
        },
        "determinism": {
          "seed": 1337,
          "sort_stable": true
        },
        "encoding_locale_lock": {
          "allowed_encodings": [
            "utf-8",
            "cp1254",
            "iso-8859-9"
          ],
          "decimal_sep": [
            ".",
            ","
          ],
          "thousands_sep": [
            ",",
            "."
          ],
          "timezone": "Europe/Istanbul"
        },
        "immutability": {
          "immutable_outputs": true,
          "read_only_inputs": true,
          "timestamped_artifacts": true
        },
        "no_merge_default": {
          "enabled": true
        },
        "size_guards": {
          "enforce_no_row_drop": true,
          "on_mismatch": "abort",
          "report_pre_post_sizes": true
        },
        "workflow_order": {
          "enforce_strict_step_order": true,
          "must_start_with": [
            "00",
            "0",
            "0a"
          ],
          "no_skip": true,
          "on_violation": "abort"
        }
      }
    }
  },
  "policies": {
    "csv_rules_lock": true,
    "protect": [
      "_csv_rules",
      "_run_order.steps.3p",
      "_run_order.steps.4p",
      "_run_order.steps.5p",
      "csv_pipelines"
    ],
    "runtime_csv_rule_changes": "forbid",
    "suggestions": {
      "enabled": false
    },
    "ui": {
      "no_reprompt_csv_rules": true,
      "show_rule_check": true,
      "silence_redundant_prompts": true
    }
  },
  "policy": {
    "blocked_steps": [
      "4"
    ],
    "csv_pipeline": {
      "apply_leading_index_rule": {
        "enabled": true
      },
      "detect_encoding": {
        "fallback": "utf-8-sig",
        "try_encodings": [
          "utf-8-sig",
          "cp1254",
          "iso-8859-9",
          "windows-1254"
        ]
      },
      "normalize_newlines": {
        "target": "\n"
      },
      "parse_with_dialect": {
        "strict_quotes": true
      },
      "phases": [
        "detect_encoding",
        "normalize_newlines",
        "parse_with_dialect",
        "validate_header_alignment",
        "apply_leading_index_rule",
        "preserve_literals",
        "snapshot_and_hash"
      ],
      "preserve_literals": {
        "empty": "",
        "nan_literal": "NaN",
        "no_type_infer": true
      },
      "row_level_fixes": {
        "similar_keywords": {
          "trim_single_trailing_empty": {
            "enabled": true
          }
        },
        "top_or_competitor": {
          "leading_index_drop": {
            "enabled": true,
            "only_if_first_cell_is_pure_index": true
          }
        }
      },
      "snapshot_and_hash": {
        "hash_algo": "sha256",
        "path": "/_runs/<run_id>/csv/<type>"
      },
      "validate_header_alignment": {
        "fail_on_mismatch": true
      }
    },
    "csv_profiles": {
      "competitor_shops_csv": {
        "dialect": {
          "delimiter": ",",
          "doublequote": true,
          "escapechar": null,
          "lineterminator": [
            "\r\n",
            "\n",
            "\r"
          ],
          "quotechar": "\""
        },
        "encoding_candidates": [
          "utf-8-sig",
          "cp1254",
          "iso-8859-9",
          "windows-1254"
        ],
        "headers": [
          "Title",
          "Monthly sales",
          "Sales",
          "Monthly revenue",
          "Revenue",
          "LQS",
          "Price",
          "Category",
          "Shop",
          "BSR Category (%)",
          "BSR Category",
          "Conversion rate",
          "Creator",
          "Product creation era",
          "Views",
          "Video",
          "URL",
          "Tag count",
          "Tags",
          "Review rate",
          "Reviews",
          "Review score",
          "Production partners",
          "Processing time",
          "Min processing time",
          "Max processing time",
          "Personalization required",
          "Creation date",
          "Favorites",
          "Listing type",
          "Listing age (days)",
          "Vintage",
          "Supply item",
          "Personalizable",
          "Image count",
          "Free US shipping"
        ],
        "preserve": {
          "empty_as_empty_string": true,
          "nan_literal": true,
          "no_auto_type_infer": true,
          "no_trim_inside_quotes": true
        },
        "row_validation": {
          "leading_index_rule": {
            "drop_leading_index": true,
            "enabled": true,
            "when_mismatch_by_1_and_first_field_is_pure_index": true
          },
          "require_field_count": "headers_or_headers_plus_1_if_leading_index"
        },
        "title": "Competitor Shops CSV"
      },
      "similar_keywords_csv": {
        "dialect": {
          "delimiter": ",",
          "doublequote": true,
          "escapechar": null,
          "lineterminator": [
            "\r\n",
            "\n",
            "\r"
          ],
          "quotechar": "\""
        },
        "encoding_candidates": [
          "utf-8-sig",
          "cp1254",
          "iso-8859-9",
          "windows-1254"
        ],
        "headers": [
          "Keyword",
          "Search volume",
          "3mo. change",
          "Competition",
          "Sales",
          "Score",
          "Trend status",
          "Search to competition ratio",
          "Google top of page bid (low range)",
          "Long-tail keyword",
          "Listing age",
          "Length",
          "Google top of page bid (high range)",
          "Google CPC",
          "Google competition level",
          "Google competition index",
          "Etsy tag",
          "Conversion rate",
          "Competition level",
          "Sales per listing",
          "Annual search trend"
        ],
        "preserve": {
          "empty_as_empty_string": true,
          "nan_literal": true,
          "no_auto_type_infer": true,
          "no_trim_inside_quotes": true
        },
        "row_validation": {
          "allow_first_field_unquoted": true,
          "require_field_count": "headers"
        },
        "title": "Similar Keywords CSV"
      },
      "top_listings_csv": {
        "dialect": {
          "delimiter": ",",
          "doublequote": true,
          "escapechar": null,
          "lineterminator": [
            "\r\n",
            "\n",
            "\r"
          ],
          "quotechar": "\""
        },
        "encoding_candidates": [
          "utf-8-sig",
          "cp1254",
          "iso-8859-9",
          "windows-1254"
        ],
        "headers": [
          "Title",
          "Revenue",
          "LQS",
          "Price",
          "Category",
          "Shop",
          "Sales",
          "Monthly sales",
          "Creator",
          "Product creation era",
          "Views",
          "Video",
          "URL",
          "Tag count",
          "Tags",
          "Review rate",
          "Reviews",
          "Review score",
          "Production partners",
          "Processing time",
          "Min processing time",
          "Max processing time",
          "Favorites",
          "Listing age (days)",
          "Personalization required",
          "Creation date",
          "Listing type",
          "Vintage",
          "Supply item",
          "Personalizable",
          "Image count",
          "Free US shipping",
          "Conversion rate",
          "BSR Category",
          "BSR Category (%)",
          "Monthly revenue"
        ],
        "preserve": {
          "empty_as_empty_string": true,
          "nan_literal": true,
          "no_auto_type_infer": true,
          "no_trim_inside_quotes": true
        },
        "row_validation": {
          "leading_index_rule": {
            "drop_leading_index": true,
            "enabled": true,
            "when_mismatch_by_1_and_first_field_is_pure_index": true
          },
          "require_field_count": "headers_or_headers_plus_1_if_leading_index"
        },
        "title": "Popular Products CSV (Top Listings)"
      }
    },
    "csv_triggers": [
      {
        "fail_if_invalid": true,
        "on_upload": true,
        "pattern": "Top_listings*.csv",
        "profile": "top_listings_csv",
        "store_at": "/_runs/<run_id>/csv/top_listings_csv"
      },
      {
        "fail_if_invalid": true,
        "on_upload": true,
        "pattern": "Listings*.csv",
        "profile": "competitor_shops_csv",
        "store_at": "/_runs/<run_id>/csv/top_listings_csv"
      },
      {
        "fail_if_invalid": true,
        "on_upload": true,
        "pattern": "Similar_keywords*.csv",
        "profile": "similar_keywords_csv",
        "store_at": "/_runs/<run_id>/csv/similar_keywords_csv"
      },
      {
        "fail_if_invalid": true,
        "on_upload": true,
        "pattern": "Competitor*.csv",
        "profile": "competitor_shops_csv",
        "store_at": "/_runs/<run_id>/csv/competitor_shops_csv"
      },
      {
        "fail_if_invalid": true,
        "on_upload": true,
        "pattern": "Rakip*.csv",
        "profile": "competitor_shops_csv",
        "store_at": "/_runs/<run_id>/csv/competitor_shops_csv"
      }
    ],
    "enforce_on_finalize": true,
    "guard": {
      "enforce_on_pre_run": true,
      "mandatory_fields": {
        "step_0": [
          "constraints",
          "description",
          "flow",
          "gates",
          "hitl_contract",
          "name",
          "next",
          "outputs",
          "preconditions",
          "product_info",
          "requires",
          "ruleset",
          "title",
          "ui",
          "upstream_signature",
          "user_task",
          "validations"
        ]
      }
    },
    "reactivation_guard": true
  },
  "precommit_checks": {
    "apply_step_validators": true
  },
  "preprocessing_policy": {
    "apply_to_steps": [
      "3",
      "4",
      "6"
    ],
    "auto_run_before_analysis": true,
    "emit_artifacts": false,
    "on_anomaly": "abort_with_short_message",
    "silent_mode": true,
    "write_anomaly_report": [
      "logs",
      "preprocessing_anomalies.json"
    ]
  },
  "product_info_index": {
    "ref": "workflow_patches.steps.0.product_info"
  },
  "product_record": {
    "colors": [
      "yellow",
      "white",
      "rose"
    ],
    "discount_policy": {
      "display": false,
      "percent": 30
    },
    "karats": [
      "10K",
      "14K",
      "18K"
    ],
    "materials": [
      "solid_gold"
    ],
    "notes": [],
    "pricing_by_karat": {
      "10K": 450,
      "14K": 750,
      "18K": 1200
    },
    "product_fixed": {
      "colors": [
        "Yellow Gold",
        "White Gold",
        "Rose Gold"
      ],
      "discount": {
        "value": "30%",
        "visible_in_outputs": false
      },
      "sizes": "US 4 – 14¾",
      "stone_info": {
        "ai_inference": "Görsel analiz ≥90% güven ile tahmin edilirse üretimde kullanılır",
        "user_input": "Varsa kullanıcı bildiriyor"
      },
      "variation_prices": {
        "10K": "xxx USD",
        "14K": "xxx USD",
        "18K": "xxx USD"
      }
    },
    "shop_logistics": {
      "customs_note": "Satıcı gümrük vergisini öder",
      "delivery_time": "2–5 iş günü",
      "dispatch_origin": "Türkiye",
      "packaging": "Özel kutu + hediye notu eklenebilir",
      "processing_time": "1–3 iş günü",
      "shipping_fee": "Ücretsiz kargo",
      "shipping_profile": "LUXURYJEWELERY",
      "ships_to": [
        "Canada",
        "ABD",
        "Almanya",
        "İngiltere",
        "Fransa"
      ],
      "tracking": true,
      "returns": {
        "policy_days": 15,
        "personalized_exception": true
      }
    },
    "sizes_us": [
      "4",
      "4.5",
      "5",
      "5.5",
      "6",
      "6.5",
      "7",
      "7.5",
      "8",
      "8.5",
      "9",
      "9.5",
      "10",
      "10.5",
      "11",
      "11.5",
      "12",
      "12.5",
      "13",
      "13.5",
      "14",
      "14¾"
    ],
    "status": "PENDING",
    "stone_policy": {
      "default": "none",
      "source": [
        "user",
        "vision>=0.90"
      ]
    },
    "type": "ring"
  },
  "production_policy": {
    "advance_only_if": [
      "user_done",
      "gpt_done",
      "validations_ok"
    ],
    "block_on_compliance_fail": true,
    "block_on_qc_fail": true,
    "deny_unlisted_next": true,
    "during_run_suggestions": "forbidden",
    "entrypoint": "0",
    "no_unsolicited_suggestions": true,
    "publish_mode": "publish_or_draft",
    "record_type_decision_step": "16",
    "reject_alt_filenames": true,
    "respect_user_override_only": true,
    "single_filename_only": true
  },
  "records": {
    "examples": {
      "example_minimal_bypass_ring_2025-09-08": {
        "created_at": "2025-09-08T20:52:39Z",
        "decided_at_step": "16",
        "record_type": "publish",
        "steps_summary": {
          "0": {
            "product_static": {
              "variation_prices": {
                "10K": "650 USD",
                "14K": "780 USD",
                "18K": "1100 USD"
              }
            },
            "status": "PASS"
          },
          "1": {
            "images": [
              ".../il_fullxfull_LE_upscale_gentle_x2.jpg",
              "...(x2..x5).jpg"
            ],
            "status": "PASS"
          },
          "10": {
            "title": "Minimalist Bypass Engagement Ring — Yellow/White/Rose Gold, Solitaire Look"
          },
          "12": {
            "tags": [
              "engagement ring",
              "bypass ring",
              "solitaire ring",
              "minimalist ring",
              "simple gold ring",
              "yellow gold ring",
              "white gold ring",
              "rose gold ring",
              "petite ring",
              "stacking ring",
              "promise ring",
              "wedding ring",
              "ring"
            ]
          },
          "15": {
            "ads_sync": {
              "status": "PASS"
            }
          },
          "16": {
            "listing": {
              "status": "PASS"
            }
          },
          "17": {
            "export": {
              "generated": true
            }
          },
          "18": {
            "checklist": {
              "status": "READY"
            }
          },
          "1b": {
            "suggestions": [
              "leaf ring",
              "bypass ring",
              "gold solitaire",
              "dainty ring",
              "nature band",
              "knot ring",
              "leaf solitaire",
              "minimalist ring"
            ]
          },
          "3a": {
            "focus_keywords": [
              "engagement ring",
              "infinity ring",
              "tungsten ring",
              "pearl ring"
            ]
          },
          "3b": {
            "description": "Zarif bypass formunda, minimalist çizgide bir “solitaire look” tasarım...",
            "tags": [
              "engagement ring",
              "bypass ring",
              "solitaire ring",
              "minimalist ring",
              "simple gold ring",
              "yellow gold ring",
              "white gold ring",
              "rose gold ring",
              "petite ring",
              "stacking ring",
              "promise ring",
              "wedding ring",
              "ring"
            ],
            "title": "Minimalist Gold Bypass Engagement Ring — Solitaire Look, Yellow/White/Rose Gold"
          },
          "4": {
            "status": "DONE"
          },
          "5": {
            "status": "DONE"
          },
          "5a": {
            "selected_shops": [
              "CraftsByAden",
              "Aquamarise",
              "LoveSuna",
              "BrielleShoppe"
            ]
          },
          "6": {
            "status": "DONE"
          },
          "6a": {
            "status": "DONE"
          },
          "8": {
            "terms_top20": [
              "rose gold ring",
              "wedding ring",
              "engagement ring",
              "yellow gold ring",
              "promise ring",
              "white gold ring",
              "simple gold ring",
              "tungsten ring",
              "ring set",
              "diamond ring",
              "vintage ring",
              "leaf ring",
              "name ring",
              "pearl ring",
              "dainty ring",
              "mens ring",
              "minimalist ring",
              "infinity ring",
              "stacking ring",
              "onyx ring"
            ]
          },
          "8a": {
            "keywords_top": [
              "wedding ring",
              "engagement ring",
              "promise ring",
              "rose gold ring",
              "yellow gold ring",
              "white gold ring",
              "simple gold ring",
              "tungsten ring"
            ]
          },
          "9": {
            "refined_keywords": [
              "engagement ring",
              "infinity ring",
              "tungsten ring",
              "pearl ring",
              "wedding ring",
              "promise ring",
              "rose gold ring",
              "yellow gold ring",
              "white gold ring",
              "simple gold ring",
              "ring set",
              "vintage ring",
              "leaf ring",
              "name ring",
              "dainty ring",
              "mens ring",
              "minimalist ring",
              "diamond ring",
              "onyx ring",
              "stacking ring"
            ]
          }
        }
      }
    }
  },
  "render": {
    "defaults": {
      "deterministic": true,
      "layout": "stable",
      "tie_breaker": "fixed_order"
    }
  },
  "run_policy": {
    "ask_inputs_on_start": false,
    "defaults": {
      "no_skip": true,
      "on_violation": "block",
      "show_rule_check": true
    },
    "enforce_no_skip": true,
    "enforce_requires": true,
    "enforce_task_completion": true,
    "require_at_step": true,
    "stop_on_fail": true,
    "strict_sequential": true
  },
  "runtime": {
    "alerts": {
      "pending": []
    },
    "batch": {
      "counter": 0,
      "deadline_at": "2025-09-04T20:23:07Z",
      "last_increment_at": null,
      "started_at": "2025-09-04T19:23:07Z",
      "status": {
        "counter": 0,
        "deadline_at": "2025-09-04T20:23:07Z",
        "minutes_left": 60
      }
    },
    "last_restore_ack": true,
    "last_restore_ack_at": "2025-09-05T08:04:37",
    "queue_workers": [
      {
        "actions": [
          {
            "do": [
              {
                "action": "digest.emit",
                "level": "info",
                "message": "STEP 0: preflight/bootstrap başlatılıyor ve kullanıcıya gösteriliyor"
              },
              {
                "action": "audit.append",
                "record": {
                  "at": "$$now",
                  "by": "queue_worker",
                  "op": "STEP_0_STARTED",
                  "step_id": 0
                }
              },
              {
                "action": "orchestrator.start",
                "with": {
                  "env": "$payload.env",
                  "execution_order_ref": "/workflow_enforcement/execution_order",
                  "run_id": "$payload.run_id"
                }
              }
            ],
            "when": "true"
          }
        ],
        "enforcement": {
          "halt_on_violation": true,
          "must_follow_execution_order": true
        },
        "name": "production_runs_worker",
        "triggers": [
          "production_runs"
        ]
      }
    ]
  },
  "safety": {
    "created_at_utc": "2025-09-10T19:28:11Z",
    "fingerprints": {
      "/_policy": "3379088e25e46db1c69fdd3253ab3cc6ed9d1fcf59d60a128919016258c7be99",
      "/similar_keywords": "e38fb169edf0887d1913cbd40074520860ee4f58581600f18632b809e2a27b24",
      "/token_tracking": "4177b2ad6b9488f8b831b77e0ed5b25414eb5fa5948b296a89dda4b84facebf4",
      "/top_listings": "435367a326a34fcdb9bb368d284cb493febb570ca3d0c82a8b00938c6ed92381"
    },
    "notes": "FINAL BACKUP: working with safety; includes user-requireds update and guards.",
    "original_sha256": "7df799b487935748887f148a3d5c04830ff266283fe18f0f0908ec9542fa115e",
    "policy_patch_note_behavioral": "Converted model-only behaviors into explicit policies/validators/UI directives.",
    "policy_patch_note_context": "Context enforcement: every step must consume all previous outputs (mandatory).",
    "policy_patch_note_focus": "Step 3a stricter: product-intent include, promo exclude, category alignment, similarity ≤0.80.",
    "policy_patch_note_size_guard": "Added security.size_shrink_guard (block & request approval on any shrink).",
    "policy_patch_note_ui_skip_mutation": "Added skip_forbidden, no_mutation_during_run, UI rules; Step0 verbatim required; core validators; await_user default.",
    "policy_patched_at_utc": "2025-09-11T16:50:30Z",
    "resealed_at_utc": "2025-09-11T05:34:53Z",
    "versioning": {
      "commit_id": "manual-1757527298",
      "created_at_utc": "2025-09-10T18:01:38Z",
      "note": "HARDENED: freeze data subtrees; allow only step/run_order/ui edits"
    },
    "working_sha256": "ab0ad8f0a7294f32b2e697174bd646de55a9cc89ed68f60044c061f064c8528d"
  },
  "schema_version": "1.0.0",
  "shop_profile": {
    "destinations": [
      "CA",
      "US",
      "DE",
      "UK",
      "FR"
    ],
    "duty_payer": "seller",
    "handling_days": [
      1,
      3
    ],
    "packaging": {
      "box": true,
      "gift_note": true
    },
    "shipping_fee": 0,
    "shipping_profile": "LUXURYJEWELERY",
    "sla_days": [
      2,
      5
    ],
    "tracking": true
  },
  "source_conflict_resolution": {
    "key": [
      "URL",
      "Title"
    ],
    "merge": {
      "prefer_non_empty": true,
      "strategy": "fill_missing_only"
    },
    "notes": "Aynı ürün farklı csv'lerden gelirse URL eşleşmesi öncelikli. URL boşsa Title eşitliği ikincil eşleşme olarak kullanılır.",
    "priority": [
      "top_listings",
      "competitor_listings",
      "similar_keywords"
    ],
    "when_conflict": "keep_higher_revenue_if_available_else_first"
  },
  "step_params": {
    "1.b": {
      "dedupe": true,
      "grouping": {
        "enabled": true,
        "max_groups": 4
      },
      "max_words": 2,
      "min_words": 2,
      "post_processing": {
        "ban_derivation": true,
        "min_segments": 3,
        "negative_terms": [
          "DIY",
          "free",
          "tutorial",
          "plated*",
          "kit",
          "supplies",
          "raw*"
        ],
        "segment_spread": {
          "optional": [
            "gemstone",
            "style_aesthetic",
            "color_tone",
            "price_intent"
          ],
          "required": [
            "material_finish",
            "use_case_occasion",
            "audience_gift"
          ]
        },
        "semantic_dedupe": true
      },
      "suggestion_count": 8
    }
  },
  "step_title_lock": {
    "enabled": true
  },
  "steps": {
    "0": {
      "constraints": {
        "must_confirm": true,
        "no_skip": true,
        "require_gpt_task": false,
        "require_user_task": true,
        "require_validations_pass": false
      },
      "description": "product_record kaydını ekranda gösterir; veri tek kaynaktan okunur.",
      "enabled": true,
      "enforcement": {
        "no_skip": true,
        "on_violation": "block"
      },
      "flow": {
        "guard": {
          "advance_only_if": [
            "gates_pass"
          ]
        },
        "on_success_next": "00"
      },
      "gates": {
        "must": [
          "validations_ok"
        ],
        "on_contract_violation": "halt_and_report",
        "on_miss": "halt",
        "on_missing_required_path": "halt_and_report",
        "on_soft_misalignment": "warn_and_continue"
      },
      "hitl_contract": {
        "gpt_tasks": [],
        "user_tasks": []
      },
      "name": "Product Info (read-only)",
      "next": [
        "00"
      ],
      "outputs": {
        "review_confirmed": true,
        "step0_review_confirmed": false,
        "user_changes": {
          "fields": {},
          "notes": ""
        }
      },
      "preconditions": {
        "critical_pass": {
          "require_ancestors_done": [
            "0",
            "1",
            "3",
            "4",
            "6",
            "16"
          ]
        }
      },
      "product_info": {
        "fixed_product": {
          "colors": [
            "Yellow Gold",
            "White Gold",
            "Rose Gold"
          ],
          "discount_percent_hidden": 30,
          "sizes_us": "4–14¾",
          "stone_policy": {
            "provided_by_user": true,
            "use_gpt_visual_inference_if_confidence_gte": 0.9
          },
          "variations": [
            {
              "karat": "10K",
              "price_usd": "450"
            },
            {
              "karat": "14K",
              "price_usd": "750"
            },
            {
              "karat": "18K",
              "price_usd": "1200"
            }
          ]
        },
        "logistics": {
          "customs_duties_payer": "seller",
          "delivery_estimate_business_days": {
            "max": 5,
            "min": 2
          },
          "destinations": [
            "Canada",
            "United States",
            "Germany",
            "United Kingdom",
            "France"
          ],
          "handling_time_business_days": {
            "max": 3,
            "min": 1
          },
          "origin_country": "Türkiye",
          "packaging": "Özel kutu + hediye notu eklenebilir.",
          "shipping_fee": "Ücretsiz kargo",
          "shipping_profile": "LUXURYJEWELERY",
          "tracking": true,
          "returns": {
            "policy_days": 15,
            "notes": "İade: 15 gün (kişiselleştirme istisnası olabilir)."
          }
        }
      },
      "requires": [],
      "ruleset": [
        {
          "id": "REQUIRE_PRODUCT_RECORD_PRESENT",
          "params": {}
        },
        {
          "id": "DISPLAY_PRODUCT_RECORD_SUMMARY",
          "params": {
            "source": "product_record"
          }
        },
        {
          "id": "BLOCK_IF_MISSING",
          "params": {}
        }
      ],
      "summary": {
        "colors": [
          "Yellow Gold",
          "White Gold",
          "Rose Gold"
        ],
        "currency": null,
        "customs_note": "Satıcı gümrük vergisini öder",
        "delivery_window_business_days": {
          "max": 5,
          "min": 2
        },
        "discount_percent_hidden": 30,
        "free_shipping": null,
        "packaging": "Özel kutu + hediye notu eklenebilir",
        "processing_time": "1–3 iş günü",
        "ship_to_countries": [
          "CA",
          "US",
          "DE",
          "GB",
          "FR"
        ],
        "sizes": "US 4 – 14¾",
        "tracking": true,
        "variation_prices": {
          "10K": "xxx USD",
          "14K": "xxx USD",
          "18K": "xxx USD"
        },
        "returns": "İade: 15 gün (kişiselleştirme istisna)."
      },
      "title": "Product Info (read-only) — Kullanıcı Onayı",
      "ui": {
        "review_paths": [
          "/_product_static/colors",
          "/_product_static/discount",
          "/_product_static/ring_sizes_us",
          "/_product_static/stone_policy",
          "/_product_static/variation_prices",
          "/_store_profile/*"
        ],
        "title": "Ön İnceleme (Step 0)",
        "force_visible": true,
        "show": {
          "mode": "full"
        },
        "help": "Bu sayfa Product Info’nun tam görünümüdür. Değişiklik yoksa HAYIR yazın; varsa EVET ve alan=değer şeklinde belirtin.",
        "hidden": false
      },
      "ui_directives": {
        "force_visible": true,
        "hidden": false,
        "show": [
          "summary",
          "rule_check"
        ]
      },
      "upstream_signature": {
        "policy": "mark_stale_on_upstream_change"
      },
      "user_task": {
        "confirm": "review_confirmed",
        "read": [
          "product_info.logistics",
          "product_info.fixed_product"
        ]
      },
      "validations": {
        "require_not_null": {
          "fields": [
            "processing_time",
            "packaging",
            "customs_note",
            "ship_to_countries",
            "delivery_window_business_days",
            "tracking",
            "colors",
            "sizes",
            "variation_prices",
            "currency",
            "discount_percent_hidden"
          ],
          "on_fail": {
            "action": "block",
            "message": "Product Info eksik — eksiksiz görünmeden üretim başlatılamaz."
          }
        },
        "review_confirmed_is_true": {
          "equals": true,
          "field": "outputs.review_confirmed"
        }
      }
    },
    "00": {
      "constraints": {
        "must_confirm": false,
        "no_skip": true,
        "require_gpt_task": true,
        "require_user_task": false,
        "require_validations_pass": true,
        "status_values": [
          "PASS",
          "FAIL"
        ]
      },
      "description": "Patch sonrası otomatik doğrulama: required_rule_ids ve required_requires kontrolü. PASS değilse kritik akışlar durur.",
      "flow": {
        "guard": {
          "advance_only_if": [
            "gates_pass"
          ]
        }
      },
      "gates": {
        "must": [
          "validations_ok"
        ],
        "on_contract_violation": "halt_and_report",
        "on_miss": "halt",
        "on_missing_required_path": "halt_and_report",
        "on_soft_misalignment": "warn_and_continue",
        "on_validation_fail": "halt_and_report"
      },
      "hitl_contract": {
        "gpt_tasks": [],
        "user_tasks": []
      },
      "inputs": [
        "workflow_patches.steps{}",
        "workflow_patches.governance.required_rule_ids{}",
        "workflow_patches.governance.required_requires{}"
      ],
      "name": "Self-Check (arka planda)",
      "next": [
        "0a"
      ],
      "notes": {
        "hardened_at": "2025-09-08T20:59:54.302900Z"
      },
      "outputs": [
        "self_check.report{}",
        "self_check.missing[]",
        "self_check.status",
        "self_check.timestamp"
      ],
      "preconditions": {
        "critical_pass": {
          "require_ancestors_done": [
            "0",
            "1",
            "3",
            "4",
            "6",
            "16"
          ]
        }
      },
      "requires": [
        "0"
      ],
      "rules": [
        "validate each step has all required ruleset IDs",
        "validate each step has required 'requires' deps (e.g., 0a for CSV-driven steps)",
        "produce a detailed report of missing IDs/deps",
        "self_check.status = PASS if no issues else FAIL"
      ],
      "ruleset": [
        {
          "id": "CHECK_REQUIRED_RULE_IDS",
          "params": {
            "source": "governance.required_rule_ids"
          }
        },
        {
          "id": "CHECK_REQUIRED_REQUIRES",
          "params": {
            "source": "governance.required_requires"
          }
        },
        {
          "id": "SELF_CHECK_STATUS_VALUES",
          "params": {
            "values": [
              "PASS",
              "FAIL"
            ]
          }
        },
        {
          "id": "SAFE_COOLDOWN_ENFORCED",
          "params": {}
        },
        {
          "id": "SAFE_CHECKPOINT_ENFORCED",
          "params": {}
        },
        {
          "id": "SAFE_REQUIRE_FILENAME_SHA_MATCH",
          "params": {}
        },
        {
          "id": "SAFE_BLOCK_ON_SUSPECT",
          "params": {}
        },
        {
          "id": "MUTATION_POLICY_BLOCK",
          "params": {}
        },
        {
          "id": "MANIFEST_LOCK_ENFORCER",
          "params": {}
        },
        {
          "id": "INVARIANTS_ENFORCER",
          "params": {}
        },
        {
          "id": "APPROVAL_GUARD_ENFORCER",
          "params": {}
        },
        {
          "assert": [
            "hard_locks.require_filename",
            "hard_locks.require_sha256"
          ],
          "id": "FILE_LOCK_ENFORCED"
        },
        {
          "assert": [
            "hard_locks.bind_to_session",
            "hard_locks.require_active_session"
          ],
          "id": "SESSION_BIND_ENFORCED"
        }
      ],
      "title": "Sistem Başlatma / Ön Yük",
      "upstream_signature": {
        "policy": "mark_stale_on_upstream_change"
      },
      "validations": {
        "execution_order_defined": true,
        "external_rules_forbidden": true,
        "present": true,
        "source_is_json_only": true
      },
      "ui": {
        "confirm_only": true
      }
    },
    "0a": {
      "constraints": {
        "blocking": false,
        "must_confirm": false,
        "no_skip": true,
        "require_gpt_task": true,
        "require_user_task": false,
        "require_validations_pass": true,
        "status_values": [
          "PASS",
          "WARN",
          "FAIL"
        ]
      },
      "description": "Her CSV türü için analizden önce daima çalışan, bloklamayan temizlik ve standardizasyon.",
      "flow": {
        "guard": {
          "advance_only_if": [
            "gates_pass"
          ]
        }
      },
      "gates": {
        "must": [
          "validations_ok"
        ],
        "on_contract_violation": "halt_and_report",
        "on_miss": "halt",
        "on_missing_required_field": "halt_and_request_fix",
        "on_missing_required_path": "halt_and_report",
        "on_soft_misalignment": "warn_and_continue",
        "on_validation_fail": "halt_and_report"
      },
      "hitl_contract": {
        "gpt_tasks": [],
        "user_tasks": []
      },
      "inputs": [
        "csv.input"
      ],
      "name": "Pre-Run Prep (Light, arka planda)",
      "next": [
        "1",
        "3",
        "6"
      ],
      "notes": {
        "hardened_at": "2025-09-08T20:59:54.303204Z"
      },
      "outputs": [
        "csv.prep.output",
        "prep.report{}",
        "prep.issues[]",
        "prep.status",
        "prep.stats{}"
      ],
      "preconditions": {
        "critical_pass": {
          "require_ancestors_done": [
            "0",
            "1",
            "3",
            "4",
            "6",
            "16"
          ]
        },
        "parent_defined": {
          "exists": true,
          "path": "/workflow_patches/steps/0"
        },
        "step0_review_confirmed": {
          "equals": true,
          "path": "/workflow_patches/steps/0/outputs/review_confirmed"
        }
      },
      "requires": [
        "00"
      ],
      "rules": [
        "always-run: true",
        "non-blocking: true (only WARN, never BLOCK)",
        "auto-fix encoding (UTF-8), newline normalize (\\n), trim",
        "type-specific header/field mappers",
        "dedupe (case/diacritics insensitive)",
        "tags split normalize (',',';','|') -> ','",
        "numeric normalize (comma as decimal)",
        "warn on missing critical fields per type; auto-skip row but continue",
        "produce prep.report{}, prep.issues[], prep.stats{rows_in, rows_out, skipped, fixed}"
      ],
      "ruleset": [
        {
          "id": "ALWAYS_RUN",
          "params": {
            "enforced": true
          }
        },
        {
          "id": "NON_BLOCKING",
          "params": {
            "warn_only": true
          }
        },
        {
          "id": "ENCODING_NORMALIZE",
          "params": {
            "encoding": "UTF-8",
            "newline": "\\n"
          }
        },
        {
          "id": "TRIM_LOWER_PUNCT_NORMALIZE",
          "params": {
            "enabled": true
          }
        },
        {
          "id": "DEDUPE_POLICY",
          "params": {
            "case_insensitive": true,
            "diacritics_insensitive": true
          }
        },
        {
          "id": "TAGS_SPLIT_NORMALIZE",
          "params": {
            "delims": [
              ",",
              ";",
              "|"
            ],
            "target": ","
          }
        },
        {
          "id": "NUMERIC_NORMALIZE",
          "params": {
            "comma_as_decimal": true
          }
        },
        {
          "id": "WARN_MISSING_CRITICAL",
          "params": {
            "fields": {
              "competitor": [
                "shop_name",
                "shop_url"
              ],
              "top_listings": [
                "title",
                "tags"
              ]
            }
          }
        },
        {
          "id": "REPORT_FIELDS",
          "params": {
            "include": [
              "rows_in",
              "rows_out",
              "skipped",
              "fixed"
            ]
          }
        }
      ],
      "title": "Ortam Kontrolleri",
      "upstream_signature": {
        "policy": "mark_stale_on_upstream_change"
      },
      "validations": {
        "colors_defined": {
          "min_len": 3,
          "path": "/_product_static/colors"
        },
        "present": true,
        "product_material_present": {
          "path": "/_product_static/material",
          "required": true
        },
        "variation_prices_complete": {
          "paths": [
            "/_product_static/variation_prices/10K",
            "/_product_static/variation_prices/14K",
            "/_product_static/variation_prices/18K"
          ],
          "required_all": true
        }
      }
    },
    "1": {
      "artifacts": [
        "media.manifest.json",
        "media.qc.report.json"
      ],
      "constraints": {
        "must_confirm": false,
        "no_skip": true,
        "require_gpt_task": false,
        "require_user_task": false,
        "require_validations_pass": true
      },
      "description": "Ürün fotoğrafları ve varsa ürün videosu sisteme yüklenir. Dosya tipleri, çözünürlük ve oran kontrolleri yapılır; başarılı olanlar ürün varlık deposuna kaydedilir.",
      "flow": {
        "guard": {
          "advance_only_if": [
            "gates_pass"
          ]
        },
        "on_fail": "halt",
        "on_success_next": "1a"
      },
      "gates": {
        "must": [
          "validations_ok"
        ],
        "on_contract_violation": "halt_and_report",
        "on_miss": "halt",
        "on_missing_required_path": "halt_and_report",
        "on_soft_misalignment": "warn_and_continue"
      },
      "hitl_contract": {
        "gpt_tasks": [
          "EXIF ve boyut kontrolü yap; geçersizleri uyar."
        ],
        "user_tasks": [
          "Görselleri (JPG/PNG/WEBP) yükle (1-20 adet)."
        ]
      },
      "id": "1",
      "inputs": [
        "user.upload.photos[]?",
        "user.upload.video?"
      ],
      "name": "Görsel Yükleme",
      "next": [
        "1a"
      ],
      "on_error": {
        "fallback_next": [],
        "policy": "fail-soft"
      },
      "outputs": [
        "product.photos[]",
        "product.video?"
      ],
      "preconditions": {
        "critical_pass": {
          "require_ancestors_done": [
            "0",
            "1",
            "3",
            "4",
            "6",
            "16"
          ]
        }
      },
      "requires": [
        "0a"
      ],
      "title": "Görsel Yükleme",
      "type": "upload_images",
      "ui": {
        "accept": [
          ".jpg",
          ".jpeg",
          ".png",
          ".webp"
        ],
        "help": "JPG, PNG veya WEBP yükleyin. En az 1, en fazla 20 görsel.",
        "max_files": 20,
        "max_size_mb": 25,
        "min_files": 1,
        "title": "Görselleri Yükle"
      },
      "upstream_signature": {
        "policy": "mark_stale_on_upstream_change"
      },
      "validation": {
        "required": true,
        "rules": [
          {
            "id": "IMG_COUNT_MIN",
            "params": {
              "min": 1
            }
          },
          {
            "id": "IMG_DIM_MIN",
            "params": {
              "min_height": 512,
              "min_width": 512
            }
          },
          {
            "id": "IMG_FORMAT",
            "params": {
              "allow": [
                "jpg",
                "jpeg",
                "png",
                "webp"
              ]
            }
          }
        ]
      },
      "validations": {
        "photos.max_files": 10,
        "photos.mime": [
          "image/jpeg",
          "image/png",
          "image/webp"
        ],
        "photos.min_resolution": "1200x1200",
        "video.max_duration_sec": 60,
        "video.mime": [
          "video/mp4",
          "video/quicktime"
        ]
      },
      "value_handling": {
        "cast_all_as_text": true,
        "normalize_yes_no": true,
        "treat_empty_as_valid": true,
        "treat_nan_as_empty": true
      }
    },
    "10": {
      "constraints": {
        "must_confirm": false,
        "no_skip": true,
        "require_gpt_task": false,
        "require_user_task": false,
        "require_validations_pass": false
      },
      "description": "Odak/support keywordler, ürün attribute'ları ve mağaza sesi ile SEO uyumlu başlık oluşturulur.",
      "flow": {
        "guard": {
          "advance_only_if": [
            "gates_pass"
          ]
        }
      },
      "gates": {
        "must": [
          "validations_ok"
        ],
        "on_contract_violation": "halt_and_report",
        "on_miss": "halt",
        "on_missing_required_path": "halt_and_report",
        "on_soft_misalignment": "auto_fix_and_continue"
      },
      "guards": {
        "title_repetition": {
          "max_repeat": 2
        }
      },
      "hitl_contract": {
        "gpt_tasks": [],
        "user_tasks": []
      },
      "inputs": [
        "keywords.focus[1..4]",
        "seo.keywords.supporting[]",
        "product.info{}",
        "shop.profile{}"
      ],
      "name": "Başlık (Title)",
      "outputs": [
        "title.final"
      ],
      "preconditions": {
        "critical_pass": {
          "require_ancestors_done": [
            "0",
            "1",
            "3",
            "4",
            "6",
            "16"
          ]
        }
      },
      "requires": [
        "7"
      ],
      "rules": [
        "title length: 80-140 chars (optimum 110-130)",
        "first 30-40 chars must include focus_1",
        "slots: focus keyword, 1 product attribute, 1 occasion/audience, optional brand voice",
        "no stuffing, no ALL CAPS",
        "forbidden terms: ['Turkey','Istanbul']"
      ],
      "ruleset": [
        {
          "id": "TITLE_FRONTLOAD",
          "params": {
            "first_chars": 40
          }
        },
        {
          "id": "TITLE_LENGTH_RANGE",
          "params": {
            "max": 140,
            "min": 80
          }
        },
        {
          "id": "TITLE_REQUIRE_ATTRIBUTE",
          "params": {
            "required": true
          }
        },
        {
          "id": "TITLE_REQUIRE_OCCASION_OR_AUDIENCE",
          "params": {
            "required": true
          }
        },
        {
          "id": "TITLE_FORBIDDEN_TERMS",
          "params": {
            "terms": [
              "Turkey",
              "Istanbul"
            ]
          }
        },
        {
          "id": "TITLE_NO_STUFFING_ALLCAPS",
          "params": {
            "enforced": true
          }
        },
        {
          "id": "PRODUCT_RECORD_CONFIRMED_REQUIRED",
          "params": {
            "source": "product_record",
            "status": "CONFIRMED"
          }
        }
      ],
      "title": "SEO Title Generation",
      "ui_directives": {
        "readonly": true
      },
      "upstream_signature": {
        "policy": "mark_stale_on_upstream_change"
      },
      "validations": {
        "present": true
      },
      "ui": {
        "show": {
          "mode": "summary"
        },
        "bindings": {
          "summary": "/steps/10/outputs/summary"
        }
      }
    },
    "11": {
      "constraints": {
        "must_confirm": false,
        "no_skip": true,
        "require_gpt_task": false,
        "require_user_task": false,
        "require_validations_pass": false
      },
      "description": "Ürün bilgileri ve mağaza sabitleriyle desteklenmiş, SEO uyumlu açıklama oluşturulur.",
      "flow": {
        "guard": {
          "advance_only_if": [
            "gates_pass"
          ]
        }
      },
      "gates": {
        "must": [
          "validations_ok"
        ],
        "on_contract_violation": "halt_and_report",
        "on_miss": "halt",
        "on_missing_required_path": "halt_and_report",
        "on_soft_misalignment": "auto_fix_and_continue"
      },
      "guards": {
        "desc_repetition": {
          "global_max": 5,
          "max_repeat": 3,
          "window": 200
        }
      },
      "hitl_contract": {
        "gpt_tasks": [],
        "user_tasks": []
      },
      "inputs": [
        "draft.title",
        "keywords.focus[]",
        "keywords.supporting[]",
        "product.info{}",
        "shop.profile{}"
      ],
      "inputs_contract": {
        "required_paths": [
          "/workflow_patches/steps/10/outputs/title",
          "/workflow_patches/steps/9/outputs/refined_keywords"
        ],
        "schema": {
          "refined_keywords": {
            "min_items": 10,
            "type": "array"
          },
          "title": {
            "max_len": 140,
            "min_len": 20,
            "type": "string"
          }
        }
      },
      "name": "Açıklama (Description)",
      "outputs": [
        "description.final"
      ],
      "preconditions": {
        "critical_pass": {
          "require_ancestors_done": [
            "0",
            "1",
            "3",
            "4",
            "6",
            "16"
          ]
        },
        "title_required": "/workflow_patches/steps/10/outputs/title"
      },
      "requires": [
        "10"
      ],
      "rules": [
        "length: 300-500 words",
        "paragraphs: 2-5",
        "first sentence includes focus_1 naturally",
        "structure: intro (focus+benefit) -> product details (material, stone, size, options) -> occasion/usage -> care/durability -> shipping/store trust",
        "2-3 supporting keywords included naturally",
        "no stuffing, no duplicate roots",
        "forbidden terms: ['Turkey','Istanbul']"
      ],
      "ruleset": [
        {
          "id": "DESC_WORDCOUNT_RANGE",
          "params": {
            "max": 500,
            "min": 300
          }
        },
        {
          "id": "DESC_PARAGRAPHS_RANGE",
          "params": {
            "max": 5,
            "min": 2
          }
        },
        {
          "id": "DESC_OPENING_HAS_FOCUS",
          "params": {
            "required": true
          }
        },
        {
          "id": "DESC_SUPPORTS_USED_RANGE",
          "params": {
            "max": 3,
            "min": 2
          }
        },
        {
          "id": "DESC_FORBIDDEN_TERMS",
          "params": {
            "terms": [
              "Turkey",
              "Istanbul"
            ]
          }
        },
        {
          "id": "DESC_NO_STUFFING_ROOTDUP",
          "params": {
            "enforced": true
          }
        },
        {
          "id": "PRODUCT_RECORD_CONFIRMED_REQUIRED",
          "params": {
            "source": "product_record",
            "status": "CONFIRMED"
          }
        }
      ],
      "title": "SEO Description Generation",
      "ui_directives": {
        "readonly": true
      },
      "upstream_signature": {
        "depends_on": [
          "/workflow_patches/steps/10/outputs/title",
          "/workflow_patches/steps/9/outputs/refined_keywords"
        ],
        "on_change": "invalidate_and_rerun"
      },
      "validations": {
        "present": true
      },
      "ui": {
        "show": {
          "mode": "summary"
        },
        "bindings": {
          "summary": "/steps/11/outputs/summary"
        }
      }
    },
    "12": {
      "constraints": {
        "must_confirm": false,
        "no_skip": true,
        "require_gpt_task": false,
        "require_user_task": false,
        "require_validations_pass": false
      },
      "description": "SEO, ürün attribute ve mağaza sesi yansıtan 13/13 benzersiz etiket seti oluşturulur.",
      "flow": {
        "guard": {
          "advance_only_if": [
            "gates_pass"
          ]
        }
      },
      "gates": {
        "must": [
          "validations_ok"
        ],
        "on_contract_violation": "halt_and_report",
        "on_miss": "halt",
        "on_missing_required_path": "halt_and_report",
        "on_soft_misalignment": "auto_fix_and_continue"
      },
      "guards": {
        "tags": {
          "count": 13,
          "no_duplicate_roots": true,
          "unique": true
        }
      },
      "hitl_contract": {
        "gpt_tasks": [],
        "user_tasks": []
      },
      "inputs": [
        "keywords.focus[]",
        "keywords.supporting[]",
        "product.info{}",
        "shop.profile{}"
      ],
      "inputs_contract": {
        "required_paths": [
          "/workflow_patches/steps/11/outputs/description",
          "/workflow_patches/steps/9/outputs/refined_keywords"
        ],
        "schema": {
          "tags": {
            "min_items": 10,
            "type": "array"
          }
        }
      },
      "name": "Etiketler (Tags)",
      "outputs": [
        "tags.final[13]"
      ],
      "preconditions": {
        "critical_pass": {
          "require_ancestors_done": [
            "0",
            "1",
            "3",
            "4",
            "6",
            "16"
          ]
        },
        "desc_required": "/workflow_patches/steps/11/outputs/description",
        "title_required": "/workflow_patches/steps/10/outputs/title"
      },
      "requires": [
        "11"
      ],
      "rules": [
        "exactly 13 unique tags",
        "distribution: 4-5 SEO/high-volume, 3-4 product attributes, 2-3 occasion/audience, 1-2 brand voice",
        "no duplicate roots, no attr/category duplicates",
        "negatives forbidden: ['DIY','free','tutorial','plated*','kit','supplies','raw*']",
        "forbidden terms: ['Turkey','Istanbul']"
      ],
      "ruleset": [
        {
          "id": "TAGS_COUNT_13",
          "params": {
            "count": 13
          }
        },
        {
          "id": "TAGS_UNIQUE",
          "params": {
            "required": true
          }
        },
        {
          "id": "SEGMENT_DIVERSITY_MIN",
          "params": {
            "min": 3
          }
        },
        {
          "id": "NO_ATTR_DUPLICATES",
          "params": {
            "required": true
          }
        },
        {
          "id": "SAME_ROOT_LIMIT",
          "params": {
            "max": 1
          }
        },
        {
          "id": "TAGS_FORBIDDEN_TERMS",
          "params": {
            "terms": [
              "Turkey",
              "Istanbul"
            ]
          }
        },
        {
          "id": "NEGATIVE_TERMS",
          "params": {
            "terms": [
              "DIY",
              "free",
              "tutorial",
              "plated*",
              "kit",
              "supplies",
              "raw*"
            ]
          }
        },
        {
          "id": "PRODUCT_RECORD_CONFIRMED_REQUIRED",
          "params": {
            "source": "product_record",
            "status": "CONFIRMED"
          }
        }
      ],
      "soft_influences": {
        "from": [
          "/workflow_patches/steps/8a/outputs/ads_keywords"
        ],
        "policy": "warn_if_misaligned_topN",
        "topN": 10
      },
      "title": "Tags Generation",
      "ui_directives": {
        "readonly": true
      },
      "upstream_signature": {
        "depends_on": [
          "/workflow_patches/steps/11/outputs/description",
          "/workflow_patches/steps/10/outputs/title",
          "/workflow_patches/steps/9/outputs/refined_keywords",
          "/workflow_patches/steps/8a/outputs/ads_keywords"
        ],
        "on_change": "invalidate_and_rerun"
      },
      "validations": {
        "present": true
      },
      "ui": {
        "show": {
          "mode": "summary"
        },
        "bindings": {
          "summary": "/steps/12/outputs/summary"
        }
      }
    },
    "13": {
      "constraints": {
        "must_confirm": false,
        "no_skip": true,
        "require_gpt_task": false,
        "require_user_task": false,
        "require_validations_pass": false
      },
      "flow": {
        "guard": {
          "advance_only_if": [
            "gates_pass"
          ]
        }
      },
      "gates": {
        "must": [
          "validations_ok"
        ],
        "on_contract_violation": "halt_and_report",
        "on_miss": "halt",
        "on_missing_required_path": "halt_and_report",
        "on_soft_misalignment": "warn_and_continue"
      },
      "label": "Görsel QC (moved to 1a, kept as background)",
      "preconditions": {
        "critical_pass": {
          "require_ancestors_done": [
            "0",
            "1",
            "3",
            "4",
            "6",
            "16"
          ]
        }
      },
      "status": "background_only",
      "title": "Kontrol Noktası (Checkpoint)",
      "upstream_signature": {
        "policy": "mark_stale_on_upstream_change"
      },
      "validations": {
        "present": true
      }
    },
    "14": {
      "constraints": {
        "must_confirm": false,
        "no_skip": true,
        "require_gpt_task": false,
        "require_user_task": false,
        "require_validations_pass": false,
        "status_values": [
          "PASS",
          "WARN",
          "FAIL"
        ]
      },
      "description": "Başlık, açıklama, etiketler ve görsellerin Etsy kuralları ve SEO/Ads stratejisi ile uyumunu denetler.",
      "flow": {
        "guard": {
          "advance_only_if": [
            "gates_pass"
          ]
        }
      },
      "gates": {
        "must": [
          "validations_ok"
        ],
        "on_contract_violation": "halt_and_report",
        "on_miss": "halt",
        "on_missing_required_path": "halt_and_report",
        "on_soft_misalignment": "auto_fix_and_continue"
      },
      "hitl_contract": {
        "gpt_tasks": [],
        "user_tasks": []
      },
      "inputs": [
        "title.final",
        "description.final",
        "tags.final[13]",
        "media.checklist",
        "media.issues[]",
        "seo.keywords.focus[]",
        "seo.keywords.supporting[]",
        "ads.keywords.final[]"
      ],
      "name": "Uyumluluk Kontrolü (Compliance)",
      "outputs": [
        "compliance.report{}",
        "compliance.issues[]",
        "compliance.recommendations[]",
        "compliance.status"
      ],
      "preconditions": {
        "critical_pass": {
          "require_ancestors_done": [
            "0",
            "1",
            "3",
            "4",
            "6",
            "16"
          ]
        }
      },
      "requires": [
        "13"
      ],
      "rules": [
        "no banned terms (e.g., brand infringement, Rolex, Disney, etc.)",
        "no ALL CAPS, no spam, no misleading claims (e.g., 'free shipping')",
        "etsy policy compliance: handmade/vintage/supplies classification",
        "SEO-Ads consistency: no conflict between SEO focus/support and Ads plan",
        "visuals must align with attributes and tags",
        "negatives forbidden: ['DIY', 'free', 'tutorial', 'plated*', 'kit', 'supplies', 'raw*', 'Turkey', 'Istanbul']",
        "self_check.status must be PASS"
      ],
      "ruleset": [
        {
          "id": "NO_BANNED_TERMS",
          "params": {
            "examples": [
              "Rolex",
              "Disney"
            ]
          }
        },
        {
          "id": "NO_ALLCAPS_SPAM",
          "params": {
            "enforced": true
          }
        },
        {
          "id": "NO_MISLEADING_CLAIMS",
          "params": {
            "forbidden": [
              "free shipping"
            ]
          }
        },
        {
          "id": "ETSY_POLICY_COMPLIANCE",
          "params": {
            "required": true
          }
        },
        {
          "id": "SEO_ADS_CONSISTENCY",
          "params": {
            "required": true
          }
        },
        {
          "id": "VISUAL_ALIGNMENT",
          "params": {
            "required": true
          }
        },
        {
          "id": "NEGATIVE_TERMS",
          "params": {
            "terms": [
              "DIY",
              "free",
              "tutorial",
              "plated*",
              "kit",
              "supplies",
              "raw*",
              "Turkey",
              "Istanbul"
            ]
          }
        },
        {
          "id": "SPAM_BLOCKS_COMPLIANCE",
          "params": {
            "block_on": "BLOCK"
          }
        },
        {
          "id": "SELF_CHECK_PASS_REQUIRED",
          "params": {
            "status": "PASS"
          }
        },
        {
          "id": "PRODUCT_RECORD_CONFIRMED_REQUIRED",
          "params": {
            "source": "product_record",
            "status": "CONFIRMED"
          }
        },
        {
          "id": "COUNTRY_POLICY_COMPLIANCE",
          "params": {
            "source": "governance.policy.country"
          }
        }
      ],
      "title": "Ara Değerlendirme",
      "upstream_signature": {
        "policy": "mark_stale_on_upstream_change"
      },
      "validations": {
        "present": true
      }
    },
    "15": {
      "constraints": {
        "must_confirm": false,
        "no_skip": true,
        "require_gpt_task": false,
        "require_user_task": false,
        "require_validations_pass": false,
        "status_values": [
          "PASS",
          "WARN",
          "FAIL"
        ]
      },
      "description": "SEO focus/support kelimeleri ile Ads pozitif/negatif setlerini senkronize eder, final seti üretir.",
      "flow": {
        "guard": {
          "advance_only_if": [
            "gates_pass"
          ]
        }
      },
      "gates": {
        "must": [
          "validations_ok"
        ],
        "on_contract_violation": "halt_and_report",
        "on_miss": "halt",
        "on_missing_required_path": "halt_and_report",
        "on_soft_misalignment": "auto_fix_and_continue"
      },
      "hitl_contract": {
        "gpt_tasks": [],
        "user_tasks": []
      },
      "inputs": [
        "seo.keywords.focus[]",
        "seo.keywords.supporting[]",
        "ads.keywords.final[]",
        "ads.negative_terms[]",
        "title.final",
        "description.final",
        "tags.final[13]",
        "compliance.status"
      ],
      "inputs_contract": {
        "required_paths": [
          "/workflow_patches/steps/8a/outputs/ads_keywords",
          "/workflow_patches/steps/9/outputs/refined_keywords"
        ],
        "schema": {
          "ads_keywords": {
            "min_items": 8,
            "type": "array"
          },
          "refined_keywords": {
            "min_items": 10,
            "type": "array"
          }
        }
      },
      "name": "Ads Entegrasyonu & Final Keyword Sync",
      "outputs": [
        "ads_sync.report{}",
        "ads_sync.issues[]",
        "ads_sync.final_positive[]",
        "ads_sync.final_negative[]",
        "ads_sync.status"
      ],
      "preconditions": {
        "ads_keywords_required": "/workflow_patches/steps/8a/outputs/ads_keywords",
        "critical_pass": {
          "require_ancestors_done": [
            "0",
            "1",
            "3",
            "4",
            "6",
            "16"
          ]
        },
        "refined_keywords_required": "/workflow_patches/steps/9/outputs/refined_keywords"
      },
      "requires": [
        "14"
      ],
      "rules": [
        "SEO vs Ads intersection: warn if no overlap",
        "remove SEO keywords that are in Ads negatives",
        "focus_1 must be present in Ads positives",
        "no title/tags keyword should appear in Ads negatives",
        "ads_sync.status = PASS if fully aligned, WARN/FAIL otherwise"
      ],
      "ruleset": [
        {
          "id": "SEO_ADS_INTERSECTION_CHECK",
          "params": {
            "warn_if_empty": true
          }
        },
        {
          "id": "REMOVE_SEO_IF_IN_NEGATIVES",
          "params": {
            "enforced": true
          }
        },
        {
          "id": "FOCUS1_MUST_IN_ADS_POSITIVE",
          "params": {
            "required": true
          }
        },
        {
          "id": "NO_TITLE_TAGS_IN_ADS_NEGATIVES",
          "params": {
            "enforced": true
          }
        },
        {
          "id": "ADS_SYNC_STATUS_VALUES",
          "params": {
            "values": [
              "PASS",
              "WARN",
              "FAIL"
            ]
          }
        },
        {
          "id": "PRODUCT_RECORD_CONFIRMED_REQUIRED",
          "params": {
            "source": "product_record",
            "status": "CONFIRMED"
          }
        }
      ],
      "title": "QA (Uyarı; akışı durdurmaz)",
      "upstream_signature": {
        "depends_on": [
          "/workflow_patches/steps/8a/outputs/ads_keywords",
          "/workflow_patches/steps/9/outputs/refined_keywords"
        ],
        "on_change": "invalidate_and_rerun"
      },
      "validations": {
        "present": true
      }
    },
    "16": {
      "constraints": {
        "must_confirm": false,
        "no_skip": true,
        "require_gpt_task": false,
        "require_user_task": false,
        "require_validations_pass": false,
        "status_values": [
          "PASS",
          "WARN",
          "FAIL"
        ]
      },
      "description": "Önceki adımlardan gelen tüm çıktıları birleştirerek yayına hazır tam ürün listing paketi oluşturur.",
      "flow": {
        "guard": {
          "advance_only_if": [
            "gates_pass"
          ]
        }
      },
      "gates": {
        "must": [
          "validations_ok"
        ],
        "on_contract_violation": "halt_and_report",
        "on_miss": "halt",
        "on_missing_required_path": "halt_and_report",
        "on_soft_misalignment": "auto_fix_and_continue",
        "required_inputs": [
          "title.final",
          "description.final",
          "tags.final[13]",
          "media.checklist",
          "compliance.status",
          "ads_sync.status",
          "seo.keywords.focus[]",
          "seo.keywords.supporting[]",
          "product.info{}",
          "shop.profile{}"
        ]
      },
      "guards": {
        "final_check": "repetition_guard_enforced"
      },
      "hitl_contract": {
        "gpt_tasks": [],
        "user_tasks": []
      },
      "inputs": [
        "title.final",
        "description.final",
        "tags.final[13]",
        "media.checklist",
        "media.qc_report",
        "media.recommendations[]",
        "compliance.status",
        "compliance.issues[]",
        "ads_sync.final_positive[]",
        "ads_sync.final_negative[]",
        "ads_sync.status",
        "seo.keywords.focus[]",
        "seo.keywords.supporting[]",
        "product.info{}",
        "shop.profile{}"
      ],
      "name": "Final Listing Assembly / Publish Prep",
      "outputs": [
        "listing.final{}",
        "listing.issues[]",
        "listing.status",
        "listing.notes"
      ],
      "preconditions": {
        "critical_pass": {
          "require_ancestors_done": [
            "0",
            "1",
            "3",
            "4",
            "6",
            "16"
          ]
        }
      },
      "requires": [
        "10",
        "11",
        "12",
        "13",
        "14",
        "15"
      ],
      "rules": [
        "title length: 80-140 chars",
        "description length: 300-500 words, 2-5 paragraphs",
        "tags: 13 unique",
        "media: at least 5 required types (studio,lifestyle,scale,detail,packaging)",
        "compliance.status must be PASS to publish",
        "ads_sync.status PASS required for full Ads alignment (else WARN)",
        "attributes from product.info must appear in title/description/media",
        "shop.profile info (voice,shipping,gift) must appear in description end",
        "self_check.status must be PASS"
      ],
      "ruleset": [
        {
          "id": "TITLE_LENGTH_RANGE",
          "params": {
            "max": 140,
            "min": 80
          }
        },
        {
          "id": "DESC_WORDCOUNT_RANGE",
          "params": {
            "max": 500,
            "min": 300
          }
        },
        {
          "id": "DESC_PARAGRAPHS_RANGE",
          "params": {
            "max": 5,
            "min": 2
          }
        },
        {
          "id": "TAGS_COUNT_13",
          "params": {
            "count": 13
          }
        },
        {
          "id": "MEDIA_REQUIRED_TYPES",
          "params": {
            "min_count": 5,
            "types": [
              "studio",
              "lifestyle",
              "scale",
              "detail",
              "packaging"
            ]
          }
        },
        {
          "id": "COMPLIANCE_PASS_REQUIRED",
          "params": {
            "status": "PASS"
          }
        },
        {
          "id": "ADS_SYNC_PASS_REQUIRED",
          "params": {
            "warn_if_not_pass": true
          }
        },
        {
          "id": "ATTRIBUTES_MUST_MATCH",
          "params": {
            "required": true
          }
        },
        {
          "id": "SHOP_PROFILE_INTEGRATION",
          "params": {
            "required": true
          }
        },
        {
          "id": "SPAM_BLOCKS_ASSEMBLY",
          "params": {
            "block_on": "BLOCK"
          }
        },
        {
          "id": "SELF_CHECK_PASS_REQUIRED",
          "params": {
            "status": "PASS"
          }
        },
        {
          "id": "PRODUCT_RECORD_CONFIRMED_REQUIRED",
          "params": {
            "source": "product_record",
            "status": "CONFIRMED"
          }
        }
      ],
      "title": "Görsel Analiz & SEO Uyumu",
      "upstream_signature": {
        "policy": "mark_stale_on_upstream_change"
      },
      "validations": {
        "present": true
      },
      "ui": {
        "confirm_only": true
      }
    },
    "17": {
      "constraints": {
        "description_wordcount_range": {
          "max": 500,
          "min": 300
        },
        "media_min_count": 5,
        "min_attributes": [
          "material"
        ],
        "min_shop_profile": [
          "brand_voice"
        ],
        "must_confirm": false,
        "no_skip": true,
        "require_gpt_task": false,
        "require_record_type": "publish",
        "require_user_task": false,
        "require_validations_pass": false,
        "required_columns": [
          "title",
          "description",
          "tags",
          "media",
          "status"
        ],
        "status_values": [
          "PASS",
          "WARN",
          "FAIL"
        ],
        "tags_exact_count": 13
      },
      "description": "Listing.final çıktısını Office 2007 uyumlu CSV formatına dönüştürür.",
      "flow": {
        "guard": {
          "advance_only_if": [
            "gates_pass"
          ]
        }
      },
      "gates": {
        "must": [
          "validations_ok"
        ],
        "on_contract_violation": "halt_and_report",
        "on_miss": "halt",
        "on_missing_required_path": "halt_and_report",
        "on_soft_misalignment": "warn_and_continue"
      },
      "hitl_contract": {
        "gpt_tasks": [],
        "user_tasks": []
      },
      "inputs": [
        "listing.final{}",
        "listing.status",
        "listing.notes"
      ],
      "inputs_contract": {
        "required_paths": [
          "/workflow_patches/steps/16/outputs/listing",
          "/workflow_patches/steps/10/outputs/title",
          "/workflow_patches/steps/11/outputs/description",
          "/workflow_patches/steps/12/outputs/tags"
        ],
        "schema": {
          "export_row": {
            "description": {
              "max_words": 500,
              "min_words": 300,
              "type": "string"
            },
            "media": {
              "min_items": 5,
              "type": "array"
            },
            "tags": {
              "min_items": 13,
              "type": "array"
            },
            "title": {
              "max_len": 140,
              "min_len": 20,
              "type": "string"
            }
          }
        }
      },
      "name": "Export CSV/Excel",
      "output_policy": {
        "display": "file_only",
        "format": [
          "CSV",
          "Excel"
        ]
      },
      "outputs": [
        "export.file_path",
        "export.sha256",
        "export.status",
        "export.notes"
      ],
      "preconditions": {
        "critical_pass": {
          "require_ancestors_done": [
            "0",
            "1",
            "3",
            "4",
            "6",
            "16"
          ]
        },
        "listing_ready": "/workflow_patches/steps/16/outputs/listing",
        "record_type_set": {
          "in": [
            "publish",
            "draft",
            "preview"
          ],
          "path": "/_run/record_type"
        }
      },
      "requires": [
        "16"
      ],
      "rules": [
        "format: CSV UTF-8, Office 2007 uyumlu",
        "row = 1 product",
        "columns: title, description, tags (comma-separated), media (comma-separated), attributes.*, shop_profile.*, status, notes",
        "no empty mandatory fields",
        "file name: listings_export_<timestamp>.csv",
        "compute SHA256 of file",
        "required columns: [title, description, tags, media, status]",
        "attributes: at least material",
        "shop_profile: at least brand_voice",
        "tags must be exactly 13 and unique",
        "media must be >=5 items, must include studio,lifestyle,scale,detail,packaging",
        "description wordcount: 300..500",
        "status must be PASS/WARN/FAIL",
        "csv quoting/escaping strict",
        "split tags and media into fixed columns optional",
        "produce export.report summary: row_count, empty_required_count, warn_rows, fail_rows, sample_issues",
        "fallback to last PASS export if hard failure",
        "self_check.status must be PASS"
      ],
      "ruleset": [
        {
          "id": "EXPORT_FORMAT",
          "params": {
            "compat": "Office2007",
            "encoding": "UTF-8",
            "type": "CSV"
          }
        },
        {
          "id": "ROW_PER_PRODUCT",
          "params": {
            "enforced": true
          }
        },
        {
          "id": "EXPORT_COLUMNS",
          "params": {
            "list": [
              "title",
              "description",
              "tags",
              "media",
              "attributes.*",
              "shop_profile.*",
              "status",
              "notes"
            ]
          }
        },
        {
          "id": "NO_EMPTY_MANDATORY_FIELDS",
          "params": {
            "enforced": true
          }
        },
        {
          "id": "FILENAME_PATTERN",
          "params": {
            "pattern": "listings_export_<timestamp>.csv"
          }
        },
        {
          "id": "SHA256_COMPUTE",
          "params": {
            "enforced": true
          }
        },
        {
          "id": "EXPORT_REQUIRED_COLUMNS",
          "params": {
            "columns": [
              "title",
              "description",
              "tags",
              "media",
              "status"
            ]
          }
        },
        {
          "id": "EXPORT_MIN_ATTRIBUTES",
          "params": {
            "attributes": [
              "material"
            ]
          }
        },
        {
          "id": "EXPORT_MIN_SHOP_PROFILE",
          "params": {
            "fields": [
              "brand_voice"
            ]
          }
        },
        {
          "id": "TAGS_COUNT_EXACT_13",
          "params": {
            "required": true
          }
        },
        {
          "id": "MEDIA_MIN_COUNT",
          "params": {
            "min": 5,
            "required_types": [
              "studio",
              "lifestyle",
              "scale",
              "detail",
              "packaging"
            ]
          }
        },
        {
          "id": "DESCRIPTION_WORDCOUNT_RANGE",
          "params": {
            "max": 500,
            "min": 300
          }
        },
        {
          "id": "EXPORT_STATUS_VALUES",
          "params": {
            "values": [
              "PASS",
              "WARN",
              "FAIL"
            ]
          }
        },
        {
          "id": "CSV_QUOTING_ESCAPING_STRICT",
          "params": {
            "required": true
          }
        },
        {
          "id": "SPLIT_TAGS_MEDIA_COLUMNS",
          "params": {
            "optional": true
          }
        },
        {
          "id": "EXPORT_REPORT_SUMMARY",
          "params": {
            "fields": [
              "row_count",
              "empty_required_count",
              "warn_rows",
              "fail_rows",
              "sample_issues"
            ]
          }
        },
        {
          "id": "EXPORT_FALLBACK_LAST_PASS",
          "params": {
            "enabled": true
          }
        },
        {
          "id": "NO_EMPTY_REQUIRED_FIELDS",
          "params": {
            "enforced": true,
            "on_missing": "WARN"
          }
        },
        {
          "id": "COMPUTE_SHA256",
          "params": {
            "record_to": "export.sha256"
          }
        },
        {
          "id": "MEDIA_MIN_COUNT_5",
          "params": {
            "min": 5,
            "validate_url_or_filename": true
          }
        },
        {
          "id": "EXPORT_SPAM_STATUS_POLICY",
          "params": {
            "allowed": [
              "PASS",
              "WARN"
            ]
          }
        },
        {
          "id": "SELF_CHECK_PASS_REQUIRED",
          "params": {
            "status": "PASS"
          }
        },
        {
          "id": "PRODUCT_RECORD_CONFIRMED_REQUIRED",
          "params": {
            "source": "product_record",
            "status": "CONFIRMED"
          }
        }
      ],
      "title": "İlk 5 + Uyumluluk",
      "upstream_signature": {
        "depends_on": [
          "/workflow_patches/steps/16/outputs/listing",
          "/workflow_patches/steps/10/outputs/title",
          "/workflow_patches/steps/11/outputs/description",
          "/workflow_patches/steps/12/outputs/tags"
        ],
        "on_change": "reexport"
      },
      "validations": {
        "present": true
      },
      "ui_policy_overrides": {
        "allow_preview": false,
        "allow_excel_open": false,
        "allow_pdf_open": false,
        "allow_download_links": true,
        "export_only": true
      }
    },
    "18": {
      "constraints": {
        "must_confirm": false,
        "no_skip": true,
        "require_gpt_task": false,
        "require_record_type": "publish",
        "require_user_task": false,
        "require_validations_pass": false,
        "status_values": [
          "READY",
          "WARN",
          "BLOCK"
        ]
      },
      "description": "Etsy'ye yükleme öncesi go/no-go kontrol listesi ve son onay.",
      "flow": {
        "guard": {
          "advance_only_if": [
            "gates_pass"
          ]
        }
      },
      "gates": {
        "must": [
          "validations_ok"
        ],
        "on_contract_violation": "halt_and_report",
        "on_manifest_mismatch": "halt_and_report",
        "on_miss": "halt",
        "on_missing_required_path": "halt_and_report",
        "on_soft_misalignment": "auto_fix_and_continue"
      },
      "hitl_contract": {
        "gpt_tasks": [],
        "user_tasks": []
      },
      "inputs": [
        "listing.final{}",
        "listing.status",
        "export.file_path",
        "export.sha256",
        "compliance.status",
        "ads_sync.status"
      ],
      "inputs_contract": {
        "required_paths": [
          "/workflow_patches/steps/17/outputs/files"
        ],
        "schema": {
          "files": {
            "min_items": 1,
            "type": "array"
          }
        }
      },
      "manifest": {
        "policy": "hash_and_compare",
        "required_paths": [
          "/workflow_patches/steps/10/outputs/title",
          "/workflow_patches/steps/11/outputs/description",
          "/workflow_patches/steps/12/outputs/tags",
          "/workflow_patches/steps/16/outputs/listing",
          "/workflow_patches/steps/17/outputs/files"
        ]
      },
      "name": "Publish Checklist",
      "outputs": [
        "publish.checklist{}",
        "publish.status",
        "publish.notes"
      ],
      "preconditions": {
        "critical_pass": {
          "require_ancestors_done": [
            "0",
            "1",
            "3",
            "4",
            "6",
            "16"
          ]
        },
        "export_files_exist": "/workflow_patches/steps/17/outputs/files"
      },
      "requires": [
        "17"
      ],
      "rules": [
        "listing.status must be PASS",
        "export.file_path must exist and export.sha256 present",
        "compliance.status must be PASS (else BLOCK)",
        "ads_sync.status PASS preferred; if WARN -> checklist WARN, if FAIL -> BLOCK",
        "self_check.status must be PASS"
      ],
      "ruleset": [
        {
          "id": "LISTING_PASS_REQUIRED",
          "params": {
            "status": "PASS"
          }
        },
        {
          "id": "EXPORT_FILE_AND_HASH_REQUIRED",
          "params": {
            "required": true
          }
        },
        {
          "id": "COMPLIANCE_PASS_REQUIRED",
          "params": {
            "status": "PASS"
          }
        },
        {
          "id": "ADS_SYNC_STATUS_POLICY",
          "params": {
            "fail": "BLOCK",
            "pass": "READY",
            "warn": "WARN"
          }
        },
        {
          "id": "PUBLISH_STATUS_VALUES",
          "params": {
            "values": [
              "READY",
              "WARN",
              "BLOCK"
            ]
          }
        },
        {
          "id": "SELF_CHECK_PASS_REQUIRED",
          "params": {
            "status": "PASS"
          }
        }
      ],
      "title": "Ads Keywords Integration",
      "upstream_signature": {
        "depends_on": [
          "/workflow_patches/steps/17/outputs/files"
        ],
        "on_change": "recheck"
      },
      "validations": {
        "present": true
      }
    },
    "18a": {
      "constraints": {
        "must_confirm": true,
        "no_skip": true
      },
      "enabled": false,
      "gates": {
        "must": [
          "validations_ok"
        ],
        "on_contract_violation": "halt_and_report",
        "on_missing_required_path": "halt_and_report",
        "on_soft_misalignment": "warn_and_continue"
      },
      "gpt_task": {
        "check": [
          "step14.pass==true",
          "step16.ready==true",
          "step17.files_ready==true",
          "step18.checklist_pass==true"
        ]
      },
      "id": "18a",
      "notes": {
        "lifecycle": "manifest-disabled"
      },
      "outputs": {
        "decision_at": null,
        "decision_by": "",
        "publish_go": false,
        "reason_if_no_go": ""
      },
      "preconditions": {
        "critical_pass": {
          "require_ancestors_done": [
            "0",
            "1",
            "3",
            "4",
            "6",
            "16"
          ]
        },
        "parent_defined": {
          "exists": true,
          "path": "/workflow_patches/steps/18"
        }
      },
      "title": "Publish Go/No-Go",
      "ui": {
        "confirm_only": true
      },
      "upstream_signature": {
        "policy": "mark_stale_on_upstream_change"
      },
      "user_task": {
        "confirm": "outputs.publish_go"
      },
      "validations": {
        "all_prior_ok": true
      }
    },
    "19": {
      "constraints": {
        "must_confirm": false,
        "no_skip": true,
        "require_gpt_task": false,
        "require_user_task": false,
        "require_validations_pass": false
      },
      "description": "Yayın sonrası 14–30 gün performans takibi ve aksiyon sinyalleri (Ads + SEO).",
      "flow": {
        "guard": {
          "advance_only_if": [
            "gates_pass"
          ]
        }
      },
      "gates": {
        "must": [
          "validations_ok"
        ],
        "on_contract_violation": "halt_and_report",
        "on_miss": "halt",
        "on_missing_required_path": "halt_and_report",
        "on_soft_misalignment": "auto_fix_and_continue"
      },
      "hitl_contract": {
        "gpt_tasks": [],
        "user_tasks": []
      },
      "inputs": [
        "metrics.ads{ctr,roas,orders,cpc,spend}",
        "metrics.seo{impressions,visits,orders,conv_rate}",
        "ab_test.plan",
        "ads.plan{}",
        "ads_sync.final_positive[]",
        "ads_sync.final_negative[]"
      ],
      "name": "Monitoring",
      "outputs": [
        "monitoring.report{}",
        "monitoring.issues[]",
        "monitoring.recommendations[]"
      ],
      "preconditions": {
        "critical_pass": {
          "require_ancestors_done": [
            "0",
            "1",
            "3",
            "4",
            "6",
            "16"
          ]
        }
      },
      "requires": [
        "18"
      ],
      "rules": [
        "window_days: 14..30",
        "warn if CTR < 1.0% or ROAS < 1.0",
        "boost if Orders >= 3 and ROAS >= target",
        "pause if Clicks >= 20 and ROAS < 1.0",
        "produce actionable recommendations per AdGroup/keyword"
      ],
      "ruleset": [
        {
          "id": "MONITORING_WINDOW_DAYS",
          "params": {
            "max": 30,
            "min": 14
          }
        },
        {
          "id": "WARN_THRESHOLDS",
          "params": {
            "ctr_lt": 0.01,
            "roas_lt": 1.0
          }
        },
        {
          "id": "BOOST_RULE",
          "params": {
            "orders_gte": 3,
            "roas_gte": "target"
          }
        },
        {
          "id": "PAUSE_RULE",
          "params": {
            "clicks_gte": 20,
            "roas_lt": 1.0
          }
        },
        {
          "id": "ACTIONABLE_PER_GROUP",
          "params": {
            "required": true
          }
        }
      ],
      "title": "Market Report",
      "upstream_signature": {
        "policy": "mark_stale_on_upstream_change"
      },
      "validations": {
        "present": true
      }
    },
    "1a": {
      "advisory_pack": {
        "hero_thumbnail": {
          "block": false,
          "rules": {
            "no_text_overlay": true,
            "plain_bg_preferred": true,
            "subject_fill_min": 0.7
          },
          "severity": "advisory"
        },
        "metrics_binding": {
          "block": false,
          "capture": [
            "ctr",
            "engagement"
          ],
          "improvement_note_required": true,
          "severity": "advisory"
        },
        "scale_photo": {
          "block": false,
          "rules": {
            "must_include_scale_indicator": true
          },
          "severity": "advisory"
        },
        "seo_context_photo": {
          "block": false,
          "rules": {
            "must_include_context": [
              "wedding",
              "gift",
              "everyday"
            ]
          },
          "severity": "advisory"
        },
        "video_quality": {
          "block": false,
          "rules": {
            "duration_seconds": {
              "max": 15,
              "min": 5
            },
            "motion": "minimal",
            "show_scale": true
          },
          "severity": "advisory"
        }
      },
      "constraints": {
        "must_confirm": false,
        "no_skip": true,
        "require_gpt_task": false,
        "require_user_task": false,
        "require_validations_pass": false
      },
      "description": "Ürün görselleri ve (varsa) video; kalite, set bütünlüğü ve SEO uyumu açısından kontrol edilir. Çıktı yalnızca rapordur; görseller otomatik değiştirilmez.",
      "flow": {
        "guard": {
          "advance_only_if": [
            "gates_pass"
          ]
        }
      },
      "gates": {
        "must": [
          "validations_ok"
        ],
        "on_contract_violation": "halt_and_report",
        "on_miss": "halt",
        "on_missing_required_path": "halt_and_report",
        "on_soft_misalignment": "warn_and_continue"
      },
      "governance": {
        "notes_required": true,
        "qc_checklist": [
          "has_studio",
          "has_lifestyle",
          "has_scale",
          "has_detail",
          "has_packaging",
          "resolution_ok",
          "background_ok",
          "lighting_ok",
          "set_consistent",
          "seo_context_ok",
          "attribute_truth_ok",
          "no_watermark_or_heavy_text",
          "no_blurry_lowres"
        ]
      },
      "guards": {
        "first_image_ctr_check": true,
        "image_count": {
          "block_on_fail": false,
          "min_required": 8,
          "note": "Üretim durmasın, sadece WARN verilsin",
          "severity": "warn"
        },
        "image_variety": [
          "closeup",
          "usage",
          "variations",
          "packaging"
        ],
        "video_required": true
      },
      "hitl_contract": {
        "gpt_tasks": [],
        "user_tasks": []
      },
      "inputs": [
        "product.photos[]",
        "product.video?",
        "draft.title",
        "draft.description",
        "draft.tags[13]",
        "seo.keywords.focus[]",
        "seo.keywords.supporting[]"
      ],
      "name": "Görsel Analiz (+13 SEO Uyumu, arka planda)",
      "outputs": [
        "media.checklist",
        "media.issues[]",
        "media.recommendations[]",
        "media.qc_report"
      ],
      "preconditions": {
        "critical_pass": {
          "require_ancestors_done": [
            "0",
            "1",
            "3",
            "4",
            "6",
            "16"
          ]
        },
        "parent_defined": {
          "exists": true,
          "path": "/workflow_patches/steps/1"
        }
      },
      "requires": [
        "1"
      ],
      "rules": [
        "required_photos: [studio, lifestyle, scale, detail, packaging]",
        "optional_video: true (360° veya kullanım sahnesi)",
        "min_resolution: 2000x2000 (kare tercih)",
        "background: clean/consistent (white/soft preferred)",
        "lighting: true colors, minimal harsh shadows",
        "set_consistency: same tone/lighting across photos",
        "seo_alignment: at least one image reflects focus_1 context (e.g., wedding, gift)",
        "attribute_truth: images must reflect mentioned attributes (e.g., gemstone=color)",
        "negatives_forbidden: [watermark, heavy text overlays, blurry/low-res]"
      ],
      "ruleset": [
        {
          "id": "PRODUCT_RECORD_CONFIRMED_REQUIRED",
          "params": {
            "source": "product_record",
            "status": "CONFIRMED"
          }
        }
      ],
      "title": "Görsel Analizi",
      "upstream_signature": {
        "policy": "mark_stale_on_upstream_change"
      },
      "validations": {
        "present": true
      }
    },
    "1b": {
      "constraints": {
        "dedupe": {
          "case_insensitive": true,
          "exact_match": true,
          "normalize_diacritics": true,
          "semantic_diversity_required": true,
          "semantic_similarity_threshold": 0.85
        },
        "exact_words_per_query": 2,
        "min_segments": 3,
        "must_confirm": false,
        "no_skip": true,
        "optional_segments": [
          "gemstone",
          "style_aesthetic",
          "color_tone",
          "price_intent"
        ],
        "require_gpt_task": false,
        "require_user_task": false,
        "require_validations_pass": false,
        "required_segments": [
          "material_finish",
          "use_case_occasion",
          "audience_gift"
        ],
        "total_queries": 8
      },
      "description": "Bu adım, Alura'dan indirilecek CSV'lerin kalitesini belirleyen 8 adet, her biri 2 kelimeden oluşan çekirdek sorguları üretir.",
      "examples": {
        "invalid": [
          "silver plated",
          "free tutorial",
          "bracelet bracelet",
          "ring"
        ],
        "valid": [
          "gold bracelet",
          "dainty necklace",
          "mom gift",
          "wedding ring",
          "opal ring",
          "gothic jewelry",
          "black earrings",
          "luxury bracelet"
        ]
      },
      "flow": {
        "guard": {
          "advance_only_if": [
            "gates_pass"
          ]
        }
      },
      "gates": {
        "must": [
          "validations_ok"
        ],
        "on_contract_violation": "halt_and_report",
        "on_miss": "halt",
        "on_missing_required_path": "halt_and_report",
        "on_soft_misalignment": "warn_and_continue"
      },
      "hitl_contract": {
        "gpt_tasks": [
          "2 kelimelik 8 farklı arama önerisi üret, tür çeşitliliği koru."
        ],
        "user_tasks": []
      },
      "name": "Arama Önerileri",
      "negative_filters": [
        "DIY",
        "free",
        "tutorial",
        "plated* (silver/gold plated/kf)",
        "kit",
        "supplies",
        "raw*"
      ],
      "outputs": [
        "alura.search_suggestions[8]",
        "alura.segments_coverage",
        "alura.rejection_reasons[]",
        "alura.selection_notes"
      ],
      "policy_ref": "_profiles.gpt_prod_executor_v1.languages.rules.search_suggestions_1b",
      "preconditions": {
        "critical_pass": {
          "require_ancestors_done": [
            "0",
            "1",
            "3",
            "4",
            "6",
            "16"
          ]
        },
        "parent_defined": {
          "exists": true,
          "path": "/workflow_patches/steps/1"
        }
      },
      "quality_filters": {
        "alura_score_min": 70,
        "competition_max": "Medium",
        "conversion_rate_min": 0.015,
        "fallback_policy": "Eşik altı ama stratejik niş sorgular gerekçelendirilirse (notes.reason) en fazla 2 adet dahil edilebilir."
      },
      "requires": [
        "1a"
      ],
      "ruleset": [
        {
          "id": "ALURA_TOTAL_QUERIES",
          "params": {
            "count": 8
          }
        },
        {
          "id": "ALURA_EXACT_WORDS_PER_QUERY",
          "params": {
            "count": 2
          }
        },
        {
          "id": "ALURA_MIN_SEGMENTS",
          "params": {
            "count": 3
          }
        },
        {
          "id": "ALURA_QUALITY_THRESHOLDS",
          "params": {
            "competition_max": "Medium",
            "conv_min": 0.015,
            "score_min": 70
          }
        },
        {
          "id": "ALURA_DEDUPE",
          "params": {
            "case_insensitive": true,
            "normalize_diacritics": true,
            "semantic_threshold": 0.85
          }
        },
        {
          "id": "ALURA_NEGATIVE_TERMS",
          "params": {
            "terms": [
              "DIY",
              "free",
              "tutorial",
              "plated*",
              "kit",
              "supplies",
              "raw*"
            ]
          }
        },
        {
          "id": "NO_DERIVATION",
          "params": {
            "enforced": true
          }
        },
        {
          "id": "PRODUCT_RECORD_CONFIRMED_REQUIRED",
          "params": {
            "source": "product_record",
            "status": "CONFIRMED"
          }
        }
      ],
      "selection_policy": [
        "Her segmentten en az 1 öneri; toplamda min 3 segment kapsanmalı.",
        "1-2 öneri yüksek hacim (pop), 2-3 öneri long-tail; geri kalanı dengeli karma.",
        "Aynı kökten gelen varyasyonlar (ör. gold bracelet ~ dainty gold bracelet) 1 öneriyle sınırlandırılır."
      ],
      "title": "Alura Arama Önerileri",
      "ui": {
        "force_visible": true,
        "show": {
          "mode": "full"
        },
        "bindings": {
          "suggestions": "/steps/1b/outputs/alura.search_suggestions",
          "segments_coverage": "/steps/1b/outputs/alura.segments_coverage",
          "rejection_reasons": "/steps/1b/outputs/alura.rejection_reasons",
          "selection_notes": "/steps/1b/outputs/alura.selection_notes"
        }
      },
      "ui_directives": {
        "readonly": true
      },
      "upstream_signature": {
        "policy": "mark_stale_on_upstream_change"
      },
      "uses": "suggestions/image",
      "validations": {
        "present": true
      }
    },
    "2": {
      "title": "Keyword Pool (Görsel + Arama + CSV)"
    },
    "20": {
      "constraints": {
        "must_confirm": false,
        "no_skip": true,
        "require_gpt_task": false,
        "require_user_task": false,
        "require_validations_pass": false
      },
      "description": "Sürüm geçmişi, onaylar, checkpointler ve rollback noktalarının denetimi.",
      "flow": {
        "guard": {
          "advance_only_if": [
            "gates_pass"
          ]
        }
      },
      "gates": {
        "must": [
          "validations_ok"
        ],
        "on_contract_violation": "halt_and_report",
        "on_miss": "halt",
        "on_missing_required_path": "halt_and_report",
        "on_soft_misalignment": "auto_fix_and_continue"
      },
      "hitl_contract": {
        "gpt_tasks": [],
        "user_tasks": []
      },
      "inputs": [
        "workflow_patches.metadata",
        "workflow_patches.governance"
      ],
      "name": "Audit",
      "notes": {
        "include": [
          "_run.record_type"
        ]
      },
      "outputs": [
        "audit.report{}",
        "audit.findings[]",
        "audit.rollback_points[]"
      ],
      "preconditions": {
        "critical_pass": {
          "require_ancestors_done": [
            "0",
            "1",
            "3",
            "4",
            "6",
            "16"
          ]
        }
      },
      "requires": [
        "19"
      ],
      "rules": [
        "each patch must have patch_note_tr",
        "every 5th patch must record a checkpoint in version history (if enabled)",
        "ruleset_hash must be present and consistent",
        "produce rollback points and audit findings"
      ],
      "ruleset": [
        {
          "id": "PATCH_NOTE_REQUIRED",
          "params": {
            "field": "patch_note_tr"
          }
        },
        {
          "id": "CHECKPOINT_EVERY_5",
          "params": {
            "enabled": true
          }
        },
        {
          "id": "RULESET_HASH_REQUIRED",
          "params": {
            "field": "ruleset_hash"
          }
        },
        {
          "id": "ROLLBACK_POINTS_PRODUCE",
          "params": {
            "required": true
          }
        }
      ],
      "title": "Final SEO Review (QA)",
      "upstream_signature": {
        "policy": "mark_stale_on_upstream_change"
      },
      "validations": {
        "present": true
      }
    },
    "21": {
      "title": "Export Draft Listing"
    },
    "22": {
      "title": "User Final Review"
    },
    "23": {
      "title": "Finalize / Publish"
    },
    "2a": {
      "title": "Keyword Pool — Görsel Tabanlı"
    },
    "2b": {
      "title": "Keyword Pool — Arama & CSV Tabanlı"
    },
    "3": {
      "artifacts": [
        "alura.load.report.json"
      ],
      "constraints": {
        "must_confirm": true,
        "no_skip": true,
        "require_gpt_task": false,
        "require_user_task": false,
        "require_validations_pass": true
      },
      "csv_ingest": {
        "delimiter": ",",
        "doublequote": true,
        "encoding_fallbacks": [
          "utf-8-sig",
          "cp1254",
          "latin1",
          "utf-8"
        ],
        "expected_headers": [
          "Keyword",
          "Search volume",
          "3mo. change",
          "Competition",
          "Sales",
          "Score",
          "Trend status",
          "Search to competition ratio",
          "Google top of page bid (low range)",
          "Long-tail keyword",
          "Listing age",
          "Length",
          "Google top of page bid (high range)",
          "Google CPC",
          "Google competition level",
          "Google competition index",
          "Etsy tag",
          "Conversion rate",
          "Competition level",
          "Sales per listing",
          "Annual search trend"
        ],
        "normalize_newlines": true,
        "preserve_empty_strings": true,
        "quotechar": "\"",
        "repair_rules": {
          "drop_leading_index_col_if_extra_and_first_is_empty_or_digit": true,
          "drop_trailing_empty_col_if_extra": true
        },
        "report_actions": true,
        "skipinitialspace": false,
        "treat_string_nan_as_literal": true
      },
      "csv_outputs": {
        "clean_csv_path": "/runtime/clean/similar_keywords.csv",
        "encoding_used": null,
        "ingest_report_path": "/runtime/report/similar_keywords.json"
      },
      "description": "Alura/benzeri kaynaklardan 8 adet CSV yüklenir. Kolon adları normalize edilir; satır ve dil filtreleri uygulanır; temel metrikler hesaplanır.",
      "enabled": true,
      "example": {
        "header": [
          "Keyword",
          "Search volume",
          "3mo. change",
          "Competition",
          "Sales",
          "Score",
          "undefined",
          "Search to competition ratio",
          "Google top of page bid (low range)",
          "Long-tail keyword",
          "Listing age",
          "Length",
          "Google top of page bid (high range)",
          "Google CPC",
          "Google competition level",
          "Google competition index",
          "Etsy tag",
          "Conversion rate",
          "Competition level",
          "Sales per listing",
          "Annual search trend"
        ],
        "row": [
          "promise ring",
          "550000",
          "-6%",
          "626301",
          "1201509",
          "60",
          "",
          "0.88",
          "34",
          "Yes",
          "334 days",
          "12",
          "153",
          "94",
          "Low",
          "100",
          "Yes",
          "1.05%",
          "Very high",
          "48",
          "-33%"
        ]
      },
      "flow": {
        "guard": {
          "advance_only_if": [
            "gates_pass"
          ]
        },
        "on_fail": "halt",
        "on_success_next": "3a"
      },
      "gates": {
        "must": [
          "validations_ok"
        ],
        "on_contract_violation": "halt_and_report",
        "on_miss": "halt",
        "on_missing_required_path": "halt_and_report",
        "on_soft_misalignment": "warn_and_continue"
      },
      "guards": {
        "analysis_blocked_until": "pre.csv.report.status==PASS",
        "require_preprocess_pass": true
      },
      "hitl_contract": {
        "gpt_tasks": [],
        "user_tasks": []
      },
      "id": "3",
      "input_prep": {
        "apply_common": true,
        "enabled": true,
        "enforce": true,
        "on_fail": "halt",
        "profile_ref": "similar_keywords"
      },
      "inputs": [
        "alura.csv[8]"
      ],
      "label": "Similar CSV Yükleme (Sessiz Önişleme)",
      "name": "Similar CSV Yükleme",
      "next": [
        "3a"
      ],
      "on_error": {
        "fallback_next": [],
        "policy": "fail-fast"
      },
      "outputs": [
        "alura.csv[8]",
        "alura.metrics"
      ],
      "params": {
        "allow_missing": false,
        "expected_files": 8,
        "language": "auto",
        "normalize_columns": true
      },
      "parsing": {
        "allow_extra_headers": true,
        "cast_all_as_text": true,
        "dedupe": {
          "case_insensitive": true,
          "diacritics_insensitive": true,
          "enabled": true
        },
        "encodings_priority": [
          "utf-8",
          "ISO-8859-1",
          "cp1254",
          "cp1252"
        ],
        "header_aliases": [
          "Keyword",
          "query",
          "search_term"
        ],
        "ignore_header_order": true,
        "normalize": {
          "case_insensitive": true,
          "collapse_spaces": true,
          "diacritics_insensitive": true,
          "trim_whitespace": true
        },
        "primary_field": "query",
        "quote_mode": "relaxed",
        "value_handling": {
          "cast_all_as_text": true,
          "normalize_yes_no": true,
          "treat_empty_as_valid": true,
          "treat_nan_as_empty": true
        }
      },
      "post": {
        "only_signal_ready": true,
        "signal": "similar_ready"
      },
      "pre": {
        "run_preprocessing": true,
        "silent": true
      },
      "preconditions": {
        "critical_pass": {
          "require_ancestors_done": [
            "0",
            "1",
            "3",
            "4",
            "6",
            "16"
          ]
        }
      },
      "preprocess": {
        "dialect": {
          "delimiter": ",",
          "doublequote": true,
          "escapechar": null,
          "lineterminator": "auto",
          "quotechar": "\""
        },
        "encoding": [
          "utf-8-sig",
          "utf-8",
          "latin1"
        ],
        "header_map": {
          "3mo. change": [
            "3mo change",
            "3 mo change",
            "3-month change"
          ]
        },
        "id": "csv_normalize_v2",
        "integrity": {
          "header_strict": true,
          "max_repaired_per_file": 50,
          "reject_if_any_rowlen_mismatch_after_repair": true,
          "repair_strategy": "merge_split_fields_if_quoted_else_reject",
          "row_len_must_equal_header": true
        },
        "normalize": {
          "cast_all_as_text": true,
          "do_not_invent_nan": true,
          "keep_default_na": false,
          "na_filter": false,
          "preserve_empty_strings": true,
          "strip_bom": true,
          "trim_whitespace": false
        },
        "outputs": {
          "header": "pre.csv.header",
          "report": "pre.csv.report",
          "row_count": "pre.csv.rows",
          "table": "pre.csv.table"
        }
      },
      "requires": [
        "0a"
      ],
      "suggestion_mode": "suppress",
      "title": "Similar Keywords Upload",
      "type": "upload_csv",
      "ui": {
        "accept": [
          ".csv"
        ],
        "help": "Header esnek: Keyword | query | search_term. Ek sütunlar serbest; NaN/boş/Yes/No kabul.",
        "max_files": 10,
        "min_files": 1,
        "title": "Similar Keywords CSV"
      },
      "ui_directives": {
        "examples": {
          "header_csv": "Keyword,Search volume,3mo. change,Competition,Sales,Score,Trend status,Search to competition ratio,Google top of page bid (low range),Long-tail keyword,Listing age,Length,Google top of page bid (high range),Google CPC,Google competition level,Google competition index,Etsy tag,Conversion rate,Competition level,Sales per listing,Annual search trend",
          "render": "code",
          "sample_row_csv": "modern gold band,10,0%,24018,962401,37,Stable,0.00,87,Yes,1747 days,16,295,191,High,96,Yes,1.00%,Low,40,0%"
        },
        "expects": "csv_upload",
        "help": "similar_keywords CSV: Başlık sayısı tüm satırlarda eşit olmalı. Fazladan baştaki index veya sondaki boş alan otomatik temizlenir. Boş değerler boş kalır; 'NaN' stringi aynen korunur.\n\nSimilar Keywords CSV — örnek başlık ve ilk satır aşağıdadır.\n• Başlık sayısı = her veri satırındaki alan sayısı olmalı.\n• Title/Keyword dışındaki alanlar da tırnaklı olabilir; boşlar boş kalır; 'NaN' metni varsa aynen kalır.\n• Sondaki fazladan boş alan veya baştaki görünmeyen index otomatik kaldırılır.",
        "templates": {
          "header_only_csv": "/mnt/data/templates/template_3_header_only.csv"
        }
      },
      "upstream_signature": {
        "policy": "mark_stale_on_upstream_change"
      },
      "validations": {
        "csv": {
          "block_on_header_len_mismatch": true,
          "require_field_count_equals_header": true,
          "warn_on_header_name_mismatch": true
        },
        "file_count": "=8",
        "required_columns": [
          "keyword",
          "search_volume?"
        ]
      },
      "value_handling": {
        "cast_all_as_text": true,
        "treat_empty_as_valid": true,
        "treat_nan_as_empty": false
      }
    },
    "3a": {
      "can_revise_after": [
        "4",
        "5a",
        "5b"
      ],
      "constraints": {
        "max_same_root_in_top50": 3,
        "min_pool_size": 100,
        "must_confirm": false,
        "no_derivation": true,
        "no_skip": true,
        "require_gpt_task": false,
        "require_user_task": false,
        "require_validations_pass": false,
        "semantic_similarity_threshold": 0.85
      },
      "description": "Bu adımda herhangi bir türetim yapılmaz. 1b’de üretilen 8×2‑kelimelik arama önerisi ile indirilen 8 Alura CSV’sinden birleşik bir anahtar kelime havuzu oluşturulur; havuz çeşitlilik ve kalite kriterlerine göre temizlenir, birleştirilir ve önceliklendirilir. Ardından 1..4 numaralı odak anahtar kelimeler (geçici) belirlenir.",
      "display": {
        "hide": [
          "tables",
          "raw_rows",
          "excel_like"
        ],
        "show": [
          "text_summary",
          "key_metrics"
        ]
      },
      "diversity": {
        "root_crowding": {
          "equivalence": "case_insensitive_exact",
          "max_per_root_in_top100": 3
        },
        "segment_cover_min": 3,
        "segments": {
          "material": [
            "gold",
            "10k",
            "14k",
            "18k",
            "yellow gold",
            "white gold",
            "rose gold"
          ],
          "setting": [
            "bezel",
            "flush",
            "solitaire",
            "channel",
            "pavé",
            "prong"
          ],
          "style": [
            "minimalist",
            "dainty",
            "simple",
            "thin",
            "delicate",
            "everyday"
          ],
          "usage": [
            "wedding",
            "promise",
            "bridal",
            "engagement",
            "stacking",
            "anniversary"
          ]
        }
      },
      "flow": {
        "guard": {
          "advance_only_if": [
            "gates_pass"
          ]
        }
      },
      "gates": {
        "must": [
          "validations_ok"
        ],
        "on_contract_violation": "halt_and_report",
        "on_miss": "halt",
        "on_missing_required_path": "halt_and_report",
        "on_soft_misalignment": "warn_and_continue"
      },
      "governance": {
        "audit_fields": [
          "source_csv_id",
          "original_query",
          "metrics_at_selection_time"
        ],
        "reproducibility": "store seeds and weights for ranking formula (w1..w5)"
      },
      "guards": {
        "keyword_pool": {
          "criteria": [
            "relevance",
            "volume",
            "competition"
          ],
          "max_size": 50,
          "min_size": 30,
          "note": "Odak seçimi için geniş çeşit havuzu",
          "require_types": [
            "short",
            "mid",
            "long_tail"
          ]
        }
      },
      "hitl_contract": {
        "gpt_tasks": [],
        "user_tasks": []
      },
      "inputs": [
        "alura.csv[8]",
        "alura.metrics",
        "context.product_category",
        "prior.signals"
      ],
      "label": "Odak Anahtar Kelime + Havuz (Sonuç Odaklı)",
      "name": "Odak Anahtar Kelime + Havuz",
      "operations": [
        "concat -> dedupe (case-insensitive, diacritics normalized)",
        "filter by quality thresholds (score>=70, conv>=0.015, competition<=Medium) with fallback allowance<=10%",
        "segment_coverage ensure >=3 segments (material/use_case/audience + optional gemstone/style/color/price)",
        "normalize & canonicalize keywords (singular/plural, common misspellings) without creating new derivatives",
        "rank by multi-score: w1*score + w2*conv + w3*ctr + w4*volume - w5*competition_penalty",
        "diversity re-ranking: penalize near-duplicates (semantic_sim>=0.85) and same-root crowding",
        "produce ranked pool and pick provisional focus_keywords[1..4]"
      ],
      "outputs": [
        "keywords.pool.ranked[]",
        "keywords.focus[1..4].provisional",
        "keywords.selection_notes",
        "keywords.segment_coverage"
      ],
      "pool_policy": {
        "allowed_fields": {
          "competitor_listings": [
            "Title",
            "Tags",
            "Sales",
            "Revenue",
            "Conversion rate"
          ],
          "similar_keywords": [
            "Keyword",
            "Score",
            "Search volume",
            "3mo. change",
            "Competition",
            "Conversion rate"
          ],
          "top_listings": [
            "Title",
            "Tags",
            "Sales",
            "Revenue",
            "Conversion rate"
          ]
        },
        "dedupe": {
          "mode": "case_insensitive_exact"
        },
        "negatives_ref": "global_negatives",
        "normalization": {
          "case_preserve": true,
          "no_lemmatize_stem_synonym": true,
          "single_space_only": true,
          "trim_whitespace": true
        },
        "pool_limits": {
          "allow_less": true,
          "max": 100,
          "target_min": 100
        },
        "source": "csv_only"
      },
      "preconditions": {
        "critical_pass": {
          "require_ancestors_done": [
            "0",
            "1",
            "3",
            "4",
            "6",
            "16"
          ]
        },
        "parent_defined": {
          "exists": true,
          "path": "/workflow_patches/steps/3"
        }
      },
      "requires": [
        "3"
      ],
      "ruleset": [
        {
          "id": "NO_DERIVATION",
          "params": {
            "enforced": true
          }
        },
        {
          "id": "POOL_MIN_SIZE",
          "params": {
            "min": 100
          }
        },
        {
          "id": "SEMANTIC_DIVERSITY_THRESHOLD",
          "params": {
            "similarity_max": 0.85
          }
        },
        {
          "id": "FOCUS_KEYWORDS_COUNT",
          "params": {
            "count": 4
          }
        },
        {
          "id": "DIVERSITY_RE_RANK",
          "params": {
            "enabled": true
          }
        },
        {
          "id": "PRODUCT_RECORD_CONFIRMED_REQUIRED",
          "params": {
            "source": "product_record",
            "status": "CONFIRMED"
          }
        }
      ],
      "scoring": {
        "combine": [
          {
            "take": "similar",
            "weight": 0.6
          },
          {
            "take": "market",
            "weight": 0.4
          }
        ],
        "features": {
          "market": {
            "revenue_signal": {
              "agg": "sum_norm",
              "any_of": [
                "Revenue",
                "Monthly revenue"
              ],
              "weight": 0.15
            },
            "sales_signal": {
              "agg": "sum_norm",
              "any_of": [
                "Sales",
                "Monthly sales"
              ],
              "weight": 0.15
            },
            "tag_hits_comp": {
              "count": true,
              "field": "Tags",
              "source": "competitor_listings",
              "weight": 0.2
            },
            "tag_hits_top": {
              "count": true,
              "field": "Tags",
              "source": "top_listings",
              "weight": 0.2
            },
            "title_hits_comp": {
              "count": true,
              "field": "Title",
              "source": "competitor_listings",
              "weight": 0.15
            },
            "title_hits_top": {
              "count": true,
              "field": "Title",
              "source": "top_listings",
              "weight": 0.15
            }
          },
          "similar": {
            "competition": {
              "field": "Competition",
              "norm": "inv",
              "weight": 0.1
            },
            "conv": {
              "field": "Conversion rate",
              "norm": "pct",
              "weight": 0.2
            },
            "score": {
              "field": "Score",
              "norm": "minmax",
              "weight": 0.45
            },
            "trend_3mo": {
              "field": "3mo. change",
              "norm": "pct",
              "weight": 0.05
            },
            "volume": {
              "field": "Search volume",
              "norm": "log1p",
              "weight": 0.2
            }
          }
        },
        "missing_values": {
          "no_imputation": true,
          "skip_feature_if_missing": true
        }
      },
      "selection": {
        "allow_focus_lt_4_if_pool_lt_4": true,
        "focus_count": 4,
        "outputs": {
          "focus_keywords": "outputs.focus_keywords",
          "pool": "outputs.pool",
          "selection_notes": "outputs.selection_notes"
        },
        "tie_breakers": [
          "conversion_rate",
          "title_tag_occurrence",
          "similar_score"
        ],
        "validations": {
          "halt_on_fail": true,
          "require": [
            "len(outputs.pool) >= 1",
            "len(outputs.focus_keywords) >= (outputs.pool.length < 4 ? outputs.pool.length : 4)"
          ]
        }
      },
      "selection_policy": {
        "focus_keywords_count": 4,
        "notes_required": true,
        "tie_breakers": [
          "higher conversion_rate",
          "higher overall score",
          "better segment diversification"
        ],
        "use_in_3b": 1
      },
      "title": "Odak Anahtar Kelime + Türetilenler",
      "ui_directives": {
        "readonly": true
      },
      "upstream_signature": {
        "policy": "mark_stale_on_upstream_change"
      },
      "validations": {
        "present": true
      },
      "ui": {
        "force_visible": true,
        "show": {
          "mode": "full"
        },
        "bindings": {
          "pool": "/steps/3a/outputs/pool"
        }
      }
    },
    "3b": {
      "actions": {
        "draft_package": {
          "description": "first_160_chars_mobile_optimized",
          "tags": {
            "count": 13,
            "diverse": true,
            "unique": true
          },
          "title": "use_focus_and_support_keywords"
        }
      },
      "can_revise_after": [
        "4",
        "5a",
        "5b"
      ],
      "constraints": {
        "max_same_root_in_tags": 1,
        "must_confirm": false,
        "no_derivation": true,
        "no_skip": true,
        "require_gpt_task": false,
        "require_user_task": false,
        "require_validations_pass": false
      },
      "description": "3.a’daki havuz ve odak #1 (varsayılan) kullanılarak taslak başlık, açıklama ve 13 etiket oluşturulur. Nihai SEO adımlarına geçmeden önce kullanıcı gözden geçirmesi içindir.",
      "flow": {
        "guard": {
          "advance_only_if": [
            "gates_pass"
          ]
        }
      },
      "gates": {
        "must": [
          "validations_ok"
        ],
        "on_contract_violation": "halt_and_report",
        "on_miss": "halt",
        "on_missing_required_path": "halt_and_report",
        "on_soft_misalignment": "warn_and_continue"
      },
      "governance": {
        "notes_required": true,
        "qc_checklist": [
          "frontload_title",
          "13_unique_tags",
          "no_attr_duplicate",
          "no_stuffing"
        ]
      },
      "hitl_contract": {
        "gpt_tasks": [],
        "user_tasks": []
      },
      "includes_rules_from": [
        "10",
        "11",
        "12"
      ],
      "inputs": [
        "keywords.pool.ranked[]",
        "keywords.focus[1..4].provisional",
        "segment_coverage",
        "product_attributes?",
        "prior.signals?"
      ],
      "label": "Taslak Paket (Title + Description + Tags)",
      "name": "Taslak Paket (Title, Desc, Tags)",
      "outputs": [
        "draft.title",
        "draft.description",
        "draft.tags[13]",
        "draft.notes",
        "draft.qc"
      ],
      "preconditions": {
        "critical_pass": {
          "require_ancestors_done": [
            "0",
            "1",
            "3",
            "4",
            "6",
            "16"
          ]
        },
        "parent_defined": {
          "exists": true,
          "path": "/workflow_patches/steps/3"
        }
      },
      "requires": [
        "3a"
      ],
      "rules": [
        "use focus_1 by default; switch to focus_2..4 only if rationale provided",
        "title.frontload focus; title<=140; readable separators; no stuffing",
        "description: first sentence includes focus naturally; benefits-first; scannable",
        "tags: 13 unique; from pool; no duplicates with category attributes; ensure >=3 segments",
        "negative filters: [\"DIY\",\"free\",\"tutorial\",\"plated*\",\"supplies\",\"raw*\"]",
        "no fabrication of materials/stones"
      ],
      "ruleset": [
        {
          "id": "USE_FOCUS1_BY_DEFAULT",
          "params": {
            "allow_switch_with_rationale": true
          }
        },
        {
          "id": "TITLE_FRONTLOAD",
          "params": {
            "first_chars": 40
          }
        },
        {
          "id": "TITLE_MAX_LEN",
          "params": {
            "max": 140
          }
        },
        {
          "id": "TAGS_COUNT_13",
          "params": {
            "count": 13
          }
        },
        {
          "id": "TAGS_UNIQUE",
          "params": {
            "required": true
          }
        },
        {
          "id": "MAX_SAME_ROOT_IN_TAGS",
          "params": {
            "max": 1
          }
        },
        {
          "id": "NEGATIVE_TERMS",
          "params": {
            "terms": [
              "DIY",
              "free",
              "tutorial",
              "plated*",
              "kit",
              "supplies",
              "raw*"
            ]
          }
        },
        {
          "id": "NO_DERIVATION",
          "params": {
            "enforced": true
          }
        },
        {
          "id": "PRODUCT_RECORD_CONFIRMED_REQUIRED",
          "params": {
            "source": "product_record",
            "status": "CONFIRMED"
          }
        }
      ],
      "title": "Taslak Paket — DRAFT",
      "upstream_signature": {
        "policy": "mark_stale_on_upstream_change"
      },
      "validations": {
        "present": true
      },
      "ui": {
        "force_visible": true,
        "show": {
          "mode": "full"
        },
        "bindings": {
          "draft": "/steps/3b/outputs/draft"
        }
      }
    },
    "3c": {
      "title": "Odak Anahtar Kelime Seçimi & Havuz",
      "ui": {
        "force_visible": true,
        "show": {
          "mode": "full"
        },
        "bindings": {
          "enriched": "/steps/3c/outputs/enriched"
        }
      }
    },
    "3d": {
      "title": "Taslak Üretimi (Başlık / Açıklama / Etiketler)"
    },
    "3p": {
      "title": "3p",
      "type": "task"
    },
    "4": {
      "archived": true,
      "constraints": {
        "expected_products_per_csv": 200,
        "min_products_per_csv": 150,
        "must_confirm": true,
        "negatives": [
          "DIY",
          "supplies",
          "kit",
          "raw",
          "tutorial",
          "plated*"
        ],
        "no_skip": true,
        "require_gpt_task": false,
        "require_user_task": false,
        "require_validations_pass": false,
        "semantic_similarity_threshold": 0.85
      },
      "description": "Kullanıcıdan gelen 4 dar Top Listings CSV (focus_1..4’e denk gelen, her biri ≈200 ürün) temizlenir, normalize edilir ve konsolide edilir. 3.a odak kelime sırasının revizyonuna dair sinyaller üretilir.",
      "enabled": false,
      "flow": {
        "guard": {
          "advance_only_if": [
            "gates_pass"
          ]
        }
      },
      "gates": {
        "must": [
          "validations_ok"
        ],
        "on_contract_violation": "halt_and_report",
        "on_miss": "halt",
        "on_missing_required_path": "halt_and_report",
        "on_soft_misalignment": "warn_and_continue"
      },
      "governance": {
        "audit_fields": [
          "source_csv_id",
          "focus_id",
          "metrics_at_selection_time"
        ],
        "notes_required": true
      },
      "hitl_contract": {
        "gpt_tasks": [],
        "user_tasks": []
      },
      "ingest_policy_ref": "csv_ingest.top_listings",
      "input_prep": {
        "apply_common": true,
        "enabled": true,
        "enforce": true,
        "on_fail": "halt",
        "profile_ref": "top_listings"
      },
      "inputs": [
        "top_listings_focus1.csv",
        "top_listings_focus2.csv",
        "top_listings_focus3.csv",
        "top_listings_focus4.csv",
        "keywords.focus[1..4].provisional",
        "draft.title",
        "draft.tags[13]"
      ],
      "label": "Top Listings Upload (Sessiz Önişleme)",
      "name": "Top Listings Upload",
      "operations": [
        "validate CSVs (encoding, delimiter, missing cells)",
        "tag each file with focus_id",
        "normalize text (case, diacritics, plural/singular)",
        "clean special chars, preserve attributes",
        "extract metrics (views, favorites, orders, conversion_rate)",
        "assign focus_weight per file; merge duplicates with consolidated metrics",
        "analyze overlap with keywords pool and draft",
        "diversity & bias correction: penalize same-root crowding, enforce segment coverage >=3",
        "compute focus_reorder_suggestion with rationale"
      ],
      "outputs": [
        "top_listings.cleaned.focus1..4",
        "top_listings.merged",
        "top_listings.keyword_metrics{}",
        "top_listings.keyword_overlap[]",
        "focus.reorder_suggestion",
        "top_listings.notes"
      ],
      "post": {
        "only_signal_ready": true,
        "signal": "top_listings_ready"
      },
      "pre": {
        "run_preprocessing": true,
        "silent": true
      },
      "preconditions": {
        "critical_pass": {
          "require_ancestors_done": [
            "0",
            "1",
            "3",
            "4",
            "6",
            "16"
          ]
        }
      },
      "preprocess": {
        "dialect": {
          "lineterminator": "auto"
        },
        "normalize": {
          "strip_bom": true
        }
      },
      "relations": {
        "default_focus_for_3b": "focus_1",
        "revision_candidates_after": [
          "focus.reorder_suggestion"
        ]
      },
      "requires": [
        "3b"
      ],
      "ruleset": [
        {
          "id": "TOPLISTINGS_MIN_PER_CSV",
          "params": {
            "min": 150
          }
        },
        {
          "id": "TOPLISTINGS_EXPECTED_PER_CSV",
          "params": {
            "expected": 200
          }
        },
        {
          "id": "EXCLUDE_NEGATIVE_TERMS",
          "params": {
            "terms": [
              "DIY",
              "free",
              "tutorial",
              "plated*",
              "kit",
              "supplies",
              "raw*"
            ]
          }
        },
        {
          "id": "DEDUP_NEAR_DUPLICATES",
          "params": {
            "semantic_threshold": 0.85
          }
        },
        {
          "id": "PRODUCT_RECORD_CONFIRMED_REQUIRED",
          "params": {
            "source": "product_record",
            "status": "CONFIRMED"
          }
        }
      ],
      "suggestion_mode": "suppress",
      "title": "Top Listings (Genel)",
      "ui_directives": {
        "hidden": true
      },
      "upstream_signature": {
        "policy": "mark_stale_on_upstream_change"
      },
      "validations": {
        "present": true
      }
    },
    "4a": {
      "archived": true,
      "enabled": false,
      "title": "Top Listings Upload",
      "ui_directives": {
        "hidden": true
      }
    },
    "4b": {
      "archived": true,
      "deprecated": true,
      "enabled": false,
      "title": "Top Listings Clean (csv_clean:top)",
      "ui_directives": {
        "hidden": true
      }
    },
    "4p": {
      "archived": true,
      "enabled": false,
      "title": "4p",
      "type": "task",
      "ui_directives": {
        "hidden": true
      }
    },
    "5": {
      "advisory_pack_similarity": {
        "advisory_signals": {
          "favorites_views": true,
          "listing_age": true,
          "review_count": true
        },
        "block": false,
        "notes": "Top Listings analizinde ekstra sütunlar (Favorites, Reviews, Age) küçük ağırlıklarla puana katkı yapar.",
        "severity": "advisory",
        "similarity_score": {
          "enabled": true,
          "factors": {
            "category_match": 0.2,
            "price_band_match": 0.1,
            "tags_keyword_match": 0.2,
            "title_keyword_match": 0.5
          },
          "normalization": "0_to_1",
          "note": "Benzerlik puanı 0–1; Title/Tags/Category/Fiyat uyumu ile hesaplanır."
        },
        "title": "Similarity & Extra Signals for Top Listings"
      },
      "constraints": {
        "must_confirm": false,
        "no_skip": true,
        "require_gpt_task": false,
        "require_user_task": false,
        "require_validations_pass": false
      },
      "csv_ingest": {
        "delimiter": ",",
        "doublequote": true,
        "encoding_fallbacks": [
          "utf-8-sig",
          "cp1254",
          "latin1",
          "utf-8"
        ],
        "expected_headers": [
          "Title",
          "Revenue",
          "LQS",
          "Price",
          "Category",
          "Shop",
          "Sales",
          "Monthly sales",
          "Creator",
          "Product creation era",
          "Views",
          "Video",
          "URL",
          "Tag count",
          "Tags",
          "Review rate",
          "Reviews",
          "Review score",
          "Production partners",
          "Processing time",
          "Min processing time",
          "Max processing time",
          "Favorites",
          "Listing age (days)",
          "Personalization required",
          "Creation date",
          "Listing type",
          "Vintage",
          "Supply item",
          "Personalizable",
          "Image count",
          "Free US shipping",
          "Conversion rate",
          "BSR Category",
          "BSR Category (%)",
          "Monthly revenue"
        ],
        "normalize_newlines": true,
        "preserve_empty_strings": true,
        "quotechar": "\"",
        "repair_rules": {
          "drop_leading_index_col_if_extra_and_first_is_empty_or_digit": true,
          "drop_trailing_empty_col_if_extra": true
        },
        "report_actions": true,
        "skipinitialspace": false,
        "treat_string_nan_as_literal": true
      },
      "csv_outputs": {
        "clean_csv_path": "/runtime/clean/top_listings.csv",
        "encoding_used": null,
        "ingest_report_path": "/runtime/report/top_listings.json"
      },
      "display": {
        "hide": [
          "tables",
          "raw_rows",
          "excel_like"
        ],
        "show": [
          "text_summary",
          "key_metrics"
        ]
      },
      "enabled": true,
      "flow": {
        "guard": {
          "advance_only_if": [
            "gates_pass"
          ]
        }
      },
      "gates": {
        "must": [
          "validations_ok"
        ],
        "on_contract_violation": "halt_and_report",
        "on_miss": "halt",
        "on_missing_required_path": "halt_and_report",
        "on_soft_misalignment": "auto_fix_and_continue"
      },
      "hitl_contract": {
        "gpt_tasks": [],
        "user_tasks": []
      },
      "label": "Popüler Ürünler Analizi (Sonuç Odaklı)",
      "name": "Popüler Ürünler Analizi",
      "output": {
        "digest_only": true,
        "ui_table": false
      },
      "preconditions": {
        "critical_pass": {
          "require_ancestors_done": [
            "0",
            "1",
            "3",
            "4",
            "6",
            "16"
          ]
        }
      },
      "requires": [
        "3d"
      ],
      "title": "Top Listings Upload (Dar)",
      "ui_directives": {
        "examples": {
          "header_csv": "Title,Revenue,LQS,Price,Category,Shop,Sales,Monthly sales,Creator,Product creation era,Views,Video,URL,Tag count,Tags,Review rate,Reviews,Review score,Production partners,Processing time,Min processing time,Max processing time,Favorites,Listing age (days),Personalization required,Creation date,Listing type,Vintage,Supply item,Personalizable,Image count,Free US shipping,Conversion rate,BSR Category,BSR Category (%),Monthly revenue",
          "render": "code",
          "sample_row_csv": "Custom Delicate Name Ring %u2022 Custom Stacking Rings %u2022 Skinny Custom Ring %u2022 Bridesmaids Gift %u2022 Baby Name Mom Gift %u2022 MOTHERS GIFT %u2022 RM21F31,$2008938,70,$26.50,Jewelry,CaitlynMinimalist,75809,684,Member of the shop,Made to Order,3031646,No,https://www.etsy.com/listing/469538833/custom-delicate-name-ring-custom,13,\"CAITLYNMINIMALIST,NAME RING,CUSTOM RING,LETTER RING,MOTHERS RING,STACKING RING,DAINTY RING,CUSTOM JEWELRY,HANDMADE JEWELRY,PERSONALIZED GIFT,BEST FRIEND GIFT,NEW BABY GIFT,MOM GIFT\",20.01%,15171,4.85,None,7.50 days,6 days,9 days,139541,3326,Yes,\"01 A%u011Fu, 2016\",Physical,No,No,Yes,6,Yes,2.50%,NaN,0.0,$18120"
        },
        "expects": "csv_upload",
        "help": "top_listings CSV: Başlık sayısı tüm satırlarda eşit olmalı. Fazladan baştaki index veya sondaki boş alan otomatik temizlenir. Boş değerler boş kalır; 'NaN' stringi aynen korunur.\n\nTop Listings (Dar) CSV — örnek başlık ve ilk satır aşağıdadır.\n• Etsy başlıklarında virgül/‘-’ olabilir; tırnaklar içeriği korur.\n• Sondaki fazladan boş alan otomatik kaldırılır; sıralama bozulmaz.",
        "hidden": false,
        "templates": {
          "header_only_csv": "/mnt/data/templates/template_5_header_only.csv"
        }
      },
      "upstream_signature": {
        "policy": "mark_stale_on_upstream_change"
      },
      "uses": "analysis/top_listings",
      "validations": {
        "csv": {
          "block_on_header_len_mismatch": true,
          "require_field_count_equals_header": true,
          "warn_on_header_name_mismatch": true
        },
        "present": true
      },
      "ui": {
        "show": {
          "mode": "summary"
        },
        "bindings": {
          "summary": "/steps/5/outputs/summary"
        }
      }
    },
    "5a": {
      "can_revise": [
        "keywords.focus[1..4]"
      ],
      "constraints": {
        "min_total_rows_warning": 600,
        "must_confirm": false,
        "negatives": [
          "DIY",
          "supplies",
          "kit",
          "raw",
          "tutorial",
          "plated*"
        ],
        "no_skip": true,
        "require_gpt_task": false,
        "require_user_task": false,
        "require_validations_pass": false
      },
      "description": "Top listings verisinden ürün/anahtar kelime performans içgörüleri çıkarılır; niş fırsatlar ve doygun alanlar işaretlenir; odak sıralaması için sinyal üretilir.",
      "enabled": true,
      "flow": {
        "guard": {
          "advance_only_if": [
            "gates_pass"
          ]
        }
      },
      "gates": {
        "must": [],
        "on_contract_violation": "halt_and_report",
        "on_miss": "halt",
        "on_missing_required_path": "halt_and_report",
        "on_soft_misalignment": "auto_fix_and_continue"
      },
      "governance": {
        "notes_required": true
      },
      "guards": {
        "analysis": {
          "include_metrics": [
            "conversion_rate",
            "listing_age"
          ],
          "note": "Popüler ürün analizinde satış dışında metrikler de hesaba katılmalı"
        }
      },
      "hitl_contract": {
        "gpt_tasks": [],
        "user_tasks": []
      },
      "inputs": [
        "top_listings.cleaned.*",
        "top_listings.merged",
        "top_listings.keyword_metrics{}",
        "top_listings.keyword_overlap[]",
        "keywords.pool.ranked[]",
        "keywords.focus[1..4].provisional",
        "draft.title",
        "draft.tags[13]"
      ],
      "min_samples_per_shop": 1,
      "name": "Rakip Mağaza Seçimi",
      "output": {
        "digest_only": true,
        "top_n": 8,
        "ui_table": false
      },
      "outputs": [
        "popular.products.top[]",
        "popular.keywords.top[]",
        "popular.segments.summary{}",
        "popular.focus_signals{}",
        "popular.notes",
        "similarity.report{}",
        "similarity.score",
        "similarity.label",
        "similarity.notes"
      ],
      "pre": [
        {
          "args": {
            "mode": "auto_fix_warn",
            "rules_ref": "_csv_rules.competitor_csv",
            "write_outputs": true
          },
          "name": "csv_preprocess.competitor_csv"
        }
      ],
      "preconditions": {
        "critical_pass": {
          "require_ancestors_done": [
            "0",
            "1",
            "3",
            "4",
            "6",
            "16"
          ]
        },
        "parent_defined": {
          "exists": true,
          "path": "/workflow_patches/steps/5"
        }
      },
      "requires": [
        "4"
      ],
      "rules": [
        "normalize product metrics (views, favorites, orders, conversion_rate) -> z-scores -> product_score",
        "aggregate keyword occurrences across products -> keyword_score",
        "dedupe near-duplicate products (semantic_sim>=0.85)",
        "analyze segment coverage (material/use_case/audience + optional gemstone/style/color/price)",
        "flag opportunities (high-conv/low-comp) and risks (high-comp/low-conv)",
        "produce focus support/oppose signals for focus_1..4",
        "Compute similarity between our listing and each row (title/desc embeddings; tag overlap; attribute match).",
        "Attach similarity.score (0–1) and similarity.label (LOW/MEDIUM/HIGH) per row.",
        "Emit similarity.report and notes; use in later steps (ads/seo/spam guard)."
      ],
      "ruleset": [
        {
          "id": "NEGATIVE_TERMS",
          "params": {
            "terms": [
              "DIY",
              "free",
              "tutorial",
              "plated*",
              "kit",
              "supplies",
              "raw*"
            ]
          }
        },
        {
          "id": "MIN_TOTAL_ROWS_WARNING",
          "params": {
            "min": 600
          }
        },
        {
          "id": "DEDUP_NEAR_DUPLICATES",
          "params": {
            "semantic_threshold": 0.85
          }
        },
        {
          "id": "FOCUS_SUPPORT_SIGNALS",
          "params": {
            "produce": true
          }
        },
        {
          "id": "SIMILARITY_TITLE_DESC_CHECK",
          "params": {}
        },
        {
          "id": "SIMILARITY_TAGS_OVERLAP",
          "params": {}
        },
        {
          "id": "SIMILARITY_ATTRIBUTES_MATCH",
          "params": {}
        },
        {
          "id": "SIMILARITY_SCORE_COMPUTE",
          "params": {}
        },
        {
          "id": "PRODUCT_RECORD_CONFIRMED_REQUIRED",
          "params": {
            "source": "product_record",
            "status": "CONFIRMED"
          }
        }
      ],
      "suggestion_mode": "suppress",
      "title": "Popüler Ürünler Analizi",
      "ui_directives": {
        "hidden": false
      },
      "upstream_signature": {
        "policy": "mark_stale_on_upstream_change"
      },
      "uses": "selection/top8_by_shop",
      "ui": {
        "show": {
          "mode": "summary"
        },
        "bindings": {
          "summary": "/steps/5a/outputs/summary"
        }
      }
    },
    "5b": {
      "constraints": {
        "coverage": "multiple segments must be represented",
        "exclusions": [
          "brand infringement",
          "supplies/DIY heavy presence"
        ],
        "must_confirm": false,
        "no_skip": true,
        "quality": ">=50% of selected shops have multi-match in popular.products.top[]",
        "require_gpt_task": false,
        "require_user_task": false,
        "require_validations_pass": false
      },
      "description": "5a ve 4 çıktıları üzerinden hedef rakip mağazalar belirlenir; ileride Ads ve SEO karşılaştırmaları için çekirdek set oluşturulur.",
      "enabled": true,
      "flow": {
        "guard": {
          "advance_only_if": [
            "gates_pass"
          ]
        }
      },
      "gates": {
        "must": [],
        "on_contract_violation": "halt_and_report",
        "on_miss": "halt",
        "on_missing_required_path": "halt_and_report",
        "on_soft_misalignment": "warn_and_continue"
      },
      "governance": {
        "notes_required": true
      },
      "guards": {
        "competitor_selection": {
          "feedback_to": "3b",
          "pattern_extraction": [
            "titles",
            "tags"
          ],
          "require_category_match": true
        }
      },
      "hitl_contract": {
        "gpt_tasks": [],
        "user_tasks": []
      },
      "inputs": [
        "popular.products.top[]",
        "popular.keywords.top[]",
        "top_listings.merged",
        "competitor_shops.csv?"
      ],
      "name": "Rakip Mağaza Seçimi",
      "notes": {
        "lifecycle": "manifest-disabled"
      },
      "outputs": [
        "competitors.candidates[]",
        "competitors.selected[]",
        "competitors.profiles{}",
        "competitors.notes",
        "similarity.report{}",
        "similarity.score",
        "similarity.label",
        "similarity.notes"
      ],
      "preconditions": {
        "critical_pass": {
          "require_ancestors_done": [
            "0",
            "1",
            "3",
            "4",
            "6",
            "16"
          ]
        },
        "parent_defined": {
          "exists": true,
          "path": "/workflow_patches/steps/5"
        }
      },
      "requires": [
        "5a"
      ],
      "rules": [
        "extract shop_candidates from ownership of top products",
        "if competitor_shops.csv present: clean/normalize and merge with candidates",
        "score shops by product_score_topK, keyword_overlap_quality, category_fit, diversity_contrib",
        "select 4–8 diverse shops; demote near-duplicate or same-root brands",
        "Compute similarity between our listing and each row (title/desc embeddings; tag overlap; attribute match).",
        "Attach similarity.score (0–1) and similarity.label (LOW/MEDIUM/HIGH) per row.",
        "Emit similarity.report and notes; use in later steps (ads/seo/spam guard)."
      ],
      "ruleset": [
        {
          "id": "SHOP_SELECTION_COUNT_RANGE",
          "params": {
            "max": 8,
            "min": 4
          }
        },
        {
          "id": "COVERAGE_MULTIPLE_SEGMENTS",
          "params": {
            "required": true
          }
        },
        {
          "id": "QUALITY_MIN_RATIO_TOP_MATCH",
          "params": {
            "ratio": 0.5
          }
        },
        {
          "id": "EXCLUSIONS",
          "params": {
            "terms": [
              "brand infringement",
              "supplies/DIY heavy"
            ]
          }
        },
        {
          "id": "SIMILARITY_TITLE_DESC_CHECK",
          "params": {}
        },
        {
          "id": "SIMILARITY_TAGS_OVERLAP",
          "params": {}
        },
        {
          "id": "SIMILARITY_ATTRIBUTES_MATCH",
          "params": {}
        },
        {
          "id": "SIMILARITY_SCORE_COMPUTE",
          "params": {}
        },
        {
          "id": "PRODUCT_RECORD_CONFIRMED_REQUIRED",
          "params": {
            "source": "product_record",
            "status": "CONFIRMED"
          }
        }
      ],
      "suggestion_mode": "suppress",
      "title": "Rakip Mağaza Seçimi",
      "ui": {
        "hidden": true
      },
      "ui_directives": {
        "hidden": false
      },
      "upstream_signature": {
        "policy": "mark_stale_on_upstream_change"
      }
    },
    "5c": {
      "enabled": true,
      "title": "Rakip Mağaza Önerileri (8)",
      "ui_directives": {
        "hidden": false
      },
      "ui": {
        "force_visible": true,
        "show": {
          "mode": "full"
        },
        "bindings": {
          "competitor_shop_suggestions": "/steps/5c/outputs/suggestions"
        }
      }
    },
    "5p": {
      "title": "5p",
      "type": "task"
    },
    "6": {
      "artifacts": [
        "competitors.load.report.json"
      ],
      "constraints": {
        "must_confirm": true,
        "no_skip": true,
        "require_gpt_task": false,
        "require_user_task": false,
        "require_validations_pass": true
      },
      "description": "Rakip mağaza listesi CSV’si (örn. competitor_shops.csv) yüklenir; mağaza URL/ID doğrulamaları ve temel temizlik yapılır.",
      "flow": {
        "guard": {
          "advance_only_if": [
            "gates_pass"
          ]
        }
      },
      "gates": {
        "must": [
          "validations_ok"
        ],
        "on_contract_violation": "halt_and_report",
        "on_miss": "halt",
        "on_missing_required_path": "halt_and_report",
        "on_soft_misalignment": "warn_and_continue"
      },
      "input_prep": {
        "apply_common": true,
        "enabled": true,
        "enforce": true,
        "on_fail": "halt",
        "profile_ref": "competitor_listings"
      },
      "inputs": [
        "competitor_shops.csv"
      ],
      "label": "Rakip Mağaza CSV Yükleme (Sessiz Önişleme)",
      "name": "Rakip Mağaza CSV Yükleme",
      "next": [
        "6a"
      ],
      "on_error": {
        "fallback_next": [],
        "policy": "fail-soft"
      },
      "outputs": [
        "competitors.shops[]"
      ],
      "params": {
        "required_columns": [
          "shop_name",
          "shop_url?"
        ]
      },
      "post": {
        "only_signal_ready": true,
        "signal": "competitor_ready"
      },
      "pre": {
        "run_preprocessing": true,
        "silent": true
      },
      "preconditions": {
        "critical_pass": {
          "require_ancestors_done": [
            "0",
            "1",
            "3",
            "4",
            "6",
            "16"
          ]
        }
      },
      "preprocess": {
        "dialect": {
          "lineterminator": "auto"
        },
        "normalize": {
          "strip_bom": true
        }
      },
      "requires": [
        "0a"
      ],
      "title": "Competitor Listings (Genel)",
      "upstream_signature": {
        "policy": "mark_stale_on_upstream_change"
      },
      "validations": {
        "row_min": 1
      },
      "ui": {
        "show": {
          "mode": "summary"
        },
        "bindings": {
          "summary": "/steps/6/outputs/summary"
        }
      }
    },
    "6a": {
      "advisory_pack_similarity": {
        "advisory_signals": {
          "review_rate": true,
          "review_score": true,
          "shop_level_aggregation": {
            "enabled": true,
            "metrics": [
              "avg_price",
              "avg_conversion_rate",
              "avg_review_score",
              "total_listings"
            ]
          }
        },
        "block": false,
        "notes": "Rakip mağaza analizi shop-level özetler (ortalama fiyat, conversion, review) ile desteklenir.",
        "severity": "advisory",
        "similarity_score": {
          "enabled": true,
          "factors": {
            "category_match": 0.2,
            "price_band_match": 0.2,
            "tags_keyword_match": 0.2,
            "title_keyword_match": 0.4
          },
          "normalization": "0_to_1",
          "note": "Rakip ürün benzerlik puanı; Title/Tags/Category/Fiyat üzerinden hesaplanır."
        },
        "title": "Similarity & Shop-Level Signals for Competitors"
      },
      "artifacts": [
        "competitors.analysis.report.json",
        "competitors.keywords.csv"
      ],
      "constraints": {
        "must_confirm": false,
        "no_skip": true,
        "require_gpt_task": false,
        "require_user_task": false,
        "require_validations_pass": true
      },
      "csv_ingest": {
        "delimiter": ",",
        "doublequote": true,
        "encoding_fallbacks": [
          "utf-8-sig",
          "cp1254",
          "latin1",
          "utf-8"
        ],
        "expected_headers": [
          "Title",
          "Monthly sales",
          "Sales",
          "Monthly revenue",
          "Revenue",
          "LQS",
          "Price",
          "Category",
          "Shop",
          "BSR Category (%)",
          "BSR Category",
          "Conversion rate",
          "Creator",
          "Product creation era",
          "Views",
          "Video",
          "URL",
          "Tag count",
          "Tags",
          "Review rate",
          "Reviews",
          "Review score",
          "Production partners",
          "Processing time",
          "Min processing time",
          "Max processing time",
          "Personalization required",
          "Creation date",
          "Favorites",
          "Listing type",
          "Listing age (days)",
          "Vintage",
          "Supply item",
          "Personalizable",
          "Image count",
          "Free US shipping"
        ],
        "normalize_newlines": true,
        "preserve_empty_strings": true,
        "quotechar": "\"",
        "repair_rules": {
          "drop_leading_index_col_if_extra_and_first_is_empty_or_digit": true,
          "drop_trailing_empty_col_if_extra": true
        },
        "report_actions": true,
        "skipinitialspace": false,
        "treat_string_nan_as_literal": true
      },
      "csv_outputs": {
        "clean_csv_path": "/runtime/clean/competitor_listings.csv",
        "encoding_used": null,
        "ingest_report_path": "/runtime/report/competitor_listings.json"
      },
      "description": "Yüklenen rakip mağazalar üzerinden ürün/etiket/başlık ve fiyat dağılımı analiz edilir; kampanya/SEO için özet sinyaller üretilir.",
      "display": {
        "hide": [
          "tables",
          "raw_rows",
          "excel_like"
        ],
        "show": [
          "text_summary",
          "key_metrics"
        ]
      },
      "enabled": true,
      "flow": {
        "guard": {
          "advance_only_if": [
            "gates_pass"
          ]
        }
      },
      "gates": {
        "must": [
          "validations_ok"
        ],
        "on_contract_violation": "halt_and_report",
        "on_miss": "halt",
        "on_missing_required_path": "halt_and_report",
        "on_soft_misalignment": "auto_fix_and_continue"
      },
      "inputs": [
        "competitors.shops[]"
      ],
      "label": "Rakip Mağaza Analizi (Sonuç Odaklı)",
      "name": "Rakip Mağaza Analizi",
      "next": [
        "7",
        "8A",
        "8B"
      ],
      "on_error": {
        "fallback_next": [
          "7"
        ],
        "policy": "fail-soft"
      },
      "outputs": [
        "competitors.products[]",
        "competitors.keywords[]",
        "competitors.signals{}",
        "competitors.*"
      ],
      "params": {
        "extract_fields": [
          "title",
          "tags",
          "price",
          "category",
          "reviews",
          "sales?"
        ],
        "fetch_products": true,
        "max_products_per_shop": 200
      },
      "preconditions": {
        "critical_pass": {
          "require_ancestors_done": [
            "0",
            "1",
            "3",
            "4",
            "6",
            "16"
          ]
        },
        "parent_defined": {
          "exists": true,
          "path": "/workflow_patches/steps/6"
        }
      },
      "requires": [
        "6"
      ],
      "title": "Competitor Listings Upload",
      "ui_directives": {
        "examples": {
          "header_csv": "Title,Monthly sales,Sales,Monthly revenue,Revenue,LQS,Price,Category,Shop,BSR Category (%),BSR Category,Conversion rate,Creator,Product creation era,Views,Video,URL,Tag count,Tags,Review rate,Reviews,Review score,Production partners,Processing time,Min processing time,Max processing time,Personalization required,Creation date,Favorites,Listing type,Listing age (days),Vintage,Supply item,Personalizable,Image count,Free US shipping",
          "render": "code",
          "sample_row_csv": "Tungsten Wedding Band: Cosmic Galaxy Ring with Gold Inlay (8mm),44,943,$5249,$113150,79,$119.99,Jewelry,Mureti,0.0,NaN,0.54%,Shop owner,Made to Order,174992,Yes,https://www.etsy.com/listing/1603322892/tungsten-wedding-band-cosmic-galaxy-ring,13,\"Meteorite Ring,Space Ring,Meteorite Ring Men,Gold Inlay RIng,Wedding Band Men,Wedding Ring Men,Unique Wedding Ring,Promise Ring,Gold Galaxy Ring,Gold Space Ring,Galaxy Wedding Band,Galaxy Gold Ring,Space Gold Ring\",25.66%,242,4.90,None,1.50 days,1 days,2 days,No,\"23 Kas, 2023\",12062,Physical,656,No,No,Yes,9,Yes"
        },
        "expects": "csv_upload",
        "help": "competitor_listings CSV: Başlık sayısı tüm satırlarda eşit olmalı. Fazladan baştaki index veya sondaki boş alan otomatik temizlenir. Boş değerler boş kalır; 'NaN' stringi aynen korunur.\n\nCompetitor Listings CSV — örnek başlık ve ilk satır aşağıdadır.\n• 'Title' içinde virgül/‘-’ olabilir; tırnaklı olduğundan ayrıştırma güvenlidir.\n• Sondaki boş fazlalık otomatik düşer; başlık-satır alan sayısı eşleşmelidir.",
        "templates": {
          "header_only_csv": "/mnt/data/templates/template_6a_header_only.csv"
        }
      },
      "upstream_signature": {
        "policy": "mark_stale_on_upstream_change"
      },
      "validations": {
        "csv": {
          "block_on_header_len_mismatch": true,
          "require_field_count_equals_header": true,
          "warn_on_header_name_mismatch": true
        },
        "signals.non_empty": true
      },
      "ui": {
        "show": {
          "mode": "summary"
        },
        "bindings": {
          "summary": "/steps/6a/outputs/summary"
        }
      }
    },
    "6b": {
      "title": "Competitor Listings Clean (Dedup + Normalize)",
      "ui": {
        "show": {
          "mode": "summary"
        },
        "bindings": {
          "summary": "/steps/6b/outputs/summary"
        }
      }
    },
    "7": {
      "constraints": {
        "bias_correction": "penalize single-shop dominance",
        "min_segments": 3,
        "must_confirm": false,
        "no_derivation": true,
        "no_skip": true,
        "require_gpt_task": false,
        "require_user_task": false,
        "require_validations_pass": false
      },
      "description": "3.a–5b çıktılarından pazar özeti üretilir; Ads için pozitif/negatif çekirdek set hazırlanır.",
      "flow": {
        "guard": {
          "advance_only_if": [
            "gates_pass"
          ]
        }
      },
      "gates": {
        "must": [
          "validations_ok"
        ],
        "on_contract_violation": "halt_and_report",
        "on_miss": "halt",
        "on_missing_required_path": "halt_and_report",
        "on_soft_misalignment": "auto_fix_and_continue"
      },
      "guards": {
        "market_aggregation": {
          "include_negative_keywords": true
        }
      },
      "hitl_contract": {
        "gpt_tasks": [],
        "user_tasks": []
      },
      "inputs": [
        "keywords.pool.ranked[]",
        "keywords.focus[1..4].provisional",
        "draft.title",
        "draft.tags[13]",
        "top_listings.merged",
        "top_listings.keyword_metrics{}",
        "focus.reorder_suggestion",
        "popular.products.top[]",
        "popular.keywords.top[]",
        "popular.segments.summary{}",
        "competitors.selected[]",
        "competitors.profiles{}",
        "alura.metrics"
      ],
      "name": "Market Aggregation & Ads Prep",
      "outputs": [
        "market.snapshot{}",
        "ads.seed.positive[]",
        "ads.seed.negative[]",
        "market.notes"
      ],
      "preconditions": {
        "critical_pass": {
          "require_ancestors_done": [
            "0",
            "1",
            "3",
            "4",
            "6",
            "16"
          ]
        }
      },
      "requires": [
        "5b"
      ],
      "rules": [
        "cluster keywords into themes by material/use_case/audience (+gemstone/style/color/price)",
        "analyze demand-supply gaps: pool vs. popular",
        "ads.seed.positive = high score/conv, pazar uyumlu, rakiplerde kanıtlı",
        "ads.seed.negative = ['DIY','free','tutorial','plated*','kit','supplies','raw*'] + rakip gürültü",
        "prioritize intents: Purchase > Occasion > Material/Style"
      ],
      "ruleset": [
        {
          "id": "NO_DERIVATION",
          "params": {
            "enforced": true
          }
        },
        {
          "id": "MIN_SEGMENTS",
          "params": {
            "count": 3
          }
        },
        {
          "id": "ADS_SEED_NEGATIVE_TERMS",
          "params": {
            "terms": [
              "DIY",
              "free",
              "tutorial",
              "plated*",
              "kit",
              "supplies",
              "raw*"
            ]
          }
        },
        {
          "id": "BIAS_CORRECTION_SINGLE_SHOP",
          "params": {
            "enabled": true
          }
        },
        {
          "id": "PRODUCT_RECORD_CONFIRMED_REQUIRED",
          "params": {
            "source": "product_record",
            "status": "CONFIRMED"
          }
        }
      ],
      "title": "Competitor Shops Upload",
      "upstream_signature": {
        "policy": "mark_stale_on_upstream_change"
      },
      "validations": {
        "present": true
      },
      "ui": {
        "show": {
          "mode": "summary"
        },
        "bindings": {
          "summary": "/steps/7/outputs/summary"
        }
      }
    },
    "8": {
      "constraints": {
        "must_confirm": false,
        "no_skip": true,
        "require_gpt_task": false,
        "require_user_task": false,
        "require_validations_pass": false
      },
      "description": "5a/5b ve 7 çıktılarından kampanya/ad group planını oluşturur; 8B'ye temiz, onaylı plan sağlar.",
      "flow": {
        "guard": {
          "advance_only_if": [
            "gates_pass"
          ]
        }
      },
      "gates": {
        "must": [
          "validations_ok"
        ],
        "on_contract_violation": "halt_and_report",
        "on_miss": "halt",
        "on_missing_required_path": "halt_and_report",
        "on_soft_misalignment": "auto_fix_and_continue"
      },
      "hitl_contract": {
        "gpt_tasks": [],
        "user_tasks": []
      },
      "inputs": [
        "popular.products.top[]",
        "popular.keywords.top[]",
        "market.aggregation{}",
        "seed.terms[]",
        "negative_terms.base[]"
      ],
      "name": "Aggregate",
      "outputs": [
        "ads_plan.csv",
        "negative_keywords.csv",
        "campaign_settings.json",
        "ads_plan.status"
      ],
      "preconditions": {
        "critical_pass": {
          "require_ancestors_done": [
            "0",
            "1",
            "3",
            "4",
            "6",
            "16"
          ]
        }
      },
      "requires": [
        "7"
      ],
      "rules": [
        {
          "id": "8A_GROUPING",
          "title": "Ürün→Campaign/AdGroup eşleme; çeşitlilik koru"
        },
        {
          "id": "8A_SEED_MATCHTYPES",
          "title": "Seed'leri phrase/exact dağıt; genişleme yok"
        },
        {
          "id": "8A_NEGATIVES",
          "title": "Negatif liste uygula (marka/düşük niyet)"
        },
        {
          "id": "8A_BUDGET_GEO",
          "title": "Bütçe & lokasyon öner; onay şart"
        },
        {
          "id": "8A_DUPE_CLEAN",
          "title": "Çift/benzer seed temizliği (exact+semantic)"
        }
      ],
      "title": "Market Aggregation & Ads Generation",
      "upstream_signature": {
        "policy": "mark_stale_on_upstream_change"
      },
      "validations": {
        "present": true
      },
      "ui": {
        "show": {
          "mode": "summary"
        },
        "bindings": {
          "summary": "/steps/8/outputs/summary"
        }
      }
    },
    "8A": {
      "title": "Aggregate"
    },
    "8B": {
      "title": "Ads Keyword Generation",
      "ui": {
        "show": {
          "mode": "summary"
        },
        "bindings": {
          "summary": "/steps/8B/outputs/summary"
        }
      }
    },
    "8a": {
      "constraints": {
        "min_segments_per_group": 1,
        "must_confirm": false,
        "near_duplicate_limit": 1,
        "no_derivation": true,
        "no_skip": true,
        "require_gpt_task": false,
        "require_user_task": false,
        "require_validations_pass": false
      },
      "description": "7. adımdaki çekirdek setlerden Etsy Ads için plan üretilir.",
      "flow": {
        "guard": {
          "advance_only_if": [
            "gates_pass"
          ]
        }
      },
      "gates": {
        "must": [
          "validations_ok"
        ],
        "on_contract_violation": "halt_and_report",
        "on_miss": "halt",
        "on_missing_required_path": "halt_and_report",
        "on_soft_misalignment": "auto_fix_and_continue"
      },
      "guards": {
        "ads_keywords": {
          "ctr_check": true,
          "relevance_check": true
        }
      },
      "hitl_contract": {
        "gpt_tasks": [],
        "user_tasks": []
      },
      "inputs": [
        "ads.seed.positive[]",
        "ads.seed.negative[]",
        "popular.products.top[]",
        "popular.keywords.top[]",
        "top_listings.*",
        "competitors.*",
        "keywords.pool.ranked[]",
        "keywords.focus[1..4]"
      ],
      "name": "Ads Keyword Generation",
      "outputs": [
        "ads.plan{}",
        "ads.keywords.final[]",
        "ads.negative_terms[]",
        "ab_test.plan",
        "ads.governance.notes"
      ],
      "preconditions": {
        "critical_pass": {
          "require_ancestors_done": [
            "0",
            "1",
            "3",
            "4",
            "6",
            "16"
          ]
        },
        "parent_defined": {
          "exists": true,
          "path": "/workflow_patches/steps/8"
        }
      },
      "requires": [
        "8A"
      ],
      "rules": [
        "map segments to AdGroups (Purchase/Occasion/Material-Style/Audience)",
        "select high conv/score, non-duplicate keywords per group",
        "ads.negative_terms = seed + competitor noise terms",
        "ab_test.window_days in [14,30]; single_variable = true",
        "pause if ROAS<1.0 and Clicks>=20",
        "boost if ROAS>=target and Orders>=3"
      ],
      "ruleset": [
        {
          "id": "ADGROUP_SEGMENT_MAPPING",
          "params": {
            "groups": [
              "Purchase",
              "Occasion",
              "Material-Style",
              "Audience"
            ]
          }
        },
        {
          "id": "AB_TEST_WINDOW_DAYS",
          "params": {
            "max": 30,
            "min": 14
          }
        },
        {
          "id": "PAUSE_RULE",
          "params": {
            "clicks_gte": 20,
            "roas_lt": 1.0
          }
        },
        {
          "id": "BOOST_RULE",
          "params": {
            "orders_gte": 3,
            "roas_gte": "target"
          }
        },
        {
          "id": "NO_DERIVATION",
          "params": {
            "enforced": true
          }
        },
        {
          "id": "NEAR_DUP_LIMIT",
          "params": {
            "max_per_group": 1
          }
        },
        {
          "id": "PRODUCT_RECORD_CONFIRMED_REQUIRED",
          "params": {
            "source": "product_record",
            "status": "CONFIRMED"
          }
        }
      ],
      "title": "Ads Keyword Generation (Plan + Anahtarlar)",
      "upstream_signature": {
        "policy": "mark_stale_on_upstream_change"
      },
      "validations": {
        "present": true
      }
    },
    "9": {
      "constraints": {
        "min_segments": 3,
        "must_confirm": false,
        "near_duplicate_limit": 1,
        "negatives": [
          "DIY",
          "free",
          "tutorial",
          "plated*",
          "kit",
          "supplies",
          "raw*"
        ],
        "no_derivation": true,
        "no_skip": true,
        "require_gpt_task": false,
        "require_user_task": false,
        "require_validations_pass": false
      },
      "description": "SEO için odak ve destek anahtar setleri kesinleştirilir; başlık/etiket uyumu sağlanır.",
      "flow": {
        "guard": {
          "advance_only_if": [
            "gates_pass"
          ]
        }
      },
      "gates": {
        "must": [
          "validations_ok"
        ],
        "on_contract_violation": "halt_and_report",
        "on_miss": "halt",
        "on_missing_required_path": "halt_and_report",
        "on_soft_misalignment": "auto_fix_and_continue"
      },
      "guards": {
        "seo_refinement": {
          "balance": [
            "focus",
            "support",
            "long_tail"
          ],
          "diversity_required": true
        }
      },
      "hitl_contract": {
        "gpt_tasks": [],
        "user_tasks": []
      },
      "inputs": [
        "keywords.pool.ranked[]",
        "keywords.focus[1..4]",
        "draft.title",
        "draft.tags[13]",
        "market.snapshot{}",
        "ads.keywords.final[]",
        "popular.keywords.top[]",
        "top_listings.keyword_metrics{}",
        "alura.metrics"
      ],
      "name": "SEO Keyword Refinement",
      "outputs": [
        "seo.keywords.focus[]",
        "seo.keywords.supporting[]",
        "seo.rejected[]",
        "seo.notes"
      ],
      "preconditions": {
        "critical_pass": {
          "require_ancestors_done": [
            "0",
            "1",
            "3",
            "4",
            "6",
            "16"
          ]
        }
      },
      "requires": [
        "8B"
      ],
      "rules": [
        "validate focus_1..4 with market/performance overlap",
        "construct supporting set from long-tail/niche keywords",
        "avoid duplication: no repeated roots across title/tags",
        "no duplicates with category attributes",
        "record rationale for each acceptance/rejection"
      ],
      "ruleset": [
        {
          "id": "NO_DERIVATION",
          "params": {
            "enforced": true
          }
        },
        {
          "id": "MIN_SEGMENTS",
          "params": {
            "count": 3
          }
        },
        {
          "id": "NEAR_DUP_LIMIT",
          "params": {
            "max": 1
          }
        },
        {
          "id": "NEGATIVE_TERMS",
          "params": {
            "terms": [
              "DIY",
              "free",
              "tutorial",
              "plated*",
              "kit",
              "supplies",
              "raw*"
            ]
          }
        },
        {
          "id": "RECORD_RATIONALE",
          "params": {
            "required": true
          }
        },
        {
          "id": "PRODUCT_RECORD_CONFIRMED_REQUIRED",
          "params": {
            "source": "product_record",
            "status": "CONFIRMED"
          }
        }
      ],
      "title": "SEO Keyword Refinement",
      "upstream_signature": {
        "policy": "mark_stale_on_upstream_change"
      },
      "validations": {
        "present": true
      },
      "ui": {
        "show": {
          "mode": "summary"
        },
        "bindings": {
          "summary": "/steps/9/outputs/summary"
        }
      }
    },
    "seo_package": {
      "constraints": {
        "desc_word_count_max": 500,
        "desc_word_count_min": 300,
        "must_confirm": false,
        "no_derivation": true,
        "no_skip": true,
        "par_max": 5,
        "par_min": 2,
        "require_gpt_task": false,
        "require_user_task": false,
        "require_validations_pass": false,
        "title_max_chars": 140,
        "title_min_chars": 80
      },
      "description": "Başlık (10), Açıklama (11) ve Etiketler (12) çıktılarının birlikte kalite kontrolü yapılır.",
      "flow": {
        "guard": {
          "advance_only_if": [
            "gates_pass"
          ]
        }
      },
      "gates": {
        "must": [
          "validations_ok"
        ],
        "on_contract_violation": "halt_and_report",
        "on_miss": "halt",
        "on_missing_required_path": "halt_and_report",
        "on_soft_misalignment": "warn_and_continue"
      },
      "governance": {
        "notes_required": true,
        "qc_checklist": [
          "title_frontload_focus",
          "title_length_ok",
          "desc_paragraphs_ok",
          "desc_word_count_ok",
          "tags_13_unique",
          "tags_segment_diversity",
          "no_root_duplicates",
          "no_negatives"
        ]
      },
      "inputs": [
        "draft.title",
        "draft.description",
        "draft.tags[13]",
        "seo.keywords.focus[]",
        "seo.keywords.supporting[]",
        "alura.metrics",
        "popular.keywords.top[]",
        "top_listings.keyword_metrics{}"
      ],
      "name": "SEO Package QC",
      "outputs": [
        "seo_package.qc_report",
        "seo_package.issues[]",
        "seo_package.recommendations[]"
      ],
      "preconditions": {
        "critical_pass": {
          "require_ancestors_done": [
            "0",
            "1",
            "3",
            "4",
            "6",
            "16"
          ]
        }
      },
      "rules": [
        "title: 80-140 chars, front-load focus_1, no stuffing, no ALL CAPS",
        "description: 300-500 words, 2-5 paragraphs, first sentence includes focus_1, scannable (short paragraphs, bullets)",
        "tags: 13 unique, >=3 segments (material/use_case/audience), no duplicates with category attributes, max 1 same-root",
        "all three outputs aligned thematically",
        "exclude negatives: ['DIY','free','tutorial','plated*','kit','supplies','raw*']"
      ],
      "ruleset": [
        {
          "id": "TITLE_LENGTH_RANGE",
          "params": {
            "max": 140,
            "min": 80
          }
        },
        {
          "id": "DESC_WORDCOUNT_RANGE",
          "params": {
            "max": 500,
            "min": 300
          }
        },
        {
          "id": "DESC_PARAGRAPHS_RANGE",
          "params": {
            "max": 5,
            "min": 2
          }
        },
        {
          "id": "TAGS_COUNT_13",
          "params": {
            "count": 13
          }
        },
        {
          "id": "SEGMENT_DIVERSITY_MIN",
          "params": {
            "min": 3
          }
        },
        {
          "id": "NO_ROOT_DUPLICATES",
          "params": {
            "enforced": true
          }
        },
        {
          "id": "NEGATIVE_TERMS",
          "params": {
            "terms": [
              "DIY",
              "free",
              "tutorial",
              "plated*",
              "kit",
              "supplies",
              "raw*"
            ]
          }
        }
      ],
      "title": "SEO Package QC (Title + Description + Tags)",
      "upstream_signature": {
        "policy": "mark_stale_on_upstream_change"
      },
      "validations": {
        "present": true
      }
    },
    "8C": {
      "ui": {
        "show": {
          "mode": "summary"
        },
        "bindings": {
          "summary": "/steps/8C/outputs/summary"
        }
      }
    },
    "12a": {
      "ui": {
        "show": {
          "mode": "summary"
        },
        "bindings": {
          "summary": "/steps/12a/outputs/summary"
        }
      }
    }
  },
  "success_criteria": {
    "1b_Search_Suggestions": {
      "count": 8,
      "diversity_required": true,
      "language": "EN",
      "token_length": 2
    }
  },
  "suggestions": {
    "enabled": false
  },
  "token_tracking": {
    "last_baseline_reload_at": null,
    "last_update_at": "2025-09-03T14:27:52.188994+03:00",
    "limit_estimate": {
      "estimated_used": 0,
      "max_tokens": 128000,
      "updated_at": "2025-09-04T19:23:07Z",
      "used_pct": 0.0
    },
    "notes": "X",
    "reset_at": "2025-09-05T08:04:37",
    "reset_reason": "restore",
    "update_counter": 11
  },
  "ui_policy": {
    "force_visibility": true,
    "hide_intermediate_tables": true,
    "no_excel_view_in_production": true,
    "no_reprompt_csv_rules": true,
    "no_spreadsheet_dump": true,
    "require_user_ack_per_step": false,
    "result_only_mode": true,
    "show_examples_from_json": true,
    "show_rule_check": true,
    "single_line_errors": true,
    "surface": {
      "on_error": [
        "short_error_message",
        "anomaly_brief"
      ],
      "on_success": [
        "text_summary",
        "key_metrics"
      ]
    },
    "text_first": true,
    "verbosity": "minimal"
  },
  "validations": {
    "7": [
      "≤140 chars",
      "Contains ≤2 repeated root words",
      "Contains 1–2 focus keywords from pool",
      "No forbidden patterns"
    ],
    "8": [
      "4–6 unique focus keywords used naturally",
      "≤3 lines per paragraph",
      "Shipping block matches Product Info",
      "No keyword stuffing"
    ],
    "8a": [
      "No duplicate roots across tags",
      "≥8 distinct tags from pool/market data",
      "Attributes consistent with materials, color, size"
    ],
    "9": [
      "Min 5 distinct angles",
      "Variations visible",
      "No watermark/overlays"
    ]
  },
  "version_id": "b0637d23-f8e9-4431-917c-505bdf80fc9d",
  "workflow_enforcement": {
    "error_handling": {
      "on_missing_required_file": "stop_and_request_upload",
      "on_unexpected_field": "show_textual_warning_keep_original",
      "on_validation_warn": "stop_and_show_textual_diff"
    },
    "execution_order": [
      "0a",
      "00",
      "0",
      "1",
      "1a",
      "1b",
      "3",
      "3a",
      "3b",
      "3c",
      "5",
      "5a",
      "5b",
      "5c",
      "6",
      "6a",
      "6b",
      "7",
      "8",
      "8a",
      "8B",
      "8C",
      "9",
      "10",
      "11",
      "12",
      "12a",
      "13",
      "14",
      "15",
      "16",
      "17",
      "18",
      "18a",
      "19",
      "20",
      "seo_package"
    ],
    "gates_model": "gates_pass = user_done && gpt_done && validations_ok",
    "guards": {
      "require_ack_before": {
        "media_upload": {
          "before_step": "1a"
        },
        "csv_upload_top_listings": {
          "before_step": "4"
        },
        "csv_upload_similar": {
          "before_step": "3"
        },
        "csv_upload_competitor": {
          "before_step": "6"
        },
        "record_type_decision": {
          "before_step": "16"
        }
      },
      "unknown_step": {
        "action": "warn_and_skip",
        "error_code": "UNKNOWN_STEP_SKIPPED",
        "message": "Step not present/defined; skipping with digest note."
      }
    },
    "no_alt_skip": true,
    "no_skip": true,
    "production_mode": {
      "no_external_guessing": true,
      "prohibit_background_invention": true,
      "single_source_of_truth": "THIS_JSON"
    },
    "require_step_completion": "Each step and substep must record DONE with success_criteria met.",
    "rules": {
      "auto_apply_non_mandatory": true,
      "auto_backtrack_fix_allowed": true,
      "auto_resume": true,
      "auto_run_without_user_approval": true,
      "correction_checkpoint": "18",
      "correction_checkpoints": [
        "16",
        "18"
      ],
      "critical_ancestors": [
        "0",
        "1",
        "3",
        "4",
        "6",
        "16"
      ],
      "default_record_type_on_new_session": "preview",
      "default_step_contract": {
        "gates": {
          "on_contract_violation": "halt_and_report",
          "on_missing_required_path": "halt_and_report",
          "on_soft_misalignment": "warn_and_continue"
        },
        "preconditions": {
          "critical_pass": {
            "require_ancestors_done": [
              "0",
              "1",
              "3",
              "4",
              "6",
              "16"
            ]
          }
        },
        "upstream_signature": {
          "policy": "mark_stale_on_upstream_change"
        }
      },
      "dependency_policy": "strict",
      "enforce_user_ack": true,
      "incoming_merge_policy": "deep_merge_no_delete",
      "incoming_requires_same_canonical": true,
      "no_pause_steps": [
        "0",
        "1",
        "3",
        "4",
        "6",
        "16"
      ],
      "parent_rollup": "auto_done_if_all_substeps_done_and_gates_pass",
      "post_update_emit_change_receipt": true,
      "record_type": {
        "allowed": [
          "publish",
          "draft"
        ],
        "decision_step": "16",
        "lock_after_step": "16",
        "required": true
      },
      "reject_non_canonical_writes": true,
      "require_record_type_after_step": "16",
      "require_sha_match_before_write": true,
      "steps_persistence": {
        "allow_workshop_changes": true,
        "autosnapshot_on_modify": true,
        "lock_default": true,
        "max_snapshots": 20,
        "require_unlock_to_modify": true
      },
      "user_required_steps": {
        "csv_upload_steps": [
          "3",
          "4",
          "6"
        ],
        "media_upload_step": "1",
        "product_info_step": "0",
        "record_type_decision_step": "16"
      },
      "require_execution_order": true
    },
    "success_criteria": {
      "0_Product_Info": {
        "user_seen_confirmed": true
      },
      "1b_Search_Suggestions": {
        "count": 8,
        "diversity_required": true,
        "language": "EN",
        "token_length": 2
      },
      "3_Similar_CSV_Upload": {
        "files_required": 8
      },
      "csv_inputs": {
        "competitor_listings": {
          "profile": "competitor_listings"
        },
        "similar_keywords": {
          "profile": "similar_keywords"
        },
        "top_listings": {
          "profile": "top_listings"
        }
      },
      "csv_pipeline": [
        "detect",
        "read_options",
        "cleaning",
        "alignment",
        "normalization",
        "validate"
      ]
    },
    "ui_policy": {
      "no_spreadsheet_dump": true,
      "show_examples_from_json": true,
      "text_first": true
    },
    "hard_halt_on_violation": true,
    "csv_pipeline": {
      "similar_keywords_csv": [
        "3",
        "3a",
        "3b",
        "3c"
      ],
      "top_listings_csv": [
        "4",
        "5",
        "5a",
        "5b"
      ],
      "competitor_shops_csv": [
        "6",
        "6a",
        "6b"
      ]
    },
    "execution_order_all": [
      {
        "id": "0",
        "enabled": true
      },
      {
        "id": "00",
        "enabled": true
      },
      {
        "id": "0a",
        "enabled": true
      },
      {
        "id": "1",
        "enabled": true
      },
      {
        "id": "1a",
        "enabled": true
      },
      {
        "id": "1b",
        "enabled": true
      },
      {
        "id": "3",
        "enabled": true
      },
      {
        "id": "3a",
        "enabled": true
      },
      {
        "id": "3b",
        "enabled": true
      },
      {
        "id": "4",
        "enabled": false
      },
      {
        "id": "5",
        "enabled": true
      },
      {
        "id": "5a",
        "enabled": true
      },
      {
        "id": "6",
        "enabled": true
      },
      {
        "id": "6a",
        "enabled": true
      },
      {
        "id": "7",
        "enabled": true
      },
      {
        "id": "8",
        "enabled": true
      },
      {
        "id": "8a",
        "enabled": true
      },
      {
        "id": "9",
        "enabled": true
      },
      {
        "id": "10",
        "enabled": true
      },
      {
        "id": "11",
        "enabled": true
      },
      {
        "id": "12",
        "enabled": true
      },
      {
        "id": "14",
        "enabled": true
      },
      {
        "id": "15",
        "enabled": true
      },
      {
        "id": "16",
        "enabled": true
      },
      {
        "id": "17",
        "enabled": true
      },
      {
        "id": "18",
        "enabled": true
      },
      {
        "id": "19",
        "enabled": true
      },
      {
        "id": "20",
        "enabled": true
      },
      {
        "id": "13",
        "enabled": true
      },
      {
        "id": "18a",
        "enabled": false
      },
      {
        "id": "3c",
        "enabled": true
      },
      {
        "id": "4a",
        "enabled": true
      },
      {
        "id": "4b",
        "enabled": true
      },
      {
        "id": "5b",
        "enabled": false
      },
      {
        "id": "6b",
        "enabled": true
      },
      {
        "id": "ab.1",
        "enabled": false
      },
      {
        "id": "ads.1",
        "enabled": false
      },
      {
        "id": "kw.1",
        "enabled": false
      },
      {
        "id": "media.1",
        "enabled": false
      },
      {
        "id": "seo.1",
        "enabled": false
      },
      {
        "id": "seo_package",
        "enabled": true
      },
      {
        "id": "trend.1",
        "enabled": false
      },
      {
        "id": "5c",
        "enabled": true
      }
    ]
  },
  "workflow_patches": {
    "audit_log": [
      {
        "actor": "gpt",
        "affected_steps": [],
        "change": "Governance Full Safety Pack yüklendi",
        "patch_n": 0,
        "ruleset_sha": "5aa532c31929b31eb7ef291d2e70f1d4204b5e8cb56e3a56fd99d64e32d664d5",
        "timestamp": "2025-09-04T05:51:14Z"
      },
      {
        "actor_tool": "gpt",
        "actor_user": "mcinar1905",
        "affected_steps": [
          "00",
          "14",
          "21"
        ],
        "change": "Governance Advanced Pack eklendi",
        "patch_n": 1,
        "ruleset_sha": "f9b56f1c545a4cde66282c6ee6e8a3e17754558d79c89b8aaa5a106ef0664bc3",
        "timestamp": "2025-09-04T06:11:10Z"
      },
      {
        "actor_tool": "gpt",
        "actor_user": "mcinar1905",
        "change": "size_shrink_guard eklendi",
        "details": {
          "action": "ask_consent",
          "block_on_unknown_reason": true,
          "min_bytes": 2048,
          "require_reason": true,
          "threshold_pct": 0.5
        },
        "patch_n": 2,
        "timestamp": "2025-09-04T18:24:48Z"
      },
      {
        "actor_tool": "gpt",
        "actor_user": "mcinar1905",
        "change": "final_marker + answering_policy eklendi",
        "details": {
          "answering_policy": {
            "block_on_mismatch_checksum": true,
            "block_on_missing_final_marker": true,
            "require_json_path_citations": true,
            "source_of_truth": "this_file"
          },
          "final_sha256": "be80f5e1cb8529caf64df459ce1f834cddaf8a2909a663a12891648d8aa1e7af"
        },
        "event": "final_marker_set",
        "patch_n": 3,
        "timestamp": "2025-09-04T18:29:55Z"
      },
      {
        "actor_tool": "gpt",
        "actor_user": "mcinar1905",
        "change": "size_change_notice eklendi",
        "details": {
          "action": "log_only",
          "min_bytes": 0,
          "notify_on_growth": true,
          "notify_on_shrink": true,
          "threshold_pct": 0.01
        },
        "event": "guard_added",
        "patch_n": 4,
        "timestamp": "2025-09-04T18:31:46Z"
      },
      {
        "actor_tool": "gpt",
        "actor_user": "mcinar1905",
        "change": "records canonical_types + aliases + guard + example_artifacts eklendi",
        "details": {
          "aliases": {
            "example": "ornek",
            "örnek": "ornek"
          },
          "canonical_types": [
            "final",
            "ornek"
          ],
          "example_primary": "EXAMPLE_LATEST.json",
          "guard": "ornek_must_equal_final"
        },
        "event": "records_policy_added",
        "patch_n": 5,
        "timestamp": "2025-09-04T18:44:08Z"
      },
      {
        "actor_tool": "gpt",
        "actor_user": "mcinar1905",
        "change": "final_marker + answering_policy eklendi",
        "details": {
          "after_bytes": 1881583,
          "before_bytes": 1880579,
          "delta_bytes": 1004,
          "delta_pct": 0.0534,
          "notify_on": "growth"
        },
        "event": "size_change_notice",
        "patch_n": 7,
        "timestamp": "2025-09-04T18:49:13Z"
      },
      {
        "actor_tool": "gpt",
        "actor_user": "mcinar1905",
        "change": "size_change_notice eklendi",
        "details": {
          "after_bytes": 1882237,
          "before_bytes": 1881583,
          "delta_bytes": 654,
          "delta_pct": 0.0348,
          "notify_on": "growth"
        },
        "event": "size_change_notice",
        "patch_n": 8,
        "timestamp": "2025-09-04T18:49:13Z"
      },
      {
        "actor_tool": "gpt",
        "actor_user": "mcinar1905",
        "change": "records policy eklendi",
        "details": {
          "after_bytes": 1883349,
          "before_bytes": 1882237,
          "delta_bytes": 1112,
          "delta_pct": 0.0591,
          "notify_on": "growth"
        },
        "event": "size_change_notice",
        "patch_n": 9,
        "timestamp": "2025-09-04T18:49:13Z"
      },
      {
        "actor_tool": "gpt",
        "actor_user": "mcinar1905",
        "change": "guard_zinciri + write_pipeline + self_tests + observe_policy_writes etkin",
        "details": {
          "enforce_guard_chain": [
            "preflight_self_test",
            "size_change_notice",
            "size_shrink_guard"
          ],
          "self_tests": {
            "block_on_shrink_over_threshold": true,
            "require_audit_entry_on_any_write": true,
            "require_notice_on_size_change": true
          },
          "size_change_notice.observe_policy_writes": true,
          "write_pipeline": {
            "check": [
              "size_change_notice",
              "size_shrink_guard"
            ],
            "commit": "if_all_pass",
            "dry_run": true,
            "pre": [
              "preflight_self_test"
            ]
          }
        },
        "event": "workflow_policy_updated",
        "patch_n": 10,
        "timestamp": "2025-09-04T18:49:13Z"
      },
      {
        "actor_tool": "gpt",
        "actor_user": "mcinar1905",
        "change": "store+product+step0 patch uygulandı",
        "details": {
          "after_bytes": 1888807,
          "before_bytes": 1886237,
          "delta_bytes": 2570,
          "delta_pct": 0.1363,
          "notify_on": "growth"
        },
        "event": "size_change_notice",
        "patch_n": 12,
        "timestamp": "2025-09-04T18:58:45Z"
      },
      {
        "actor_tool": "gpt",
        "actor_user": "mcinar1905",
        "change": "Mağaza/Ürün + Step0 review guard'ları eklendi (publish guard YOK)",
        "details": {
          "guards": [
            "enforce_ship_countries",
            "hide_discount_in_outputs",
            "require_prices_at_step0",
            "require_pre_start_confirmation"
          ],
          "product_static": true,
          "removed_publish_guard": true,
          "store_profile": true
        },
        "event": "store_product_profile_applied",
        "patch_n": 13,
        "timestamp": "2025-09-04T18:58:45Z"
      },
      {
        "actor_tool": "gpt",
        "actor_user": "mcinar1905",
        "change": "batch_enforcer eklendi",
        "details": {
          "after_bytes": 1890859,
          "before_bytes": 1889874,
          "delta_bytes": 985,
          "delta_pct": 0.0521,
          "notify_on": "growth"
        },
        "event": "size_change_notice",
        "patch_n": 15,
        "timestamp": "2025-09-04T19:04:16Z"
      },
      {
        "actor_tool": "gpt",
        "actor_user": "mcinar1905",
        "change": "runtime.batch + _policy.batch + guard(batch_enforcer) + chain/pipeline güncellendi",
        "details": {
          "enforce_guard_chain": [
            "preflight_self_test",
            "batch_enforcer",
            "size_change_notice",
            "size_shrink_guard"
          ],
          "guard": "batch_enforcer",
          "policy_batch": {
            "max_updates": 5,
            "on_reach_max": "ask_restore_fifth",
            "on_timeout": "ask_reupload_latest",
            "timeout_minutes": 60
          },
          "write_pipeline_check": [
            "batch_enforcer",
            "size_change_notice",
            "size_shrink_guard"
          ]
        },
        "event": "batch_policy_added",
        "patch_n": 16,
        "timestamp": "2025-09-04T19:04:16Z"
      },
      {
        "actor_tool": "gpt",
        "actor_user": "mcinar1905",
        "change": "batch status + ui banner eklendi",
        "details": {
          "after_bytes": 1893055,
          "before_bytes": 1892173,
          "delta_bytes": 882,
          "delta_pct": 0.0466,
          "notify_on": "growth"
        },
        "event": "size_change_notice",
        "patch_n": 18,
        "timestamp": "2025-09-04T19:10:31Z"
      },
      {
        "actor_tool": "gpt",
        "actor_user": "mcinar1905",
        "change": "runtime.batch.status + update_batch_status guard + global_banner(template) eklendi",
        "details": {
          "enforce_guard_chain": [
            "preflight_self_test",
            "batch_enforcer",
            "update_batch_status",
            "size_change_notice",
            "size_shrink_guard"
          ],
          "status_path": "/runtime/batch/status",
          "ui_banner_rendered": "/workflow_patches/ui/global_banner_rendered",
          "ui_banner_template": "/workflow_patches/ui/global_banner",
          "write_pipeline_check": [
            "batch_enforcer",
            "size_change_notice",
            "size_shrink_guard",
            "update_batch_status"
          ]
        },
        "event": "batch_status_enabled",
        "patch_n": 19,
        "timestamp": "2025-09-04T19:10:31Z"
      },
      {
        "actor_tool": "gpt",
        "actor_user": "mcinar1905",
        "change": "token_limit_tracker + thresholds unify",
        "details": {
          "after_bytes": 1895318,
          "before_bytes": 1894409,
          "delta_bytes": 909,
          "delta_pct": 0.048,
          "notify_on": "growth"
        },
        "event": "size_change_notice",
        "patch_n": 21,
        "timestamp": "2025-09-04T19:20:30Z"
      },
      {
        "actor_tool": "gpt",
        "actor_user": "mcinar1905",
        "change": "policy/governance eşikleri 80/95 ve token_limit_tracker guard eklendi",
        "details": {
          "_policy.token_tracking.block_threshold_pct": 95,
          "_policy.token_tracking.warn_threshold_pct": 80,
          "chain": [
            "preflight_self_test",
            "batch_enforcer",
            "update_batch_status",
            "token_limit_tracker",
            "size_change_notice",
            "size_shrink_guard"
          ],
          "governance.block_threshold_percent": 95,
          "governance.warn_threshold_percent": 80,
          "guard": "token_limit_tracker",
          "write_pipeline_check": [
            "batch_enforcer",
            "size_change_notice",
            "size_shrink_guard",
            "update_batch_status",
            "token_limit_tracker"
          ]
        },
        "event": "token_limit_policy_added",
        "patch_n": 22,
        "timestamp": "2025-09-04T19:20:30Z"
      },
      {
        "actor_tool": "gpt",
        "actor_user": "mcinar1905",
        "change": "Batch status + token banner render",
        "details": {
          "counter": 0,
          "deadline_at": "2025-09-04T20:23:07Z",
          "minutes_left": 60,
          "started_at": "2025-09-04T19:23:07Z",
          "token_used_pct": 0.0
        },
        "event": "status_banner_rendered",
        "patch_n": 24,
        "timestamp": "2025-09-04T19:23:07Z"
      },
      {
        "actor_tool": "gpt",
        "actor_user": "mcinar1905",
        "change": "atomic writes + always_log + post(render_banners) eklendi",
        "details": {
          "after_bytes": 1898219,
          "before_bytes": 1897465,
          "delta_bytes": 754,
          "delta_pct": 0.0397,
          "notify_on": "growth"
        },
        "event": "size_change_notice",
        "patch_n": 26,
        "timestamp": "2025-09-04T19:29:08Z"
      },
      {
        "actor_tool": "gpt",
        "actor_user": "mcinar1905",
        "change": "self_tests.require_notice_on_any_write + size_change_notice.always_log + write_pipeline.post(render_banners)",
        "details": {
          "atomic_writes": true,
          "post_steps": [
            "render_banners"
          ],
          "require_notice_on_any_write": true,
          "size_change_notice.always_log": true
        },
        "event": "atomic_pipeline_enabled",
        "patch_n": 27,
        "timestamp": "2025-09-04T19:29:08Z"
      },
      {
        "actor_tool": "gpt",
        "actor_user": "mcinar1905",
        "change": "step_id_aliases + step_plan_enforcer eklendi",
        "details": {
          "after_bytes": 1900125,
          "before_bytes": 1899231,
          "delta_bytes": 894,
          "delta_pct": 0.0471,
          "notify_on": "growth"
        },
        "event": "size_change_notice",
        "patch_n": 29,
        "timestamp": "2025-09-04T19:48:08Z"
      },
      {
        "actor_tool": "gpt",
        "actor_user": "mcinar1905",
        "change": "ID normalization + aliases + plan enforcement (standalone/rules allow)",
        "details": {
          "aliases_added": {
            "1.a": "1a",
            "1.b": "1b",
            "3.a": "3a",
            "3.b": "3b"
          },
          "enforce_guard_chain": [
            "preflight_self_test",
            "batch_enforcer",
            "step_plan_enforcer",
            "update_batch_status",
            "token_limit_tracker",
            "size_change_notice",
            "size_shrink_guard"
          ],
          "write_pipeline_check": [
            "step_plan_enforcer",
            "batch_enforcer",
            "size_change_notice",
            "size_shrink_guard",
            "update_batch_status",
            "token_limit_tracker"
          ]
        },
        "event": "steps_sync_enabled",
        "patch_n": 30,
        "timestamp": "2025-09-04T19:48:08Z"
      },
      {
        "actor_tool": "gpt",
        "actor_user": "mcinar1905",
        "change": "batch warn + token warn bağlandı; render_banners check'e eklendi",
        "details": {
          "after_bytes": 1901673,
          "before_bytes": 1901557,
          "delta_bytes": 116,
          "delta_pct": 0.0061,
          "notify_on": "growth"
        },
        "event": "size_change_notice",
        "patch_n": 32,
        "timestamp": "2025-09-04T19:52:06Z"
      },
      {
        "actor_tool": "gpt",
        "actor_user": "mcinar1905",
        "change": "update_batch_status.warn(5dk) + notify_and_banner; token_limit_tracker actions confirmed; render_banners check+post",
        "details": {
          "update_batch_status": {
            "action_on_warn": "notify_and_banner",
            "clock": "utc",
            "compute_minutes_left": true,
            "counter_path": "/runtime/batch/counter",
            "deadline_at_path": "/runtime/batch/deadline_at",
            "enabled": true,
            "started_at_path": "/runtime/batch/started_at",
            "status_path": "/runtime/batch/status",
            "ui_banner": {
              "enabled": true,
              "template_path": "/workflow_patches/ui/global_banner",
              "write_target": "/workflow_patches/ui/global_banner_rendered"
            },
            "warn_threshold_minutes": 5
          },
          "write_pipeline_check": [
            "step_plan_enforcer",
            "batch_enforcer",
            "size_change_notice",
            "size_shrink_guard",
            "update_batch_status",
            "token_limit_tracker",
            "render_banners"
          ],
          "write_pipeline_post": [
            "render_banners"
          ]
        },
        "event": "warn_and_render_enabled",
        "patch_n": 33,
        "timestamp": "2025-09-04T19:52:06Z"
      },
      {
        "actor_tool": "gpt",
        "actor_user": "mcinar1905",
        "change": "neverlose_bundle eklendi (immutable core + drift alarm + auto backup)",
        "details": {
          "after_bytes": 1905004,
          "before_bytes": 1903544,
          "delta_bytes": 1460,
          "delta_pct": 0.0767,
          "notify_on": "growth"
        },
        "event": "size_change_notice",
        "patch_n": 35,
        "timestamp": "2025-09-04T20:01:05Z"
      },
      {
        "actor_tool": "gpt",
        "actor_user": "mcinar1905",
        "change": "required_paths + lock_core_guard + auto_backup + drift_detector + core_digest set",
        "details": {
          "core_digest": "542915b16f0766c92fd057b43b5dbc2ab0f28ce3d22034304c5afd54b965ece7",
          "guard_order_chain": [
            "auto_backup",
            "drift_detector",
            "preflight_self_test",
            "batch_enforcer",
            "step_plan_enforcer",
            "update_batch_status",
            "token_limit_tracker",
            "size_change_notice",
            "size_shrink_guard"
          ],
          "guard_order_pre": [
            "auto_backup",
            "drift_detector",
            "preflight_self_test"
          ],
          "required_paths": [
            "/_policy/workflow/enforce_guard_chain",
            "/_policy/workflow/write_pipeline",
            "/_policy/workflow/guards/size_change_notice",
            "/_policy/workflow/guards/size_shrink_guard",
            "/_policy/workflow/guards/batch_enforcer",
            "/_policy/workflow/guards/update_batch_status",
            "/_policy/workflow/guards/token_limit_tracker",
            "/_policy/workflow/guards/step_plan_enforcer",
            "/_store_profile",
            "/_product_static"
          ]
        },
        "event": "neverlose_enabled",
        "patch_n": 36,
        "timestamp": "2025-09-04T20:01:05Z"
      },
      {
        "actor_tool": "gpt",
        "actor_user": "mcinar1905",
        "change": "alert_router eklendi (arka plan uyarı kuyruğu + UI mirror + attention bayrağı)",
        "details": {
          "after_bytes": 1908661,
          "before_bytes": 1906922,
          "delta_bytes": 1739,
          "delta_pct": 0.0912,
          "notify_on": "growth"
        },
        "event": "size_change_notice",
        "patch_n": 38,
        "timestamp": "2025-09-04T20:06:52Z"
      },
      {
        "actor_tool": "gpt",
        "actor_user": "mcinar1905",
        "change": "alert_router write_pipeline.check/post içine eklendi; self_test alert delivery etkin",
        "details": {
          "write_pipeline_check": [
            "step_plan_enforcer",
            "batch_enforcer",
            "size_change_notice",
            "size_shrink_guard",
            "update_batch_status",
            "token_limit_tracker",
            "alert_router",
            "render_banners"
          ],
          "write_pipeline_post": [
            "alert_router",
            "render_banners"
          ]
        },
        "event": "alerting_enabled",
        "patch_n": 39,
        "timestamp": "2025-09-04T20:06:52Z"
      },
      {
        "actor_tool": "gpt",
        "actor_user": "mcinar1905",
        "change": "silent_autofix + session_bootstrap eklendi",
        "details": {
          "after_bytes": 1911188,
          "before_bytes": 1909884,
          "delta_bytes": 1304,
          "delta_pct": 0.0683,
          "notify_on": "growth"
        },
        "event": "size_change_notice",
        "patch_n": 41,
        "timestamp": "2025-09-04T20:30:42Z"
      },
      {
        "actor_tool": "gpt",
        "actor_user": "mcinar1905",
        "change": "checklist_enforcer + quiet_mode + session bootstrap",
        "details": {
          "pre_pipeline": [
            "checklist_enforcer",
            "auto_backup",
            "drift_detector",
            "preflight_self_test"
          ],
          "strict_source_of_truth": true
        },
        "event": "silent_autofix_enabled",
        "patch_n": 42,
        "timestamp": "2025-09-04T20:30:42Z"
      },
      {
        "actor_tool": "gpt",
        "actor_user": "mcinar1905",
        "change": "time_daemon_guard eklendi (realtime_check)",
        "details": {
          "after_bytes": 1912590,
          "before_bytes": 1912139,
          "delta_bytes": 451,
          "delta_pct": 0.0236,
          "notify_on": "growth"
        },
        "event": "size_change_notice",
        "patch_n": 44,
        "timestamp": "2025-09-04T20:37:22Z"
      },
      {
        "actor_tool": "gpt",
        "actor_user": "mcinar1905",
        "change": "minutes_left updated based on real UTC clock at each write",
        "details": {
          "guard_in_chain": true,
          "guard_in_pre": true
        },
        "event": "time_daemon_guard_enabled",
        "patch_n": 45,
        "timestamp": "2025-09-04T20:37:22Z"
      }
    ],
    "audit_log_detailed": [
      {
        "actor_tool": "gpt",
        "actor_user": "mcinar1905",
        "changes": [],
        "patch_n": 0,
        "summary": "Toplu güvenlik & audit/policy patch",
        "timestamp": "2025-09-04T06:11:10Z"
      }
    ],
    "governance": {
      "actor_bindings": {
        "default_actor": "gpt_prod_executor_v1",
        "steps": {
          "0": "gpt_prod_executor_v1",
          "1": "gpt_prod_executor_v1",
          "10": "gpt_prod_executor_v1",
          "11": "gpt_prod_executor_v1",
          "12": "gpt_prod_executor_v1",
          "14": "gpt_prod_executor_v1",
          "15": "gpt_prod_executor_v1",
          "16": "gpt_prod_executor_v1",
          "17": "gpt_prod_executor_v1",
          "18": "gpt_prod_executor_v1",
          "19": "gpt_prod_executor_v1",
          "1a": "gpt_prod_executor_v1",
          "1b": "gpt_prod_executor_v1",
          "20": "gpt_prod_executor_v1",
          "3": "gpt_prod_executor_v1",
          "3a": "gpt_prod_executor_v1",
          "3b": "gpt_prod_executor_v1",
          "4": "gpt_prod_executor_v1",
          "5": "gpt_prod_executor_v1",
          "5a": "gpt_prod_executor_v1",
          "6": "gpt_prod_executor_v1",
          "6a": "gpt_prod_executor_v1",
          "7": "gpt_prod_executor_v1",
          "8": "gpt_prod_executor_v1",
          "8a": "gpt_prod_executor_v1",
          "9": "gpt_prod_executor_v1"
        }
      },
      "approval_guard": {
        "case_insensitive": true,
        "require_diff_preview": true,
        "require_phrase": "onaylıyorum",
        "require_user_sha_match": true
      },
      "auto_resume": {
        "checkpoints": [
          "3b",
          "4b",
          "6b",
          "3c",
          "11",
          "12",
          "16"
        ],
        "enabled": true
      },
      "correction_checkpoints": [
        "16",
        "18"
      ],
      "csv_schema_mode": {
        "default": "forgiving",
        "on_mismatch": "silent"
      },
      "diff_store": {
        "embed_in_json": false,
        "location": "artifacts/diffs/",
        "store_last_n": 20
      },
      "display_labels": {
        "10": "Final Başlık",
        "11": "Final Etiketler",
        "12": "Final Açıklama / SEO Optimize",
        "16": "Kayıt Türü Kararı (Review + İndirme)",
        "19": "Export (Paket Oluştur)",
        "3c": "Odak Anahtar Kelime Seçimi & Havuz",
        "3d": "Taslak Başlık/Açıklama/Etiketler",
        "4b": "Top Listings — Temizleme",
        "5c": "Rakip Mağaza Önerileri (8)",
        "6b": "Rakip Listings — Temizleme"
      },
      "dynamic_steps": {
        "allow_new": true,
        "allowed_suffixes": [
          "a",
          "b",
          "c",
          "d",
          "e",
          "f"
        ],
        "inherit_defaults": true,
        "register_mode": "append_after_base",
        "substep_order": "alpha"
      },
      "guards": {
        "enforce_ship_countries": {
          "enabled": true
        },
        "hide_discount_in_outputs": {
          "enabled": true
        },
        "ornek_must_equal_final": {
          "enabled": true
        },
        "render_banners": {
          "enabled": true
        },
        "require_pre_start_confirmation": {
          "enabled": true
        },
        "require_prices_at_step0": {
          "enabled": true
        },
        "size_drop_guard": {
          "action": "halt",
          "threshold": 0.1
        },
        "size_shrink_guard": {
          "action": "ask_consent",
          "block_on_unknown_reason": true,
          "min_bytes": 2048,
          "require_reason": true,
          "threshold_pct": 0.5
        }
      },
      "handshake_instructions": {
        "1": "Yeni oturumda 'Final JSON’u yükleyin' diye sor.",
        "2": "Dosya adı, boyut ve SHA256’ı oku; FINALLOCK__WITH_TRIGGER__PATCHED_v3.json, 625271, 040f8a3 ile bire bir eşle.",
        "3": "Eşleşmiyorsa: HALT: JSON_MISSING_OR_MISMATCH ve dur.",
        "4": "Eşleşirse: 'JSON CONFIRMED' de, sonra sadece DIGEST/HALT satırlarıyla ilerle.",
        "5": "Excel/önizleme açma.",
        "6": "Soru-cevaplarda yalnızca JSON’dan yanıt ver; path belirt (/workflow_patches/...). 'Hatırlıyorum' yok.",
        "7": "Her adım öncesi guard uygula; fail olursa HALT, otomatik düzeltme yok."
      },
      "hard_locks": {
        "bind_to_session": true,
        "expire_minutes": 120,
        "require_active_session": true,
        "require_filename": true,
        "require_sha256": true,
        "required_filename": "1FINAL_LATEST_ALLCSV_FIX_patched_v27.json",
        "required_sha256": "845e8bf5f581d6d74983ede0f3aff03bc9fe3233315c2a7cd5f195924fcaab3c",
        "session_nonce": "9837cef9-5f53-4a68-9016-eb1dbfbe1dc7",
        "strict_sha_rollover": true
      },
      "hash_log": [
        {
          "patch_n": 0,
          "sha256": "5aa532c31929b31eb7ef291d2e70f1d4204b5e8cb56e3a56fd99d64e32d664d5",
          "timestamp": "2025-09-04T05:51:14Z"
        },
        {
          "patch_n": 1,
          "sha256": "f9b56f1c545a4cde66282c6ee6e8a3e17754558d79c89b8aaa5a106ef0664bc3",
          "timestamp": "2025-09-04T06:11:10Z"
        }
      ],
      "help": {
        "index": {
          "find:açıklama": [
            "12",
            "3d"
          ],
          "find:başlık": [
            "10",
            "3d"
          ],
          "find:etiket": [
            "11",
            "3d"
          ],
          "find:indirme": [
            "16",
            "19"
          ],
          "find:popüler": [
            "8",
            "4b"
          ],
          "find:rakip": [
            "5c",
            "7",
            "6b"
          ]
        }
      },
      "identity": {
        "current_user": "mcinar1905",
        "require_user_ack": true
      },
      "integrity": {
        "build_id": "FINAL/v1.1",
        "must_have": [
          "workflow_patches/governance/csv_schema_mode",
          "workflow_patches/governance/auto_resume/checkpoints",
          "workflow_patches/governance/correction_checkpoints",
          "workflow_patches/governance/validation_checklist",
          "workflow_patches/governance/portable_state",
          "workflow_patches/governance/knowledge_bus",
          "workflow_patches/governance/step_aliases",
          "workflow_patches/governance/display_labels",
          "workflow_patches/steps/10/ruleset",
          "workflow_patches/steps/11/ruleset",
          "workflow_patches/steps/12/ruleset",
          "workflow_patches/steps/16/ruleset/downloads/office_2007_tr",
          "workflow_patches/token_tracking"
        ],
        "on_mismatch": {
          "action": "report",
          "show": [
            "size_bytes_expected",
            "actual_size",
            "sha256_prefix",
            "sha256_actual"
          ]
        },
        "on_missing": "report",
        "verify": {
          "allow_delta_bytes": 2048,
          "mode": "compute",
          "sha256_prefix": null,
          "size_bytes_expected": null
        }
      },
      "invariants": {
        "requires": "cannot_remove",
        "step_count": "non_decreasing",
        "title_hash": "cannot_change"
      },
      "knowledge_bus": {
        "annotations": {
          "10": "produces:title.final",
          "11": "produces:tags.final(13)",
          "12": "produces:description.final",
          "3c": "produces:keywords.focus",
          "3d": "produces:draft.title,draft.description,draft.tags"
        },
        "enabled": true
      },
      "mutation_policy": {
        "allow": [
          "add_rule",
          "update_rule_params"
        ],
        "deny": [
          "delete_step",
          "rename_step",
          "merge_steps",
          "change_step_id",
          "remove_rule",
          "edit_outputs",
          "edit_constraints"
        ],
        "mode": "whitelist",
        "whitelist_paths": [
          "product_record",
          "step_overrides",
          "flow_policy",
          "run_policy",
          "workflow_patches.governance.hash_log",
          "workflow_patches.version_history"
        ]
      },
      "packs_index": {
        "on_missing": "report",
        "required": []
      },
      "policy": {
        "country": {
          "CA": {
            "shipping_allowed": true
          },
          "DE": {
            "shipping_allowed": true
          },
          "FR": {
            "shipping_allowed": true
          },
          "GB": {
            "shipping_allowed": true
          },
          "TR": {
            "forbidden_terms": [
              "istanbul",
              "turkey"
            ],
            "shipping_allowed": true,
            "tax_customs": {
              "payer": "seller",
              "vat_included": true
            }
          },
          "US": {
            "shipping_allowed": true
          }
        }
      },
      "portable_state": {
        "enabled": true,
        "persist": [
          "keywords.pool",
          "keywords.focus",
          "draft.title",
          "draft.description",
          "draft.tags",
          "title.final",
          "tags.final",
          "description.final"
        ],
        "restore_on_new_session": true
      },
      "required_requires": {
        "1a": [
          "0"
        ],
        "3a": [
          "0a"
        ],
        "4": [
          "0a"
        ],
        "5a": [
          "0a"
        ],
        "5b": [
          "0a"
        ]
      },
      "required_rule_ids": {
        "0": [
          "REQUIRE_PRODUCT_RECORD_PRESENT",
          "DISPLAY_PRODUCT_RECORD_SUMMARY",
          "BLOCK_IF_MISSING"
        ],
        "00": [
          "SAFE_COOLDOWN_ENFORCED",
          "SAFE_CHECKPOINT_ENFORCED",
          "SAFE_REQUIRE_FILENAME_SHA_MATCH",
          "SAFE_BLOCK_ON_SUSPECT",
          "MUTATION_POLICY_BLOCK",
          "MANIFEST_LOCK_ENFORCER",
          "INVARIANTS_ENFORCER",
          "APPROVAL_GUARD_ENFORCER",
          "FILE_LOCK_ENFORCED",
          "SESSION_BIND_ENFORCED"
        ],
        "0a": [
          "ALWAYS_RUN",
          "NON_BLOCKING",
          "ENCODING_NORMALIZE",
          "TRIM_LOWER_PUNCT_NORMALIZE",
          "HEADER_AUTO_MAP",
          "DEDUPE_POLICY",
          "TAGS_SPLIT_NORMALIZE",
          "NUMERIC_NORMALIZE",
          "WARN_MISSING_CRITICAL",
          "REPORT_FIELDS"
        ],
        "10": [
          "TITLE_FRONTLOAD",
          "TITLE_LENGTH_RANGE",
          "TITLE_REQUIRE_ATTRIBUTE",
          "TITLE_REQUIRE_OCCASION_OR_AUDIENCE",
          "TITLE_FORBIDDEN_TERMS",
          "TITLE_NO_STUFFING_ALLCAPS"
        ],
        "11": [
          "DESC_WORDCOUNT_RANGE",
          "DESC_PARAGRAPHS_RANGE",
          "DESC_OPENING_HAS_FOCUS",
          "DESC_SUPPORTS_USED_RANGE",
          "DESC_FORBIDDEN_TERMS",
          "DESC_NO_STUFFING_ROOTDUP"
        ],
        "12": [
          "TAGS_COUNT_13",
          "TAGS_UNIQUE",
          "SEGMENT_DIVERSITY_MIN",
          "NO_ATTR_DUPLICATES",
          "SAME_ROOT_LIMIT",
          "TAGS_FORBIDDEN_TERMS",
          "NEGATIVE_TERMS"
        ],
        "13": [
          "REQUIRED_PHOTO_TYPES",
          "MIN_RESOLUTION",
          "FORBID_WATERMARK_BLUR",
          "SEO_CONTEXT_IMAGE_REQUIRED"
        ],
        "14": [
          "NO_BANNED_TERMS",
          "NO_ALLCAPS_SPAM",
          "NO_MISLEADING_CLAIMS",
          "ETSY_POLICY_COMPLIANCE",
          "SEO_ADS_CONSISTENCY",
          "VISUAL_ALIGNMENT",
          "NEGATIVE_TERMS",
          "SPAM_BLOCKS_COMPLIANCE",
          "COUNTRY_POLICY_COMPLIANCE"
        ],
        "15": [
          "SEO_ADS_INTERSECTION_CHECK",
          "REMOVE_SEO_IF_IN_NEGATIVES",
          "FOCUS1_MUST_IN_ADS_POSITIVE",
          "NO_TITLE_TAGS_IN_ADS_NEGATIVES",
          "ADS_SYNC_STATUS_VALUES"
        ],
        "16": [
          "TITLE_LENGTH_RANGE",
          "DESC_WORDCOUNT_RANGE",
          "DESC_PARAGRAPHS_RANGE",
          "TAGS_COUNT_13",
          "MEDIA_REQUIRED_TYPES",
          "COMPLIANCE_PASS_REQUIRED",
          "ADS_SYNC_PASS_REQUIRED",
          "ATTRIBUTES_MUST_MATCH",
          "SHOP_PROFILE_INTEGRATION",
          "SPAM_BLOCKS_ASSEMBLY"
        ],
        "17": [
          "EXPORT_FORMAT",
          "ROW_PER_PRODUCT",
          "EXPORT_COLUMNS",
          "NO_EMPTY_REQUIRED_FIELDS",
          "FILENAME_PATTERN",
          "COMPUTE_SHA256",
          "EXPORT_REQUIRED_COLUMNS",
          "EXPORT_MIN_ATTRIBUTES",
          "TAGS_COUNT_EXACT_13",
          "MEDIA_MIN_COUNT_5",
          "DESCRIPTION_WORDCOUNT_RANGE",
          "CSV_QUOTING_ESCAPING_STRICT",
          "SPLIT_TAGS_MEDIA_COLUMNS",
          "EXPORT_REPORT_SUMMARY",
          "EXPORT_FALLBACK_LAST_PASS",
          "EXPORT_SPAM_STATUS_POLICY"
        ],
        "18": [
          "LISTING_PASS_REQUIRED",
          "EXPORT_FILE_AND_HASH_REQUIRED",
          "COMPLIANCE_PASS_REQUIRED",
          "ADS_SYNC_STATUS_POLICY",
          "PUBLISH_STATUS_VALUES"
        ],
        "19": [
          "MONITORING_WINDOW_DAYS",
          "WARN_THRESHOLDS",
          "BOOST_RULE",
          "PAUSE_RULE",
          "ACTIONABLE_PER_GROUP"
        ],
        "1b": [
          "ALURA_TOTAL_QUERIES",
          "ALURA_EXACT_WORDS_PER_QUERY",
          "ALURA_MIN_SEGMENTS",
          "ALURA_QUALITY_THRESHOLDS",
          "ALURA_DEDUPE",
          "NO_DERIVATION"
        ],
        "20": [
          "PATCH_NOTE_REQUIRED",
          "CHECKPOINT_EVERY_5",
          "RULESET_HASH_REQUIRED",
          "ROLLBACK_POINTS_PRODUCE"
        ],
        "21": [
          "SPAM_STATUS_VALUES",
          "CAT_POLICY_MAP",
          "TITLE_PATTERN_REUSE_DETECT",
          "DESC_PATTERN_REUSE_DETECT",
          "MEDIA_NEAR_DUP",
          "DESC_CONTACT_LINK_FORBIDDEN",
          "EMOJI_OVERUSE_LIMIT",
          "TAG_ATTRIBUTE_CONSISTENCY",
          "COUNTRY_POLICY_SPAM_MAP"
        ],
        "3a": [
          "NO_DERIVATION",
          "POOL_MIN_SIZE",
          "SEMANTIC_DIVERSITY_THRESHOLD",
          "FOCUS_KEYWORDS_COUNT",
          "DIVERSITY_RE_RANK"
        ],
        "3b": [
          "USE_FOCUS1_BY_DEFAULT",
          "TITLE_FRONTLOAD",
          "TITLE_MAX_LEN",
          "TAGS_COUNT_13",
          "TAGS_UNIQUE",
          "MAX_SAME_ROOT_IN_TAGS",
          "NEGATIVE_TERMS",
          "NO_DERIVATION"
        ],
        "4": [
          "TOPLISTINGS_MIN_PER_CSV",
          "TOPLISTINGS_EXPECTED_PER_CSV",
          "EXCLUDE_NEGATIVE_TERMS",
          "DEDUP_NEAR_DUPLICATES"
        ],
        "5a": [
          "NEGATIVE_TERMS",
          "MIN_TOTAL_ROWS_WARNING",
          "DEDUP_NEAR_DUPLICATES",
          "FOCUS_SUPPORT_SIGNALS",
          "SIMILARITY_TITLE_DESC_CHECK",
          "SIMILARITY_TAGS_OVERLAP",
          "SIMILARITY_ATTRIBUTES_MATCH",
          "SIMILARITY_SCORE_COMPUTE"
        ],
        "5b": [
          "SHOP_SELECTION_COUNT_RANGE",
          "COVERAGE_MULTIPLE_SEGMENTS",
          "QUALITY_MIN_RATIO_TOP_MATCH",
          "EXCLUSIONS",
          "SIMILARITY_TITLE_DESC_CHECK",
          "SIMILARITY_TAGS_OVERLAP",
          "SIMILARITY_ATTRIBUTES_MATCH",
          "SIMILARITY_SCORE_COMPUTE"
        ],
        "7": [
          "NO_DERIVATION",
          "MIN_SEGMENTS",
          "ADS_SEED_NEGATIVE_TERMS",
          "BIAS_CORRECTION_SINGLE_SHOP"
        ],
        "8B": [
          "ADGROUP_SEGMENT_MAPPING",
          "AB_TEST_WINDOW_DAYS",
          "PAUSE_RULE",
          "BOOST_RULE",
          "NO_DERIVATION",
          "NEAR_DUP_LIMIT"
        ],
        "9": [
          "NO_DERIVATION",
          "MIN_SEGMENTS",
          "NEAR_DUP_LIMIT",
          "NEGATIVE_TERMS",
          "RECORD_RATIONALE"
        ],
        "seo_package": [
          "TITLE_LENGTH_RANGE",
          "DESC_WORDCOUNT_RANGE",
          "DESC_PARAGRAPHS_RANGE",
          "TAGS_COUNT_13",
          "SEGMENT_DIVERSITY_MIN",
          "NO_ROOT_DUPLICATES",
          "NEGATIVE_TERMS"
        ]
      },
      "ruleset_hash": "369e7fed19249856dfba3b5879eddc54af7b053129905ee4f8ca274273ddf62c",
      "ruleset_last_updated_at": "2025-09-03T18:16:03.272563",
      "safety": {
        "checkpoint_every": 5,
        "cooldown_minutes": 60,
        "last_filename": null,
        "last_patched_at": "2025-09-10T09:58:11.511081Z",
        "last_sha256": null,
        "patch_count": 0,
        "suspect_session_closed": false,
        "version_history": []
      },
      "schema_version": "1.0.0",
      "session_handshake": {
        "banner": "BUILD=${governance.integrity.build_id} — integrity+discovery+packs+triggers+manifest selfcheck",
        "on_open": {
          "ensure_modes": {
            "csv_schema_mode": "forgiving",
            "on_mismatch": "silent"
          },
          "rebind_triggers": true,
          "run": [
            "integrity.selfcheck",
            "discovery.build_indexes",
            "manifest.selfcheck",
            "packs.selfcheck",
            "triggers.selfcheck"
          ]
        },
        "require_json_confirm": true
      },
      "step_aliases": {
        "10": [
          "final başlık",
          "final title",
          "title finalize"
        ],
        "11": [
          "final etiket",
          "final tags",
          "tags finalize"
        ],
        "12": [
          "final açıklama",
          "seo optimize",
          "final description"
        ],
        "16": [
          "kayıt türü",
          "review",
          "final review"
        ],
        "19": [
          "export",
          "dışa aktar"
        ],
        "3c": [
          "odak",
          "odak kelime",
          "focus",
          "focus selection",
          "keyword focus"
        ],
        "3d": [
          "taslak",
          "taslak başlık",
          "taslak açıklama",
          "draft"
        ],
        "4b": [
          "top listings clean",
          "popüler ürün temizleme"
        ],
        "5c": [
          "rakip mağaza önerisi",
          "competitor shops",
          "suggested shops"
        ],
        "6b": [
          "competitor clean",
          "rakip temizleme"
        ]
      },
      "step_manifest": [
        "0",
        "1",
        "1a",
        "1b",
        "2",
        "3a",
        "3b",
        "3c",
        "3d",
        "4a",
        "4b",
        "5",
        "5a",
        "5b",
        "5c",
        "6a",
        "6b",
        "7",
        "8",
        "9",
        "10",
        "11",
        "12",
        "13",
        "14",
        "15",
        "16",
        "18",
        "19",
        "20"
      ],
      "step_manifest_resolver": {
        "allow_workshop_auto_promote": false,
        "auto_register_in_manifest": true,
        "include_orphans": true,
        "prefer_manifest_order": true,
        "resolve_on_load": true,
        "strategy": "union",
        "substep_sort": "alpha"
      },
      "token_tracking": {
        "block_threshold_percent": 95,
        "warn_threshold_percent": 80
      },
      "triggers_index": {
        "on_missing": "report",
        "required": []
      },
      "validation_checklist": {
        "final_publish_checklist_required": true,
        "steps": [
          "10",
          "11",
          "12",
          "16"
        ]
      }
    },
    "guards": {
      "csv_hard_fail": {
        "enabled": false,
        "on_error": "warn"
      },
      "enforce_profile": {
        "allowed_actor": "gpt_prod_executor_v1",
        "enabled": true,
        "on_fail": "HALT: ACTOR_MISMATCH",
        "type": "actor_check"
      },
      "enforce_ship_countries": {
        "enabled": true
      },
      "general_json_guards": {
        "apply_to_steps": [
          "*"
        ],
        "notes": "CSV hariç tüm akış ve metadata üzerinde çalışır.",
        "pack": "JSON_GENERAL_SAFETY_v1"
      },
      "hide_discount_in_outputs": {
        "enabled": true
      },
      "ornek_must_equal_final": {
        "enabled": true
      },
      "production_display": {
        "enforce": true,
        "message_on_violation": "Üretimde ara tablo/Excel gösterimi yasak. Sadece sonuç özetleri sunulur.",
        "rules": {
          "disallow_raw_csv_echo": true,
          "disallow_table_previews_in_steps": [
            "3",
            "4",
            "6"
          ]
        }
      },
      "render_banners": {
        "enabled": true
      },
      "require_pre_start_confirmation": {
        "enabled": true
      },
      "require_prices_at_step0": {
        "enabled": true
      },
      "session_handshake": {
        "enabled": true,
        "on_fail": "HALT: SESSION_JSON_MISMATCH",
        "required_fields": [
          "filename",
          "size_bytes",
          "sha256_prefix"
        ],
        "type": "session_guard"
      },
      "size_shrink_guard": {
        "action": "ask_consent",
        "block_on_unknown_reason": true,
        "min_bytes": 2048,
        "require_reason": true,
        "threshold_pct": 0.5
      }
    },
    "language_policy": {
      "gpt_explanation": "TR allowed for explanations only",
      "seo_content": "EN"
    },
    "metadata": {
      "last_patched_at": "2025-09-03T18:16:03.271904",
      "non_destructive": true,
      "note_tr": "Bu blok, üretim/SEO/Ads adımlarına ilişkin kuralları, aynı dosyada şemayı bozmadan eklemek için eklendi.",
      "patch_note_tr": "5a/5b Similarity Scoring kuralları eklendi (title/desc, tags, attributes, score).",
      "patched_at": "2025-09-03T14:48:32.992735",
      "source_files": [
        "Altın Takı Kategorisi İçin Etsy Ads Optimizasyon Raporu.docx",
        "alura metrikleri.docx",
        "seo rebleri.docx"
      ]
    },
    "registry": {
      "step_kinds": {
        "analyze_market": {
          "gates": {
            "on_soft_misalignment": "auto_fix_and_continue"
          },
          "output": {
            "digest_only": true
          },
          "requires": [],
          "ruleset": {
            "NO_FABRICATION": true
          }
        },
        "assemble_listing": {
          "output": {
            "digest_only": true
          },
          "requires": []
        },
        "compliance_check": {
          "output": {
            "digest_only": true
          },
          "ruleset": {
            "NO_MISLEADING": true
          }
        },
        "export": {
          "guards": {
            "block_if_preview": {
              "action": "halt_and_report",
              "when_record_type_in": [
                "preview",
                "draft"
              ]
            }
          },
          "output": {
            "digest_only": true
          },
          "requires": [],
          "ruleset": {
            "RECORD_TYPE": "publish"
          }
        },
        "generate_description": {
          "output": {
            "digest_only": true
          },
          "ruleset": {
            "DESC_WORDCOUNT": [
              300,
              500
            ],
            "NO_FABRICATION": true
          }
        },
        "generate_title": {
          "output": {
            "digest_only": true
          },
          "ruleset": {
            "NO_STUFFING": true,
            "TITLE_LENGTH": [
              80,
              140
            ]
          }
        },
        "ingest_csv": {
          "gates": {
            "on_soft_misalignment": "auto_fix_and_continue"
          },
          "output": {
            "digest_only": true
          },
          "requires": [],
          "ruleset": {
            "BOM_FORBIDDEN": true,
            "HEADER_STRICT": true
          }
        },
        "seo_tags": {
          "output": {
            "digest_only": true
          },
          "ruleset": {
            "COUNT": 13,
            "NEAR_DUP_LIMIT": 1
          }
        }
      }
    },
    "safety_pointer": "_final_safety",
    "standalone_tasks": {
      "discovery.build_indexes": {
        "discover": {
          "packs": {
            "from": [
              "/workflow_patches/triggers",
              "/workflow_patches/standalone_tasks"
            ],
            "name_match": ".*(pack|chain).*"
          },
          "triggers": {
            "from": [
              "/workflow_patches/triggers"
            ],
            "name_match": ".*"
          }
        },
        "id": "discovery.build_indexes",
        "label": "Packs & Triggers Otomatik Keşif",
        "mode": {
          "dedup": true,
          "sort": true,
          "update": true
        },
        "output": "discovery_last.json",
        "write_to": {
          "packs": "/workflow_patches/governance/packs_index/required",
          "triggers": "/workflow_patches/governance/triggers_index/required"
        }
      },
      "integrity.selfcheck": {
        "checks": "@governance.integrity.must_have",
        "id": "integrity.selfcheck",
        "label": "JSON Bütünlük Kontrolü",
        "on_fail": {
          "hint": "Eksikleri tek ONAY bloğu ile geri yükleyin",
          "report": true
        },
        "output": "integrity_last.json",
        "verify": "@governance.integrity.verify"
      },
      "manifest.selfcheck": {
        "checks": "@governance.step_manifest",
        "id": "manifest.selfcheck",
        "label": "Manifest Tutarlılık Kontrolü",
        "on_fail": {
          "report": true
        },
        "output": "manifest_integrity_last.json",
        "validate": {
          "require_placeholder_if_missing": true
        }
      },
      "packs.selfcheck": {
        "checks": "@governance.packs_index.required",
        "id": "packs.selfcheck",
        "label": "Packs Bütünlük Kontrolü",
        "on_fail": {
          "report": true
        },
        "output": "packs_integrity_last.json",
        "validate": {
          "ensure_steps_in_manifest": true,
          "resolve_aliases": true
        }
      },
      "selftest": {
        "id": "standalone.selftest",
        "label": "Giriş Sağlık Kontrolü",
        "on_fail": {
          "retry": true,
          "suppress_warnings": true,
          "switch_csv_mode": "forgiving"
        },
        "outputs": {
          "report": "selftest_last.json"
        },
        "steps": [
          {
            "id": "3a",
            "mode": "dryrun"
          },
          {
            "id": "3b",
            "mode": "dryrun"
          },
          {
            "id": "4b",
            "mode": "dryrun"
          },
          {
            "id": "6a",
            "mode": "dryrun"
          },
          {
            "id": "6b",
            "mode": "dryrun"
          }
        ]
      },
      "triggers.selfcheck": {
        "checks": "@governance.triggers_index.required",
        "id": "triggers.selfcheck",
        "label": "Triggers Bütünlük Kontrolü",
        "on_fail": {
          "report": true
        },
        "output": "triggers_integrity_last.json",
        "validate": {
          "ensure_bound_steps_exist": true,
          "resolve_aliases": true
        }
      }
    },
    "steps": {
      "0": {
        "constraints": {
          "must_confirm": true,
          "no_skip": true,
          "require_gpt_task": false,
          "require_user_task": true,
          "require_validations_pass": false
        },
        "description": "product_record kaydını ekranda gösterir; veri tek kaynaktan okunur.",
        "display_contract": {
          "block_until_user_ack": true,
          "prompt_to_user": "Yukarıdaki Product Info tam görünümüdür. Değişiklik var mı? (EVET/HAYIR). EVET ise alan=değer biçiminde yazın.",
          "render_full": true,
          "show_paths": [
            "/workflow_patches/steps/0/constraints",
            "/workflow_patches/steps/0/description",
            "/workflow_patches/steps/0/flow",
            "/workflow_patches/steps/0/gates",
            "/workflow_patches/steps/0/hitl_contract",
            "/workflow_patches/steps/0/name",
            "/workflow_patches/steps/0/next",
            "/workflow_patches/steps/0/outputs",
            "/workflow_patches/steps/0/preconditions",
            "/workflow_patches/steps/0/product_info",
            "/workflow_patches/steps/0/requires",
            "/workflow_patches/steps/0/ruleset",
            "/workflow_patches/steps/0/title",
            "/workflow_patches/steps/0/ui",
            "/workflow_patches/steps/0/upstream_signature",
            "/workflow_patches/steps/0/user_task",
            "/workflow_patches/steps/0/validations"
          ],
          "title": "STEP 0 — PRODUCT INFO (TAM GÖRÜNÜM)"
        },
        "flow": {
          "guard": {
            "advance_only_if": []
          },
          "on_success_next": "00"
        },
        "gates": {
          "must": [
            "validations_ok"
          ],
          "on_contract_violation": "halt_and_report",
          "on_miss": "halt",
          "on_missing_required_path": "halt_and_report",
          "on_soft_misalignment": "warn_and_continue"
        },
        "hitl_contract": {
          "gpt_tasks": [],
          "user_tasks": []
        },
        "name": "Product Info (read-only) — Kullanıcı Onayı",
        "next": [
          "00"
        ],
        "outputs": {
          "review_confirmed": true
        },
        "preconditions": {
          "critical_pass": {
            "require_ancestors_done": [
              "0",
              "1",
              "3",
              "6",
              "16"
            ]
          }
        },
        "product_info": {
          "fixed_product": {
            "colors": [
              "Yellow Gold",
              "White Gold",
              "Rose Gold"
            ],
            "discount_percent_hidden": 30,
            "sizes_us": "4–14¾",
            "stone_policy": {
              "provided_by_user": true,
              "use_gpt_visual_inference_if_confidence_gte": 0.9
            },
            "variations": [
              {
                "karat": "10K",
                "price_usd": "450"
              },
              {
                "karat": "14K",
                "price_usd": "750"
              },
              {
                "karat": "18K",
                "price_usd": "1200"
              }
            ],
            "colors[]": [
              "Yellow Gold",
              "White Gold",
              "Rose Gold"
            ],
            "variations[]": [
              {
                "karat": "10K",
                "price_usd": "xxx"
              },
              {
                "karat": "14K",
                "price_usd": "xxx"
              },
              {
                "karat": "18K",
                "price_usd": "xxx"
              }
            ],
            "ring_size_scale": "US",
            "ring_size_range_us": {
              "min": "4",
              "max": "14.75"
            }
          },
          "logistics": {
            "customs_duties_payer": "seller",
            "delivery_estimate_business_days": {
              "max": 5,
              "min": 2
            },
            "destinations": [
              "Canada",
              "United States",
              "Germany",
              "United Kingdom",
              "France"
            ],
            "handling_time_business_days": {
              "max": 3,
              "min": 1
            },
            "origin_country": "Türkiye",
            "packaging": "Özel kutu + hediye notu eklenebilir.",
            "shipping_fee": "Ücretsiz kargo",
            "shipping_profile": "LUXURYJEWELERY",
            "tracking": true,
            "ddp_price_inclusive": true,
            "shipping_countries[]": [
              "Canada",
              "United States",
              "Germany",
              "United Kingdom",
              "France"
            ],
            "delivery_time_business_days": {
              "min": 2,
              "max": 5
            },
            "shipping_fee_usd": 0,
            "destinations[]": [
              "Canada",
              "United States",
              "Germany",
              "United Kingdom",
              "France"
            ]
          },
          "ads": {
            "daily_budget_usd": 10,
            "target_market": "US",
            "target_locale": "en-US"
          },
          "pricing": {
            "discount_percent_hidden": 30
          },
          "gemstone": {
            "policy": "user_provided_or_ai_confidence>=0.90"
          },
          "packaging": {
            "description": "Özel kutu + hediye notu"
          }
        },
        "requires": [],
        "ruleset": [
          {
            "id": "REQUIRE_PRODUCT_RECORD_PRESENT",
            "params": {}
          },
          {
            "id": "DISPLAY_PRODUCT_RECORD_SUMMARY",
            "params": {
              "source": "product_record"
            }
          },
          {
            "id": "BLOCK_IF_MISSING",
            "params": {}
          }
        ],
        "title": "Product Info (read-only) — Kullanıcı Onayı",
        "ui": {
          "review_paths": [
            "/_product_static/colors",
            "/_product_static/discount",
            "/_product_static/ring_sizes_us",
            "/_product_static/stone_policy",
            "/_product_static/variation_prices",
            "/_store_profile/*"
          ],
          "title": "Ön İnceleme (Step 0)"
        },
        "upstream_signature": {
          "policy": "mark_stale_on_upstream_change"
        },
        "user_task": {
          "confirm": "review_confirmed",
          "read": [
            "product_info.logistics",
            "product_info.fixed_product"
          ]
        },
        "validations": {
          "review_confirmed_is_true": {
            "equals": true,
            "field": "outputs.review_confirmed"
          }
        },
        "display": {
          "render_full": true,
          "sections_auto": [
            {
              "title": "Review Confirmed",
              "bind": "review_confirmed"
            }
          ]
        },
        "label": "Product Info (read-only) — Kullanıcı Onayı",
        "await_user": true,
        "require_user_confirm": true,
        "no_skip": true,
        "policies": {
          "returns": {
            "enabled": true,
            "window_days": 15,
            "notes": "Returns accepted within 15 days. Item must be unused and in original packaging. Contact us before returning. Buyer pays return shipping unless the item arrives damaged."
          },
          "resizing": {
            "enabled": false
          },
          "description_clauses": {
            "ddp_sentence": "Tariffs & import duties are prepaid (DDP) by the seller; the listing price is inclusive of these fees."
          }
        },
        "care_instructions": {
          "short": "Solid gold care: avoid chemicals/chlorine; remove during sport, shower, pool; store separately in a soft pouch; clean with mild soap + lukewarm water; dry thoroughly; finish with a soft polishing cloth."
        },
        "ui_ext": {
          "token_tracking": true
        }
      },
      "00": {
        "constraints": {
          "must_confirm": false,
          "no_skip": true,
          "require_gpt_task": true,
          "require_user_task": false,
          "require_validations_pass": true,
          "status_values": [
            "PASS",
            "FAIL"
          ]
        },
        "description": "Advisory; başarısızlıkta üretimi durdurmaz, uyarı üretir.",
        "flow": {
          "guard": {
            "advance_only_if": []
          }
        },
        "gates": {
          "must": [
            "validations_ok"
          ],
          "on_contract_violation": "halt_and_report",
          "on_miss": "halt",
          "on_missing_required_path": "halt_and_report",
          "on_soft_misalignment": "warn_and_continue",
          "on_validation_fail": "halt_and_report"
        },
        "hitl_contract": {
          "gpt_tasks": [],
          "user_tasks": []
        },
        "inputs": {
          "bootstrap_files": [
            "keyword_maps",
            "stopwords",
            "negative_lists",
            "template_outlines"
          ],
          "model_presets": {
            "title_gen": "v1",
            "desc_gen": "v1",
            "tags_gen": "v1"
          },
          "cache": {
            "warm": true
          }
        },
        "name": "Sistem Başlatma / Ön Yük",
        "next": [
          "0a"
        ],
        "notes": {
          "hardened_at": "2025-09-08T20:59:54.302900Z"
        },
        "outputs": [
          "self_check.report{}",
          "self_check.missing[]",
          "self_check.status",
          "self_check.timestamp"
        ],
        "preconditions": {
          "critical_pass": {
            "require_ancestors_done": [
              "0",
              "1",
              "3",
              "6",
              "16"
            ]
          }
        },
        "requires": [
          "0"
        ],
        "rules": [
          "validate each step has all required ruleset IDs",
          "validate each step has required 'requires' deps (e.g., 0a for CSV-driven steps)",
          "produce a detailed report of missing IDs/deps",
          "self_check.status = PASS if no issues else FAIL"
        ],
        "ruleset": [
          {
            "id": "CHECK_REQUIRED_RULE_IDS",
            "params": {
              "source": "governance.required_rule_ids"
            }
          },
          {
            "id": "CHECK_REQUIRED_REQUIRES",
            "params": {
              "source": "governance.required_requires"
            }
          },
          {
            "id": "SELF_CHECK_STATUS_VALUES",
            "params": {
              "values": [
                "PASS",
                "FAIL"
              ]
            }
          },
          {
            "id": "SAFE_COOLDOWN_ENFORCED",
            "params": {}
          },
          {
            "id": "SAFE_CHECKPOINT_ENFORCED",
            "params": {}
          },
          {
            "id": "SAFE_REQUIRE_FILENAME_SHA_MATCH",
            "params": {}
          },
          {
            "id": "SAFE_BLOCK_ON_SUSPECT",
            "params": {}
          },
          {
            "id": "MUTATION_POLICY_BLOCK",
            "params": {}
          },
          {
            "id": "MANIFEST_LOCK_ENFORCER",
            "params": {}
          },
          {
            "id": "INVARIANTS_ENFORCER",
            "params": {}
          },
          {
            "id": "APPROVAL_GUARD_ENFORCER",
            "params": {}
          },
          {
            "assert": [
              "hard_locks.require_filename",
              "hard_locks.require_sha256"
            ],
            "id": "FILE_LOCK_ENFORCED"
          },
          {
            "assert": [
              "hard_locks.bind_to_session",
              "hard_locks.require_active_session"
            ],
            "id": "SESSION_BIND_ENFORCED"
          }
        ],
        "title": "Sistem Başlatma / Ön Yük",
        "upstream_signature": {
          "policy": "mark_stale_on_upstream_change"
        },
        "validations": {
          "execution_order_defined": true,
          "external_rules_forbidden": true,
          "present": true,
          "source_is_json_only": true
        },
        "display_contract": {
          "render_full": true,
          "block_until_user_ack": false
        },
        "stop_for_confirmation": false,
        "is_background": false,
        "label": "Sistem Başlatma / Ön Yük",
        "await_user": true,
        "require_user_confirm": true,
        "no_skip": true,
        "purpose": "Başlangıç servislerini ve ön-kütükleri doğrular; cache ısıtma, preset yükleme, sözlük/şablon önbellekleme.",
        "validators_required": false,
        "enforcement": {
          "on_violation": "warn"
        },
        "outputs_expected": {
          "init_ok": true,
          "logs": []
        },
        "checklist": [
          "Stopword/negative listeler yüklendi mi?",
          "Şablonlar cache’e alındı mı?",
          "Model preset’ler hazır mı?"
        ],
        "what_gpt_does": [
          "bootstrap_files erişimini doğrular",
          "cache durumunu kontrol eder",
          "eksik preset/asset varsa raporlar"
        ],
        "what_user_does": [
          "Eksik dosyaları yükler",
          "Bozuk preset/sözlük varsa düzeltir"
        ],
        "preload": {
          "paths[]": [
            "/workflow_patches/steps/0/product_info",
            "/workflow_patches/steps/0/policies",
            "/workflow_patches/steps/0/care_instructions",
            "/workflow_patches/steps/10",
            "/workflow_patches/steps/11",
            "/workflow_patches/steps/12"
          ]
        },
        "caches": {
          "ddp_sentence": {
            "__REF__": "/workflow_patches/steps/0/policies/description_clauses/ddp_sentence"
          },
          "shipping_countries": {
            "__REF__": "/workflow_patches/steps/0/product_info/logistics/destinations[]"
          }
        },
        "invariants": {
          "require_order_sync": true
        },
        "commit_gate": {
          "checklist[]": [
            "preflight_ok",
            "refs_zero_broken",
            "order_mirrored",
            "token_below_halt",
            "diff_allowed_only"
          ],
          "profiles": {
            "order_sync_only": {
              "allowed_paths[]": [
                "/step_flow_lock/canonical_order",
                "/workflow_enforcement/execution_order",
                "/_runtime/queue_workers/orchestrator/start/execution_order_ref",
                "/_run_order/steps"
              ],
              "deny_delete": true,
              "deny_rename": true,
              "deny_move": true,
              "deny_overwrite_non_empty": true
            },
            "step0_only": {
              "allowed_paths[]": [
                "/workflow_patches/steps/0"
              ],
              "deny_delete": true,
              "deny_rename": true,
              "deny_move": true,
              "deny_overwrite_non_empty": true
            },
            "all_steps": {
              "allowed_paths[]": [
                "/workflow_patches/steps"
              ],
              "deny_delete": true,
              "deny_rename": true,
              "deny_move": true,
              "deny_overwrite_non_empty": true
            }
          },
          "user_ack": {
            "required": true,
            "ack_phrase": "ONAY: 0-VERİ-KAYBI"
          },
          "active_profile": "all_steps",
          "invariants": {
            "require_enabled_steps[]": [
              "5b"
            ],
            "forbid_skip": true,
            "enforce_sequential_run": true,
            "require_steps_sequence": {
              "__REF__": "/step_flow_lock/canonical_order"
            },
            "consistency_checks": {
              "canonical_vs_execution_order": {
                "A": {
                  "__REF__": "/step_flow_lock/canonical_order"
                },
                "B": {
                  "__REF__": "/workflow_enforcement/execution_order"
                }
              },
              "manifest_hashes_ref": {
                "__REF__": "/_policy/hashes/steps"
              },
              "allowed_aux_steps_ref": {
                "__REF__": "/env/profiles/prod/allowed_aux_steps"
              },
              "id_aliases_ref": {
                "__REF__": "/governance/id_aliases"
              }
            }
          },
          "policy": {
            "v1": {
              "refs": {
                "id_aliases_ref": {
                  "__REF__": "/governance/id_aliases"
                },
                "enabled_runtime_ref": {
                  "__REF__": "/_run_order/steps"
                },
                "manifest_hashes_ref": {
                  "__REF__": "/_policy/hashes/steps"
                },
                "allowed_aux_steps_ref": {
                  "__REF__": "/env/profiles/prod/allowed_aux_steps"
                },
                "steps_meta_ref": {
                  "__REF__": "/steps_meta"
                }
              },
              "rules": {
                "soft": [
                  {
                    "id": "aux_not_whitelisted",
                    "severity": "soft",
                    "description": "Any enabled step marked as aux must be present in allowed_aux_steps_ref.",
                    "evaluator": "enabled_aux_not_in_whitelist",
                    "inputs": {
                      "enabled_runtime": {
                        "__REF__": "/_run_order/steps"
                      },
                      "allowed_aux_steps": {
                        "__REF__": "/env/profiles/prod/allowed_aux_steps"
                      },
                      "steps_meta": {
                        "__REF__": "/steps_meta"
                      }
                    },
                    "on_violation": {
                      "action": "WARN",
                      "code": "CG-AUX-WHITELIST"
                    }
                  },
                  {
                    "id": "boot_health_broken_refs_warn",
                    "severity": "soft",
                    "description": "Warn if broken refs were detected at boot health scan.",
                    "evaluator": "numeric_gt",
                    "inputs": {
                      "path": "/_runtime/boot/health/broken_refs",
                      "value": 0
                    },
                    "on_violation": {
                      "action": "WARN",
                      "code": "CG-HEALTH-REFS"
                    }
                  },
                  {
                    "id": "boot_alias_conflicts_warn",
                    "severity": "soft",
                    "description": "Warn if alias conflicts were detected at boot.",
                    "evaluator": "numeric_gt",
                    "inputs": {
                      "path": "/_runtime/boot/health/alias_conflicts",
                      "value": 0
                    },
                    "on_violation": {
                      "action": "WARN",
                      "code": "CG-HEALTH-ALIAS"
                    }
                  },
                  {
                    "id": "boot_profile_missing_warn",
                    "severity": "soft",
                    "description": "Warn if shop profile is missing at boot.",
                    "evaluator": "missing_or_empty",
                    "inputs": {
                      "path": "/_run_order/steps/0/shop_profile"
                    },
                    "on_violation": {
                      "action": "WARN",
                      "code": "CG-BOOT-PROFILE"
                    }
                  },
                  {
                    "id": "warn_if_unresolved_runtime_refs",
                    "code": "CG-RUNTIME-REFS-WARN",
                    "desc": "Boot warning when unresolved __REF__ is detected; escalates via policy if enabled.",
                    "when": {
                      "path": "/_runtime/refs/unresolved_count",
                      "op": ">",
                      "value": 0
                    },
                    "action": "WARN"
                  }
                ],
                "hard": [
                  {
                    "id": "alias_conflict_enabled",
                    "severity": "hard",
                    "description": "If an alias and its canonical target are both enabled, halt to avoid duplicate execution.",
                    "evaluator": "alias_and_target_both_enabled",
                    "inputs": {
                      "enabled_runtime": {
                        "__REF__": "/_run_order/steps"
                      },
                      "id_aliases": {
                        "__REF__": "/governance/id_aliases"
                      }
                    },
                    "on_violation": {
                      "action": "HALT",
                      "code": "CG-ALIAS-CONFLICT"
                    }
                  },
                  {
                    "id": "manifest_hash_drift",
                    "severity": "hard",
                    "description": "Authoritative manifest in patches must match the runtime copy; any drift halts.",
                    "evaluator": "manifest_hash_mismatch",
                    "inputs": {
                      "authoritative_hashes": {
                        "__REF__": "/_policy/hashes/steps"
                      },
                      "authoritative_manifest_root": {
                        "__REF__": "/workflow_patches/steps"
                      },
                      "runtime_steps_root": {
                        "__REF__": "/_run_order/steps"
                      }
                    },
                    "on_violation": {
                      "action": "HALT",
                      "code": "CG-MANIFEST-DRIFT"
                    }
                  },
                  {
                    "id": "require_3c_draft_presence",
                    "severity": "hard",
                    "description": "Before title/description/tags finalization (10/11/12), ensure 3c draft bundle exists and is non-empty.",
                    "evaluator": "require_fields",
                    "inputs": {
                      "fields": [
                        "/_run_order/steps/3c/outputs/draft.title",
                        "/_run_order/steps/3c/outputs/draft.description",
                        "/_run_order/steps/3c/outputs/draft.tags[13]"
                      ]
                    },
                    "on_violation": {
                      "action": "HALT",
                      "code": "CG-REQ-3C-DRAFT"
                    }
                  },
                  {
                    "id": "require_competitors_clean_unified",
                    "severity": "hard",
                    "description": "Ensure unified competitors.clean[] (from step 6 surface) is present before step 7.",
                    "evaluator": "require_fields",
                    "inputs": {
                      "fields": [
                        "/_run_order/steps/6/outputs/competitors.clean[]"
                      ]
                    },
                    "on_violation": {
                      "action": "HALT",
                      "code": "CG-REQ-COMP-CLEAN"
                    }
                  },
                  {
                    "id": "require_focus_candidates_exist",
                    "severity": "hard",
                    "description": "focus_candidates must exist (3a) before dependent steps (3b,5,5a).",
                    "evaluator": "require_fields",
                    "inputs": {
                      "fields": [
                        "/_run_order/steps/3a/outputs/focus_candidates"
                      ]
                    },
                    "on_violation": {
                      "action": "HALT",
                      "code": "CG-REQ-FOCUS-CANDS"
                    }
                  },
                  {
                    "id": "forbid_csv_inputs_in_00",
                    "severity": "hard",
                    "description": "Boot step must not require CSV inputs.",
                    "evaluator": "forbid_inputs_pattern",
                    "inputs": {
                      "step": "00",
                      "pattern": "csv"
                    },
                    "on_violation": {
                      "action": "HALT",
                      "code": "CG-BOOT-NO-CSV"
                    }
                  },
                  {
                    "id": "boot_manifest_drift_halt",
                    "severity": "hard",
                    "description": "Halt if manifest drift > 0 (authoritative vs runtime).",
                    "evaluator": "numeric_gt",
                    "inputs": {
                      "path": "/_runtime/boot/health/manifest_drift",
                      "value": 0
                    },
                    "on_violation": {
                      "action": "HALT",
                      "code": "CG-HEALTH-MANIFEST"
                    }
                  }
                ]
              },
              "escalation": {
                "soft_to_hard": {
                  "enabled": true,
                  "after_runs": 1,
                  "track_key": "commit_gate.last_violations"
                }
              }
            }
          },
          "runtime": {
            "last_violations": []
          }
        },
        "invariants_ext": {
          "require_paths_exist": [
            "/ui_policies/global/token_tracking",
            "/_runtime/usage_counters/tokens"
          ],
          "on_fail": "halt",
          "explain": "Token takibi yapılandırması eksik; üretim güvenli değil."
        },
        "ui_ext": {
          "token_tracking": true
        }
      },
      "0a": {
        "constraints": {
          "blocking": false,
          "must_confirm": false,
          "no_skip": true,
          "require_gpt_task": true,
          "require_user_task": false,
          "require_validations_pass": true,
          "status_values": [
            "PASS",
            "WARN",
            "FAIL"
          ]
        },
        "description": "Bloklamaz; uyarı üretir ve raporlar (advisory). 0 (Kullanıcı Onayı) tamamlanmadan 1’e geçilmez.",
        "flow": {
          "guard": {
            "advance_only_if": []
          }
        },
        "gates": {
          "must": [
            "validations_ok"
          ],
          "on_contract_violation": "halt_and_report",
          "on_miss": "halt",
          "on_missing_required_field": "halt_and_request_fix",
          "on_missing_required_path": "halt_and_report",
          "on_soft_misalignment": "warn_and_continue",
          "on_validation_fail": "halt_and_report"
        },
        "hitl_contract": {
          "gpt_tasks": [],
          "user_tasks": []
        },
        "inputs": {
          "env_config": "Ortam ayarları (JSON/YAML)",
          "runtime_info": "Tarayıcı/istemci sürümleri, saat, timezone",
          "network_targets": [
            "github_raw",
            "cdn",
            "image_store"
          ],
          "storage": {
            "quota_min_mb": 50,
            "available_mb": null
          },
          "credentials": {
            "github": "optional",
            "alura": "optional",
            "gdrive": "optional"
          }
        },
        "name": "Ortam Kontrolleri",
        "next": [
          "1",
          "3",
          "6"
        ],
        "notes": {
          "hardened_at": "2025-09-08T20:59:54.303204Z"
        },
        "outputs": [
          "csv.prep.output",
          "prep.report{}",
          "prep.issues[]",
          "prep.status",
          "prep.stats{}"
        ],
        "preconditions": {
          "critical_pass": {
            "require_ancestors_done": [
              "0",
              "1",
              "3",
              "6",
              "16"
            ]
          },
          "parent_defined": {
            "exists": true,
            "path": "/workflow_patches/steps/0"
          },
          "step0_review_confirmed": {
            "equals": true,
            "path": "/workflow_patches/steps/0/outputs/review_confirmed"
          }
        },
        "requires": [
          "00"
        ],
        "rules": [
          "always-run: true",
          "non-blocking: true (only WARN, never BLOCK)",
          "auto-fix encoding (UTF-8), newline normalize (\\n), trim",
          "type-specific header/field mappers",
          "dedupe (case/diacritics insensitive)",
          "tags split normalize (',',';','|') -> ','",
          "numeric normalize (comma as decimal)",
          "warn on missing critical fields per type; auto-skip row but continue",
          "produce prep.report{}, prep.issues[], prep.stats{rows_in, rows_out, skipped, fixed}"
        ],
        "ruleset": [
          {
            "id": "ALWAYS_RUN",
            "params": {
              "enforced": true
            }
          },
          {
            "id": "NON_BLOCKING",
            "params": {
              "warn_only": true
            }
          },
          {
            "id": "ENCODING_NORMALIZE",
            "params": {
              "encoding": "UTF-8",
              "newline": "\\n"
            }
          },
          {
            "id": "TRIM_LOWER_PUNCT_NORMALIZE",
            "params": {
              "enabled": true
            }
          },
          {
            "id": "DEDUPE_POLICY",
            "params": {
              "case_insensitive": true,
              "diacritics_insensitive": true
            }
          },
          {
            "id": "TAGS_SPLIT_NORMALIZE",
            "params": {
              "delims": [
                ",",
                ";",
                "|"
              ],
              "target": ","
            }
          },
          {
            "id": "NUMERIC_NORMALIZE",
            "params": {
              "comma_as_decimal": true
            }
          },
          {
            "id": "WARN_MISSING_CRITICAL",
            "params": {
              "fields": {
                "competitor": [
                  "shop_name",
                  "shop_url"
                ],
                "top_listings": [
                  "title",
                  "tags"
                ]
              }
            }
          },
          {
            "id": "REPORT_FIELDS",
            "params": {
              "include": [
                "rows_in",
                "rows_out",
                "skipped",
                "fixed"
              ]
            }
          }
        ],
        "title": "Ortam Kontrolleri",
        "upstream_signature": {
          "policy": "mark_stale_on_upstream_change"
        },
        "validations": {
          "colors_defined": {
            "min_len": 3,
            "path": "/_product_static/colors"
          },
          "present": true,
          "product_material_present": {
            "path": "/_product_static/material",
            "required": true
          },
          "variation_prices_complete": {
            "paths": [
              "/_product_static/variation_prices/10K",
              "/_product_static/variation_prices/14K",
              "/_product_static/variation_prices/18K"
            ],
            "required_all": true
          }
        },
        "control_matrix": {
          "meta": {
            "generated_at": "2025-09-13T11:49:46.214728Z",
            "author": "gpt",
            "principle": "mirror-all-rules-here",
            "on_violation": "RUN_FAIL",
            "merged_at": "2025-09-13T11:55:15.465447Z"
          },
          "global": {
            "digest_only_until_step": 16,
            "export_policy": {
              "prefer": "raw_link",
              "fallback": "manual_upload"
            },
            "write_policy": {
              "mode": "copy_only",
              "allowed_root": "/final/**"
            },
            "required_stops": [
              0,
              1,
              3,
              4,
              6,
              16
            ],
            "integrity_checks": [
              "/_policy/critical.required_paths",
              "/_policy/integrity.section_hashes",
              "workflow_patches.steps_registry_lock"
            ]
          },
          "steps": {
            "0": {
              "must_confirm": true,
              "outputs_expected": [
                "outputs.review_confirmed"
              ],
              "show_paths_include": [
                "/workflow_patches/steps/0/product_info",
                "/_product_static/variation_prices"
              ]
            },
            "00": {
              "purpose": "pre-run self-check",
              "must_confirm": false
            },
            "0a": {
              "purpose": "policy_enforcement_and_integrity_gate",
              "must_confirm": false,
              "checks": [
                "digest_only_enforced",
                "export_policy_defined",
                "write_policy_enforced",
                "required_stops_present",
                "integrity_checks_pass"
              ]
            },
            "1": {
              "purpose": "media_upload_qc",
              "must_confirm": true,
              "constraints": {
                "min_images": 5,
                "formats": [
                  "jpg",
                  "jpeg",
                  "png",
                  "webp"
                ],
                "min_short_edge_px": 2000
              }
            },
            "1a": {
              "purpose": "media_analysis_and_seo_alignment",
              "must_confirm": false,
              "outputs_expected": [
                "media.checklist",
                "media.issues[]",
                "media.recommendations[]",
                "media.qc_report"
              ]
            },
            "1b": {
              "purpose": "two-word_search_suggestions",
              "must_confirm": false,
              "constraints": {
                "count": 8,
                "two_word_each": true,
                "dedupe": true
              }
            },
            "3": {
              "purpose": "similar_csv_ingestion",
              "must_confirm": true,
              "constraints": {
                "files_required": 8,
                "keyword_column": "Keyword"
              }
            },
            "3a": {
              "purpose": "focus_selection_and_pool_build",
              "must_confirm": false,
              "constraints": {
                "min_pool_size": 300,
                "max_same_root_in_top50": 3,
                "semantic_similarity_threshold": 0.85,
                "focus_keywords_count": 4,
                "notes_required": true,
                "tie_breakers": [
                  "higher conversion_rate",
                  "higher overall score",
                  "better segment diversification"
                ],
                "use_in_3b": 1,
                "source_mix": {
                  "own_pool": {
                    "min": 0.5,
                    "max": 0.6
                  },
                  "top_products_csv": {
                    "min": 0.2,
                    "max": 0.3
                  },
                  "competitors": {
                    "min": 0.1,
                    "max": 0.2
                  },
                  "relevance_gate_required": true
                },
                "scoring": {
                  "weights": {
                    "volume": 1.0,
                    "competition": -1.0,
                    "ctr": 0.8,
                    "cr": 1.0,
                    "novelty_gain": 0.7,
                    "source_weight": 0.3,
                    "risk_flags": -2.0
                  },
                  "notes": "Normalize inputs to [0,1]; sum weights; higher is better; drop on risk."
                }
              },
              "outputs_expected": [
                "keywords.drop_log[]",
                "keywords.focus[1..4].provisional",
                "keywords.pool.ranked[]",
                "keywords.pool.tier1.top50[]",
                "keywords.pool.tier2.next150[]",
                "keywords.pool.tier3.rest[]",
                "keywords.segment_coverage",
                "keywords.selection_notes"
              ],
              "seo_requirements": {
                "search_volume": "required",
                "competition": "required",
                "ctr_or_conversion_rate": "required",
                "long_tail": "required",
                "title_desc_tag_alignment": "required"
              },
              "enforce": {
                "fail_on_violation": true,
                "report_paths": [
                  "/workflow_patches/steps/0a/control_matrix/steps/3a/constraints"
                ]
              }
            },
            "3b": {
              "purpose": "post-3a policy enforcement",
              "must_confirm": false,
              "ruleset_policy_keys_expected": [
                "add_missing",
                "keep_extras",
                "mode",
                "on_mismatch",
                "reorder_known"
              ],
              "note": "No explicit outputs (title/desc/tags) in this step per final JSON.",
              "constraints": {
                "inputs_required": [
                  "3a.keywords.focus",
                  "3a.keywords.pool.ranked[]",
                  "3a.keywords.segment_coverage"
                ]
              },
              "outputs_expected": [
                "draft.seed.description_outline.p1_core",
                "draft.seed.description_outline.p2_features",
                "draft.seed.description_outline.p3_logistics_cta",
                "draft.seed.tag_buckets.long_tail",
                "draft.seed.tag_buckets.material_karat",
                "draft.seed.tag_buckets.product",
                "draft.seed.tag_buckets.recipient_or_occasion",
                "draft.seed.tag_buckets.size_finish",
                "draft.seed.tag_buckets.style",
                "draft.seed.title_core_ngram",
                "source_mix_log"
              ],
              "enforce": {
                "fail_on_violation": true,
                "report_paths": [
                  "/workflow_patches/steps/0a/control_matrix/steps/3b/constraints"
                ]
              }
            },
            "4": {
              "purpose": "focus_selection_user_confirmation",
              "must_confirm": true
            },
            "5": {
              "purpose": "Top listings upload (narrow category focus)",
              "must_confirm": false,
              "constraints": {
                "must_match": {
                  "product_type": true
                },
                "require_one_of": [
                  "metal_karat_match",
                  "style_or_motif_match"
                ],
                "min_recency_window_days": 60,
                "price_band_tolerance": 0.3,
                "similarity": {
                  "jaccard_min": 0.5,
                  "cosine_min": 0.6
                },
                "forbidden": {
                  "brand_or_trademark": true,
                  "generic_spam_terms": [
                    "gift",
                    "gift idea",
                    "trending"
                  ]
                },
                "language": {
                  "locale": "en-US",
                  "prevent_all_caps": true
                },
                "per_shop_cap": 0.25
              },
              "outputs_expected": [
                "top_products.narrow_raw[]"
              ],
              "enforce": {
                "fail_on_violation": true,
                "report_paths": [
                  "/workflow_patches/steps/0a/control_matrix/steps/5/constraints"
                ]
              }
            },
            "5a": {
              "purpose": "ngrams_and_recombination",
              "must_confirm": false
            },
            "5b": {
              "purpose": "filtering_and_prioritization",
              "must_confirm": false
            },
            "6": {
              "purpose": "Competitor shops upload (raw intake with shop balancing)",
              "must_confirm": true,
              "outputs_expected": [
                "competitors.raw[]"
              ],
              "constraints": {
                "must_match": {
                  "product_type": true
                },
                "require_one_of": [
                  "metal_karat_match",
                  "style_or_motif_match"
                ],
                "similarity": {
                  "jaccard_min": 0.5,
                  "cosine_min": 0.6
                },
                "forbidden": {
                  "brand_or_trademark": true,
                  "generic_spam_terms": [
                    "gift",
                    "gift idea",
                    "trending"
                  ]
                },
                "language": {
                  "locale": "en-US",
                  "prevent_all_caps": true
                },
                "per_shop_cap": 0.25
              },
              "enforce": {
                "fail_on_violation": true,
                "report_paths": [
                  "/workflow_patches/steps/0a/control_matrix/steps/6/constraints"
                ]
              }
            },
            "16": {
              "purpose": "export_and_hash",
              "must_confirm": true,
              "export_ui": [
                "filename",
                "github_raw_link"
              ],
              "post": [
                "zip",
                "hash"
              ]
            },
            "10": {
              "purpose": "Title quality & policy enforcement (mobile-first, relevance, coherence)",
              "must_confirm": true,
              "constraints": {
                "front_load_max_chars": 40,
                "max_length": 140,
                "no_keyword_stuffing": true,
                "trim_duplicates": true,
                "coherence_with": [
                  "12.tags",
                  "11.description"
                ],
                "require_components": {
                  "step0_metal_and_karat": true,
                  "product_type": true,
                  "long_tail_variant": true
                },
                "conditional_components": {
                  "color_variant": "optional_if_multi_variant"
                },
                "forbidden_unless_true_in_step0": {
                  "personalized": "require: product_info.personalization == true",
                  "stone_type": "require: product_info.stone.type is known"
                },
                "unknown_stone_policy": "do_not_name_stone_in_title_when_unknown",
                "language": {
                  "disallow_misleading_claims": true,
                  "prevent_all_caps": true
                }
              },
              "outputs_expected": [
                "draft.title"
              ],
              "enforce": {
                "fail_on_violation": true,
                "report_paths": [
                  "/workflow_patches/steps/0a/control_matrix/steps/10/constraints"
                ]
              }
            },
            "11": {
              "purpose": "Description quality & policy enforcement (mobile-first, 3-paragraph, US English, alignment)",
              "must_confirm": true,
              "constraints": {
                "length": {
                  "min_words": 250,
                  "max_words": 500
                },
                "paragraphs": {
                  "count": 3,
                  "p1_max_chars": 180,
                  "p1_must_contain": [
                    "step0_metal_and_karat",
                    "product_type",
                    "benefit_or_value"
                  ],
                  "p2_must_cover": [
                    "metal_karat_options",
                    "color_options_if_present",
                    "size_or_dimensions",
                    "comfort_or_finish",
                    "stone_policy"
                  ],
                  "p3_must_cover": [
                    "shipping_prep_time",
                    "origin_country",
                    "care_or_warranty",
                    "cta_message"
                  ]
                },
                "keyword_policy": {
                  "no_keyword_stuffing": true,
                  "long_tail_mentions": {
                    "min": 2,
                    "max": 4
                  },
                  "unique_root_repeat_limit": 1,
                  "coherence_with": [
                    "10.title",
                    "12.tags"
                  ]
                },
                "language": {
                  "locale": "en-US",
                  "spelling": "american",
                  "avoid_slang": true,
                  "prevent_all_caps": true
                },
                "truthfulness": {
                  "forbidden_unless_true_in_step0": {
                    "personalized": "require: product_info.personalization == true",
                    "stone_type": "require: product_info.stone.type is known"
                  },
                  "unknown_stone_policy": "must_include_neutral_statement_if_unknown"
                },
                "step0_binding": {
                  "require_metal_and_karat": true,
                  "require_product_type": true,
                  "require_shipping_prep_time": true,
                  "require_origin_country": true
                }
              },
              "outputs_expected": [
                "draft.description"
              ],
              "enforce": {
                "fail_on_violation": true,
                "report_paths": [
                  "/workflow_patches/steps/0a/control_matrix/steps/11/constraints"
                ]
              }
            },
            "12": {
              "purpose": "Final tags quality & policy enforcement (uniqueness, diversity, alignment)",
              "constraints": {
                "counts": {
                  "exact_tags": 13,
                  "max_tag_length": 20
                },
                "dedupe": {
                  "unique_by_root": true,
                  "max_root_repeats": {
                    "default": 1,
                    "product_root": 2
                  },
                  "similarity_threshold": 0.7,
                  "lemmatization": "en"
                },
                "diversity_bucket_targets": {
                  "product": 1,
                  "material_karat": 1,
                  "long_tail": {
                    "min": 3,
                    "max": 5
                  },
                  "style": 2,
                  "recipient_or_occasion": {
                    "min": 1,
                    "max": 2
                  },
                  "size_finish": {
                    "min": 1,
                    "max": 2
                  }
                },
                "source_mix": {
                  "own_pool": {
                    "min": 0.5,
                    "max": 0.6
                  },
                  "top_products_csv": {
                    "min": 0.2,
                    "max": 0.3
                  },
                  "competitors": {
                    "min": 0.1,
                    "max": 0.2
                  },
                  "relevance_gate_required": true
                },
                "alignment": {
                  "must_align_with": [
                    "10.title",
                    "11.description"
                  ],
                  "require_core_ngram_from_title": true
                },
                "language": {
                  "locale": "en-US",
                  "prevent_all_caps": true
                },
                "truthfulness": {
                  "only_if_true_in_step0": {
                    "personalized": "require: product_info.personalization == true",
                    "stone_type": "require: product_info.stone.type is known"
                  }
                },
                "forbidden": {
                  "brand_or_trademark": true,
                  "generic_spam_terms": [
                    "gift",
                    "gift idea",
                    "trending"
                  ],
                  "non_us_spelling": [
                    "colour"
                  ],
                  "misleading_or_unverified": true
                }
              },
              "outputs_expected": [
                "draft.tags[13]"
              ],
              "enforce": {
                "fail_on_violation": true,
                "report_paths": [
                  "/workflow_patches/steps/0a/control_matrix/steps/12/constraints"
                ],
                "log": {
                  "source_mix_breakdown": true,
                  "dedupe_decisions": true,
                  "alignment_checks": true
                }
              }
            },
            "8": {
              "purpose": "Ads campaign skeleton & theming (budget-aware grouping)",
              "constraints": {
                "inputs_required": [
                  "3a.keywords.focus",
                  "3a.keywords.selection_notes",
                  "12.tags",
                  "top_products.csv",
                  "competitors.csv"
                ],
                "ad_groups": {
                  "count": {
                    "min": 3,
                    "max": 4
                  },
                  "theme_overlap_allowed": false,
                  "us_locale_required": true
                },
                "forbidden": {
                  "brand_or_trademark": true,
                  "generic_spam_terms": [
                    "gift",
                    "gift idea",
                    "trending"
                  ]
                },
                "alignment": {
                  "must_carry_themes_from": [
                    "10.title",
                    "12.tags",
                    "3a.keywords.focus"
                  ]
                },
                "budget_binding": {
                  "budget_ref_path": "/workflow_patches/steps/0/product_info/ads/daily_budget_usd",
                  "assume_daily_budget_usd_max": 10
                }
              },
              "outputs_expected": [
                "ads.groups[3..4]"
              ],
              "enforce": {
                "fail_on_violation": true,
                "report_paths": [
                  "/workflow_patches/steps/0a/control_matrix/steps/8/constraints"
                ]
              }
            },
            "8a": {
              "purpose": "Ads keyword generation (long-tail heavy, negatives, budget-aware)",
              "constraints": {
                "inputs_required": [
                  "ads.groups[]",
                  "3a.keywords.pool.ranked[]",
                  "12.tags"
                ],
                "per_group_keywords": {
                  "min": 8,
                  "max": 12
                },
                "match_types_allowed": [
                  "exact",
                  "phrase"
                ],
                "disallow_broad": true,
                "long_tail_ratio_min": 0.6,
                "negatives_required": true,
                "negatives": {
                  "generic": [
                    "gift",
                    "gift idea",
                    "trending"
                  ],
                  "brand_or_trademark": true,
                  "cross_negatives_between_groups": true
                },
                "alignment": {
                  "require_core_ngram_from_title": true
                },
                "dedupe_similarity_threshold": 0.7,
                "language": {
                  "locale": "en-US",
                  "prevent_all_caps": true
                },
                "budget_binding": {
                  "budget_ref_path": "/workflow_patches/steps/0/product_info/ads/daily_budget_usd",
                  "assume_daily_budget_usd_max": 10
                }
              },
              "outputs_expected": [
                "ads.keywords[]",
                "ads.negatives[]"
              ],
              "enforce": {
                "fail_on_violation": true,
                "report_paths": [
                  "/workflow_patches/steps/0a/control_matrix/steps/8a/constraints"
                ],
                "log": {
                  "source_mix_breakdown": true,
                  "alignment_checks": true,
                  "dedupe_decisions": true
                }
              }
            },
            "9": {
              "purpose": "SEO keyword refinement (dedupe, alignment, Ads↔SEO consolidation)",
              "constraints": {
                "inputs_required": [
                  "10.title",
                  "11.description",
                  "12.tags",
                  "ads.keywords"
                ],
                "root_repeat_limit": {
                  "default": 1,
                  "product_root": 2
                },
                "similarity_drop_threshold": 0.7,
                "long_tail_priority": true,
                "alignment": {
                  "title_core_ngram_in_tags": true,
                  "title_core_ngram_in_ads_keywords": true
                }
              },
              "outputs_expected": [
                "seo.keywords.refined[]",
                "seo.drop_log[]"
              ],
              "enforce": {
                "fail_on_violation": true,
                "report_paths": [
                  "/workflow_patches/steps/0a/control_matrix/steps/9/constraints"
                ]
              }
            },
            "4a": {
              "purpose": "Top listings upload (raw intake with relevance gating)",
              "constraints": {
                "must_match": {
                  "product_type": true
                },
                "require_one_of": [
                  "metal_karat_match",
                  "style_or_motif_match"
                ],
                "min_recency_window_days": 90,
                "price_band_tolerance": 0.3,
                "similarity": {
                  "jaccard_min": 0.5,
                  "cosine_min": 0.6
                },
                "forbidden": {
                  "brand_or_trademark": true,
                  "generic_spam_terms": [
                    "gift",
                    "gift idea",
                    "trending"
                  ]
                },
                "language": {
                  "locale": "en-US",
                  "prevent_all_caps": true
                },
                "per_shop_cap": 0.25
              },
              "outputs_expected": [
                "top_products.raw[]"
              ],
              "enforce": {
                "fail_on_violation": true,
                "report_paths": [
                  "/workflow_patches/steps/0a/control_matrix/steps/4a/constraints"
                ]
              }
            },
            "4b": {
              "purpose": "Top listings clean (normalize + dedupe + relevance confirm)",
              "constraints": {
                "normalize": [
                  "lowercase",
                  "trim",
                  "collapse_spaces",
                  "strip_punctuation"
                ],
                "dedupe": {
                  "by_title_and_tags": true
                },
                "similarity": {
                  "jaccard_min": 0.5,
                  "cosine_min": 0.6
                },
                "forbidden": {
                  "brand_or_trademark": true,
                  "generic_spam_terms": [
                    "gift",
                    "gift idea",
                    "trending"
                  ]
                },
                "language": {
                  "locale": "en-US",
                  "prevent_all_caps": true
                }
              },
              "outputs_expected": [
                "top_products.clean[]"
              ],
              "enforce": {
                "fail_on_violation": true,
                "report_paths": [
                  "/workflow_patches/steps/0a/control_matrix/steps/4b/constraints"
                ]
              }
            },
            "6a": {
              "purpose": "Competitor analysis (theme extraction + bias control)",
              "constraints": {
                "extract_themes": true,
                "shop_bias_cap": 0.25,
                "similarity": {
                  "jaccard_min": 0.5,
                  "cosine_min": 0.6
                },
                "forbidden": {
                  "brand_or_trademark": true,
                  "generic_spam_terms": [
                    "gift",
                    "gift idea",
                    "trending"
                  ]
                }
              },
              "outputs_expected": [
                "competitors.themes[]",
                "competitors.bias_report"
              ],
              "enforce": {
                "fail_on_violation": true,
                "report_paths": [
                  "/workflow_patches/steps/0a/control_matrix/steps/6a/constraints"
                ]
              }
            },
            "6b": {
              "purpose": "Competitor listings clean (normalize + dedupe + relevance confirm)",
              "constraints": {
                "normalize": [
                  "lowercase",
                  "trim",
                  "collapse_spaces",
                  "strip_punctuation"
                ],
                "dedupe": {
                  "by_title_and_tags": true
                },
                "similarity": {
                  "jaccard_min": 0.5,
                  "cosine_min": 0.6
                },
                "forbidden": {
                  "brand_or_trademark": true,
                  "generic_spam_terms": [
                    "gift",
                    "gift idea",
                    "trending"
                  ]
                },
                "language": {
                  "locale": "en-US",
                  "prevent_all_caps": true
                }
              },
              "outputs_expected": [
                "competitors.clean[]"
              ],
              "enforce": {
                "fail_on_violation": true,
                "report_paths": [
                  "/workflow_patches/steps/0a/control_matrix/steps/6b/constraints"
                ]
              }
            },
            "0a_checks_step0_shipping": {
              "checks": [
                {
                  "path": "context_info.basics.shipping.delivery_time",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "context_info.basics.shipping.free_shipping",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "context_info.basics.shipping.tracking",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "context_info.basics.shipping.packaging.gift_box",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "context_info.basics.shipping.packaging.gift_note",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "context_info.basics.shipping.customs.seller_pays_duties",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "context_info.basics.shipping.target_markets",
                  "required": true,
                  "fail_on_violation": true
                }
              ]
            },
            "0a_checks_intake_enforcement": {
              "checks": [
                {
                  "path": "workflow_patches.steps.4.constraints.require_csv",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "workflow_patches.steps.4.constraints.empty_intake",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "workflow_patches.steps.4a.constraints.require_csv",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "workflow_patches.steps.4a.constraints.empty_intake",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "workflow_patches.steps.4b.constraints.require_csv",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "workflow_patches.steps.4b.constraints.empty_intake",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "workflow_patches.steps.5.constraints.require_csv",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "workflow_patches.steps.5.constraints.empty_intake",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "workflow_patches.steps.5a.constraints.require_csv",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "workflow_patches.steps.5a.constraints.empty_intake",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "workflow_patches.steps.5b.constraints.require_csv",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "workflow_patches.steps.5b.constraints.empty_intake",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "workflow_patches.steps.6.constraints.require_csv",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "workflow_patches.steps.6.constraints.empty_intake",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "workflow_patches.steps.6a.constraints.require_csv",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "workflow_patches.steps.6a.constraints.empty_intake",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "workflow_patches.steps.6b.constraints.require_csv",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "workflow_patches.steps.6b.constraints.empty_intake",
                  "required": true,
                  "fail_on_violation": true
                }
              ]
            },
            "0a_checks_5c_presence": {
              "checks": [
                {
                  "path": "workflow_patches.steps.5c.title",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "workflow_patches.steps.5c.stop_for_confirmation",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "workflow_patches.steps.5c.constraints.requires_input_from",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "_run_order.steps.5c.display_contract",
                  "required": true,
                  "fail_on_violation": true
                }
              ]
            },
            "0a_checks_registry_lock": {
              "checks": [
                {
                  "path": "workflow_patches.steps_registry_lock",
                  "required": true,
                  "fail_on_violation": true
                }
              ]
            },
            "0a_checks_vision_schema": {
              "checks": [
                {
                  "path": "workflow_patches.steps.1.constraints.vision_extraction.enabled",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "workflow_patches.steps.1.constraints.vision_extraction.supported_fields",
                  "required": true,
                  "fail_on_violation": true
                }
              ]
            },
            "0a_checks_gift_rule_sync": {
              "checks": [
                {
                  "path": "workflow_patches.steps.4.forbidden",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "workflow_patches.steps.4a.forbidden",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "workflow_patches.steps.4b.forbidden",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "workflow_patches.steps.5.forbidden",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "workflow_patches.steps.5a.forbidden",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "workflow_patches.steps.5b.forbidden",
                  "required": true,
                  "fail_on_violation": true
                }
              ]
            },
            "0a_checks_ui_prefs": {
              "checks": [
                {
                  "path": "_run_order.settings.text_only_preview",
                  "required": true,
                  "fail_on_violation": true
                }
              ]
            },
            "0a_checks_zero_acceptance": {
              "checks": [
                {
                  "path": "_policy.workflow.guards.zero_acceptance_strategy",
                  "required": true,
                  "fail_on_violation": true
                }
              ]
            },
            "0a_checks_content_family": {
              "checks": [
                {
                  "path": "workflow_patches.steps.9",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "workflow_patches.steps.10",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "workflow_patches.steps.11",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "workflow_patches.steps.12",
                  "required": true,
                  "fail_on_violation": true
                }
              ]
            },
            "0a_checks_preview_settings": {
              "checks": [
                {
                  "path": "_run_order.settings.text_only_preview",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "_run_order.settings.preview_render.plain_text",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "_run_order.settings.preview_render.disable_autonumbering",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "_run_order.settings.preview_render.disable_bullets",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "_run_order.settings.deterministic_seed",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "_run_order.settings.session_variance",
                  "required": true,
                  "fail_on_violation": true
                }
              ]
            },
            "0a_checks_step_ui_plain": {
              "checks": [
                {
                  "path": "_run_order.steps.3a.ui_output.force_plain_text",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "_run_order.steps.3a.ui_output.disable_autonumbering",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "_run_order.steps.3a.display_contract",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "_run_order.steps.3b.ui_output.force_plain_text",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "_run_order.steps.3b.ui_output.disable_autonumbering",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "_run_order.steps.3b.display_contract",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "_run_order.steps.10.ui_output.force_plain_text",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "_run_order.steps.10.ui_output.disable_autonumbering",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "_run_order.steps.10.display_contract",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "_run_order.steps.11.ui_output.force_plain_text",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "_run_order.steps.11.ui_output.disable_autonumbering",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "_run_order.steps.11.display_contract",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "_run_order.steps.12.ui_output.force_plain_text",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "_run_order.steps.12.ui_output.disable_autonumbering",
                  "required": true,
                  "fail_on_violation": true
                },
                {
                  "path": "_run_order.steps.12.display_contract",
                  "required": true,
                  "fail_on_violation": true
                }
              ]
            }
          },
          "enforcement": {
            "fail_fast": true,
            "report_paths": [
              "/workflow_patches/steps/0a/control_matrix",
              "/_policy/integrity"
            ],
            "require_all_steps_have_title": true
          },
          "hydration": {
            "step_titles": "enforced",
            "sources": [
              "steps/*",
              "_run_order/steps/*"
            ]
          }
        },
        "display_contract": {
          "render_full": true,
          "block_until_user_ack": false
        },
        "stop_for_confirmation": false,
        "is_background": false,
        "label": "Ortam Kontrolleri",
        "await_user": true,
        "require_user_confirm": true,
        "no_skip": true,
        "purpose": "Üretim başlamadan hemen önce çalışma ortamını kontrol eder; runtime, ağ, depolama ve kimlik doğrulamanın hazır olduğunu doğrular.",
        "validators_required": false,
        "enforcement": {
          "on_violation": "warn",
          "order_source_policy": {
            "mode": "strict",
            "allowed[]": [
              "/step_flow_lock/canonical_order"
            ]
          },
          "write_guard": {
            "mode": "add_only",
            "deny_delete": true,
            "deny_rename": true,
            "deny_move": true,
            "deny_overwrite_non_empty": true
          },
          "ids": {
            "require_unique": true,
            "case_sensitive": true
          },
          "refs": {
            "require_zero_broken": true
          },
          "order": {
            "mirror_required": true
          }
        },
        "outputs_expected": {
          "env_status": "OK | WARN",
          "warnings": [],
          "details": {
            "clock_skew_ok": true,
            "raw_access_ok": true,
            "storage_ok": true,
            "third_party_ok": true
          }
        },
        "checklist": [
          "Saat/timezone doğru mu (±2dk/±1 TZ)?",
          "RAW linkine erişim test edildi mi?",
          "Depolama kotası yeterli mi (>= 50MB)?",
          "Opsiyonel kimlik bilgileri mevcutsa geçerli mi?"
        ],
        "what_gpt_does": [
          "env_config ve runtime_info’yu konsolide eder",
          "RAW erişimini dener; hata varsa uyarı oluşturur",
          "Depolama ve ağ durumu için kısa rapor üretir"
        ],
        "what_user_does": [
          "Eksik kimlik bilgilerini tamamlar",
          "RAW link problemi varsa pinned commit kullanır",
          "Saat/Timezone hatasını düzeltir (OS/Browser)"
        ],
        "preflight": {
          "checks[]": [
            "json_parse_ok",
            "order_source_present:/step_flow_lock/canonical_order|/workflow_enforcement/execution_order|/_run_order/steps",
            "order_ids_unique",
            "order_ids_string",
            "case_conflicts_absent",
            "ref_integrity_ok"
          ],
          "fail_mode": "HALT"
        },
        "ref_audit": {
          "enabled": true,
          "scope": "/*",
          "report_limit": 50
        },
        "tokens": {
          "track_session": true,
          "warn_ratio": 0.7,
          "halt_ratio": 0.9,
          "estimate_source": "browser_session",
          "on_warn": "notify_user",
          "on_halt": "exit_session",
          "require_exit": true,
          "notes": "Tarayıcı oturumu için token takibi; %70 uyarı, %90 zorunlu çıkış."
        },
        "json_validation": {
          "enabled": true,
          "strict": true
        },
        "ui_ext": {
          "token_tracking": true
        }
      },
      "1": {
        "artifacts": [
          "media.manifest.json",
          "media.qc.report.json"
        ],
        "constraints": {
          "must_confirm": true,
          "no_skip": true,
          "require_gpt_task": false,
          "require_user_task": true,
          "require_validations_pass": true,
          "vision_extraction": {
            "enabled": false,
            "supported_fields": [
              "stone.type",
              "stone.cut",
              "stone.shape",
              "stone.setting"
            ],
            "notes": "When enabled, these fields are auto-extracted if vision_conf >= stone_info_policy.threshold; otherwise user_provided preferred."
          }
        },
        "description": "Ürün fotoğrafları ve varsa ürün videosu sisteme yüklenir. Dosya tipleri, çözünürlük ve oran kontrolleri yapılır; başarılı olanlar ürün varlık deposuna kaydedilir.",
        "flow": {
          "guard": {
            "advance_only_if": []
          },
          "on_fail": "halt",
          "on_success_next": "1a"
        },
        "gates": {
          "must": [
            "validations_ok"
          ],
          "on_contract_violation": "halt_and_report",
          "on_miss": "halt",
          "on_missing_required_path": "halt_and_report",
          "on_soft_misalignment": "warn_and_continue"
        },
        "hitl_contract": {
          "gpt_tasks": [
            "EXIF ve boyut kontrolü yap; geçersizleri uyar."
          ],
          "user_tasks": [
            "Görselleri (JPG/PNG/WEBP) yükle (1-20 adet)."
          ]
        },
        "id": "1",
        "inputs": [
          "user.upload.photos[]?",
          "user.upload.video?"
        ],
        "name": "Görsel Yükleme",
        "next": [
          "1a"
        ],
        "on_error": {
          "fallback_next": [],
          "policy": "fail-soft"
        },
        "outputs": [
          "product.photos[]",
          "product.video?"
        ],
        "preconditions": {
          "critical_pass": {
            "require_ancestors_done": [
              "0",
              "1",
              "3",
              "6",
              "16"
            ]
          }
        },
        "requires": [
          "0a"
        ],
        "title": "Görsel Yükleme",
        "type": "upload_images",
        "ui": {
          "accept": [
            ".jpg",
            ".jpeg",
            ".png",
            ".webp"
          ],
          "help": "JPG, PNG veya WEBP yükleyin. En az 1, en fazla 20 görsel.",
          "max_files": 20,
          "max_size_mb": 25,
          "min_files": 1,
          "title": "Görselleri Yükle"
        },
        "upstream_signature": {
          "policy": "mark_stale_on_upstream_change"
        },
        "validation": {
          "required": true,
          "rules": [
            {
              "id": "IMG_COUNT_MIN",
              "params": {
                "min": 1
              }
            },
            {
              "id": "IMG_DIM_MIN",
              "params": {
                "min_height": 512,
                "min_width": 512
              }
            },
            {
              "id": "IMG_FORMAT",
              "params": {
                "allow": [
                  "jpg",
                  "jpeg",
                  "png",
                  "webp"
                ]
              }
            }
          ]
        },
        "validations": {
          "photos.max_files": 10,
          "photos.mime": [
            "image/jpeg",
            "image/png",
            "image/webp"
          ],
          "photos.min_resolution": "1200x1200",
          "video.max_duration_sec": 60,
          "video.mime": [
            "video/mp4",
            "video/quicktime"
          ]
        },
        "value_handling": {
          "cast_all_as_text": true,
          "normalize_yes_no": true,
          "treat_empty_as_valid": true,
          "treat_nan_as_empty": true
        },
        "label": "Görsel Yükleme",
        "await_user": true,
        "require_user_confirm": true,
        "no_skip": true,
        "ui_ext": {
          "token_tracking": true
        }
      },
      "10": {
        "constraints": {
          "must_confirm": false,
          "no_skip": true,
          "require_gpt_task": false,
          "require_user_task": false,
          "require_validations_pass": false
        },
        "description": "Odak/support keywordler, ürün attribute'ları ve mağaza sesi ile SEO uyumlu başlık oluşturulur.",
        "flow": {
          "guard": {
            "advance_only_if": []
          }
        },
        "gates": {
          "must": [
            "validations_ok"
          ],
          "on_contract_violation": "halt_and_report",
          "on_miss": "halt",
          "on_missing_required_path": "halt_and_report",
          "on_soft_misalignment": "auto_fix_and_continue"
        },
        "guards": {
          "title_repetition": {
            "max_repeat": 2
          },
          "must_include_tokens": [
            "selected_karat",
            "selected_color",
            "noun"
          ],
          "forbid_terms": [
            "free shipping",
            "%",
            "discount",
            "on sale"
          ],
          "fail_on_missing": true
        },
        "hitl_contract": {
          "gpt_tasks": [],
          "user_tasks": []
        },
        "inputs": [
          "keywords.focus[1..4]",
          "seo.keywords.supporting[]",
          "product.info{}",
          "shop.profile{}"
        ],
        "name": "SEO Title Generation",
        "outputs": [
          "title.final"
        ],
        "preconditions": {
          "critical_pass": {
            "require_ancestors_done": [
              "0",
              "1",
              "3",
              "6",
              "16"
            ]
          }
        },
        "requires": [
          "7"
        ],
        "rules": [
          "title length: 80-140 chars (optimum 110-130)",
          "first 30-40 chars must include focus_1",
          "slots: focus keyword, 1 product attribute, 1 occasion/audience, optional brand voice",
          "no stuffing, no ALL CAPS",
          "forbidden terms: ['Turkey','Istanbul']"
        ],
        "ruleset": {
          "consistency_check": {
            "against": "product_info"
          },
          "enforce_from_step0": [
            "karat",
            "metal_color",
            "variant_size_range"
          ],
          "forbid_terms": [
            "personalized",
            "custom",
            "engraved",
            "initial pendant"
          ],
          "frontload_focus": {
            "first_chars": 35
          },
          "guards": {
            "require_user_ack": true
          },
          "max_len": 140,
          "optional_input": [
            "trending_keywords"
          ],
          "structure": "1_main + 2_variations + 1_niche",
          "variants": 2
        },
        "title": "SEO Title Generation",
        "upstream_signature": {
          "policy": "mark_stale_on_upstream_change"
        },
        "validations": {
          "present": true
        },
        "validators": [
          "mobile_first<=40",
          "title_len<=55",
          "no_markdown",
          "lang==en-US"
        ],
        "label": "SEO Title Generation",
        "await_user": true,
        "require_user_confirm": true,
        "no_skip": true,
        "bindings": {
          "colors[]": {
            "__REF__": "/workflow_patches/steps/0/product_info/fixed_product/colors[]"
          },
          "sizes_us": {
            "__REF__": "/workflow_patches/steps/0/product_info/fixed_product/sizes_us"
          },
          "variations[]": {
            "__REF__": "/workflow_patches/steps/0/product_info/fixed_product/variations[]"
          },
          "target_locale": {
            "__REF__": "/workflow_patches/steps/0/product_info/ads/target_locale"
          }
        },
        "selection_prefs": {
          "karat_priority": [
            "14K",
            "18K",
            "10K"
          ],
          "color_priority": [
            "Yellow Gold",
            "White Gold",
            "Rose Gold"
          ],
          "size_strategy": "variant_specific_or_omit"
        },
        "template": {
          "title_en": "{noun}: {selected_karat} {selected_color}{size_suffix}",
          "locale_from": "target_locale",
          "notes": "noun comes from product taxonomy/catalog; do not include shipping/discount."
        },
        "post_render_validations": {
          "regex_forbid": [
            "free\\s+shipping",
            "%",
            "discount",
            "on\\s+sale"
          ]
        },
        "seo_title_guidelines": {
          "summary": [
            "Use one clear noun at start; no keyword stuffing.",
            "Include one karat and one metal color; avoid multiple synonyms.",
            "Optionally include variant size; omit range in title.",
            "Do not include shipping/discount/promo in title.",
            "Keep titles concise and unique; avoid repeated terms."
          ],
          "sources": [
            "Google Search Central — title link best practices",
            "Etsy Seller Handbook — Listing quality & titles (2025)",
            "Industry practice — 50–60 char target"
          ]
        },
        "ui_ext": {
          "token_tracking": true
        }
      },
      "11": {
        "constraints": {
          "must_confirm": false,
          "no_skip": true,
          "require_gpt_task": false,
          "require_user_task": false,
          "require_validations_pass": false
        },
        "description": "Ürün bilgileri ve mağaza sabitleriyle desteklenmiş, SEO uyumlu açıklama oluşturulur.",
        "flow": {
          "guard": {
            "advance_only_if": []
          }
        },
        "gates": {
          "must": [
            "validations_ok"
          ],
          "on_contract_violation": "halt_and_report",
          "on_miss": "halt",
          "on_missing_required_path": "halt_and_report",
          "on_soft_misalignment": "auto_fix_and_continue"
        },
        "guards": {
          "desc_repetition": {
            "global_max": 5,
            "max_repeat": 3,
            "window": 200
          }
        },
        "hitl_contract": {
          "gpt_tasks": [],
          "user_tasks": []
        },
        "inputs": [
          "draft.title",
          "keywords.focus[]",
          "keywords.supporting[]",
          "product.info{}",
          "shop.profile{}"
        ],
        "inputs_contract": {
          "required_paths": [
            "/workflow_patches/steps/10/outputs/title",
            "/workflow_patches/steps/9/outputs/refined_keywords"
          ],
          "schema": {
            "refined_keywords": {
              "min_items": 10,
              "type": "array"
            },
            "title": {
              "max_len": 140,
              "min_len": 20,
              "type": "string"
            }
          }
        },
        "name": "SEO Description Generation",
        "outputs": [
          "description.final"
        ],
        "preconditions": {
          "critical_pass": {
            "require_ancestors_done": [
              "0",
              "1",
              "3",
              "6",
              "16"
            ]
          },
          "title_required": "/workflow_patches/steps/10/outputs/title"
        },
        "requires": [
          "10"
        ],
        "rules": [
          "length: 300-500 words",
          "paragraphs: 2-5",
          "first sentence includes focus_1 naturally",
          "structure: intro (focus+benefit) -> product details (material, stone, size, options) -> occasion/usage -> care/durability -> shipping/store trust",
          "2-3 supporting keywords included naturally",
          "no stuffing, no duplicate roots",
          "forbidden terms: ['Turkey','Istanbul']"
        ],
        "ruleset": {
          "audit": {
            "log_source_for_each_tag": true
          },
          "composition": {
            "competitor": {
              "max": 3,
              "min": 2,
              "source": "competitor_listings.cleaned"
            },
            "focus": {
              "max": 5,
              "min": 4,
              "source": "focus_keywords"
            },
            "longtail": {
              "max": 3,
              "min": 2,
              "source": "similar_keywords.cleaned+search.suggestions"
            },
            "popular": {
              "max": 4,
              "min": 3,
              "source": "top_listings.cleaned"
            }
          },
          "consistency_check": {
            "against": [
              "title",
              "description",
              "product_info"
            ]
          },
          "constraints": {
            "count": 13,
            "forbid_terms": [
              "personalized",
              "custom",
              "engraved",
              "initial pendant"
            ],
            "include_focus1": true,
            "no_duplicates": true,
            "segments_required": [
              "material",
              "product_type",
              "occasion_or_use"
            ],
            "unique": true
          },
          "guards": {
            "require_user_ack": true
          },
          "input_sources": [
            "similar_keywords.cleaned",
            "top_listings.cleaned",
            "competitor_listings.cleaned",
            "focus_keywords",
            "draft.tags"
          ],
          "weighting": {
            "focus": 0.4,
            "longtail": 0.2,
            "popular_competitor": 0.4
          }
        },
        "title": "SEO Description Generation",
        "upstream_signature": {
          "depends_on": [
            "/workflow_patches/steps/10/outputs/title",
            "/workflow_patches/steps/9/outputs/refined_keywords"
          ],
          "on_change": "invalidate_and_rerun"
        },
        "validations": {
          "present": true
        },
        "validators": [
          "paragraphs==3",
          "plain_text",
          "lang==en-US",
          "no_turkish_chars"
        ],
        "label": "SEO Description Generation",
        "await_user": true,
        "require_user_confirm": true,
        "no_skip": true,
        "bindings": {
          "locale": {
            "__REF__": "/workflow_patches/steps/0/product_info/ads/target_locale"
          },
          "colors[]": {
            "__REF__": "/workflow_patches/steps/0/product_info/fixed_product/colors[]"
          },
          "sizes_us": {
            "__REF__": "/workflow_patches/steps/0/product_info/fixed_product/sizes_us"
          },
          "variations[]": {
            "__REF__": "/workflow_patches/steps/0/product_info/fixed_product/variations[]"
          },
          "stone_policy": {
            "__REF__": "/workflow_patches/steps/0/product_info/fixed_product/stone_policy"
          },
          "handling_min": {
            "__REF__": "/workflow_patches/steps/0/product_info/logistics/handling_time_business_days/min"
          },
          "handling_max": {
            "__REF__": "/workflow_patches/steps/0/product_info/logistics/handling_time_business_days/max"
          },
          "delivery_min": {
            "__REF__": "/workflow_patches/steps/0/product_info/logistics/delivery_estimate_business_days/min"
          },
          "delivery_max": {
            "__REF__": "/workflow_patches/steps/0/product_info/logistics/delivery_estimate_business_days/max"
          },
          "tracking": {
            "__REF__": "/workflow_patches/steps/0/product_info/logistics/tracking"
          },
          "packaging": {
            "__REF__": "/workflow_patches/steps/0/product_info/logistics/packaging"
          },
          "shipping_fee": {
            "__REF__": "/workflow_patches/steps/0/product_info/logistics/shipping_fee"
          },
          "customs_payer": {
            "__REF__": "/workflow_patches/steps/0/product_info/logistics/customs_duties_payer"
          },
          "origin_country": {
            "__REF__": "/workflow_patches/steps/0/product_info/logistics/origin_country"
          },
          "destinations[]": {
            "__REF__": "/workflow_patches/steps/0/product_info/logistics/destinations[]"
          },
          "ring_scale": {
            "__REF__": "/workflow_patches/steps/0/product_info/fixed_product/ring_size_scale"
          },
          "ring_min": {
            "__REF__": "/workflow_patches/steps/0/product_info/fixed_product/ring_size_range_us/min"
          },
          "ring_max": {
            "__REF__": "/workflow_patches/steps/0/product_info/fixed_product/ring_size_range_us/max"
          },
          "packaging_desc": {
            "__REF__": "/workflow_patches/steps/0/product_info/packaging/description"
          },
          "returns_enabled": {
            "__REF__": "/workflow_patches/steps/0/policies/returns/enabled"
          },
          "returns_window_days": {
            "__REF__": "/workflow_patches/steps/0/policies/returns/window_days"
          },
          "care_short": {
            "__REF__": "/workflow_patches/steps/0/care_instructions/short"
          },
          "ddp_sentence": {
            "__REF__": "/workflow_patches/steps/0/policies/description_clauses/ddp_sentence"
          }
        },
        "desc_template": {
          "locale_from": "bindings.locale",
          "blocks": [
            {
              "id": "intro",
              "type": "paragraph",
              "text": "Introducing our {{noun}} in {{selected_karat}} {{selected_color}} — crafted for everyday elegance. {{focus_kw}}",
              "sentences_max_words": 20
            },
            {
              "id": "details",
              "type": "list",
              "items": [
                "Material & finish: {{selected_karat}} {{selected_color}}",
                "Available size: {{variant_size_or_omit sizes_us}}",
                "Stone: {{stone_summary stone_policy}}",
                "Care & durability: everyday wear, gentle care",
                "Customization: made-to-order options where available"
              ]
            },
            {
              "id": "logistics",
              "type": "paragraph",
              "text": "Processing {{handling_min}}–{{handling_max}} business days. Delivery {{delivery_min}}–{{delivery_max}} business days{{#if tracking}} with tracking{{/if}}. Packaging: {{packaging}}. Customs: {{#if_eq customs_payer 'seller'}}Seller pays{{/if_eq}}. Origin: {{origin_country}}.",
              "sentences_max_words": 20
            },
            {
              "id": "ddp_notice",
              "type": "paragraph",
              "text": "{{#if_eq customs_payer 'seller'}}Tariffs & import duties are prepaid (DDP) by the seller; the listing price is inclusive of these fees.{{/if_eq}}",
              "sentences_max_words": 20
            },
            {
              "id": "ring_sizes_line",
              "type": "text",
              "text": "Available sizes: {{ring_scale}} {{ring_min}}–{{ring_max}}.",
              "sentences_max_words": 18
            },
            {
              "id": "packaging_line",
              "type": "text",
              "text": "Gift-ready packaging: {{packaging_desc}}.",
              "sentences_max_words": 18
            },
            {
              "id": "returns_line",
              "type": "text",
              "text": "{{#if returns_enabled}}Returns accepted within {{returns_window_days}} days.{{/if}}",
              "sentences_max_words": 16
            },
            {
              "id": "care_line",
              "type": "text",
              "text": "Care: {{care_short}}",
              "sentences_max_words": 28
            }
          ]
        },
        "desc_guards": {
          "must_include_tokens": [
            "selected_karat",
            "selected_color",
            "noun",
            "handling_min",
            "handling_max",
            "delivery_min",
            "delivery_max"
          ],
          "forbid_terms": [
            "free shipping",
            "%",
            "discount",
            "on sale"
          ],
          "fail_on_missing": true,
          "desc_repetition": {
            "max_repeat": 2
          },
          "paragraphs_expected": 3
        },
        "post_render_validations": {
          "regex_forbid": [
            "free\\s+shipping",
            "%",
            "discount",
            "on\\s*sale"
          ],
          "regex_must": [
            "Processing",
            "Delivery",
            "Packaging",
            "Origin"
          ],
          "no_keyword_stuffing_hint": true
        },
        "ui_ext": {
          "token_tracking": true
        }
      },
      "12": {
        "constraints": {
          "must_confirm": false,
          "no_skip": true,
          "require_gpt_task": false,
          "require_user_task": false,
          "require_validations_pass": false
        },
        "description": "SEO, ürün attribute ve mağaza sesi yansıtan 13/13 benzersiz etiket seti oluşturulur.",
        "flow": {
          "guard": {
            "advance_only_if": []
          }
        },
        "gates": {
          "must": [
            "validations_ok"
          ],
          "on_contract_violation": "halt_and_report",
          "on_miss": "halt",
          "on_missing_required_path": "halt_and_report",
          "on_soft_misalignment": "auto_fix_and_continue"
        },
        "guards": {
          "tags": {
            "count": 13,
            "no_duplicate_roots": true,
            "unique": true
          },
          "forbid_terms": [
            "free shipping",
            "%",
            "discount",
            "on sale"
          ],
          "forbid_entity_types": [
            "brand",
            "celebrity"
          ],
          "attr_dup_strict": true,
          "attr_sources": [
            "bindings.attr_colors[]",
            "bindings.attr_sizes_us",
            "bindings.attr_variations[]",
            "bindings.attr_stone"
          ],
          "fail_on_missing": true,
          "forbid_model_generation_by_default": true,
          "model_fallback_if_less_than": 13,
          "model_fallback_cap": 13
        },
        "hitl_contract": {
          "gpt_tasks": [],
          "user_tasks": []
        },
        "inputs": [
          "keywords.focus[]",
          "keywords.supporting[]",
          "product.info{}",
          "shop.profile{}"
        ],
        "inputs_contract": {
          "required_paths": [
            "/workflow_patches/steps/11/outputs/description",
            "/workflow_patches/steps/9/outputs/refined_keywords"
          ],
          "schema": {
            "tags": {
              "min_items": 10,
              "type": "array"
            }
          }
        },
        "name": "Tags Generation",
        "outputs": [
          "tags.final[13]"
        ],
        "preconditions": {
          "critical_pass": {
            "require_ancestors_done": [
              "0",
              "1",
              "3",
              "6",
              "16"
            ]
          },
          "desc_required": "/workflow_patches/steps/11/outputs/description",
          "title_required": "/workflow_patches/steps/10/outputs/title"
        },
        "requires": [
          "11"
        ],
        "rules": [
          "exactly 13 unique tags",
          "distribution: 4-5 SEO/high-volume, 3-4 product attributes, 2-3 occasion/audience, 1-2 brand voice",
          "no duplicate roots, no attr/category duplicates",
          "negatives forbidden: ['DIY','free','tutorial','plated*','kit','supplies','raw*']",
          "forbidden terms: ['Turkey','Istanbul']"
        ],
        "ruleset": {
          "consistency_check": {
            "against": [
              "title",
              "tags",
              "product_info"
            ]
          },
          "forbid_terms": [
            "personalized",
            "custom",
            "engraved",
            "initial pendant"
          ],
          "frontload_focus": {
            "first_chars": 150
          },
          "guards": {
            "require_user_ack": true
          },
          "include_from_step0": [
            "karat",
            "metal_color",
            "variant_size_range",
            "processing_time",
            "packaging_note"
          ],
          "language_variant": "en-US",
          "length": {
            "max_words": 180,
            "min_words": 120
          },
          "paragraphs": {
            "count": 4,
            "structure": [
              "intro_focus",
              "features_from_step0",
              "benefits_gift_use",
              "cta"
            ]
          },
          "priority_order": [
            "focus_keyword_frontload",
            "product_info_integration",
            "user_benefits",
            "call_to_action"
          ],
          "style": {
            "readability": "grade8",
            "scan_friendly": true,
            "tone": "professional_warm"
          }
        },
        "soft_influences": {
          "from": [
            "/workflow_patches/steps/8a/outputs/ads_keywords"
          ],
          "policy": "warn_if_misaligned_topN",
          "topN": 10
        },
        "title": "Tags Generation",
        "upstream_signature": {
          "depends_on": [
            "/workflow_patches/steps/11/outputs/description",
            "/workflow_patches/steps/10/outputs/title",
            "/workflow_patches/steps/9/outputs/refined_keywords",
            "/workflow_patches/steps/8a/outputs/ads_keywords"
          ],
          "on_change": "invalidate_and_rerun"
        },
        "validations": {
          "present": true
        },
        "validators": [
          "count==13",
          "unique==true",
          "no_root_dup==true",
          "no_attribute_only==true",
          "forbidden_block",
          "lang==en-US"
        ],
        "forbidden": [
          "Turkey",
          "Istanbul",
          "gift idea",
          "trending"
        ],
        "extra_rules": {
          "attribute_only_regex": "^(10k|14k|18k|yellow|white|rose|gold|silver)$"
        },
        "label": "Tags Generation",
        "await_user": true,
        "require_user_confirm": true,
        "no_skip": true,
        "bindings": {
          "locale": {
            "__REF__": "/workflow_patches/steps/0/product_info/ads/target_locale"
          },
          "attr_colors[]": {
            "__REF__": "/workflow_patches/steps/0/product_info/fixed_product/colors[]"
          },
          "attr_sizes_us": {
            "__REF__": "/workflow_patches/steps/0/product_info/fixed_product/sizes_us"
          },
          "attr_variations[]": {
            "__REF__": "/workflow_patches/steps/0/product_info/fixed_product/variations[]"
          },
          "attr_stone": {
            "__REF__": "/workflow_patches/steps/0/product_info/fixed_product/stone_policy"
          }
        },
        "tags_constraints": {
          "target_count": 13,
          "unique": true,
          "unique_root": true,
          "variety_over_repetition": true,
          "length_max_per_tag": 20,
          "prefer_multi_word": true,
          "min_words": 2,
          "max_words": 3,
          "normalize": {
            "lowercase": true,
            "strip_punct": true,
            "lemmatize": "auto_from_locale"
          }
        },
        "post_validations": {
          "must_fill_all_13": true,
          "no_duplicate_roots": true,
          "max_len_20_check": true
        },
        "sources": {
          "similar_keywords": {
            "enabled": true
          },
          "top_listings": {
            "enabled": true
          },
          "competitor_upload": {
            "enabled": true
          }
        },
        "mix": {
          "priority[]": [
            "similar_keywords",
            "top_listings",
            "competitor_upload",
            "attributes",
            "model_fallback"
          ],
          "limits": {
            "similar_keywords": {
              "max": 13
            },
            "top_listings": {
              "max": 6
            },
            "competitor_upload": {
              "max": 6
            },
            "attributes": {
              "max": 5
            },
            "model_fallback": {
              "max": 13
            }
          }
        },
        "quality": {
          "min_confidence": 0.8,
          "allow_override_sources[]": [
            "top_listings",
            "competitor_upload"
          ],
          "ban_duplicates": {
            "root": true,
            "exact": true
          },
          "normalize": {
            "lowercase": true,
            "trim": true,
            "spaces_collapse": true
          }
        },
        "postprocess": {
          "enforce_exactly_13": true,
          "remove_forbidden": true,
          "remove_negatives": true
        },
        "notes": {
          "policy": "CSV-first tags: prioritize similar_keywords; top_listings and competitor_upload have equal weight and may override. Only if <13 high-quality tags remain, allow model_fallback to fill up to 13."
        },
        "ui_ext": {
          "token_tracking": true
        }
      },
      "13": {
        "kind": "checkpoint",
        "name": "Checkpoint – Akış Kapıları (BG)",
        "ruleset": {
          "note": "Tanım boştu; manifestte yer aldığı için placeholder eklendi."
        },
        "title": "Checkpoint – Akış Kapıları (BG)",
        "label": "Checkpoint – Akış Kapıları (BG)",
        "await_user": true,
        "require_user_confirm": true,
        "no_skip": true,
        "json_title": "Checkpoint – Akış Kapıları (BG)",
        "ui_ext": {
          "token_tracking": true
        }
      },
      "14": {
        "constraints": {
          "must_confirm": false,
          "no_skip": true,
          "require_gpt_task": false,
          "require_user_task": false,
          "require_validations_pass": false,
          "status_values": [
            "PASS",
            "WARN",
            "FAIL"
          ]
        },
        "description": "Başlık, açıklama, etiketler ve görsellerin Etsy kuralları ve SEO/Ads stratejisi ile uyumunu denetler.",
        "flow": {
          "guard": {
            "advance_only_if": []
          }
        },
        "gates": {
          "must": [
            "validations_ok"
          ],
          "on_contract_violation": "halt_and_report",
          "on_miss": "halt",
          "on_missing_required_path": "halt_and_report",
          "on_soft_misalignment": "auto_fix_and_continue"
        },
        "hitl_contract": {
          "gpt_tasks": [],
          "user_tasks": []
        },
        "inputs": [
          "title.final",
          "description.final",
          "tags.final[13]",
          "media.checklist",
          "media.issues[]",
          "seo.keywords.focus[]",
          "seo.keywords.supporting[]",
          "ads.keywords.final[]"
        ],
        "name": "Ara Değerlendirme – SEO Uyum",
        "outputs": [
          "compliance.report{}",
          "compliance.issues[]",
          "compliance.recommendations[]",
          "compliance.status"
        ],
        "preconditions": {
          "critical_pass": {
            "require_ancestors_done": [
              "0",
              "1",
              "3",
              "6",
              "16"
            ]
          }
        },
        "requires": [
          "13"
        ],
        "rules": [
          "no banned terms (e.g., brand infringement, Rolex, Disney, etc.)",
          "no ALL CAPS, no spam, no misleading claims (e.g., 'free shipping')",
          "etsy policy compliance: handmade/vintage/supplies classification",
          "SEO-Ads consistency: no conflict between SEO focus/support and Ads plan",
          "visuals must align with attributes and tags",
          "negatives forbidden: ['DIY', 'free', 'tutorial', 'plated*', 'kit', 'supplies', 'raw*', 'Turkey', 'Istanbul']",
          "self_check.status must be PASS"
        ],
        "ruleset": [
          {
            "id": "NO_BANNED_TERMS",
            "params": {
              "examples": [
                "Rolex",
                "Disney"
              ]
            }
          },
          {
            "id": "NO_ALLCAPS_SPAM",
            "params": {
              "enforced": true
            }
          },
          {
            "id": "NO_MISLEADING_CLAIMS",
            "params": {
              "forbidden": [
                "free shipping"
              ]
            }
          },
          {
            "id": "ETSY_POLICY_COMPLIANCE",
            "params": {
              "required": true
            }
          },
          {
            "id": "SEO_ADS_CONSISTENCY",
            "params": {
              "required": true
            }
          },
          {
            "id": "VISUAL_ALIGNMENT",
            "params": {
              "required": true
            }
          },
          {
            "id": "NEGATIVE_TERMS",
            "params": {
              "terms": [
                "DIY",
                "free",
                "tutorial",
                "plated*",
                "kit",
                "supplies",
                "raw*",
                "Turkey",
                "Istanbul"
              ]
            }
          },
          {
            "id": "SPAM_BLOCKS_COMPLIANCE",
            "params": {
              "block_on": "BLOCK"
            }
          },
          {
            "id": "SELF_CHECK_PASS_REQUIRED",
            "params": {
              "status": "PASS"
            }
          },
          {
            "id": "PRODUCT_RECORD_CONFIRMED_REQUIRED",
            "params": {
              "source": "product_record",
              "status": "CONFIRMED"
            }
          },
          {
            "id": "COUNTRY_POLICY_COMPLIANCE",
            "params": {
              "source": "governance.policy.country"
            }
          }
        ],
        "title": "Ara Değerlendirme – SEO Uyum",
        "upstream_signature": {
          "policy": "mark_stale_on_upstream_change"
        },
        "validations": {
          "present": true
        },
        "label": "Ara Değerlendirme – SEO Uyum",
        "await_user": true,
        "require_user_confirm": true,
        "no_skip": true,
        "json_title": "Ara Değerlendirme – SEO Uyum",
        "ui_ext": {
          "token_tracking": true
        }
      },
      "15": {
        "kind": "qa",
        "name": "QA – Uyarı (Soft)",
        "ruleset": {
          "guards": {
            "halt_on_error": false
          },
          "mode": "warn",
          "note": "QA sadece uyarı üretir, akışı durdurmaz"
        },
        "title": "QA – Uyarı (Soft)",
        "description": "SEO focus/support kelimeleri ile Ads pozitif/negatif setlerini senkronize eder, final seti üretir.",
        "label": "QA – Uyarı (Soft)",
        "await_user": true,
        "require_user_confirm": true,
        "no_skip": true,
        "json_title": "QA – Uyarı (Soft)",
        "ui_ext": {
          "token_tracking": true
        }
      },
      "16": {
        "constraints": {
          "must_confirm": false,
          "no_skip": true,
          "require_gpt_task": false,
          "require_user_task": true,
          "require_validations_pass": false,
          "status_values": [
            "PASS",
            "WARN",
            "FAIL"
          ]
        },
        "description": "Önceki adımlardan gelen tüm çıktıları birleştirerek yayına hazır tam ürün listing paketi oluşturur.",
        "flow": {
          "guard": {
            "advance_only_if": []
          }
        },
        "gates": {
          "must": [
            "validations_ok"
          ],
          "on_contract_violation": "halt_and_report",
          "on_miss": "halt",
          "on_missing_required_path": "halt_and_report",
          "on_soft_misalignment": "auto_fix_and_continue",
          "required_inputs": [
            "title.final",
            "description.final",
            "tags.final[13]",
            "media.checklist",
            "compliance.status",
            "ads_sync.status",
            "seo.keywords.focus[]",
            "seo.keywords.supporting[]",
            "product.info{}",
            "shop.profile{}"
          ]
        },
        "guards": {
          "final_check": "repetition_guard_enforced"
        },
        "hitl_contract": {
          "gpt_tasks": [],
          "user_tasks": []
        },
        "inputs": [
          "title.final",
          "description.final",
          "tags.final[13]",
          "media.checklist",
          "media.qc_report",
          "media.recommendations[]",
          "compliance.status",
          "compliance.issues[]",
          "ads_sync.final_positive[]",
          "ads_sync.final_negative[]",
          "ads_sync.status",
          "seo.keywords.focus[]",
          "seo.keywords.supporting[]",
          "product.info{}",
          "shop.profile{}"
        ],
        "name": "Listing Assemble & Record-Type Select",
        "outputs": [
          "listing.final{}",
          "listing.issues[]",
          "listing.status",
          "listing.notes"
        ],
        "preconditions": {
          "critical_pass": {
            "require_ancestors_done": [
              "0",
              "1",
              "3",
              "6",
              "16"
            ]
          }
        },
        "requires": [
          "10",
          "11",
          "12",
          "13",
          "14",
          "15"
        ],
        "rules": {
          "allow_rollback": true
        },
        "ruleset": {
          "downloads": {
            "office_2007_tr": {
              "bundle": true,
              "formats": [
                {
                  "file": "listing_final_en-US.docx",
                  "type": "docx"
                },
                {
                  "file": "listing_final_en-US.rtf",
                  "type": "rtf"
                },
                {
                  "delimiter": ";",
                  "encoding": "windows-1254",
                  "file": "tags_tr.csv",
                  "headers": [
                    "Tag"
                  ],
                  "type": "csv"
                },
                {
                  "encoding": "utf-16le",
                  "file": "listing_final_en-US.txt",
                  "line_separator": "\\r\\n",
                  "type": "txt"
                }
              ],
              "include_from_steps": {
                "description.final": true,
                "product_info(core)": [
                  "karat",
                  "metal_color",
                  "variant_size_range",
                  "processing_time",
                  "packaging_note"
                ],
                "tags.final": true,
                "title.final": true
              }
            }
          }
        },
        "title": "Listing Assemble & Record-Type Select",
        "upstream_signature": {
          "policy": "mark_stale_on_upstream_change"
        },
        "validations": {
          "present": true
        },
        "export_contract": {
          "emit_artifact": true,
          "artifact_name_template": "{channel}.{version}.{date}_{time}.json",
          "display": {
            "render_full": true,
            "sections": [
              {
                "title": "Oluşturulacak Dosya Adı",
                "bind": "export.filename"
              },
              {
                "title": "GitHub Raw Link",
                "bind": "export.raw_link"
              },
              {
                "title": "Yapılacak İşlem",
                "static": "Dosyayı indir → Desktop/json-proje klasörüne koy → push-json.bat'ı çalıştırın → ardından Onay'a basın."
              }
            ]
          },
          "constraints": {
            "must_confirm": true,
            "require_user_task": true
          },
          "outputs": {
            "export.filename": "{channel}.{version}.{date}_{time}.json",
            "export.raw_link": "https://raw.githubusercontent.com/mertgs190500/json-proje/main/{channel}.{version}.{date}_{time}.json"
          }
        },
        "tags": {
          "channel": "strict"
        },
        "label": "Listing Assemble & Record-Type Select",
        "await_user": true,
        "require_user_confirm": true,
        "no_skip": true,
        "json_title": "Listing Assemble & Record-Type Select",
        "ranking": {
          "weights": {
            "ctr": 0.6,
            "relevance": 0.3,
            "diversity": 0.1
          },
          "normalize": true
        },
        "ui_ext": {
          "token_tracking": true
        }
      },
      "17": {
        "name": "Export (CSV/XLSX/JSON)",
        "enabled": true,
        "auto": true,
        "inputs": {
          "artifact_filename": "{channel}.{version}.{date}_{time}.json"
        },
        "actions": {
          "compute_sha256": {
            "fn": "sha256",
            "file": "{export.filename}",
            "out": "steps.17.export.sha256"
          },
          "emit_zip": {
            "fn": "zip",
            "files": [
              "{export.filename}"
            ],
            "zip_name": "visible.v{N}.zip",
            "out": "steps.17.export.zip_path"
          },
          "record_log": {
            "fn": "append_log",
            "target": "/_meta/export_log",
            "entry": {
              "event": "export",
              "version": "{version}",
              "filename": "{export.filename}",
              "sha256": "{steps.17.export.sha256}",
              "ts": "{now:Europe/Istanbul}"
            }
          }
        },
        "display": {
          "render_full": true,
          "sections": [
            {
              "title": "SHA256",
              "bind": "steps.17.export.sha256"
            },
            {
              "title": "ZIP adı",
              "bind": "steps.17.export.zip_path"
            }
          ]
        },
        "constraints": {
          "must_confirm": false,
          "require_user_task": false
        },
        "title": "Export (CSV/XLSX/JSON)",
        "description": "Listing.final çıktısını Office 2007 uyumlu CSV formatına dönüştürür.",
        "label": "Export (CSV/XLSX/JSON)",
        "await_user": true,
        "require_user_confirm": true,
        "no_skip": true,
        "json_title": "Export (CSV/XLSX/JSON)",
        "ui_ext": {
          "token_tracking": true
        }
      },
      "18": {
        "constraints": {
          "must_confirm": false,
          "no_skip": true,
          "require_gpt_task": false,
          "require_record_type": "publish",
          "require_user_task": false,
          "require_validations_pass": false,
          "status_values": [
            "READY",
            "WARN",
            "BLOCK"
          ]
        },
        "description": "Etsy'ye yükleme öncesi go/no-go kontrol listesi ve son onay.",
        "flow": {
          "guard": {
            "advance_only_if": []
          }
        },
        "gates": {
          "must": [
            "validations_ok"
          ],
          "on_contract_violation": "halt_and_report",
          "on_manifest_mismatch": "halt_and_report",
          "on_miss": "halt",
          "on_missing_required_path": "halt_and_report",
          "on_soft_misalignment": "auto_fix_and_continue"
        },
        "hitl_contract": {
          "gpt_tasks": [],
          "user_tasks": []
        },
        "inputs": [
          "listing.final{}",
          "listing.status",
          "export.file_path",
          "export.sha256",
          "compliance.status",
          "ads_sync.status"
        ],
        "inputs_contract": {
          "required_paths": [
            "/workflow_patches/steps/17/outputs/files"
          ],
          "schema": {
            "files": {
              "min_items": 1,
              "type": "array"
            }
          }
        },
        "manifest": {
          "policy": "hash_and_compare",
          "required_paths": [
            "/workflow_patches/steps/10/outputs/title",
            "/workflow_patches/steps/11/outputs/description",
            "/workflow_patches/steps/12/outputs/tags",
            "/workflow_patches/steps/16/outputs/listing",
            "/workflow_patches/steps/17/outputs/files"
          ]
        },
        "name": "Pre-Publish Review (Checkpoint 18)",
        "outputs": [
          "publish.checklist{}",
          "publish.status",
          "publish.notes"
        ],
        "preconditions": {
          "critical_pass": {
            "require_ancestors_done": [
              "0",
              "1",
              "3",
              "6",
              "16"
            ]
          },
          "export_files_exist": "/workflow_patches/steps/17/outputs/files"
        },
        "requires": [
          "17"
        ],
        "rules": [
          "listing.status must be PASS",
          "export.file_path must exist and export.sha256 present",
          "compliance.status must be PASS (else BLOCK)",
          "ads_sync.status PASS preferred; if WARN -> checklist WARN, if FAIL -> BLOCK",
          "self_check.status must be PASS"
        ],
        "ruleset": [
          {
            "id": "LISTING_PASS_REQUIRED",
            "params": {
              "status": "PASS"
            }
          },
          {
            "id": "EXPORT_FILE_AND_HASH_REQUIRED",
            "params": {
              "required": true
            }
          },
          {
            "id": "COMPLIANCE_PASS_REQUIRED",
            "params": {
              "status": "PASS"
            }
          },
          {
            "id": "ADS_SYNC_STATUS_POLICY",
            "params": {
              "fail": "BLOCK",
              "pass": "READY",
              "warn": "WARN"
            }
          },
          {
            "id": "PUBLISH_STATUS_VALUES",
            "params": {
              "values": [
                "READY",
                "WARN",
                "BLOCK"
              ]
            }
          },
          {
            "id": "SELF_CHECK_PASS_REQUIRED",
            "params": {
              "status": "PASS"
            }
          }
        ],
        "title": "Pre-Publish Review (Checkpoint 18)",
        "upstream_signature": {
          "depends_on": [
            "/workflow_patches/steps/17/outputs/files"
          ],
          "on_change": "recheck"
        },
        "validations": {
          "present": true
        },
        "label": "Pre-Publish Review (Checkpoint 18)",
        "await_user": true,
        "require_user_confirm": true,
        "no_skip": true,
        "json_title": "Pre-Publish Review (Checkpoint 18)",
        "ui_ext": {
          "token_tracking": true
        }
      },
      "18a": {
        "constraints": {
          "must_confirm": true,
          "no_skip": true
        },
        "enabled": true,
        "gates": {
          "must": [
            "validations_ok"
          ],
          "on_contract_violation": "halt_and_report",
          "on_missing_required_path": "halt_and_report",
          "on_soft_misalignment": "warn_and_continue"
        },
        "gpt_task": {
          "check": [
            "step14.pass==true",
            "step16.ready==true",
            "step17.files_ready==true",
            "step18.checklist_pass==true"
          ]
        },
        "id": "18a",
        "notes": {
          "lifecycle": "manifest-disabled"
        },
        "outputs": {
          "decision_at": null,
          "decision_by": "",
          "publish_go": false,
          "reason_if_no_go": ""
        },
        "preconditions": {
          "critical_pass": {
            "require_ancestors_done": [
              "0",
              "1",
              "3",
              "6",
              "16"
            ]
          },
          "parent_defined": {
            "exists": true,
            "path": "/workflow_patches/steps/18"
          }
        },
        "title": "Publish Go/No-Go (Disabled)",
        "ui": {
          "hidden": true
        },
        "upstream_signature": {
          "policy": "mark_stale_on_upstream_change"
        },
        "user_task": {
          "confirm": "outputs.publish_go"
        },
        "validations": {
          "all_prior_ok": true
        },
        "display": {
          "render_full": true,
          "sections_auto": [
            {
              "title": "Decision At",
              "bind": "decision_at"
            },
            {
              "title": "Decision By",
              "bind": "decision_by"
            },
            {
              "title": "Publish Go",
              "bind": "publish_go"
            },
            {
              "title": "Reason If No Go",
              "bind": "reason_if_no_go"
            }
          ]
        },
        "name": "Publish Go/No-Go (Disabled)",
        "label": "Publish Go/No-Go (Disabled)",
        "await_user": true,
        "require_user_confirm": true,
        "no_skip": true,
        "json_title": "Publish Go/No-Go (Disabled)",
        "ui_ext": {
          "token_tracking": true
        }
      },
      "19": {
        "constraints": {
          "must_confirm": false,
          "no_skip": true,
          "require_gpt_task": false,
          "require_user_task": false,
          "require_validations_pass": false
        },
        "description": "Yayın sonrası 14–30 gün performans takibi ve aksiyon sinyalleri (Ads + SEO).",
        "flow": {
          "guard": {
            "advance_only_if": []
          }
        },
        "gates": {
          "must": [
            "validations_ok"
          ],
          "on_contract_violation": "halt_and_report",
          "on_miss": "halt",
          "on_missing_required_path": "halt_and_report",
          "on_soft_misalignment": "auto_fix_and_continue"
        },
        "hitl_contract": {
          "gpt_tasks": [],
          "user_tasks": []
        },
        "inputs": [
          "metrics.ads{ctr,roas,orders,cpc,spend}",
          "metrics.seo{impressions,visits,orders,conv_rate}",
          "ab_test.plan",
          "ads.plan{}",
          "ads_sync.final_positive[]",
          "ads_sync.final_negative[]"
        ],
        "name": "30-Day Listing Performance Report (+ Optimization)",
        "outputs": [
          "monitoring.report{}",
          "monitoring.issues[]",
          "monitoring.recommendations[]"
        ],
        "preconditions": {
          "critical_pass": {
            "require_ancestors_done": [
              "0",
              "1",
              "3",
              "6",
              "16"
            ]
          }
        },
        "requires": [
          "18"
        ],
        "rules": [
          "window_days: 14..30",
          "warn if CTR < 1.0% or ROAS < 1.0",
          "boost if Orders >= 3 and ROAS >= target",
          "pause if Clicks >= 20 and ROAS < 1.0",
          "produce actionable recommendations per AdGroup/keyword"
        ],
        "ruleset": [
          {
            "id": "MONITORING_WINDOW_DAYS",
            "params": {
              "max": 30,
              "min": 14
            }
          },
          {
            "id": "WARN_THRESHOLDS",
            "params": {
              "ctr_lt": 0.01,
              "roas_lt": 1.0
            }
          },
          {
            "id": "BOOST_RULE",
            "params": {
              "orders_gte": 3,
              "roas_gte": "target"
            }
          },
          {
            "id": "PAUSE_RULE",
            "params": {
              "clicks_gte": 20,
              "roas_lt": 1.0
            }
          },
          {
            "id": "ACTIONABLE_PER_GROUP",
            "params": {
              "required": true
            }
          }
        ],
        "title": "30-Day Listing Performance Report (+ Optimization)",
        "upstream_signature": {
          "policy": "mark_stale_on_upstream_change"
        },
        "validations": {
          "present": true
        },
        "label": "30-Day Listing Performance Report (+ Optimization)",
        "await_user": true,
        "require_user_confirm": true,
        "no_skip": true,
        "json_title": "30-Day Listing Performance Report (+ Optimization)",
        "ui_ext": {
          "token_tracking": true
        }
      },
      "1a": {
        "advisory_pack": {
          "hero_thumbnail": {
            "block": false,
            "rules": {
              "no_text_overlay": true,
              "plain_bg_preferred": true,
              "subject_fill_min": 0.7
            },
            "severity": "advisory"
          },
          "metrics_binding": {
            "block": false,
            "capture": [
              "ctr",
              "engagement"
            ],
            "improvement_note_required": true,
            "severity": "advisory"
          },
          "scale_photo": {
            "block": false,
            "rules": {
              "must_include_scale_indicator": true
            },
            "severity": "advisory"
          },
          "seo_context_photo": {
            "block": false,
            "rules": {
              "must_include_context": [
                "wedding",
                "gift",
                "everyday"
              ]
            },
            "severity": "advisory"
          },
          "video_quality": {
            "block": false,
            "rules": {
              "duration_seconds": {
                "max": 15,
                "min": 5
              },
              "motion": "minimal",
              "show_scale": true
            },
            "severity": "advisory"
          }
        },
        "constraints": {
          "must_confirm": false,
          "no_skip": true,
          "require_gpt_task": false,
          "require_user_task": false,
          "require_validations_pass": false
        },
        "description": "Ürün görselleri ve (varsa) video; kalite, set bütünlüğü ve SEO uyumu açısından kontrol edilir. Çıktı yalnızca rapordur; görseller otomatik değiştirilmez.",
        "flow": {
          "guard": {
            "advance_only_if": []
          }
        },
        "gates": {
          "must": [
            "validations_ok"
          ],
          "on_contract_violation": "halt_and_report",
          "on_miss": "halt",
          "on_missing_required_path": "halt_and_report",
          "on_soft_misalignment": "warn_and_continue"
        },
        "governance": {
          "notes_required": true,
          "qc_checklist": [
            "has_studio",
            "has_lifestyle",
            "has_scale",
            "has_detail",
            "has_packaging",
            "resolution_ok",
            "background_ok",
            "lighting_ok",
            "set_consistent",
            "seo_context_ok",
            "attribute_truth_ok",
            "no_watermark_or_heavy_text",
            "no_blurry_lowres"
          ]
        },
        "guards": {
          "first_image_ctr_check": true,
          "image_count": {
            "block_on_fail": false,
            "min_required": 8,
            "note": "Üretim durmasın, sadece WARN verilsin",
            "severity": "warn"
          },
          "image_variety": [
            "closeup",
            "usage",
            "variations",
            "packaging"
          ],
          "video_required": true
        },
        "hitl_contract": {
          "gpt_tasks": [],
          "user_tasks": []
        },
        "inputs": [
          "product.photos[]",
          "product.video?",
          "draft.title",
          "draft.description",
          "draft.tags[13]",
          "seo.keywords.focus[]",
          "seo.keywords.supporting[]"
        ],
        "name": "Görsel Analizi",
        "outputs": [
          "media.checklist",
          "media.issues[]",
          "media.recommendations[]",
          "media.qc_report"
        ],
        "preconditions": {
          "critical_pass": {
            "require_ancestors_done": [
              "0",
              "1",
              "3",
              "6",
              "16"
            ]
          },
          "parent_defined": {
            "exists": true,
            "path": "/workflow_patches/steps/1"
          }
        },
        "requires": [
          "1"
        ],
        "rules": [
          "required_photos: [studio, lifestyle, scale, detail, packaging]",
          "optional_video: true (360° veya kullanım sahnesi)",
          "min_resolution: 2000x2000 (kare tercih)",
          "background: clean/consistent (white/soft preferred)",
          "lighting: true colors, minimal harsh shadows",
          "set_consistency: same tone/lighting across photos",
          "seo_alignment: at least one image reflects focus_1 context (e.g., wedding, gift)",
          "attribute_truth: images must reflect mentioned attributes (e.g., gemstone=color)",
          "negatives_forbidden: [watermark, heavy text overlays, blurry/low-res]"
        ],
        "ruleset": [
          {
            "id": "PRODUCT_RECORD_CONFIRMED_REQUIRED",
            "params": {
              "source": "product_record",
              "status": "CONFIRMED"
            }
          }
        ],
        "title": "Görsel Analizi",
        "upstream_signature": {
          "policy": "mark_stale_on_upstream_change"
        },
        "validations": {
          "present": true
        },
        "tags": {
          "channel": "visible"
        },
        "label": "Görsel Analizi",
        "await_user": true,
        "require_user_confirm": true,
        "no_skip": true,
        "manifest": {
          "transforms": [
            "extract_exif_and_file_meta",
            "segment_subject_and_bg",
            "compute_quality_metrics(lapvar,noise,exposure,wb,blocking)",
            "specular_glare_estimate",
            "composition_metrics(thirds,deadspace,horizon)",
            "phash_duplicates",
            "skin_bodypart_detector",
            "jewelry_material_tone_finish",
            "gemstone_presence_color",
            "scale_estimator(coin/ruler/hand)",
            "vision_embedding_style_cluster"
          ],
          "outputs": {
            "media.exif": "object",
            "media.file": "object",
            "media.derived": "object",
            "media.usage": "object",
            "media.video": "object",
            "style": "object",
            "media.qc_report": "object"
          },
          "rules": [
            {
              "id": "report_only",
              "assert": "true",
              "on_fail": "warn_and_continue"
            }
          ]
        },
        "ui_ext": {
          "token_tracking": true
        }
      },
      "1b": {
        "constraints": {
          "dedupe": {
            "case_insensitive": true,
            "exact_match": true,
            "normalize_diacritics": true,
            "semantic_diversity_required": true,
            "semantic_similarity_threshold": 0.85
          },
          "exact_words_per_query": 2,
          "min_segments": 3,
          "must_confirm": false,
          "no_skip": true,
          "optional_segments": [
            "gemstone",
            "style_aesthetic",
            "color_tone",
            "price_intent"
          ],
          "require_gpt_task": false,
          "require_user_task": false,
          "require_validations_pass": false,
          "required_segments": [
            "material_finish",
            "use_case_occasion",
            "audience_gift"
          ],
          "total_queries": 10
        },
        "description": "Bu adım, Alura'dan indirilecek CSV'lerin kalitesini belirleyen 8 adet, her biri 2 kelimeden oluşan çekirdek sorguları üretir.",
        "examples": {
          "invalid": [
            "silver plated",
            "free tutorial",
            "bracelet bracelet",
            "ring"
          ],
          "valid": [
            "gold bracelet",
            "dainty necklace",
            "mom gift",
            "wedding ring",
            "opal ring",
            "gothic jewelry",
            "black earrings",
            "luxury bracelet"
          ]
        },
        "flow": {
          "guard": {
            "advance_only_if": []
          }
        },
        "gates": {
          "must": [
            "validations_ok"
          ],
          "on_contract_violation": "halt_and_report",
          "on_miss": "halt",
          "on_missing_required_path": "halt_and_report",
          "on_soft_misalignment": "warn_and_continue"
        },
        "hitl_contract": {
          "gpt_tasks": [
            "2 kelimelik 8 farklı arama önerisi üret, tür çeşitliliği koru."
          ],
          "user_tasks": []
        },
        "name": "Alura Arama Önerileri",
        "negative_filters": [
          "DIY",
          "free",
          "tutorial",
          "plated* (silver/gold plated/kf)",
          "kit",
          "supplies",
          "raw*"
        ],
        "outputs": [
          "alura.search_suggestions[8]",
          "alura.segments_coverage",
          "alura.rejection_reasons[]",
          "alura.selection_notes"
        ],
        "policy_ref": "_profiles.gpt_prod_executor_v1.languages.rules.search_suggestions_1b",
        "preconditions": {
          "critical_pass": {
            "require_ancestors_done": [
              "0",
              "1",
              "3",
              "6",
              "16"
            ]
          },
          "parent_defined": {
            "exists": true,
            "path": "/workflow_patches/steps/1"
          }
        },
        "quality_filters": {
          "alura_score_min": 70,
          "competition_max": "Medium",
          "conversion_rate_min": 0.015,
          "fallback_policy": "Eşik altı ama stratejik niş sorgular gerekçelendirilirse (notes.reason) en fazla 2 adet dahil edilebilir."
        },
        "requires": [
          "1a"
        ],
        "ruleset": [
          {
            "id": "ALURA_TOTAL_QUERIES",
            "params": {
              "count": 10
            }
          },
          {
            "id": "ALURA_EXACT_WORDS_PER_QUERY",
            "params": {
              "count": 10
            }
          },
          {
            "id": "ALURA_MIN_SEGMENTS",
            "params": {
              "count": 10
            }
          },
          {
            "id": "ALURA_QUALITY_THRESHOLDS",
            "params": {
              "competition_max": "Medium",
              "conv_min": 0.015,
              "score_min": 70
            }
          },
          {
            "id": "ALURA_DEDUPE",
            "params": {
              "case_insensitive": true,
              "normalize_diacritics": true,
              "semantic_threshold": 0.85
            }
          },
          {
            "id": "ALURA_NEGATIVE_TERMS",
            "params": {
              "terms": [
                "DIY",
                "free",
                "tutorial",
                "plated*",
                "kit",
                "supplies",
                "raw*"
              ]
            }
          },
          {
            "id": "NO_DERIVATION",
            "params": {
              "enforced": true
            }
          },
          {
            "id": "PRODUCT_RECORD_CONFIRMED_REQUIRED",
            "params": {
              "source": "product_record",
              "status": "CONFIRMED"
            }
          }
        ],
        "selection_policy": [
          "Her segmentten en az 1 öneri; toplamda min 3 segment kapsanmalı.",
          "1-2 öneri yüksek hacim (pop), 2-3 öneri long-tail; geri kalanı dengeli karma.",
          "Aynı kökten gelen varyasyonlar (ör. gold bracelet ~ dainty gold bracelet) 1 öneriyle sınırlandırılır."
        ],
        "title": "Alura Arama Önerileri",
        "ui": {
          "instructions": "8 öneri üret: her biri tam 2 kelime, tekrar yok, kategori çeşitliliği yüksek."
        },
        "upstream_signature": {
          "policy": "mark_stale_on_upstream_change"
        },
        "uses": "suggestions/image",
        "validations": {
          "present": true
        },
        "label": "Alura Arama Önerileri",
        "await_user": true,
        "require_user_confirm": true,
        "no_skip": true,
        "manifest": {
          "description": "Generate exactly 10 two-word EN search suggestions for Alura CSV pulls. No source bias; diversity across segments; keyword-like POS.",
          "transforms": [
            "normalize_case_and_diacritics",
            "romanize_tr_chars",
            "language_detect_and_filter(target='en')",
            "tokenize_and_pos_tag",
            "ngram_enforcer(n=2)",
            "ban_function_words_prepositions",
            "dedupe_by_root_distance(levenshtein<=2)",
            "mmr_diversify(beta=0.7, sim='cosine')"
          ],
          "rules": [
            {
              "id": "exact_count_10",
              "assert": "len(suggestions)==10",
              "on_fail": "auto_fix_and_continue"
            },
            {
              "id": "two_word_only",
              "assert": "all(tokens(s)==2 for s in suggestions)",
              "on_fail": "auto_fix_and_continue"
            },
            {
              "id": "english_only",
              "assert": "all(lang(s)=='en' for s in suggestions)",
              "on_fail": "auto_fix_and_continue"
            },
            {
              "id": "pos_pattern",
              "assert": "all(pos(s) in [('ADJ','NOUN'),('NOUN','NOUN')] for s in suggestions)",
              "on_fail": "auto_fix_and_continue"
            },
            {
              "id": "length_sane",
              "assert": "all(3<=len(w)<=18 for s in suggestions for w in split(s))",
              "on_fail": "auto_fix_and_continue"
            },
            {
              "id": "no_negatives",
              "assert": "exclude(suggestions, negatives)",
              "on_fail": "auto_fix_and_continue"
            },
            {
              "id": "diversity_segments_min4",
              "assert": "segments_covered(suggestions)>=4",
              "on_fail": "auto_fix_and_continue"
            },
            {
              "id": "root_crowding_limit",
              "assert": "max_per_root(suggestions)<=2",
              "on_fail": "auto_fix_and_continue"
            },
            {
              "id": "no_punct_or_symbols",
              "assert": "all(is_alnum_space(s) for s in suggestions)",
              "on_fail": "auto_fix_and_continue"
            },
            {
              "id": "backup_fill",
              "assert": "if len(suggestions)<10 then suggestions+=backup_candidates[:(10-len(suggestions))]",
              "on_fail": "auto_fix_and_continue"
            }
          ],
          "outputs": {
            "suggestions": [
              "string"
            ],
            "backup_candidates": [
              "string"
            ],
            "diversity_report": {
              "segments": [
                "string"
              ],
              "per_segment_counts": {
                "string": "integer"
              },
              "root_crowding_max": "integer"
            }
          },
          "handoff": [
            "3a"
          ]
        },
        "ui_ext": {
          "token_tracking": true
        }
      },
      "20": {
        "constraints": {
          "must_confirm": false,
          "no_skip": true,
          "require_gpt_task": false,
          "require_user_task": false,
          "require_validations_pass": false
        },
        "description": "Sürüm geçmişi, onaylar, checkpointler ve rollback noktalarının denetimi.",
        "flow": {
          "guard": {
            "advance_only_if": []
          }
        },
        "gates": {
          "must": [
            "validations_ok"
          ],
          "on_contract_violation": "halt_and_report",
          "on_miss": "halt",
          "on_missing_required_path": "halt_and_report",
          "on_soft_misalignment": "auto_fix_and_continue"
        },
        "hitl_contract": {
          "gpt_tasks": [],
          "user_tasks": []
        },
        "inputs": [
          "workflow_patches.metadata",
          "workflow_patches.governance"
        ],
        "name": "Versioning & Rollback QA",
        "notes": {
          "include": [
            "_run.record_type"
          ]
        },
        "outputs": [
          "audit.report{}",
          "audit.findings[]",
          "audit.rollback_points[]"
        ],
        "preconditions": {
          "critical_pass": {
            "require_ancestors_done": [
              "0",
              "1",
              "3",
              "6",
              "16"
            ]
          }
        },
        "requires": [
          "19"
        ],
        "rules": [
          "each patch must have patch_note_tr",
          "every 5th patch must record a checkpoint in version history (if enabled)",
          "ruleset_hash must be present and consistent",
          "produce rollback points and audit findings"
        ],
        "ruleset": [
          {
            "id": "PATCH_NOTE_REQUIRED",
            "params": {
              "field": "patch_note_tr"
            }
          },
          {
            "id": "CHECKPOINT_EVERY_5",
            "params": {
              "enabled": true
            }
          },
          {
            "id": "RULESET_HASH_REQUIRED",
            "params": {
              "field": "ruleset_hash"
            }
          },
          {
            "id": "ROLLBACK_POINTS_PRODUCE",
            "params": {
              "required": true
            }
          }
        ],
        "title": "Versioning & Rollback QA",
        "upstream_signature": {
          "policy": "mark_stale_on_upstream_change"
        },
        "validations": {
          "present": true
        },
        "label": "Versioning & Rollback QA",
        "await_user": true,
        "require_user_confirm": true,
        "no_skip": true,
        "json_title": "Versioning & Rollback QA",
        "ui_ext": {
          "token_tracking": true
        }
      },
      "3": {
        "artifacts": [
          "alura.load.report.json"
        ],
        "constraints": {
          "must_confirm": true,
          "no_skip": true,
          "require_gpt_task": false,
          "require_user_task": true,
          "require_validations_pass": true
        },
        "description": "Alura/benzeri kaynaklardan 8 adet CSV yüklenir. Kolon adları normalize edilir; satır ve dil filtreleri uygulanır; temel metrikler hesaplanır.",
        "example": {
          "header": [
            "Keyword",
            "Search volume",
            "3mo. change",
            "Competition",
            "Sales",
            "Score",
            "undefined",
            "Search to competition ratio",
            "Google top of page bid (low range)",
            "Long-tail keyword",
            "Listing age",
            "Length",
            "Google top of page bid (high range)",
            "Google CPC",
            "Google competition level",
            "Google competition index",
            "Etsy tag",
            "Conversion rate",
            "Competition level",
            "Sales per listing",
            "Annual search trend"
          ],
          "row": [
            "promise ring",
            "550000",
            "-6%",
            "626301",
            "1201509",
            "60",
            "",
            "0.88",
            "34",
            "Yes",
            "334 days",
            "12",
            "153",
            "94",
            "Low",
            "100",
            "Yes",
            "1.05%",
            "Very high",
            "48",
            "-33%"
          ]
        },
        "flow": {
          "guard": {
            "advance_only_if": []
          },
          "on_fail": "halt",
          "on_success_next": "3a"
        },
        "gates": {
          "must": [
            "validations_ok"
          ],
          "on_contract_violation": "halt_and_report",
          "on_miss": "halt",
          "on_missing_required_path": "halt_and_report",
          "on_soft_misalignment": "warn_and_continue"
        },
        "guards": {
          "analysis_blocked_until": "pre.csv.report.status==PASS",
          "require_preprocess_pass": true
        },
        "hitl_contract": {
          "gpt_tasks": [],
          "user_tasks": []
        },
        "id": "3",
        "input_prep": {
          "apply_common": true,
          "enabled": true,
          "enforce": true,
          "on_fail": "halt",
          "profile_ref": "similar_keywords"
        },
        "inputs": [
          "alura.csv[8]"
        ],
        "label": "Similar Keywords Upload",
        "name": "Similar Keywords Upload",
        "next": [
          "3a"
        ],
        "on_error": {
          "fallback_next": [],
          "policy": "fail-fast"
        },
        "outputs": [
          "alura.csv[8]",
          "alura.metrics"
        ],
        "params": {
          "allow_missing": false,
          "expected_files": 8,
          "language": "auto",
          "normalize_columns": true
        },
        "parsing": {
          "allow_extra_headers": true,
          "cast_all_as_text": true,
          "dedupe": {
            "case_insensitive": true,
            "diacritics_insensitive": true,
            "enabled": true
          },
          "encodings_priority": [
            "utf-8",
            "ISO-8859-1",
            "cp1254",
            "cp1252"
          ],
          "header_aliases": [
            "Keyword",
            "query",
            "search_term"
          ],
          "ignore_header_order": true,
          "normalize": {
            "case_insensitive": true,
            "collapse_spaces": true,
            "diacritics_insensitive": true,
            "trim_whitespace": true
          },
          "primary_field": "query",
          "quote_mode": "relaxed",
          "value_handling": {
            "cast_all_as_text": true,
            "normalize_yes_no": true,
            "treat_empty_as_valid": true,
            "treat_nan_as_empty": true
          }
        },
        "post": {
          "only_signal_ready": true,
          "signal": "similar_ready"
        },
        "post_upload_process": [
          "apply:policy.csv_pipeline to profile similar_keywords_csv"
        ],
        "pre": {
          "run_preprocessing": true,
          "silent": true
        },
        "preconditions": {
          "critical_pass": {
            "require_ancestors_done": [
              "0",
              "1",
              "3",
              "6",
              "16"
            ]
          }
        },
        "preprocess": {
          "dialect": {
            "delimiter": ",",
            "doublequote": true,
            "escapechar": null,
            "lineterminator": "auto",
            "quotechar": "\""
          },
          "encoding": [
            "utf-8-sig",
            "utf-8",
            "latin1"
          ],
          "header_map": {
            "3mo. change": [
              "3mo change",
              "3 mo change",
              "3-month change"
            ]
          },
          "id": "csv_normalize_v2",
          "integrity": {
            "header_strict": true,
            "max_repaired_per_file": 50,
            "reject_if_any_rowlen_mismatch_after_repair": true,
            "repair_strategy": "merge_split_fields_if_quoted_else_reject",
            "row_len_must_equal_header": true
          },
          "normalize": {
            "cast_all_as_text": true,
            "do_not_invent_nan": true,
            "keep_default_na": false,
            "na_filter": false,
            "preserve_empty_strings": true,
            "strip_bom": true,
            "trim_whitespace": false
          },
          "outputs": {
            "header": "pre.csv.header",
            "report": "pre.csv.report",
            "row_count": "pre.csv.rows",
            "table": "pre.csv.table"
          }
        },
        "requires": [
          "0a"
        ],
        "suggestion_mode": "suppress",
        "title": "Similar Keywords Upload",
        "type": "upload_csv",
        "ui": {
          "accept": [
            ".csv"
          ],
          "help": "Header esnek: Keyword | query | search_term. Ek sütunlar serbest; NaN/boş/Yes/No kabul.",
          "max_files": 10,
          "min_files": 8,
          "title": "Similar Keywords CSV"
        },
        "upstream_signature": {
          "policy": "mark_stale_on_upstream_change"
        },
        "validations": {
          "file_count": "=8",
          "required_columns": [
            "keyword",
            "search_volume?"
          ]
        },
        "value_handling": {
          "cast_all_as_text": true,
          "treat_empty_as_valid": false,
          "treat_nan_as_empty": false
        },
        "await_user": true,
        "require_user_confirm": true,
        "no_skip": true,
        "input_prep_ext": {
          "profile_candidates": [
            "similar_keywords_v2",
            "similar_keywords_strict",
            "similar_keywords"
          ],
          "auto_select_profile": "by_header",
          "on_profile_mismatch": "halt",
          "keep_default_na": false,
          "na_filter": false
        },
        "ui_ext": {
          "accept": [
            ".csv"
          ],
          "help_add": "Başlıklar virgülle ayrıdır. 'Keyword' zorunlu. Tamamen sayısal Keyword kabul edilmez; harf içeren oran <%20 ise HALT.",
          "token_tracking": true
        },
        "validations_ext": {
          "required_columns_any_of": [
            [
              "Keyword"
            ]
          ],
          "row_length_equals_header": {
            "on_fail": "halt",
            "report_first_n": 50
          },
          "keyword_has_letters_min_ratio": {
            "min_ratio": 0.2,
            "sample_n": 1000,
            "on_fail": "halt",
            "explain": "Keyword alanı büyük oranda ID içeriyor."
          }
        },
        "outputs_ext": {
          "frame_name": "similar_keywords_norm_v2"
        }
      },
      "3a": {
        "can_revise_after": [
          "4",
          "5a",
          "5b"
        ],
        "constraints": {
          "max_same_root_in_top50": 3,
          "min_pool_size": 100,
          "must_confirm": false,
          "no_derivation": true,
          "no_skip": true,
          "require_gpt_task": false,
          "require_user_task": false,
          "require_validations_pass": false,
          "semantic_similarity_threshold": 0.85
        },
        "description": "CSV’lerden geniş havuz kur; 1..6 odak kelimeyi seç; çeşitlilik ve kalite kuralları uygula. Kaynak farkı puanlamayı ETKİLEMEZ. + MMR çeşitlilik, EV skoru, TR-normalizasyon, konsensüs sıklığı, rol ataması, destek terimler ve neden günlüğü.",
        "display": {
          "hide": [
            "tables",
            "raw_rows",
            "excel_like"
          ],
          "show": [
            "text_summary",
            "key_metrics"
          ]
        },
        "diversity": {
          "root_crowding": {
            "equivalence": "case_insensitive_exact",
            "max_per_root_in_top100": 3
          },
          "segment_cover_min": 3,
          "segments": {
            "material": [
              "gold",
              "10k",
              "14k",
              "18k",
              "yellow gold",
              "white gold",
              "rose gold"
            ],
            "setting": [
              "bezel",
              "flush",
              "solitaire",
              "channel",
              "pavé",
              "prong"
            ],
            "style": [
              "minimalist",
              "dainty",
              "simple",
              "thin",
              "delicate",
              "everyday"
            ],
            "usage": [
              "wedding",
              "promise",
              "bridal",
              "engagement",
              "stacking",
              "anniversary"
            ]
          }
        },
        "flow": {
          "guard": {
            "advance_only_if": []
          }
        },
        "gates": {
          "must": [
            "validations_ok"
          ],
          "on_contract_violation": "halt_and_report",
          "on_miss": "halt",
          "on_missing_required_path": "halt_and_report",
          "on_soft_misalignment": "warn_and_continue"
        },
        "governance": {
          "audit_fields": [
            "source_csv_id",
            "original_query",
            "metrics_at_selection_time"
          ],
          "reproducibility": "store seeds and weights for ranking formula (w1..w5)"
        },
        "guards": {
          "keyword_pool": {
            "criteria": [
              "relevance",
              "volume",
              "competition"
            ],
            "max_size": 50,
            "min_size": 30,
            "note": "Odak seçimi için geniş çeşit havuzu",
            "require_types": [
              "short",
              "mid",
              "long_tail"
            ]
          }
        },
        "hitl_contract": {
          "gpt_tasks": [],
          "user_tasks": []
        },
        "inputs": [
          "alura.csv[8]",
          "alura.metrics",
          "context.product_category",
          "prior.signals"
        ],
        "label": "Odak Anahtar Kelime + Türetilenler",
        "name": "Odak Anahtar Kelime + Türetilenler",
        "operations": [
          "concat -> dedupe (case-insensitive, diacritics normalized)",
          "filter by quality thresholds (score>=70, conv>=0.015, competition<=Medium) with fallback allowance<=10%",
          "segment_coverage ensure >=3 segments (material/use_case/audience + optional gemstone/style/color/price)",
          "normalize & canonicalize keywords (singular/plural, common misspellings) without creating new derivatives",
          "rank by multi-score: w1*score + w2*conv + w3*ctr + w4*volume - w5*competition_penalty",
          "diversity re-ranking: penalize near-duplicates (semantic_sim>=0.85) and same-root crowding",
          "produce ranked pool and pick provisional focus_keywords[1..4]"
        ],
        "outputs": [
          "keywords.pool.ranked[]",
          "keywords.focus[1..4].provisional",
          "keywords.selection_notes",
          "keywords.segment_coverage"
        ],
        "pool_policy": {
          "allowed_fields": {
            "competitor_listings": [
              "Title",
              "Tags",
              "Sales",
              "Revenue",
              "Conversion rate"
            ],
            "similar_keywords": [
              "Keyword",
              "Score",
              "Search volume",
              "3mo. change",
              "Competition",
              "Conversion rate"
            ],
            "top_listings": [
              "Title",
              "Tags",
              "Sales",
              "Revenue",
              "Conversion rate"
            ]
          },
          "dedupe": {
            "mode": "case_insensitive_exact"
          },
          "negatives_ref": "global_negatives",
          "normalization": {
            "case_preserve": true,
            "no_lemmatize_stem_synonym": true,
            "single_space_only": true,
            "trim_whitespace": true
          },
          "pool_limits": {
            "allow_less": true,
            "max": 100,
            "target_min": 100
          },
          "source": "csv_only"
        },
        "preconditions": {
          "critical_pass": {
            "require_ancestors_done": [
              "0",
              "1",
              "3",
              "6",
              "16"
            ]
          },
          "parent_defined": {
            "exists": true,
            "path": "/workflow_patches/steps/3"
          }
        },
        "requires": [
          "3"
        ],
        "ruleset": {
          "column_map_extra": {
            "Long-tail keyword|Long tail": "Long-tail keyword",
            "Search Keyword|Keyword": "Search Keyword",
            "Search volume|Search Volume": "Search volume"
          },
          "filters": {
            "alpha_ratio_min": 0.6,
            "min_keyword_len": 3
          }
        },
        "scoring": {
          "combine": [
            {
              "take": "similar",
              "weight": 0.6
            },
            {
              "take": "market",
              "weight": 0.4
            }
          ],
          "features": {
            "market": {
              "revenue_signal": {
                "agg": "sum_norm",
                "any_of": [
                  "Revenue",
                  "Monthly revenue"
                ],
                "weight": 0.15
              },
              "sales_signal": {
                "agg": "sum_norm",
                "any_of": [
                  "Sales",
                  "Monthly sales"
                ],
                "weight": 0.15
              },
              "tag_hits_comp": {
                "count": true,
                "field": "Tags",
                "source": "competitor_listings",
                "weight": 0.2
              },
              "tag_hits_top": {
                "count": true,
                "field": "Tags",
                "source": "top_listings",
                "weight": 0.2
              },
              "title_hits_comp": {
                "count": true,
                "field": "Title",
                "source": "competitor_listings",
                "weight": 0.15
              },
              "title_hits_top": {
                "count": true,
                "field": "Title",
                "source": "top_listings",
                "weight": 0.15
              }
            },
            "similar": {
              "competition": {
                "field": "Competition",
                "norm": "inv",
                "weight": 0.1
              },
              "conv": {
                "field": "Conversion rate",
                "norm": "pct",
                "weight": 0.2
              },
              "score": {
                "field": "Score",
                "norm": "minmax",
                "weight": 0.45
              },
              "trend_3mo": {
                "field": "3mo. change",
                "norm": "pct",
                "weight": 0.05
              },
              "volume": {
                "field": "Search volume",
                "norm": "log1p",
                "weight": 0.2
              }
            }
          },
          "missing_values": {
            "no_imputation": true,
            "skip_feature_if_missing": true
          }
        },
        "selection": {
          "allow_focus_lt_4_if_pool_lt_4": true,
          "focus_count": 4,
          "outputs": {
            "focus_keywords": "outputs.focus_keywords",
            "pool": "outputs.pool",
            "selection_notes": "outputs.selection_notes"
          },
          "tie_breakers": [
            "conversion_rate",
            "title_tag_occurrence",
            "similar_score"
          ],
          "validations": {
            "halt_on_fail": true,
            "require": [
              "len(outputs.pool) >= 1",
              "len(outputs.focus_keywords) >= (outputs.pool.length < 4 ? outputs.pool.length : 4)"
            ]
          }
        },
        "selection_policy": {
          "focus_keywords_count": 4,
          "notes_required": true,
          "tie_breakers": [
            "higher conversion_rate",
            "higher overall score",
            "better segment diversification"
          ],
          "use_in_3b": 1
        },
        "title": "Odak Anahtar Kelime + Türetilenler",
        "upstream_signature": {
          "policy": "mark_stale_on_upstream_change"
        },
        "validations": {
          "present": true
        },
        "await_user": true,
        "require_user_confirm": true,
        "no_skip": true,
        "manifest": {
          "inputs": {
            "csv_pools": [
              {
                "path": "*/alura_*.csv"
              },
              {
                "path": "*/top_listings*.csv"
              },
              {
                "path": "*/competitors*.csv"
              }
            ],
            "negatives": [
              "string"
            ],
            "product": {
              "category": "string",
              "attributes": [
                "string"
              ]
            },
            "metrics": {
              "volume?": "number",
              "competition?": "number",
              "ctr?": "number",
              "cvr?": "number",
              "trend?": "number"
            },
            "ads_feedback?": [
              {
                "term": "string",
                "cvr": "number",
                "ctr": "number"
              }
            ],
            "market?": {
              "top_competitors_share?": "number"
            },
            "locale?": "string"
          },
          "transforms": [
            "normalize_case_and_diacritics",
            "unify_delimiters",
            "dedupe_by_root_distance(levenshtein<=2)",
            "locale_tr_casefold_I_dots",
            "split_compound_terms",
            "tag_long_tail_short_mid_labels",
            "mmr_prepare_embeddings(corpus=keyword_pool)"
          ],
          "rules": [
            {
              "id": "pool_min",
              "assert": "len(keyword_pool) >= 30",
              "on_fail": "warn_and_report"
            },
            {
              "id": "neg_filter",
              "assert": "exclude(keyword_pool, negatives)",
              "on_fail": "auto_fix_and_continue"
            },
            {
              "id": "diversity_segments",
              "assert": "segments_covered(keyword_pool) >= 3",
              "on_fail": "warn_and_continue"
            },
            {
              "id": "root_crowding",
              "assert": "max_per_root(keyword_pool) <= 2",
              "on_fail": "auto_fix_and_continue"
            },
            {
              "id": "score_compute",
              "assert": "score = w1*relevance + w2*volume - w3*competition + w4*cvr_proxy + w5*trend + w6*entropy - w7*crowding - w8*neg_flag",
              "on_fail": "warn_and_continue"
            },
            {
              "id": "no_source_bias",
              "assert": "score_does_not_reference(source)",
              "on_fail": "warn_and_report"
            },
            {
              "id": "ads_uplift_optional",
              "assert": "if ads_feedback then score += uplift(ads_feedback)",
              "on_fail": "warn_and_continue"
            },
            {
              "id": "select_focus_1_6",
              "assert": "focus_keywords = select_top_diverse(keyword_pool, 6)",
              "on_fail": "warn_and_report"
            },
            {
              "id": "ensure_long_tail_mix",
              "assert": "count(label=='long_tail' for term in keyword_pool) >= 10",
              "on_fail": "warn_and_continue"
            },
            {
              "id": "segment_coverage_focus",
              "assert": "segments_covered(focus_keywords)>=3",
              "on_fail": "auto_fix_and_continue"
            },
            {
              "id": "min_long_tail_in_focus",
              "assert": "count(label=='long_tail' for term in focus_keywords) >= 3",
              "on_fail": "auto_fix_and_continue"
            },
            {
              "id": "mmr_diversity",
              "assert": "focus_candidates = mmr_select(keyword_pool, score, k=24, beta=0.6, sim='cosine')",
              "on_fail": "warn_and_continue"
            },
            {
              "id": "ev_expected_value_score",
              "assert": "ev = volume * conv_prob(competition, ctr, cvr); score += ev_weight*normalize(ev)",
              "on_fail": "warn_and_continue"
            },
            {
              "id": "dominant_competitor_penalty",
              "assert": "if market.top_competitors_share>0.6 then score -= dominance_penalty",
              "on_fail": "warn_and_continue"
            },
            {
              "id": "consensus_frequency_boost",
              "assert": "freq = frequency_across_sources(source_map); score += freq_weight*normalize(freq)",
              "on_fail": "warn_and_continue"
            },
            {
              "id": "assign_focus_roles",
              "assert": "focus_roles = {'focus_1':'highest_ev','focus_2':'alt_segment_high_ev','focus_3':'long_tail_1','focus_4':'season_niche','focus_5':'attribute_match','focus_6':'low_competition_discovery'}",
              "on_fail": "warn_and_continue"
            },
            {
              "id": "support_terms_build",
              "assert": "support_terms = build_support_terms(focus_keywords, keyword_pool, per_focus=2..3, different_segments=true)",
              "on_fail": "warn_and_continue"
            },
            {
              "id": "language_map_build",
              "assert": "language_map = build_language_map(keyword_pool, locale='tr', target='en')",
              "on_fail": "warn_and_continue"
            },
            {
              "id": "why_log_build",
              "assert": "why_log = [{'term':t,'ev':ev(t),'diversity':div(t),'trend':trend(t),'reason':explain(t)} for t in focus_keywords]",
              "on_fail": "warn_and_continue"
            }
          ],
          "outputs": {
            "focus_keywords": [
              "string"
            ],
            "keyword_pool": [
              "string"
            ],
            "title_seed": "string",
            "desc_seeds": [
              "string"
            ],
            "tags_seed": [
              "string"
            ],
            "negatives_used": [
              "string"
            ],
            "source_map": {
              "term": [
                "alura",
                "top",
                "competitors",
                "ads?"
              ]
            },
            "focus_roles": {
              "focus_1": "string",
              "focus_2": "string",
              "focus_3": "string",
              "focus_4": "string",
              "focus_5": "string",
              "focus_6": "string"
            },
            "support_terms": [
              {
                "focus": "string",
                "terms": [
                  "string"
                ]
              }
            ],
            "language_map?": [
              {
                "term": "string",
                "tr": "string",
                "en": "string"
              }
            ],
            "why_log": [
              {
                "term": "string",
                "ev": "number",
                "diversity": "number",
                "trend": "number",
                "reason": "string"
              }
            ]
          },
          "handoff": [
            "3b",
            "10",
            "11",
            "12"
          ]
        },
        "ui_ext": {
          "token_tracking": true
        }
      },
      "3b": {
        "kind": "csv_clean:similar",
        "name": "Taslak Paket — DRAFT",
        "ruleset": {
          "policy": {
            "add_missing": false,
            "keep_extras": true,
            "mode": "forgiving",
            "on_mismatch": "silent",
            "reorder_known": true
          }
        },
        "title": "Taslak Paket — DRAFT",
        "description": "3.a’daki havuz ve odak #1 (varsayılan) kullanılarak taslak başlık, açıklama ve 13 etiket oluşturulur. Nihai SEO adımlarına geçmeden önce kullanıcı gözden geçirmesi içindir.",
        "output_format": {
          "title_core_ngram": "string",
          "description_outline": "plain_text_lines",
          "tag_buckets": "json_object",
          "render_preview_hint": "plain_text"
        },
        "label": "Taslak Paket — DRAFT",
        "await_user": true,
        "require_user_confirm": true,
        "no_skip": true,
        "ui_ext": {
          "token_tracking": true
        }
      },
      "3c": {
        "name": "Taslak Zenginleştirme",
        "ruleset": {
          "filters": {
            "alpha_ratio_min": 0.6,
            "drop_zero_volume": true,
            "min_length": 3
          }
        },
        "title": "Odak Anahtar Kelime Seçimi & Havuz",
        "await_user": true,
        "require_user_confirm": true,
        "no_skip": true,
        "ui_ext": {
          "token_tracking": true
        }
      },
      "4": {
        "_original_snapshot": {
          "had_keys": [
            "constraints",
            "description",
            "flow",
            "gates",
            "governance",
            "hitl_contract",
            "ingest_policy_ref",
            "input_prep",
            "inputs",
            "label",
            "name",
            "operations",
            "outputs",
            "post",
            "pre",
            "preconditions",
            "preprocess",
            "relations",
            "requires",
            "ruleset",
            "suggestion_mode",
            "title",
            "upstream_signature",
            "validations"
          ]
        },
        "enabled": false,
        "locked": true,
        "name": "Top Listings (Genel)",
        "reactivation_protection": {
          "allowed_fields": [
            "notes"
          ],
          "fingerprint": "sha256:fd97e833d794ae372cebc4d8b540607287d867411e05c4380fccb87f8483158f",
          "fingerprint_algo": "sha256"
        },
        "removed_at": "2025-09-12T07:25:50.861753",
        "removed_by": "user",
        "removed_reason": "decommissioned by user request",
        "status": "active",
        "tombstone": false,
        "visible": false,
        "constraints": {
          "require_user_task": true,
          "must_confirm": true,
          "require_validations_pass": true,
          "require_csv": false,
          "empty_intake": "SKIP"
        },
        "ui": {
          "min_files": 1
        },
        "title": "Top Listings (Genel)",
        "description": "Kullanıcıdan gelen 4 dar Top Listings CSV (focus_1..4’e denk gelen, her biri ≈200 ürün) temizlenir, normalize edilir ve konsolide edilir. 3.a odak kelime sırasının revizyonuna dair sinyaller üretilir.",
        "stop_for_confirmation": false,
        "label": "Top Listings (Genel)",
        "await_user": true,
        "require_user_confirm": true,
        "no_skip": true,
        "ui_ext": {
          "token_tracking": true
        }
      },
      "4a": {
        "name": "Top Listings Upload",
        "ruleset": {
          "realign": {
            "if_currency_in_title": true,
            "if_url_in_video_false": "move_to_URL",
            "trim_percent_signs": [
              "Conversion rate",
              "BSR Category (%)"
            ]
          }
        },
        "status": "active",
        "tombstone": false,
        "title": "Top Listings Upload",
        "constraints": {
          "require_csv": false,
          "empty_intake": "SKIP"
        },
        "stop_for_confirmation": false,
        "label": "Top Listings Upload",
        "await_user": true,
        "require_user_confirm": true,
        "no_skip": true,
        "enabled": false,
        "ui_ext": {
          "token_tracking": true
        }
      },
      "4b": {
        "kind": "csv_clean:top",
        "name": "Top Listings Clean (csv_clean:top)",
        "ruleset": {
          "policy": {
            "add_missing": false,
            "keep_extras": true,
            "mode": "forgiving",
            "on_mismatch": "silent",
            "reorder_known": true
          }
        },
        "status": "active",
        "tombstone": false,
        "title": "Top Listings Clean (csv_clean:top)",
        "constraints": {
          "require_csv": false,
          "empty_intake": "SKIP"
        },
        "stop_for_confirmation": false,
        "label": "Top Listings Clean (csv_clean:top)",
        "await_user": true,
        "require_user_confirm": true,
        "no_skip": true,
        "enabled": false,
        "ui_ext": {
          "token_tracking": true
        }
      },
      "5": {
        "advisory_pack_similarity": {
          "advisory_signals": {
            "favorites_views": true,
            "listing_age": true,
            "review_count": true
          },
          "block": false,
          "notes": "Top Listings analizinde ekstra sütunlar (Favorites, Reviews, Age) küçük ağırlıklarla puana katkı yapar.",
          "severity": "advisory",
          "similarity_score": {
            "enabled": true,
            "factors": {
              "category_match": 0.2,
              "price_band_match": 0.1,
              "tags_keyword_match": 0.2,
              "title_keyword_match": 0.5
            },
            "normalization": "0_to_1",
            "note": "Benzerlik puanı 0–1; Title/Tags/Category/Fiyat uyumu ile hesaplanır."
          },
          "title": "Similarity & Extra Signals for Top Listings"
        },
        "constraints": {
          "must_confirm": false,
          "no_skip": true,
          "require_gpt_task": false,
          "require_user_task": false,
          "require_validations_pass": false,
          "require_csv": true,
          "empty_intake": "RUN FAIL"
        },
        "display": {
          "hide": [
            "tables",
            "raw_rows",
            "excel_like"
          ],
          "show": [
            "text_summary",
            "key_metrics"
          ]
        },
        "flow": {
          "guard": {
            "advance_only_if": []
          }
        },
        "gates": {
          "must": [
            "validations_ok"
          ],
          "on_contract_violation": "halt_and_report",
          "on_miss": "halt",
          "on_missing_required_path": "halt_and_report",
          "on_soft_misalignment": "auto_fix_and_continue"
        },
        "hitl_contract": {
          "gpt_tasks": [],
          "user_tasks": []
        },
        "label": "Top Listings Upload (Dar)",
        "name": "Top Listings Upload (Dar)",
        "output": {
          "digest_only": true,
          "ui_table": false
        },
        "preconditions": {
          "critical_pass": {
            "require_ancestors_done": [
              "0",
              "1",
              "3",
              "6",
              "16"
            ]
          }
        },
        "requires": [],
        "upstream_signature": {
          "policy": "mark_stale_on_upstream_change"
        },
        "uses": "analysis/top_listings",
        "validations": {
          "present": true
        },
        "title": "Top Listings Upload (Dar)",
        "await_user": true,
        "require_user_confirm": true,
        "no_skip": true,
        "input_prep_ext": {
          "profile_candidates": [
            "top_listings_title_first_v1",
            "listings_title_first_v1"
          ],
          "auto_select_profile": "by_header",
          "on_profile_mismatch": "halt",
          "keep_default_na": false,
          "na_filter": false
        },
        "ui_ext": {
          "accept": [
            ".csv"
          ],
          "help_add": "Title virgül içerebilir. İlk ',\"' konumuna kadar Title kabul edilir; sonrası tırnaklı CSV gibi parse edilir.",
          "token_tracking": true
        },
        "validations_ext": {
          "required_columns_any_of": [
            [
              "Title"
            ]
          ],
          "row_length_equals_header": {
            "on_fail": "halt",
            "report_first_n": 50
          }
        },
        "outputs_ext": {
          "frame_name": "listings_union_norm"
        }
      },
      "5a": {
        "can_revise": [
          "keywords.focus[1..4]"
        ],
        "constraints": {
          "min_total_rows_warning": 600,
          "must_confirm": false,
          "negatives": [
            "DIY",
            "supplies",
            "kit",
            "raw",
            "tutorial",
            "plated*"
          ],
          "no_skip": true,
          "require_gpt_task": false,
          "require_user_task": false,
          "require_validations_pass": false,
          "require_csv": true,
          "empty_intake": "RUN FAIL"
        },
        "description": "Top listings verisinden ürün/anahtar kelime performans içgörüleri çıkarılır; niş fırsatlar ve doygun alanlar işaretlenir; odak sıralaması için sinyal üretilir.",
        "flow": {
          "guard": {
            "advance_only_if": []
          }
        },
        "gates": {
          "must": [],
          "on_contract_violation": "halt_and_report",
          "on_miss": "halt",
          "on_missing_required_path": "halt_and_report",
          "on_soft_misalignment": "auto_fix_and_continue"
        },
        "governance": {
          "notes_required": true
        },
        "guards": {
          "analysis": {
            "include_metrics": [
              "conversion_rate",
              "listing_age"
            ],
            "note": "Popüler ürün analizinde satış dışında metrikler de hesaba katılmalı"
          }
        },
        "hitl_contract": {
          "gpt_tasks": [],
          "user_tasks": []
        },
        "inputs": [
          "top_listings.cleaned.*",
          "top_listings.merged",
          "top_listings.keyword_metrics{}",
          "top_listings.keyword_overlap[]",
          "keywords.pool.ranked[]",
          "keywords.focus[1..4].provisional",
          "draft.title",
          "draft.tags[13]"
        ],
        "min_samples_per_shop": 1,
        "name": "Popüler Ürünler Analizi",
        "output": {
          "digest_only": true,
          "top_n": 8,
          "ui_table": false
        },
        "outputs": [
          "popular.products.top[]",
          "popular.keywords.top[]",
          "popular.segments.summary{}",
          "popular.focus_signals{}",
          "popular.notes",
          "similarity.report{}",
          "similarity.score",
          "similarity.label",
          "similarity.notes"
        ],
        "pre": [
          {
            "args": {
              "mode": "auto_fix_warn",
              "rules_ref": "_csv_rules.competitor_csv",
              "write_outputs": true
            },
            "name": "csv_preprocess.competitor_csv"
          }
        ],
        "preconditions": {
          "critical_pass": {
            "require_ancestors_done": [
              "0",
              "1",
              "3",
              "6",
              "16"
            ]
          },
          "parent_defined": {
            "exists": true,
            "path": "/workflow_patches/steps/5"
          }
        },
        "requires": [],
        "rules": [
          "normalize product metrics (views, favorites, orders, conversion_rate) -> z-scores -> product_score",
          "aggregate keyword occurrences across products -> keyword_score",
          "dedupe near-duplicate products (semantic_sim>=0.85)",
          "analyze segment coverage (material/use_case/audience + optional gemstone/style/color/price)",
          "flag opportunities (high-conv/low-comp) and risks (high-comp/low-conv)",
          "produce focus support/oppose signals for focus_1..4",
          "Compute similarity between our listing and each row (title/desc embeddings; tag overlap; attribute match).",
          "Attach similarity.score (0–1) and similarity.label (LOW/MEDIUM/HIGH) per row.",
          "Emit similarity.report and notes; use in later steps (ads/seo/spam guard)."
        ],
        "ruleset": {
          "keep_original": true,
          "locale_auto": true,
          "parse_price": "smart"
        },
        "suggestion_mode": "suppress",
        "title": "Popüler Ürünler Analizi",
        "upstream_signature": {
          "policy": "mark_stale_on_upstream_change"
        },
        "uses": "selection/top8_by_shop",
        "label": "Popüler Ürünler Analizi",
        "await_user": true,
        "require_user_confirm": true,
        "no_skip": true,
        "manifest": {
          "inputs": {
            "alura": {
              "score": "number",
              "ctr": "number",
              "conv": "number",
              "competition": "number"
            },
            "competitors": [
              {
                "title": "string",
                "tags": [
                  "string"
                ],
                "price": "number",
                "free_shipping": "boolean",
                "bestseller": "boolean",
                "photos": "integer",
                "video": "boolean"
              }
            ],
            "trends": {
              "season": "string",
              "trend_ok": "boolean"
            }
          },
          "rules": [
            {
              "id": "alura_score_min",
              "assert": "alura.score >= 60",
              "on_fail": "warn_and_continue"
            },
            {
              "id": "kw_set_13_unique",
              "assert": "len(output.tags)==13 && len(set(output.tags))==13",
              "on_fail": "auto_fix_and_continue"
            },
            {
              "id": "dedupe_vs_attributes",
              "assert": "no_overlap(output.tags, product.attributes)",
              "on_fail": "auto_fix_and_continue"
            },
            {
              "id": "price_within_norm",
              "assert": "price >= stats.avg_price*0.90 && price <= stats.avg_price*1.10",
              "on_fail": "warn_and_continue"
            },
            {
              "id": "free_shipping_if_norm",
              "assert": "stats.free_shipping_ratio >= 0.60 -> shipping.free==true",
              "on_fail": "warn_and_continue"
            },
            {
              "id": "photos_minimum",
              "assert": "stats.photos_count >= 5",
              "on_fail": "warn_and_continue"
            },
            {
              "id": "video_recommend",
              "assert": "stats.video_present == true",
              "on_fail": "warn_and_continue"
            },
            {
              "id": "trend_validation",
              "assert": "trends.trend_ok == true",
              "on_fail": "warn_and_continue"
            }
          ],
          "outputs": {
            "keyword_set": {
              "primary": "string",
              "variants": [
                "string"
              ]
            },
            "pricing_norm": {
              "min": "number",
              "avg": "number",
              "max": "number",
              "free_shipping_ratio": "number"
            },
            "visual_standard": {
              "min_photos": 5,
              "video": "recommended"
            },
            "trend_notes": "string"
          },
          "handoff": [
            "5b",
            "5c",
            "10",
            "11",
            "12"
          ]
        },
        "ui_ext": {
          "token_tracking": true
        }
      },
      "5b": {
        "constraints": {
          "coverage": "multiple segments must be represented",
          "exclusions": [
            "brand infringement",
            "supplies/DIY heavy presence"
          ],
          "must_confirm": false,
          "no_skip": true,
          "quality": ">=50% of selected shops have multi-match in popular.products.top[]",
          "require_gpt_task": false,
          "require_user_task": false,
          "require_validations_pass": false,
          "require_csv": true,
          "empty_intake": "RUN FAIL"
        },
        "description": "5a ve 4 çıktıları üzerinden hedef rakip mağazalar belirlenir; ileride Ads ve SEO karşılaştırmaları için çekirdek set oluşturulur.",
        "enabled": true,
        "flow": {
          "guard": {
            "advance_only_if": []
          }
        },
        "gates": {
          "must": [],
          "on_contract_violation": "halt_and_report",
          "on_miss": "halt",
          "on_missing_required_path": "halt_and_report",
          "on_soft_misalignment": "warn_and_continue"
        },
        "governance": {
          "notes_required": true
        },
        "guards": {
          "competitor_selection": {
            "feedback_to": "3b",
            "pattern_extraction": [
              "titles",
              "tags"
            ],
            "require_category_match": true
          }
        },
        "hitl_contract": {
          "gpt_tasks": [],
          "user_tasks": []
        },
        "inputs": [
          "popular.products.top[]",
          "popular.keywords.top[]",
          "top_listings.merged",
          "competitor_shops.csv?"
        ],
        "name": "Rakip Mağaza Seçimi",
        "notes": {
          "lifecycle": "manifest-disabled"
        },
        "outputs": [
          "competitors.candidates[]",
          "competitors.selected[]",
          "competitors.profiles{}",
          "competitors.notes",
          "similarity.report{}",
          "similarity.score",
          "similarity.label",
          "similarity.notes"
        ],
        "preconditions": {
          "critical_pass": {
            "require_ancestors_done": [
              "0",
              "1",
              "3",
              "6",
              "16"
            ]
          },
          "parent_defined": {
            "exists": true,
            "path": "/workflow_patches/steps/5"
          }
        },
        "requires": [
          "5a"
        ],
        "rules": [
          "extract shop_candidates from ownership of top products",
          "if competitor_shops.csv present: clean/normalize and merge with candidates",
          "score shops by product_score_topK, keyword_overlap_quality, category_fit, diversity_contrib",
          "select 4–8 diverse shops; demote near-duplicate or same-root brands",
          "Compute similarity between our listing and each row (title/desc embeddings; tag overlap; attribute match).",
          "Attach similarity.score (0–1) and similarity.label (LOW/MEDIUM/HIGH) per row.",
          "Emit similarity.report and notes; use in later steps (ads/seo/spam guard)."
        ],
        "ruleset": [
          {
            "id": "SHOP_SELECTION_COUNT_RANGE",
            "params": {
              "max": 8,
              "min": 4
            }
          },
          {
            "id": "COVERAGE_MULTIPLE_SEGMENTS",
            "params": {
              "required": true
            }
          },
          {
            "id": "QUALITY_MIN_RATIO_TOP_MATCH",
            "params": {
              "ratio": 0.5
            }
          },
          {
            "id": "EXCLUSIONS",
            "params": {
              "terms": [
                "brand infringement",
                "supplies/DIY heavy"
              ]
            }
          },
          {
            "id": "SIMILARITY_TITLE_DESC_CHECK",
            "params": {}
          },
          {
            "id": "SIMILARITY_TAGS_OVERLAP",
            "params": {}
          },
          {
            "id": "SIMILARITY_ATTRIBUTES_MATCH",
            "params": {}
          },
          {
            "id": "SIMILARITY_SCORE_COMPUTE",
            "params": {}
          },
          {
            "id": "PRODUCT_RECORD_CONFIRMED_REQUIRED",
            "params": {
              "source": "product_record",
              "status": "CONFIRMED"
            }
          }
        ],
        "suggestion_mode": "suppress",
        "title": "Rakip Mağaza Seçimi",
        "ui": {
          "hidden": true
        },
        "upstream_signature": {
          "policy": "mark_stale_on_upstream_change"
        },
        "label": "Rakip Mağaza Seçimi",
        "await_user": true,
        "require_user_confirm": true,
        "no_skip": true,
        "ui_ext": {
          "token_tracking": true
        }
      },
      "6": {
        "artifacts": [
          "competitors.load.report.json"
        ],
        "constraints": {
          "must_confirm": true,
          "no_skip": true,
          "require_gpt_task": false,
          "require_user_task": true,
          "require_validations_pass": true,
          "require_csv": true,
          "empty_intake": "RUN FAIL"
        },
        "description": "Rakip mağaza listesi CSV’si (örn. competitor_shops.csv) yüklenir; mağaza URL/ID doğrulamaları ve temel temizlik yapılır.",
        "flow": {
          "guard": {
            "advance_only_if": []
          }
        },
        "gates": {
          "must": [
            "validations_ok"
          ],
          "on_contract_violation": "halt_and_report",
          "on_miss": "halt",
          "on_missing_required_path": "halt_and_report",
          "on_soft_misalignment": "warn_and_continue"
        },
        "input_prep": {
          "apply_common": true,
          "enabled": true,
          "enforce": true,
          "on_fail": "halt",
          "profile_ref": "competitor_listings"
        },
        "inputs": [
          "competitor_shops.csv"
        ],
        "label": "Competitor Listings (Genel)",
        "name": "Competitor Listings (Genel)",
        "next": [
          "6a"
        ],
        "on_error": {
          "fallback_next": [],
          "policy": "fail-soft"
        },
        "outputs": [
          "competitors.shops[]"
        ],
        "params": {
          "required_columns": [
            "shop_name",
            "shop_url?"
          ]
        },
        "post": {
          "only_signal_ready": true,
          "signal": "competitor_ready"
        },
        "post_upload_process": [
          "apply:policy.csv_pipeline to profile competitor_shops_csv"
        ],
        "pre": {
          "run_preprocessing": true,
          "silent": true
        },
        "preconditions": {
          "critical_pass": {
            "require_ancestors_done": [
              "0",
              "1",
              "3",
              "6",
              "16"
            ]
          }
        },
        "preprocess": {
          "dialect": {
            "lineterminator": "auto"
          },
          "normalize": {
            "strip_bom": true
          }
        },
        "requires": [
          "0a"
        ],
        "title": "Competitor Listings (Genel)",
        "upstream_signature": {
          "policy": "mark_stale_on_upstream_change"
        },
        "validations": {
          "row_min": 1
        },
        "ui": {
          "min_files": 1
        },
        "await_user": true,
        "require_user_confirm": true,
        "no_skip": true,
        "ui_ext": {
          "token_tracking": true
        }
      },
      "6a": {
        "advisory_pack_similarity": {
          "advisory_signals": {
            "review_rate": true,
            "review_score": true,
            "shop_level_aggregation": {
              "enabled": true,
              "metrics": [
                "avg_price",
                "avg_conversion_rate",
                "avg_review_score",
                "total_listings"
              ]
            }
          },
          "block": false,
          "notes": "Rakip mağaza analizi shop-level özetler (ortalama fiyat, conversion, review) ile desteklenir.",
          "severity": "advisory",
          "similarity_score": {
            "enabled": true,
            "factors": {
              "category_match": 0.2,
              "price_band_match": 0.2,
              "tags_keyword_match": 0.2,
              "title_keyword_match": 0.4
            },
            "normalization": "0_to_1",
            "note": "Rakip ürün benzerlik puanı; Title/Tags/Category/Fiyat üzerinden hesaplanır."
          },
          "title": "Similarity & Shop-Level Signals for Competitors"
        },
        "artifacts": [
          "competitors.analysis.report.json",
          "competitors.keywords.csv"
        ],
        "constraints": {
          "must_confirm": false,
          "no_skip": true,
          "require_gpt_task": false,
          "require_user_task": false,
          "require_validations_pass": true,
          "require_csv": true,
          "empty_intake": "RUN FAIL"
        },
        "description": "Yüklenen rakip mağazalar üzerinden ürün/etiket/başlık ve fiyat dağılımı analiz edilir; kampanya/SEO için özet sinyaller üretilir.",
        "display": {
          "hide": [
            "tables",
            "raw_rows",
            "excel_like"
          ],
          "show": [
            "text_summary",
            "key_metrics"
          ]
        },
        "flow": {
          "guard": {
            "advance_only_if": []
          }
        },
        "gates": {
          "must": [
            "validations_ok"
          ],
          "on_contract_violation": "halt_and_report",
          "on_miss": "halt",
          "on_missing_required_path": "halt_and_report",
          "on_soft_misalignment": "auto_fix_and_continue"
        },
        "inputs": [
          "competitors.shops[]"
        ],
        "label": "Competitor Listings Upload",
        "name": "Competitor Listings Upload",
        "next": [
          "7",
          "8A",
          "8B"
        ],
        "on_error": {
          "fallback_next": [
            "7"
          ],
          "policy": "fail-soft"
        },
        "outputs": [
          "competitors.products[]",
          "competitors.keywords[]",
          "competitors.signals{}",
          "competitors.*"
        ],
        "params": {
          "extract_fields": [
            "title",
            "tags",
            "price",
            "category",
            "reviews",
            "sales?"
          ],
          "fetch_products": true,
          "max_products_per_shop": 200
        },
        "preconditions": {
          "critical_pass": {
            "require_ancestors_done": [
              "0",
              "1",
              "3",
              "6",
              "16"
            ]
          },
          "parent_defined": {
            "exists": true,
            "path": "/workflow_patches/steps/6"
          }
        },
        "requires": [
          "6"
        ],
        "ruleset": {
          "column_map": {
            "Shop|Shop name|Seller": "shop",
            "Tags|Tag list|Keywords": "tags",
            "Title|Listing title": "title"
          },
          "dedup": {
            "by": [
              "listing_id",
              "shop"
            ],
            "only_if_listing_id_present": true
          },
          "derive_listing_id": {
            "from_url": {
              "candidates": [
                "URL",
                "Url",
                "listing_url",
                "Listing URL",
                "link"
              ],
              "regex": "/listing/(\\d+)"
            },
            "prefer": [
              "listing_id",
              "Listing ID",
              "id"
            ]
          },
          "realign": {
            "if_currency_in_title": true
          }
        },
        "title": "Competitor Listings Upload",
        "upstream_signature": {
          "policy": "mark_stale_on_upstream_change"
        },
        "validations": {
          "signals.non_empty": true
        },
        "await_user": true,
        "require_user_confirm": true,
        "no_skip": true,
        "ui_ext": {
          "token_tracking": true
        }
      },
      "6b": {
        "kind": "csv_clean:competitor",
        "name": "6b",
        "ruleset": {
          "dedup": {
            "approx_by": [
              "shop",
              "title"
            ],
            "by": [
              "listing_id",
              "shop"
            ],
            "threshold": 0.92
          },
          "policy": {
            "add_missing": false,
            "keep_extras": true,
            "mode": "forgiving",
            "on_mismatch": "silent",
            "reorder_known": true
          }
        },
        "title": "Competitor Listings Clean (Dedup + Normalize)",
        "constraints": {
          "require_csv": true,
          "empty_intake": "RUN FAIL"
        },
        "await_user": true,
        "require_user_confirm": true,
        "no_skip": true,
        "ui_ext": {
          "token_tracking": true
        }
      },
      "7": {
        "constraints": {
          "bias_correction": "penalize single-shop dominance",
          "min_segments": 3,
          "must_confirm": false,
          "no_derivation": true,
          "no_skip": true,
          "require_gpt_task": false,
          "require_user_task": false,
          "require_validations_pass": false
        },
        "description": "Rakip mağaza ve liste analizleri; anahtar kelimeleri materyal/kullanım/kitle temalarında kümeler; arz–talep boşluklarını çıkarır; Ads için pozitif/negatif çekirdek setini üretir. Girdiler: 5a (pazar+trend), 6/6a (CSV/sinyaller). Çıkış: 8 ve 18’e handoff.",
        "flow": {
          "guard": {
            "advance_only_if": []
          }
        },
        "gates": {
          "must": [
            "validations_ok"
          ],
          "on_contract_violation": "halt_and_report",
          "on_miss": "halt",
          "on_missing_required_path": "halt_and_report",
          "on_soft_misalignment": "auto_fix_and_continue"
        },
        "guards": {
          "market_aggregation": {
            "include_negative_keywords": true
          }
        },
        "hitl_contract": {
          "gpt_tasks": [],
          "user_tasks": []
        },
        "inputs": [
          "keywords.pool.ranked[]",
          "keywords.focus[1..4].provisional",
          "draft.title",
          "draft.tags[13]",
          "top_listings.merged",
          "top_listings.keyword_metrics{}",
          "focus.reorder_suggestion",
          "popular.products.top[]",
          "popular.keywords.top[]",
          "popular.segments.summary{}",
          "competitors.selected[]",
          "competitors.profiles{}",
          "alura.metrics"
        ],
        "name": "Rakip Analizi & Ads Çekirdeği",
        "outputs": [
          "market.snapshot{}",
          "ads.seed.positive[]",
          "ads.seed.negative[]",
          "market.notes"
        ],
        "preconditions": {
          "critical_pass": {
            "require_ancestors_done": [
              "0",
              "1",
              "3",
              "6",
              "16"
            ]
          }
        },
        "requires": [
          "5b"
        ],
        "rules": [
          "cluster keywords into themes by material/use_case/audience (+gemstone/style/color/price)",
          "analyze demand-supply gaps: pool vs. popular",
          "ads.seed.positive = high score/conv, pazar uyumlu, rakiplerde kanıtlı",
          "ads.seed.negative = ['DIY','free','tutorial','plated*','kit','supplies','raw*'] + rakip gürültü",
          "prioritize intents: Purchase > Occasion > Material/Style"
        ],
        "ruleset": {
          "missing_metric_policy": {
            "missing_as_zero": true,
            "renormalize_weights": true,
            "warn_only": true
          },
          "weights": {
            "monthly_sales": 0.0
          }
        },
        "title": "Rakip Analizi & Ads Çekirdeği",
        "upstream_signature": {
          "policy": "mark_stale_on_upstream_change"
        },
        "validations": {
          "present": true
        },
        "label": "Rakip Analizi & Ads Çekirdeği",
        "await_user": true,
        "require_user_confirm": true,
        "no_skip": true,
        "json_title": "Rakip Analizi & Ads Çekirdeği",
        "ui_ext": {
          "token_tracking": true
        }
      },
      "8": {
        "constraints": {
          "must_confirm": false,
          "no_skip": true,
          "require_gpt_task": false,
          "require_user_task": false,
          "require_validations_pass": false
        },
        "description": "5a/5b ve 7 çıktılarından kampanya/ad group planını oluşturur; 8B'ye temiz, onaylı plan sağlar.",
        "flow": {
          "guard": {
            "advance_only_if": []
          }
        },
        "gates": {
          "must": [
            "validations_ok"
          ],
          "on_contract_violation": "halt_and_report",
          "on_miss": "halt",
          "on_missing_required_path": "halt_and_report",
          "on_soft_misalignment": "auto_fix_and_continue"
        },
        "hitl_contract": {
          "gpt_tasks": [],
          "user_tasks": []
        },
        "inputs": [
          "popular.products.top[]",
          "popular.keywords.top[]",
          "market.aggregation{}",
          "seed.terms[]",
          "negative_terms.base[]"
        ],
        "name": "Market Aggregation & Ads Generation",
        "outputs": [
          "ads_plan.csv",
          "negative_keywords.csv",
          "campaign_settings.json",
          "ads_plan.status"
        ],
        "preconditions": {
          "critical_pass": {
            "require_ancestors_done": [
              "0",
              "1",
              "3",
              "6",
              "16"
            ]
          }
        },
        "requires": [
          "7"
        ],
        "rules": [
          {
            "id": "8A_GROUPING",
            "title": "Ürün→Campaign/AdGroup eşleme; çeşitlilik koru"
          },
          {
            "id": "8A_SEED_MATCHTYPES",
            "title": "Seed'leri phrase/exact dağıt; genişleme yok"
          },
          {
            "id": "8A_NEGATIVES",
            "title": "Negatif liste uygula (marka/düşük niyet)"
          },
          {
            "id": "8A_BUDGET_GEO",
            "title": "Bütçe & lokasyon öner; onay şart"
          },
          {
            "id": "8A_DUPE_CLEAN",
            "title": "Çift/benzer seed temizliği (exact+semantic)"
          }
        ],
        "ruleset": {
          "missing_metric_policy": {
            "missing_as_zero": true,
            "renormalize_weights": true,
            "warn_only": true
          }
        },
        "title": "Market Aggregation & Ads Generation",
        "upstream_signature": {
          "policy": "mark_stale_on_upstream_change"
        },
        "validations": {
          "present": true
        },
        "label": "Market Aggregation & Ads Generation",
        "await_user": true,
        "require_user_confirm": true,
        "no_skip": true,
        "ui_ext": {
          "token_tracking": true
        }
      },
      "8a": {
        "constraints": {
          "min_segments_per_group": 1,
          "must_confirm": false,
          "near_duplicate_limit": 1,
          "no_derivation": true,
          "no_skip": true,
          "require_gpt_task": false,
          "require_user_task": false,
          "require_validations_pass": false
        },
        "description": "7. adımdaki çekirdek setlerden Etsy Ads için plan üretilir.",
        "flow": {
          "guard": {
            "advance_only_if": []
          }
        },
        "gates": {
          "must": [
            "validations_ok"
          ],
          "on_contract_violation": "halt_and_report",
          "on_miss": "halt",
          "on_missing_required_path": "halt_and_report",
          "on_soft_misalignment": "auto_fix_and_continue"
        },
        "guards": {
          "ads_keywords": {
            "ctr_check": true,
            "relevance_check": true
          }
        },
        "hitl_contract": {
          "gpt_tasks": [],
          "user_tasks": []
        },
        "inputs": [
          "ads.seed.positive[]",
          "ads.seed.negative[]",
          "popular.products.top[]",
          "popular.keywords.top[]",
          "top_listings.*",
          "competitors.*",
          "keywords.pool.ranked[]",
          "keywords.focus[1..4]"
        ],
        "name": "Ads Keyword Generation (Plan + Anahtarlar)",
        "outputs": [
          "ads.plan{}",
          "ads.keywords.final[]",
          "ads.negative_terms[]",
          "ab_test.plan",
          "ads.governance.notes"
        ],
        "preconditions": {
          "critical_pass": {
            "require_ancestors_done": [
              "0",
              "1",
              "3",
              "6",
              "16"
            ]
          },
          "parent_defined": {
            "exists": true,
            "path": "/workflow_patches/steps/8"
          }
        },
        "requires": [
          "8A"
        ],
        "rules": [
          "map segments to AdGroups (Purchase/Occasion/Material-Style/Audience)",
          "select high conv/score, non-duplicate keywords per group",
          "ads.negative_terms = seed + competitor noise terms",
          "ab_test.window_days in [14,30]; single_variable = true",
          "pause if ROAS<1.0 and Clicks>=20",
          "boost if ROAS>=target and Orders>=3"
        ],
        "ruleset": [
          {
            "id": "ADGROUP_SEGMENT_MAPPING",
            "params": {
              "groups": [
                "Purchase",
                "Occasion",
                "Material-Style",
                "Audience"
              ]
            }
          },
          {
            "id": "AB_TEST_WINDOW_DAYS",
            "params": {
              "max": 30,
              "min": 14
            }
          },
          {
            "id": "PAUSE_RULE",
            "params": {
              "clicks_gte": 20,
              "roas_lt": 1.0
            }
          },
          {
            "id": "BOOST_RULE",
            "params": {
              "orders_gte": 3,
              "roas_gte": "target"
            }
          },
          {
            "id": "NO_DERIVATION",
            "params": {
              "enforced": true
            }
          },
          {
            "id": "NEAR_DUP_LIMIT",
            "params": {
              "max_per_group": 1
            }
          },
          {
            "id": "PRODUCT_RECORD_CONFIRMED_REQUIRED",
            "params": {
              "source": "product_record",
              "status": "CONFIRMED"
            }
          }
        ],
        "title": "Ads Keyword Generation (Plan + Anahtarlar)",
        "upstream_signature": {
          "policy": "mark_stale_on_upstream_change"
        },
        "validations": {
          "present": true
        },
        "label": "Ads Keyword Generation (Plan + Anahtarlar)",
        "await_user": true,
        "require_user_confirm": true,
        "no_skip": true,
        "ui_ext": {
          "token_tracking": true
        }
      },
      "9": {
        "constraints": {
          "min_segments": 3,
          "must_confirm": false,
          "near_duplicate_limit": 1,
          "negatives": [
            "DIY",
            "free",
            "tutorial",
            "plated*",
            "kit",
            "supplies",
            "raw*"
          ],
          "no_derivation": true,
          "no_skip": true,
          "require_gpt_task": false,
          "require_user_task": false,
          "require_validations_pass": false
        },
        "description": "SEO için odak ve destek anahtar setleri kesinleştirilir; başlık/etiket uyumu sağlanır.",
        "flow": {
          "guard": {
            "advance_only_if": []
          }
        },
        "gates": {
          "must": [
            "validations_ok"
          ],
          "on_contract_violation": "halt_and_report",
          "on_miss": "halt",
          "on_missing_required_path": "halt_and_report",
          "on_soft_misalignment": "auto_fix_and_continue"
        },
        "guards": {
          "seo_refinement": {
            "balance": [
              "focus",
              "support",
              "long_tail"
            ],
            "diversity_required": true
          }
        },
        "hitl_contract": {
          "gpt_tasks": [],
          "user_tasks": []
        },
        "inputs": [
          "keywords.pool.ranked[]",
          "keywords.focus[1..4]",
          "draft.title",
          "draft.tags[13]",
          "market.snapshot{}",
          "ads.keywords.final[]",
          "popular.keywords.top[]",
          "top_listings.keyword_metrics{}",
          "alura.metrics"
        ],
        "kind": "meta_enrich",
        "name": "SEO Keyword Refinement",
        "outputs": [
          "seo.keywords.focus[]",
          "seo.keywords.supporting[]",
          "seo.rejected[]",
          "seo.notes"
        ],
        "preconditions": {
          "critical_pass": {
            "require_ancestors_done": [
              "0",
              "1",
              "3",
              "6",
              "16"
            ]
          }
        },
        "requires": [
          "8B"
        ],
        "rules": [
          "validate focus_1..4 with market/performance overlap",
          "construct supporting set from long-tail/niche keywords",
          "avoid duplication: no repeated roots across title/tags",
          "no duplicates with category attributes",
          "record rationale for each acceptance/rejection"
        ],
        "ruleset": {
          "noop_if_missing": true,
          "normalize": {
            "strip_extra_spaces": true,
            "unicode_nfc": true
          },
          "note": "Light metadata enrichment; does not block flow."
        },
        "title": "SEO Keyword Refinement",
        "upstream_signature": {
          "policy": "mark_stale_on_upstream_change"
        },
        "validations": {
          "present": true
        },
        "label": "SEO Keyword Refinement",
        "await_user": true,
        "require_user_confirm": true,
        "no_skip": true,
        "requires_input_from": [
          "8B",
          "8C"
        ],
        "ui_ext": {
          "token_tracking": true
        }
      },
      "ab.1": {
        "enabled": false,
        "gates": {
          "on_soft_misalignment": "auto_fix_and_continue"
        },
        "kind": "analyze_market",
        "label": "Experiment: A/B Titles & Tags",
        "name": "ab_testing_titles_tags",
        "notes": {
          "origin": "workshop",
          "promoted_at": "2025-09-09T18:11:47.783512Z",
          "source": "workshop/promotion"
        },
        "output": {
          "digest_only": true
        },
        "requires": [],
        "ruleset": {
          "NO_FABRICATION": true,
          "method": "clone_listing",
          "single_variable": true,
          "test_window_days": 14
        },
        "status": "draft",
        "ui": {
          "hidden": true
        },
        "await_user": true,
        "require_user_confirm": true,
        "no_skip": true,
        "ui_ext": {
          "token_tracking": true
        }
      },
      "ads.1": {
        "enabled": false,
        "gates": {
          "on_soft_misalignment": "auto_fix_and_continue"
        },
        "kind": "analyze_market",
        "label": "Optimize: Etsy Ads ROAS Loop",
        "name": "etsy_ads_roas_loop",
        "notes": {
          "origin": "workshop",
          "promoted_at": "2025-09-09T18:11:47.783512Z",
          "source": "workshop/promotion"
        },
        "output": {
          "digest_only": true
        },
        "requires": [],
        "ruleset": {
          "NO_FABRICATION": true,
          "budget_focus": "top_converting_listings",
          "data_window_days": 14,
          "kpis": [
            "Impressions",
            "CTR",
            "CPC",
            "Orders",
            "ROAS"
          ],
          "negative_terms_action": "turn_off_low_quality_queries"
        },
        "status": "draft",
        "ui": {
          "hidden": true
        },
        "await_user": true,
        "require_user_confirm": true,
        "no_skip": true,
        "ui_ext": {
          "token_tracking": true
        }
      },
      "kw.1": {
        "enabled": false,
        "gates": {
          "on_soft_misalignment": "auto_fix_and_continue"
        },
        "kind": "analyze_market",
        "label": "Learn/Discover: Alura-driven Keyword Set",
        "name": "keyword_research_alura",
        "notes": {
          "origin": "workshop",
          "promoted_at": "2025-09-09T18:11:47.783512Z",
          "source": "workshop/promotion"
        },
        "output": {
          "digest_only": true
        },
        "requires": [],
        "ruleset": {
          "NO_FABRICATION": true,
          "quality": {
            "avoid_cannibalization": true,
            "long_tail_bias": true
          },
          "selection": {
            "max_competition": "<= medium",
            "min_search_volume": ">= medium",
            "prefer_high_conversion": true,
            "require_relevance": true
          }
        },
        "status": "draft",
        "ui": {
          "hidden": true
        },
        "await_user": true,
        "require_user_confirm": true,
        "no_skip": true,
        "ui_ext": {
          "token_tracking": true
        }
      },
      "media.1": {
        "enabled": false,
        "gates": {
          "hi_res_required": true,
          "lifestyle_or_scale_shot": true,
          "min_images": 5,
          "on_soft_misalignment": "auto_fix_and_continue",
          "short_video_recommended": true
        },
        "kind": "compliance_check",
        "label": "Gate: Image/Video Quality for CTR",
        "name": "imagery_quality_gate",
        "notes": {
          "origin": "workshop",
          "promoted_at": "2025-09-09T18:11:47.783512Z",
          "source": "workshop/promotion"
        },
        "output": {
          "digest_only": true
        },
        "requires": [],
        "ruleset": {
          "NO_MISLEADING": true
        },
        "status": "draft",
        "ui": {
          "hidden": true
        },
        "await_user": true,
        "require_user_confirm": true,
        "no_skip": true,
        "ui_ext": {
          "token_tracking": true
        }
      },
      "seo.1": {
        "enabled": false,
        "gates": {
          "on_soft_misalignment": "auto_fix_and_continue"
        },
        "kind": "generate_title",
        "label": "Apply: Title/Tags/Attributes Harmony",
        "name": "title_tags_attributes_hard_rules",
        "notes": {
          "origin": "workshop",
          "promoted_at": "2025-09-09T18:11:47.783512Z",
          "source": "workshop/promotion"
        },
        "output": {
          "digest_only": true
        },
        "requires": [],
        "ruleset": {
          "NO_STUFFING": true,
          "TITLE_LENGTH": [
            80,
            140
          ],
          "attributes": {
            "no_attr_dup_in_tags": true,
            "treat_as_bonus_tags": true
          },
          "tags": {
            "no_duplicates": true,
            "use_all_13": true,
            "variety_over_repetition": true,
            "unique": true,
            "unique_root": true,
            "length_max_per_tag": 20,
            "prefer_multi_word": true,
            "min_words": 2,
            "max_words": 3,
            "locale_synonyms": {
              "en-US": {
                "jewelry": [
                  "jewellery"
                ],
                "color": [
                  "colour"
                ]
              },
              "en-GB": {
                "jewellery": [
                  "jewelry"
                ],
                "colour": [
                  "color"
                ]
              }
            },
            "attr_dup_strict": true,
            "attr_sources": [
              "bindings.attr_colors[]",
              "bindings.attr_sizes_us",
              "bindings.attr_variations[]",
              "bindings.attr_stone"
            ],
            "ip_filters": {
              "forbid_terms": [
                "free shipping",
                "%",
                "discount",
                "on sale"
              ],
              "forbid_entity_types": [
                "brand",
                "celebrity"
              ]
            }
          },
          "title": {
            "front_load": true,
            "mobile_first_40chars": true
          }
        },
        "status": "draft",
        "ui": {
          "hidden": true
        },
        "await_user": true,
        "require_user_confirm": true,
        "no_skip": true,
        "bindings": {
          "locale": {
            "__REF__": "/workflow_patches/steps/0/product_info/ads/target_locale"
          },
          "attr_colors[]": {
            "__REF__": "/workflow_patches/steps/0/product_info/fixed_product/colors[]"
          },
          "attr_sizes_us": {
            "__REF__": "/workflow_patches/steps/0/product_info/fixed_product/sizes_us"
          },
          "attr_variations[]": {
            "__REF__": "/workflow_patches/steps/0/product_info/fixed_product/variations[]"
          },
          "attr_stone": {
            "__REF__": "/workflow_patches/steps/0/product_info/fixed_product/stone_policy"
          }
        },
        "ui_ext": {
          "token_tracking": true
        }
      },
      "seo_package": {
        "constraints": {
          "desc_word_count_max": 500,
          "desc_word_count_min": 300,
          "must_confirm": false,
          "no_derivation": true,
          "no_skip": true,
          "par_max": 5,
          "par_min": 2,
          "require_gpt_task": false,
          "require_user_task": false,
          "require_validations_pass": false,
          "title_max_chars": 140,
          "title_min_chars": 80
        },
        "description": "Başlık (10), Açıklama (11) ve Etiketler (12) çıktılarının birlikte kalite kontrolü yapılır.",
        "flow": {
          "guard": {
            "advance_only_if": []
          }
        },
        "gates": {
          "must": [
            "validations_ok"
          ],
          "on_contract_violation": "halt_and_report",
          "on_miss": "halt",
          "on_missing_required_path": "halt_and_report",
          "on_soft_misalignment": "warn_and_continue"
        },
        "governance": {
          "notes_required": true,
          "qc_checklist": [
            "title_frontload_focus",
            "title_length_ok",
            "desc_paragraphs_ok",
            "desc_word_count_ok",
            "tags_13_unique",
            "tags_segment_diversity",
            "no_root_duplicates",
            "no_negatives"
          ]
        },
        "inputs": [
          "draft.title",
          "draft.description",
          "draft.tags[13]",
          "seo.keywords.focus[]",
          "seo.keywords.supporting[]",
          "alura.metrics",
          "popular.keywords.top[]",
          "top_listings.keyword_metrics{}"
        ],
        "name": "SEO Package QC",
        "outputs": [
          "seo_package.qc_report",
          "seo_package.issues[]",
          "seo_package.recommendations[]"
        ],
        "preconditions": {
          "critical_pass": {
            "require_ancestors_done": [
              "0",
              "1",
              "3",
              "6",
              "16"
            ]
          }
        },
        "rules": [
          "title: 80-140 chars, front-load focus_1, no stuffing, no ALL CAPS",
          "description: 300-500 words, 2-5 paragraphs, first sentence includes focus_1, scannable (short paragraphs, bullets)",
          "tags: 13 unique, >=3 segments (material/use_case/audience), no duplicates with category attributes, max 1 same-root",
          "all three outputs aligned thematically",
          "exclude negatives: ['DIY','free','tutorial','plated*','kit','supplies','raw*']"
        ],
        "ruleset": [
          {
            "id": "TITLE_LENGTH_RANGE",
            "params": {
              "max": 140,
              "min": 80
            }
          },
          {
            "id": "DESC_WORDCOUNT_RANGE",
            "params": {
              "max": 500,
              "min": 300
            }
          },
          {
            "id": "DESC_PARAGRAPHS_RANGE",
            "params": {
              "max": 5,
              "min": 2
            }
          },
          {
            "id": "TAGS_COUNT_13",
            "params": {
              "count": 13
            }
          },
          {
            "id": "SEGMENT_DIVERSITY_MIN",
            "params": {
              "min": 3
            }
          },
          {
            "id": "NO_ROOT_DUPLICATES",
            "params": {
              "enforced": true
            }
          },
          {
            "id": "NEGATIVE_TERMS",
            "params": {
              "terms": [
                "DIY",
                "free",
                "tutorial",
                "plated*",
                "kit",
                "supplies",
                "raw*"
              ]
            }
          }
        ],
        "title": "SEO Package QC (Title + Description + Tags)",
        "upstream_signature": {
          "policy": "mark_stale_on_upstream_change"
        },
        "validations": {
          "present": true
        },
        "await_user": true,
        "require_user_confirm": true,
        "no_skip": true,
        "ui_ext": {
          "token_tracking": true
        }
      },
      "trend.1": {
        "enabled": false,
        "gates": {
          "on_soft_misalignment": "auto_fix_and_continue"
        },
        "kind": "analyze_market",
        "label": "Discover: Seasonal & Niche Trends",
        "name": "seasonal_niche_scanner",
        "notes": {
          "origin": "workshop",
          "promoted_at": "2025-09-09T18:11:47.783512Z",
          "source": "workshop/promotion"
        },
        "output": {
          "digest_only": true
        },
        "requires": [],
        "ruleset": {
          "NO_FABRICATION": true,
          "history_graph_check": true,
          "preload_keywords_by_season": true
        },
        "status": "draft",
        "ui": {
          "hidden": true
        },
        "await_user": true,
        "require_user_confirm": true,
        "no_skip": true,
        "ui_ext": {
          "token_tracking": true
        }
      },
      "5c": {
        "title": "Rakip Mağaza Önerileri (8)",
        "description": "Top Listings çıktılarına göre mağaza öneri havuzu (strict/medium/loose).",
        "stop_for_confirmation": true,
        "constraints": {
          "requires_input_from": [
            "5",
            "5a",
            "5b"
          ]
        },
        "name": "Rakip Mağaza Önerileri (8)",
        "label": "Rakip Mağaza Önerileri (8)",
        "await_user": true,
        "require_user_confirm": true,
        "no_skip": true,
        "ui_ext": {
          "token_tracking": true
        }
      },
      "12a": {
        "enabled": true,
        "ui_ext": {
          "token_tracking": true
        }
      },
      "8B": {
        "name": "Ads Sync – Positive Set",
        "enabled": true,
        "inputs": [],
        "outputs": [
          "ads.seed.positive[]"
        ],
        "requires_input_from": [],
        "ui_ext": {
          "token_tracking": true
        }
      },
      "8C": {
        "name": "Ads Sync – Negative Set",
        "enabled": true,
        "inputs": [],
        "outputs": [
          "ads.seed.negative[]"
        ],
        "requires_input_from": [],
        "ui_ext": {
          "token_tracking": true
        }
      }
    },
    "steps_defaults": {
      "gates": {
        "on_soft_misalignment": "auto_fix_and_continue"
      },
      "output": {
        "digest_only": true
      },
      "preprocess": {
        "dialect": {
          "lineterminator": "auto"
        },
        "normalize": {
          "strip_bom": true
        }
      },
      "await_user": true,
      "require_user_confirm": true,
      "no_skip": true
    },
    "steps_index": {
      "18a": "18a",
      "Ads Entegrasyonu & Final Keyword Sync": "15",
      "Ads Keyword Generation": "8a",
      "Aggregate": "8",
      "Arama Önerileri": "1b",
      "Audit": "20",
      "Açıklama (Description)": "11",
      "Başlık (Title)": "10",
      "Etiketler (Tags)": "12",
      "Export CSV/Excel": "17",
      "Final Listing Assembly / Publish Prep": "16",
      "Görsel Analiz (+13 SEO Uyumu, arka planda)": "1a",
      "Görsel QC (moved to 1a, kept as background)": "13",
      "Görsel Yükleme": "1",
      "Market Aggregation & Ads Prep": "7",
      "Monitoring": "19",
      "Odak Anahtar Kelime + Havuz": "3a",
      "Popüler Ürünler Analizi": "5",
      "Pre-Run Prep (Light, arka planda)": "0a",
      "Product Info (read-only)": "0",
      "Publish Checklist": "18",
      "Rakip Mağaza Analizi": "6a",
      "Rakip Mağaza CSV Yükleme": "6",
      "Rakip Mağaza Seçimi": "5b",
      "SEO Keyword Refinement": "9",
      "SEO Package QC": "seo_package",
      "Self-Check (arka planda)": "00",
      "Similar CSV Yükleme": "3",
      "Taslak Paket (Title, Desc, Tags)": "3b",
      "Top Listings Upload": "4",
      "Uyumluluk Kontrolü (Compliance)": "14"
    },
    "steps_locks": {
      "0": {
        "locked": true,
        "owner": "user:@mcinar1905",
        "unlock_via": "/_admin/unlock_request"
      },
      "00": {
        "locked": true,
        "owner": "user:@mcinar1905",
        "unlock_via": "/_admin/unlock_request"
      },
      "0a": {
        "locked": true,
        "owner": "user:@mcinar1905",
        "unlock_via": "/_admin/unlock_request"
      },
      "1": {
        "locked": true,
        "owner": "user:@mcinar1905",
        "unlock_via": "/_admin/unlock_request"
      },
      "10": {
        "locked": false,
        "owner": "user:@mcinar1905",
        "unlock_actor": "gpt_prod_executor_v1",
        "unlock_authorized_by": "user:@mcinar1905",
        "unlock_via": "/_admin/unlock_request",
        "unlocked_at": "2025-09-09T18:09:16.385835Z"
      },
      "11": {
        "locked": false,
        "owner": "user:@mcinar1905",
        "unlock_actor": "gpt_prod_executor_v1",
        "unlock_authorized_by": "user:@mcinar1905",
        "unlock_via": "/_admin/unlock_request",
        "unlocked_at": "2025-09-09T18:09:16.385835Z"
      },
      "12": {
        "locked": true,
        "owner": "user:@mcinar1905",
        "unlock_via": "/_admin/unlock_request"
      },
      "13": {
        "locked": true,
        "owner": "user:@mcinar1905",
        "unlock_via": "/_admin/unlock_request"
      },
      "14": {
        "locked": false,
        "owner": "user:@mcinar1905",
        "unlock_actor": "gpt_prod_executor_v1",
        "unlock_authorized_by": "user:@mcinar1905",
        "unlock_via": "/_admin/unlock_request",
        "unlocked_at": "2025-09-09T18:09:16.385835Z"
      },
      "15": {
        "locked": false,
        "owner": "user:@mcinar1905",
        "unlock_actor": "gpt_prod_executor_v1",
        "unlock_authorized_by": "user:@mcinar1905",
        "unlock_via": "/_admin/unlock_request",
        "unlocked_at": "2025-09-09T18:09:16.385835Z"
      },
      "16": {
        "locked": true,
        "owner": "user:@mcinar1905",
        "unlock_via": "/_admin/unlock_request"
      },
      "17": {
        "locked": true,
        "owner": "user:@mcinar1905",
        "unlock_via": "/_admin/unlock_request"
      },
      "18": {
        "locked": true,
        "owner": "user:@mcinar1905",
        "unlock_via": "/_admin/unlock_request"
      },
      "18a": {
        "locked": true,
        "owner": "user:@mcinar1905",
        "unlock_via": "/_admin/unlock_request"
      },
      "19": {
        "locked": true,
        "owner": "user:@mcinar1905",
        "unlock_via": "/_admin/unlock_request"
      },
      "1a": {
        "locked": true,
        "owner": "user:@mcinar1905",
        "unlock_via": "/_admin/unlock_request"
      },
      "1b": {
        "locked": true,
        "owner": "user:@mcinar1905",
        "unlock_via": "/_admin/unlock_request"
      },
      "20": {
        "locked": true,
        "owner": "user:@mcinar1905",
        "unlock_via": "/_admin/unlock_request"
      },
      "3": {
        "locked": true,
        "owner": "user:@mcinar1905",
        "unlock_via": "/_admin/unlock_request"
      },
      "3a": {
        "locked": true,
        "owner": "user:@mcinar1905",
        "unlock_via": "/_admin/unlock_request"
      },
      "3b": {
        "locked": true,
        "owner": "user:@mcinar1905",
        "unlock_via": "/_admin/unlock_request"
      },
      "4": {
        "locked": true,
        "owner": "user:@mcinar1905",
        "unlock_via": "/_admin/unlock_request"
      },
      "5": {
        "locked": true,
        "owner": "user:@mcinar1905",
        "unlock_via": "/_admin/unlock_request"
      },
      "5a": {
        "locked": true,
        "owner": "user:@mcinar1905",
        "unlock_via": "/_admin/unlock_request"
      },
      "5b": {
        "locked": true,
        "owner": "user:@mcinar1905",
        "unlock_via": "/_admin/unlock_request"
      },
      "6": {
        "locked": true,
        "owner": "user:@mcinar1905",
        "unlock_via": "/_admin/unlock_request"
      },
      "6a": {
        "locked": true,
        "owner": "user:@mcinar1905",
        "unlock_via": "/_admin/unlock_request"
      },
      "7": {
        "locked": true,
        "owner": "user:@mcinar1905",
        "unlock_via": "/_admin/unlock_request"
      },
      "8": {
        "locked": true,
        "owner": "user:@mcinar1905",
        "unlock_via": "/_admin/unlock_request"
      },
      "8a": {
        "locked": true,
        "owner": "user:@mcinar1905",
        "unlock_via": "/_admin/unlock_request"
      },
      "9": {
        "locked": true,
        "owner": "user:@mcinar1905",
        "unlock_via": "/_admin/unlock_request"
      },
      "ab.1": {
        "locked": true,
        "owner": "user:@mcinar1905",
        "unlock_via": "/_admin/unlock_request"
      },
      "ads.1": {
        "locked": true,
        "owner": "user:@mcinar1905",
        "unlock_via": "/_admin/unlock_request"
      },
      "kw.1": {
        "locked": true,
        "owner": "user:@mcinar1905",
        "unlock_via": "/_admin/unlock_request"
      },
      "media.1": {
        "locked": true,
        "owner": "user:@mcinar1905",
        "unlock_via": "/_admin/unlock_request"
      },
      "seo.1": {
        "locked": true,
        "owner": "user:@mcinar1905",
        "unlock_via": "/_admin/unlock_request"
      },
      "seo_package": {
        "locked": true,
        "owner": "user:@mcinar1905",
        "unlock_via": "/_admin/unlock_request"
      },
      "trend.1": {
        "locked": true,
        "owner": "user:@mcinar1905",
        "unlock_via": "/_admin/unlock_request"
      }
    },
    "steps_registry_lock": {
      "forbid_delete": true,
      "forbid_rename": true,
      "keys": [
        "0",
        "00",
        "0a",
        "1",
        "1a",
        "1b",
        "3",
        "3a",
        "3b",
        "4",
        "4a",
        "4b",
        "5",
        "5a",
        "5b",
        "5c",
        "6",
        "6a",
        "7",
        "8",
        "8a",
        "9",
        "10",
        "11",
        "12",
        "13",
        "14",
        "15",
        "16",
        "17",
        "18",
        "18a",
        "19",
        "20"
      ]
    },
    "token_tracking": {
      "audit": true,
      "members": [
        "mcinar1905"
      ],
      "quota": "full",
      "team": "gpt_prod_executor_v1"
    },
    "ui": {
      "global_banner": "Batch {counter}/5 • Kalan: {minutes_left} dk",
      "global_banner_rendered": "Batch 0/5 • Kalan: 60 dk",
      "system_prompt": "",
      "token_banner": "Token {percent}% • Limit {limit}",
      "token_banner_rendered": "Token 0.0% • Limit 128000"
    },
    "workshop": {
      "authoring_guide": {
        "text": "STEPS & SUBSTEPS WORKSHOP\n- Amaç: Adımları/alt adımları JSON içinde güvenle tasarlayıp yayınlamadan önce denemek.\n- Kavramlar:\n  • backlog: Taslak adımlar (manifest dışında, çalıştırılmaz).\n  • promote: Taslakları gerçek adım tanımlarına ve manifester eklemeye dönüştürme.\n  • templates: Kısa yol; registry/step_kinds ile eşleştir.\n- Kurallar:\n  • backlog.status ∈ {draft, ready, deprecated}\n  • promote yalnız 'ready' için; 'enabled' varsayılan false, manifest'e ekleme opsiyoneldir.\n  • publish akışı etkilenmez; digest-only davranışı korunur.\n"
      },
      "backlog": [
        {
          "gates": {
            "on_soft_misalignment": "auto_fix_and_continue"
          },
          "id": "learn.a",
          "kind": "analyze_market",
          "label": "Learn: Material Vocabulary",
          "name": "learn_material_vocab",
          "notes": {
            "origin": "workshop"
          },
          "output": {
            "digest_only": true
          },
          "requires": [],
          "status": "draft",
          "ui": {
            "hidden": true
          }
        },
        {
          "gates": {
            "on_soft_misalignment": "auto_fix_and_continue"
          },
          "id": "discover.a",
          "kind": "analyze_market",
          "label": "Discover: Competitor Gaps",
          "name": "discover_competitor_gaps",
          "notes": {
            "origin": "workshop"
          },
          "output": {
            "digest_only": true
          },
          "requires": [],
          "status": "draft",
          "ui": {
            "hidden": true
          }
        },
        {
          "gates": {
            "on_soft_misalignment": "auto_fix_and_continue"
          },
          "id": "apply.a",
          "kind": "seo_tags",
          "label": "Apply: SEO Tags",
          "name": "apply_seo_tags",
          "notes": {
            "origin": "workshop"
          },
          "output": {
            "digest_only": true
          },
          "requires": [],
          "status": "draft",
          "ui": {
            "hidden": true
          }
        },
        {
          "gates": {
            "on_soft_misalignment": "auto_fix_and_continue"
          },
          "id": "kw.1",
          "kind": "analyze_market",
          "label": "Learn/Discover: Alura-driven Keyword Set",
          "name": "keyword_research_alura",
          "notes": {
            "origin": "workshop"
          },
          "output": {
            "digest_only": true
          },
          "requires": [],
          "ruleset": {
            "quality": {
              "avoid_cannibalization": true,
              "long_tail_bias": true
            },
            "selection": {
              "max_competition": "<= medium",
              "min_search_volume": ">= medium",
              "prefer_high_conversion": true,
              "require_relevance": true
            }
          },
          "status": "ready",
          "ui": {
            "hidden": true
          }
        },
        {
          "gates": {
            "on_soft_misalignment": "auto_fix_and_continue"
          },
          "id": "seo.1",
          "kind": "generate_title",
          "label": "Apply: Title/Tags/Attributes Harmony",
          "name": "title_tags_attributes_hard_rules",
          "notes": {
            "origin": "workshop"
          },
          "output": {
            "digest_only": true
          },
          "requires": [],
          "ruleset": {
            "attributes": {
              "no_attr_dup_in_tags": true,
              "treat_as_bonus_tags": true
            },
            "tags": {
              "no_duplicates": true,
              "use_all_13": true,
              "variety_over_repetition": true
            },
            "title": {
              "front_load": true,
              "mobile_first_40chars": true
            }
          },
          "status": "ready",
          "ui": {
            "hidden": true
          }
        },
        {
          "gates": {
            "hi_res_required": true,
            "lifestyle_or_scale_shot": true,
            "min_images": 5,
            "short_video_recommended": true
          },
          "id": "media.1",
          "kind": "compliance_check",
          "label": "Gate: Image/Video Quality for CTR",
          "name": "imagery_quality_gate",
          "notes": {
            "origin": "workshop"
          },
          "output": {
            "digest_only": true
          },
          "requires": [],
          "status": "ready",
          "ui": {
            "hidden": true
          }
        },
        {
          "gates": {
            "on_soft_misalignment": "auto_fix_and_continue"
          },
          "id": "ads.1",
          "kind": "analyze_market",
          "label": "Optimize: Etsy Ads ROAS Loop",
          "name": "etsy_ads_roas_loop",
          "notes": {
            "origin": "workshop"
          },
          "output": {
            "digest_only": true
          },
          "requires": [],
          "ruleset": {
            "budget_focus": "top_converting_listings",
            "data_window_days": 14,
            "kpis": [
              "Impressions",
              "CTR",
              "CPC",
              "Orders",
              "ROAS"
            ],
            "negative_terms_action": "turn_off_low_quality_queries"
          },
          "status": "ready",
          "ui": {
            "hidden": true
          }
        },
        {
          "gates": {
            "on_soft_misalignment": "auto_fix_and_continue"
          },
          "id": "ab.1",
          "kind": "analyze_market",
          "label": "Experiment: A/B Titles & Tags",
          "name": "ab_testing_titles_tags",
          "notes": {
            "origin": "workshop"
          },
          "output": {
            "digest_only": true
          },
          "requires": [],
          "ruleset": {
            "method": "clone_listing",
            "single_variable": true,
            "test_window_days": 14
          },
          "status": "ready",
          "ui": {
            "hidden": true
          }
        },
        {
          "gates": {
            "on_soft_misalignment": "auto_fix_and_continue"
          },
          "id": "trend.1",
          "kind": "analyze_market",
          "label": "Discover: Seasonal & Niche Trends",
          "name": "seasonal_niche_scanner",
          "notes": {
            "origin": "workshop"
          },
          "output": {
            "digest_only": true
          },
          "requires": [],
          "ruleset": {
            "history_graph_check": true,
            "preload_keywords_by_season": true
          },
          "status": "ready",
          "ui": {
            "hidden": true
          }
        }
      ],
      "backlog_spec_schema": {
        "defaults": {
          "gates": {
            "on_soft_misalignment": "auto_fix_and_continue"
          },
          "notes": {
            "origin": "workshop"
          },
          "output": {
            "digest_only": true
          },
          "requires": [],
          "status": "draft",
          "ui": {
            "hidden": true
          }
        },
        "fields": [
          "id",
          "name",
          "label",
          "kind",
          "requires",
          "ruleset",
          "gates",
          "output",
          "ui",
          "status",
          "notes"
        ],
        "kind_ref": "/workflow_patches/registry/step_kinds"
      },
      "bulk_add": {
        "examples": [
          {
            "id": "learn.1",
            "kind": "analyze_market",
            "label": "Learn: Intent Map",
            "name": "learn_intent_map"
          },
          {
            "id": "discover.1",
            "kind": "analyze_market",
            "label": "Discover: Keyword Clusters",
            "name": "discover_keyword_clusters"
          },
          {
            "id": "apply.1",
            "kind": "generate_title",
            "label": "Apply: Title Rules",
            "name": "apply_title_rules"
          }
        ],
        "pending_names": [
          "(buraya senin liste… örn: 'learn_material_vocab', 'discover_competitor_gaps', 'apply_seo_tags')"
        ]
      },
      "promotion": {
        "rules": {
          "add_to_manifest": false,
          "enabled_default": false,
          "position": "after:last_defined",
          "substep_suffix_policy": "alpha"
        },
        "strategy": "manual_confirm"
      }
    },
    "global": {
      "commit_gate": {
        "policy": {
          "v1": {
            "rules": {
              "hard": [
                {
                  "id": "halt_if_unresolved_runtime_refs",
                  "code": "CG-RUNTIME-REFS",
                  "desc": "Advance is blocked when runtime unresolved __REF__ exists.",
                  "when": {
                    "path": "/_runtime/refs/unresolved_count",
                    "op": ">",
                    "value": 0
                  },
                  "action": "HALT"
                }
              ]
            }
          }
        }
      }
    }
  },
  "versioning": {
    "schema": "v6.fix.portable.enforced+patch2",
    "changelog": [
      {
        "ts": "2025-09-17T08:55:57.277477Z",
        "who": "system",
        "what": "applied 9 enforcement proposals excluding min-bytes guard"
      }
    ]
  },
  "_runtime": {
    "queue_workers": {
      "orchestrator": {
        "start": {
          "execution_order_ref": "/step_flow_lock/canonical_order"
        }
      }
    },
    "pricing": {
      "sources": {
        "discount_percent_ref": {
          "__REF__": "/workflow_patches/steps/0/product_info/fixed_product/discount_percent_hidden"
        },
        "variations_ref": {
          "__REF__": "/workflow_patches/steps/0/product_info/fixed_product/variations"
        }
      },
      "policy": {
        "use_effective_for_similarity": true,
        "rounding": {
          "currency": "USD",
          "precision": 2
        }
      },
      "effective": {
        "by_karat": {
          "__COMPUTED__": "price_usd * (1 - discount_percent/100) grouped by 'karat'"
        },
        "avg_price_usd": {
          "__COMPUTED__": "mean(effective.by_karat[*].price_usd)"
        }
      },
      "landed_cost_note": "Fiyat, gümrük ve vergileri içerir (DDP). ABD gönderilerinde sürpriz ödeme yoktur."
    },
    "mappings": {
      "price_band_reference": {
        "__REF__": "/_runtime/pricing/effective/avg_price_usd"
      },
      "price_band_tolerance": 0.3
    },
    "policy_overrides": {
      "media": {
        "video_required": "optional",
        "min_images_required": 8,
        "strict_qc": {
          "images": {
            "min_side_px": 2000,
            "first_photo_min_longest_px": 635,
            "first_shape_allowed": [
              "landscape",
              "square"
            ],
            "thumbnail_aspect_ratio": "4:3",
            "min_images_required": 8
          },
          "alt_text": {
            "enabled": true,
            "max_chars": 250,
            "rule": "describe_visuals_no_keyword_stuffing"
          },
          "video": {
            "suggest_if_missing": true,
            "duration_sec": {
              "min": 15,
              "max": 60
            },
            "guidelines": [
              "no audio required",
              "show usage/context",
              "steady framing"
            ]
          }
        },
        "platform_reco": {
          "video": {
            "preferred_duration_sec": {
              "min": 3,
              "max": 15
            },
            "resolution_min": {
              "height_px": 1080
            },
            "silent_preferred": true,
            "on_missing": "WARN"
          }
        }
      },
      "seasonal": {
        "enabled": true,
        "mode": "additive",
        "windows_ref": {
          "__REF__": "/_runtime/seasonal/windows"
        },
        "apply_to": {
          "__REF__": "/_runtime/seasonal/apply_to"
        },
        "weights": {
          "christmas": {
            "keywords_boost": {
              "gift": 0.3,
              "holiday": 0.2,
              "stocking": 0.15
            },
            "description_scenarios": {
              "extra_seed_weight": 0.25
            },
            "tags": {
              "segment_priorities": {
                "occasion": 1.0,
                "attribute": 0.0,
                "voice": 0.0
              }
            }
          },
          "valentines": {
            "keywords_boost": {
              "valentine": 0.35,
              "romantic": 0.25
            },
            "description_scenarios": {
              "extra_seed_weight": 0.25
            },
            "tags": {
              "segment_priorities": {
                "occasion": 1.0,
                "attribute": 0.0,
                "voice": 0.0
              }
            }
          },
          "mothers_day": {
            "keywords_boost": {
              "mother": 0.3,
              "mom": 0.25,
              "gift": 0.2,
              "thank you": 0.15
            },
            "description_scenarios": {
              "extra_seed_weight": 0.2
            },
            "tags": {
              "segment_priorities": {
                "occasion": 1.0,
                "attribute": 0.0,
                "voice": 0.0
              }
            }
          },
          "fathers_day": {
            "keywords_boost": {
              "father": 0.3,
              "dad": 0.25,
              "gift for him": 0.2
            },
            "description_scenarios": {
              "extra_seed_weight": 0.2
            },
            "tags": {
              "segment_priorities": {
                "occasion": 1.0,
                "attribute": 0.0,
                "voice": 0.0
              }
            }
          },
          "black_friday": {
            "keywords_boost": {
              "black friday": 0.35,
              "holiday": 0.2,
              "gift": 0.2
            },
            "description_scenarios": {
              "extra_seed_weight": 0.2
            },
            "tags": {
              "segment_priorities": {
                "occasion": 1.0,
                "attribute": 0.0,
                "voice": 0.0
              }
            }
          },
          "cyber_monday": {
            "keywords_boost": {
              "cyber monday": 0.35,
              "holiday": 0.2,
              "gift": 0.2
            },
            "description_scenarios": {
              "extra_seed_weight": 0.2
            },
            "tags": {
              "segment_priorities": {
                "occasion": 1.0,
                "attribute": 0.0,
                "voice": 0.0
              }
            }
          },
          "new_year": {
            "keywords_boost": {
              "new year": 0.3,
              "january": 0.15,
              "fresh start": 0.15,
              "gift": 0.15
            },
            "description_scenarios": {
              "extra_seed_weight": 0.15
            },
            "tags": {
              "segment_priorities": {
                "occasion": 1.0,
                "attribute": 0.0,
                "voice": 0.0
              }
            }
          },
          "graduation": {
            "keywords_boost": {
              "graduation gift": 0.35,
              "class of": 0.2,
              "congrats": 0.15
            },
            "description_scenarios": {
              "extra_seed_weight": 0.2
            },
            "tags": {
              "segment_priorities": {
                "occasion": 1.0,
                "attribute": 0.0,
                "voice": 0.0
              }
            }
          },
          "wedding_season": {
            "keywords_boost": {
              "wedding": 0.3,
              "bridal": 0.25,
              "bridesmaid gift": 0.2
            },
            "description_scenarios": {
              "extra_seed_weight": 0.2
            },
            "tags": {
              "segment_priorities": {
                "occasion": 1.0,
                "attribute": 0.0,
                "voice": 0.0
              }
            }
          }
        }
      },
      "tags_pipeline": {
        "alignment_override": {
          "with_title": {
            "min_exact_phrases": 2
          },
          "scope": "global"
        }
      },
      "text_mappings": {
        "shipping": {
          "tracking_true_phrase": "Takip numarası sağlanır",
          "apply_in": [
            "description",
            "export"
          ],
          "notes": "Boolean tracking=true is rendered as phrase for outputs."
        }
      },
      "title": {
        "generation": {
          "forbidden_fields": [
            "returns"
          ],
          "forbidden_terms": [
            "iade",
            "iade:",
            "15 gün",
            "return",
            "returns",
            "free returns"
          ],
          "notes": "Do NOT include returns policy/duration in titles."
        }
      }
    },
    "validators": {
      "description": {
        "lang": "en-US",
        "paragraphs": 3,
        "word_count": {
          "min": 300,
          "max": 500
        },
        "tone": "professional_warm",
        "forbidden_terms": [
          "Turkey",
          "Istanbul"
        ],
        "no_turkish_chars": true,
        "no_keyword_stuffing": true,
        "scenarios": {
          "enabled": true,
          "min_bullets": 3,
          "max_bullets": 5,
          "min_words_per_bullet": 4,
          "max_words_per_bullet": 18
        }
      }
    },
    "description_layout": {
      "blocks": [
        {
          "id": "intro",
          "requires": [
            "keywords.focus_1"
          ]
        },
        {
          "id": "product_details",
          "from": {
            "__REF__": "/workflow_patches/steps/0/product_info/fixed_product"
          },
          "fields": [
            "karat",
            "colors",
            "sizes_us",
            "stone_policy"
          ]
        },
        {
          "id": "usage_occasion",
          "requires": [
            "keywords.supporting"
          ]
        },
        {
          "id": "care_durability"
        },
        {
          "id": "shipping_trust",
          "from": {
            "__REF__": "/workflow_patches/steps/0/product_info/logistics"
          }
        }
      ]
    },
    "seasonal": {
      "preload_keywords_by_season": true,
      "windows": [
        {
          "name": "christmas",
          "from": "11-01",
          "to": "12-26",
          "seeds": [
            "christmas gift",
            "holiday jewelry",
            "stocking stuffer"
          ]
        },
        {
          "name": "valentines",
          "from": "01-15",
          "to": "02-15",
          "seeds": [
            "valentine gift",
            "romantic jewelry"
          ]
        },
        {
          "name": "mothers_day",
          "from": "05-01",
          "to": "05-14",
          "seeds": [
            "mother's day gift",
            "gift for mom",
            "thank you mom",
            "jewelry for mom"
          ]
        },
        {
          "name": "fathers_day",
          "from": "06-01",
          "to": "06-21",
          "seeds": [
            "father's day gift",
            "gift for him",
            "dad gift"
          ]
        },
        {
          "name": "black_friday",
          "from": "11-20",
          "to": "11-30",
          "seeds": [
            "black friday jewelry",
            "holiday gift",
            "doorbuster gift"
          ]
        },
        {
          "name": "cyber_monday",
          "from": "11-28",
          "to": "12-03",
          "seeds": [
            "cyber monday jewelry",
            "holiday gift",
            "online deal"
          ]
        },
        {
          "name": "new_year",
          "from": "12-26",
          "to": "01-05",
          "seeds": [
            "new year jewelry",
            "fresh start",
            "january gift"
          ]
        },
        {
          "name": "graduation",
          "from": "05-15",
          "to": "06-30",
          "seeds": [
            "graduation gift",
            "class of",
            "congrats gift"
          ]
        },
        {
          "name": "wedding_season",
          "from": "04-15",
          "to": "09-15",
          "seeds": [
            "wedding jewelry",
            "bridal gift",
            "bridesmaid gift"
          ]
        }
      ],
      "apply_to": [
        "ads",
        "seo",
        "tags"
      ]
    },
    "export": {
      "v2": {
        "columns_additional": [
          "price_effective_usd",
          "sku",
          "quantity"
        ],
        "price_effective_usd_ref": {
          "__REF__": "/_runtime/pricing/effective/avg_price_usd"
        },
        "status": "disabled"
      }
    },
    "bridges": {
      "similarity": {
        "price_band": {
          "ref_price": {
            "__REF__": "/_runtime/mappings/price_band_reference"
          },
          "tolerance": {
            "__REF__": "/_runtime/mappings/price_band_tolerance"
          },
          "use_effective": {
            "__REF__": "/_runtime/pricing/policy/use_effective_for_similarity"
          }
        }
      },
      "media_qc": {
        "video_required": {
          "__REF__": "/_runtime/policy_overrides/media/video_required"
        },
        "min_images_required": {
          "__REF__": "/_runtime/policy_overrides/media/min_images_required"
        },
        "strict_ref": {
          "__REF__": "/_runtime/policy_overrides/media/strict_qc"
        },
        "platform_reco_ref": {
          "__REF__": "/_runtime/policy_overrides/media/platform_reco"
        }
      },
      "description": {
        "layout_ref": {
          "__REF__": "/_runtime/description_layout/blocks"
        },
        "validators_ref": {
          "__REF__": "/_runtime/validators/description"
        },
        "scenarios_ref": {
          "__REF__": "/_runtime/description_scenarios"
        },
        "people_first_ref": {
          "__REF__": "/_runtime/description_people_first"
        },
        "language_consistency_ref": {
          "__REF__": "/_runtime/language_consistency"
        }
      },
      "seasonal": {
        "enabled": {
          "__REF__": "/_runtime/seasonal/preload_keywords_by_season"
        },
        "windows_ref": {
          "__REF__": "/_runtime/seasonal/windows"
        },
        "apply_to": {
          "__REF__": "/_runtime/seasonal/apply_to"
        },
        "weights_ref": {
          "__REF__": "/_runtime/policy_overrides/seasonal/weights"
        }
      },
      "export": {
        "v2": {
          "status": {
            "__REF__": "/_runtime/export/v2/status"
          },
          "columns_additional": {
            "__REF__": "/_runtime/export/v2/columns_additional"
          },
          "price_effective_usd_ref": {
            "__REF__": "/_runtime/export/v2/price_effective_usd_ref"
          }
        }
      },
      "bind_points": {
        "step_5_top_listings": {
          "price_band_ref": {
            "__REF__": "/_runtime/bridges/similarity/price_band/ref_price"
          },
          "tolerance_ref": {
            "__REF__": "/_runtime/bridges/similarity/price_band/tolerance"
          }
        },
        "step_6_competitor_listings": {
          "price_band_ref": {
            "__REF__": "/_runtime/bridges/similarity/price_band/ref_price"
          },
          "tolerance_ref": {
            "__REF__": "/_runtime/bridges/similarity/price_band/tolerance"
          },
          "policy_denylist_ref": {
            "__REF__": "/_runtime/bridges/compliance/denylist_ref"
          },
          "policy_denylist_seeds_ref": {
            "__REF__": "/_runtime/bridges/compliance/denylist_seeds_ref"
          }
        },
        "step_7_market_aggregation": {
          "seasonal_enabled": {
            "__REF__": "/_runtime/bridges/seasonal/enabled"
          },
          "seasonal_active_name": {
            "__REF__": "/_runtime/bridges/calendar_switch/active/name"
          },
          "shipping_cost_guard_ref": {
            "__REF__": "/_runtime/shipping_cost_guard"
          },
          "shipping_report_sink_ref": {
            "__REF__": "/_runtime/bridges/report_sinks/shipping_guard"
          },
          "shipping_signals_ref": {
            "__REF__": "/_runtime/shipping_cost_guard/signals"
          }
        },
        "step_9_seo_keyword_refinement": {
          "seasonal_windows": {
            "__REF__": "/_runtime/bridges/seasonal/windows_ref"
          },
          "seasonal_weights": {
            "__REF__": "/_runtime/bridges/seasonal/weights_ref"
          },
          "seasonal_weights_active": {
            "__REF__": "/_runtime/bridges/calendar_switch/active/weights"
          },
          "tags_pipeline_ref": {
            "__REF__": "/_runtime/tags_pipeline"
          },
          "tags_hard_gates_ref": {
            "__REF__": "/_runtime/tags_pipeline/hard_gates"
          },
          "tags_report_sink_ref": {
            "__REF__": "/_runtime/bridges/report_sinks/tags_hard_gates"
          },
          "attributes_coverage_gate_ref": {
            "__REF__": "/_runtime/attributes_coverage_gate"
          },
          "policy_denylist_ref": {
            "__REF__": "/_runtime/bridges/compliance/denylist_ref"
          },
          "tags_pipeline_overrides_ref": {
            "__REF__": "/_runtime/bridges/tags_pipeline/overrides_ref"
          },
          "policy_denylist_seeds_ref": {
            "__REF__": "/_runtime/bridges/compliance/denylist_seeds_ref"
          }
        },
        "step_10_title_generation": {
          "description_layout": {
            "__REF__": "/_runtime/bridges/description/layout_ref"
          },
          "seasonal_weights": {
            "__REF__": "/_runtime/bridges/seasonal/weights_ref"
          },
          "seasonal_weights_active": {
            "__REF__": "/_runtime/bridges/calendar_switch/active/weights"
          },
          "title_guidelines_ref": {
            "__REF__": "/_runtime/bridges/title/guidelines_ref"
          },
          "title_report_sink_ref": {
            "__REF__": "/_runtime/bridges/report_sinks/title_guidelines"
          },
          "title_generation_overrides_ref": {
            "__REF__": "/_runtime/bridges/title_overrides/generation_ref"
          },
          "preflight_hints_ref": {
            "__REF__": "/_runtime/bridges/preflight/hints_ref"
          }
        },
        "step_11_description_generation": {
          "validators": {
            "__REF__": "/_runtime/bridges/description/validators_ref"
          },
          "layout": {
            "__REF__": "/_runtime/bridges/description/layout_ref"
          },
          "seasonal_weights": {
            "__REF__": "/_runtime/bridges/seasonal/weights_ref"
          },
          "seasonal_weights_active": {
            "__REF__": "/_runtime/bridges/calendar_switch/active/weights"
          },
          "people_first_ref": {
            "__REF__": "/_runtime/bridges/description/people_first_ref"
          },
          "language_consistency_ref": {
            "__REF__": "/_runtime/bridges/description/language_consistency_ref"
          },
          "description_report_sink_ref": {
            "__REF__": "/_runtime/bridges/report_sinks/description_people_first"
          },
          "text_mappings_ref": {
            "__REF__": "/_runtime/bridges/policy_notes/text_mappings_ref"
          },
          "returns_policy_ref": {
            "__REF__": "/_runtime/bridges/policy_notes/returns_policy_ref"
          },
          "shipping_and_returns_section_ref": {
            "__REF__": "/_runtime/bridges/templates/description/shipping_and_returns_ref"
          },
          "preflight_hints_ref": {
            "__REF__": "/_runtime/bridges/preflight/hints_ref"
          },
          "preflight_profile_ref": {
            "__REF__": "/_runtime/bridges/preflight/profile_ref"
          },
          "tariff_notice_section_ref": {
            "__REF__": "/_runtime/bridges/templates/description/tariff_notice_ref"
          }
        },
        "step_12_tags_generation": {
          "seasonal_apply_to": {
            "__REF__": "/_runtime/bridges/seasonal/apply_to"
          },
          "seasonal_weights": {
            "__REF__": "/_runtime/bridges/seasonal/weights_ref"
          },
          "seasonal_weights_active": {
            "__REF__": "/_runtime/bridges/calendar_switch/active/weights"
          },
          "tags_pipeline_ref": {
            "__REF__": "/_runtime/tags_pipeline"
          },
          "tags_selection_report_sink_ref": {
            "__REF__": "/_runtime/bridges/report_sinks/tags_selection"
          },
          "tags_pipeline_overrides_ref": {
            "__REF__": "/_runtime/bridges/tags_pipeline/overrides_ref"
          },
          "preflight_hints_ref": {
            "__REF__": "/_runtime/bridges/preflight/hints_ref"
          }
        },
        "step_8_visual_analysis": {
          "media_qc_strict": {
            "__REF__": "/_runtime/bridges/media_qc/strict_ref"
          },
          "report_sink_ref": {
            "__REF__": "/_runtime/bridges/report_sinks/visual_qc"
          },
          "media_platform_reco_ref": {
            "__REF__": "/_runtime/bridges/media_qc/platform_reco_ref"
          }
        },
        "step_17_export": {
          "remote_cache_ref": {
            "__REF__": "/_runtime/bridges/remote_cache/github_raw_main_ref"
          },
          "remote_source_ref": {
            "__REF__": "/_runtime/bridges/remote_cache/github_raw_source_ref"
          },
          "remote_cache_report_sink_ref": {
            "__REF__": "/_runtime/bridges/report_sinks/remote_cache"
          },
          "text_mappings_ref": {
            "__REF__": "/_runtime/bridges/policy_notes/text_mappings_ref"
          },
          "returns_policy_ref": {
            "__REF__": "/_runtime/bridges/policy_notes/returns_policy_ref"
          },
          "preflight_report_ref": {
            "__REF__": "/_runtime/bridges/preflight/report_ref"
          }
        },
        "step_0_product_info": {
          "remote_cache_ref": {
            "__REF__": "/_runtime/bridges/remote_cache/github_raw_main_ref"
          },
          "remote_cache_report_sink_ref": {
            "__REF__": "/_runtime/bridges/report_sinks/remote_cache"
          },
          "ui_review_paths_patch_ref": {
            "__REF__": "/_runtime/bridges/ui_patches/step0_review_paths_add_ref"
          }
        },
        "step_16_listing_assemble": {
          "preflight_report_ref": {
            "__REF__": "/_runtime/bridges/preflight/report_ref"
          }
        },
        "step_18_pre_publish": {
          "preflight_report_ref": {
            "__REF__": "/_runtime/bridges/preflight/report_ref"
          }
        },
        "step_00_system_boot": {
          "preflight_report_ref": {
            "__REF__": "/_runtime/bridges/preflight/report_ref"
          },
          "preflight_profile_ref": {
            "__REF__": "/_runtime/bridges/preflight/profile_ref"
          },
          "preflight_hints_ref": {
            "__REF__": "/_runtime/bridges/preflight/hints_ref"
          },
          "preflight_run_plan_ref": {
            "__REF__": "/_runtime/reports/preflight/run_plan"
          },
          "preflight_fingerprints_ref": {
            "__REF__": "/_runtime/knowledge/preflight_fingerprints"
          },
          "preflight_index_ref": {
            "__REF__": "/_runtime/knowledge/preflight_index"
          },
          "memory_guard_ref": {
            "__REF__": "/_runtime/exec/memory_guard"
          },
          "preflight_run_plan_extra_ref": {
            "__REF__": "/_runtime/reports/preflight/run_plan_extra"
          }
        },
        "run_order": {
          "views": {
            "index_ref": {
              "__REF__": "/_run_order/steps"
            },
            "list_ref": {
              "__REF__": "/_run_order/steps_list_snapshot"
            }
          }
        },
        "step_3_upload": {
          "preprocess_ref": {
            "__REF__": "/_csv_rules/similar_keywords_csv"
          }
        },
        "step_5_upload": {
          "preprocess_ref": {
            "__REF__": "/_csv_rules/top_listings_csv"
          }
        },
        "step_6_upload": {
          "preprocess_ref": {
            "__REF__": "/_csv_rules/competitor_csv"
          }
        }
      },
      "calendar_switch": {
        "enabled": true,
        "clock": {
          "timezone": "UTC",
          "now": {
            "__COMPUTED__": "today('UTC')"
          }
        },
        "windows_ref": {
          "__REF__": "/_runtime/seasonal/windows"
        },
        "weights_ref": {
          "__REF__": "/_runtime/bridges/seasonal/weights_ref"
        },
        "mode": "single_best",
        "priority": [
          "black_friday",
          "cyber_monday",
          "christmas",
          "valentines",
          "mothers_day",
          "fathers_day",
          "graduation",
          "wedding_season",
          "new_year"
        ],
        "active": {
          "name": {
            "__COMPUTED__": "season_name_from_windows(clock.now, windows_ref, priority)"
          },
          "window": {
            "__COMPUTED__": "season_window_for(active.name)"
          },
          "weights": {
            "__COMPUTED__": "weights_ref[active.name]"
          }
        }
      },
      "title": {
        "guidelines_ref": {
          "__REF__": "/_runtime/title_guidelines"
        }
      },
      "report_sinks": {
        "visual_qc": {
          "__REF__": "/_runtime/reports/visual_qc"
        },
        "shipping_guard": {
          "__REF__": "/_runtime/reports/shipping_guard"
        },
        "tags_hard_gates": {
          "__REF__": "/_runtime/reports/tags_hard_gates"
        },
        "title_guidelines": {
          "__REF__": "/_runtime/reports/title_guidelines"
        },
        "description_people_first": {
          "__REF__": "/_runtime/reports/description_people_first"
        },
        "tags_selection": {
          "__REF__": "/_runtime/reports/tags_selection"
        },
        "remote_cache": {
          "__REF__": "/_runtime/reports/remote_cache"
        }
      },
      "compliance": {
        "denylist_ref": {
          "__REF__": "/_runtime/compliance/denylist"
        },
        "denylist_seeds_ref": {
          "__REF__": "/_runtime/compliance/denylist_seeds"
        }
      },
      "tags_pipeline": {
        "overrides_ref": {
          "__REF__": "/_runtime/policy_overrides/tags_pipeline/alignment_override"
        }
      },
      "remote_cache": {
        "github_raw_main_ref": {
          "__REF__": "/_runtime/remote_sources/mirrors/github_raw_main"
        },
        "github_raw_source_ref": {
          "__REF__": "/_runtime/remote_sources/sources/github_raw_main"
        }
      },
      "ui_patches": {
        "step0_review_paths_add_ref": {
          "__REF__": "/_runtime/ui_patches/steps/0/review_paths_add"
        }
      },
      "policy_notes": {
        "text_mappings_ref": {
          "__REF__": "/_runtime/policy_overrides/text_mappings"
        },
        "returns_policy_ref": {
          "__REF__": "/_store_profile/returns"
        }
      },
      "templates": {
        "description": {
          "shipping_and_returns_ref": {
            "__REF__": "/_runtime/content_templates/description/sections/shipping_and_returns"
          },
          "tariff_notice_ref": {
            "__REF__": "/_runtime/content_templates/description/sections/tariff_notice"
          }
        }
      },
      "title_overrides": {
        "generation_ref": {
          "__REF__": "/_runtime/policy_overrides/title/generation"
        }
      },
      "preflight": {
        "report_ref": {
          "__REF__": "/_runtime/reports/preflight"
        },
        "profile_ref": {
          "__REF__": "/_runtime/knowledge/preflight_profile"
        },
        "hints_ref": {
          "__REF__": "/_runtime/triggers/hints"
        }
      }
    },
    "description_scenarios": {
      "enabled": true,
      "position_hint": {
        "after_block_id": "usage_occasion"
      },
      "format": {
        "type": "bullets",
        "min": 3,
        "max": 5,
        "sentence_case": true
      },
      "language": "en-US",
      "tonality": "professional_warm",
      "forbidden_terms": [
        "Turkey",
        "Istanbul"
      ],
      "validators": {
        "min_bullets": 3,
        "max_bullets": 5,
        "min_words_per_bullet": 4,
        "max_words_per_bullet": 18
      },
      "examples": [
        "Everyday office wear — low-profile comfort that layers cleanly.",
        "Gift-ready choice for birthdays, anniversaries, or graduations.",
        "Pairs with engagement or wedding sets without visual clutter."
      ]
    },
    "tags_pipeline": {
      "enabled": true,
      "sources": {
        "from_csv": {
          "top_listings": {
            "__COMPUTED__": "discover_csv_source('top_listings')"
          },
          "competitor_listings": {
            "__COMPUTED__": "discover_csv_source('competitor_listings')"
          },
          "similar_keywords": {
            "__COMPUTED__": "discover_csv_source('similar_keywords')"
          }
        },
        "seasonal_weights_ref": {
          "__REF__": "/_runtime/bridges/calendar_switch/active/weights"
        }
      },
      "normalize": {
        "locale": "en-US",
        "case": "lower",
        "strip_punctuation": true,
        "strip_stopwords": true,
        "dedupe": {
          "by_root": true
        }
      },
      "alignment": {
        "with_title": {
          "min_exact_phrases": 1
        },
        "with_description": {
          "min_similarity": 0.7
        },
        "forbidden_terms": [
          "Turkey",
          "Istanbul"
        ]
      },
      "scoring": {
        "weights": {
          "title_exact": 0.45,
          "market_freq": 0.25,
          "competitor_cover": 0.15,
          "long_tail": 0.1,
          "season_weight": 0.05
        }
      },
      "selection": {
        "target_count": 13,
        "multiword_min_ratio": 0.7,
        "same_root_limit": 1,
        "segments": {
          "title_aligned": 4,
          "intent_scenarios": 4,
          "attributes": 3,
          "seasonal_or_niche": 2
        }
      },
      "guards": {
        "unique": true,
        "no_duplicate_with_category_attributes": true,
        "no_keyword_stuffing": true
      },
      "hard_gates": {
        "no_attribute_root_dup": true,
        "intent_scenarios_min": 4
      }
    },
    "title_guidelines": {
      "locale": "en-US",
      "max_chars": 140,
      "style": {
        "natural_phrase": true,
        "avoid_comma_list": true,
        "no_all_caps": true
      },
      "alignment": {
        "must_include_focus": true,
        "optional_season_hint": {
          "enabled": true,
          "max_tokens": 2,
          "only_if_season_weight_gte": 0.2
        }
      }
    },
    "description_people_first": {
      "checks": [
        "clear_benefit_first_paragraph",
        "scannable_structure",
        "avoid_keyword_stuffing",
        "accurate_attributes_from_step0",
        "include_care_and_shipping_info"
      ],
      "pass_threshold": 4
    },
    "language_consistency": {
      "expected_locale": "en-US",
      "detect_locale": {
        "__COMPUTED__": "detect_locale(description)"
      },
      "actions": {
        "on_mismatch": "request_manual_translation"
      }
    },
    "shipping_cost_guard": {
      "enabled": true,
      "by_market": {
        "US": {
          "warn_above_usd": 6.99,
          "hard_fail_above_usd": 14.99,
          "suggestions": [
            "offer_free_shipping_threshold",
            "optimize_packaging_weight",
            "bundle_items_for_rate_efficiency"
          ]
        }
      },
      "signals": {
        "prefer_free_shipping": true,
        "promo_hint": "If WARN, suggest free-shipping threshold."
      }
    },
    "reports": {
      "config": {
        "retention": {
          "max_entries_per_sink": 200,
          "rotate": true
        },
        "format": {
          "timestamp": "iso8601",
          "id_field": "listing_id"
        }
      },
      "visual_qc": {
        "counters": {
          "total": 0,
          "pass": 0,
          "warn": 0,
          "fail": 0
        },
        "last_run": {
          "started_at": null,
          "ended_at": null
        },
        "log": [],
        "strict_policy_ref": {
          "__REF__": "/_runtime/policy_overrides/media/strict_qc"
        }
      },
      "shipping_guard": {
        "counters": {
          "total": 0,
          "warn": 0,
          "fail": 0
        },
        "last_run": {
          "started_at": null,
          "ended_at": null
        },
        "log": [],
        "thresholds_ref": {
          "__REF__": "/_runtime/shipping_cost_guard/by_market/US"
        }
      },
      "tags_hard_gates": {
        "counters": {
          "checked": 0,
          "blocked_attribute_dup": 0,
          "below_intent_min": 0
        },
        "last_run": {
          "started_at": null,
          "ended_at": null
        },
        "log": [],
        "gates_ref": {
          "__REF__": "/_runtime/tags_pipeline/hard_gates"
        }
      },
      "title_guidelines": {
        "counters": {
          "checked": 0,
          "violations": 0
        },
        "last_run": {
          "started_at": null,
          "ended_at": null
        },
        "log": [],
        "guidelines_ref": {
          "__REF__": "/_runtime/title_guidelines"
        }
      },
      "description_people_first": {
        "counters": {
          "checked": 0,
          "passed": 0,
          "failed": 0
        },
        "last_run": {
          "started_at": null,
          "ended_at": null
        },
        "log": [],
        "checks_ref": {
          "__REF__": "/_runtime/description_people_first/checks"
        }
      },
      "tags_selection": {
        "counters": {
          "runs": 0
        },
        "last_run": {
          "started_at": null,
          "ended_at": null
        },
        "log": [],
        "pipeline_ref": {
          "__REF__": "/_runtime/tags_pipeline"
        }
      },
      "schema_demo": {
        "common_fields": {
          "id": "string",
          "listing_id": "string",
          "timestamp": "iso8601"
        },
        "visual_qc": {
          "entry": {
            "id": "demo-visualqc-0001",
            "listing_id": "LISTING_DEMO_123",
            "timestamp": "2025-01-01T00:00:00Z",
            "image_checks": {
              "min_side_ok": true,
              "first_photo_min_ok": true,
              "shape_ok": true,
              "thumb_ar_ok": true,
              "count_ok": true
            },
            "alt_text": {
              "generated": true,
              "max_chars_respected": true
            },
            "video": {
              "present": false,
              "suggested": true
            },
            "status": "WARN",
            "notes": "Video missing; suggest 15–60s usage clip."
          }
        },
        "shipping_guard": {
          "entry": {
            "id": "demo-shipping-0001",
            "listing_id": "LISTING_DEMO_123",
            "timestamp": "2025-01-01T00:00:00Z",
            "market": "US",
            "shipping_price_usd": 9.99,
            "thresholds": {
              "warn_above_usd": 6.99,
              "hard_fail_above_usd": 14.99
            },
            "status": "WARN",
            "suggestions_applied": [
              "offer_free_shipping_threshold"
            ]
          }
        },
        "tags_hard_gates": {
          "entry": {
            "id": "demo-tagsgates-0001",
            "listing_id": "LISTING_DEMO_123",
            "timestamp": "2025-01-01T00:00:00Z",
            "attribute_overlap_blocks": 1,
            "intent_scenarios_count": 3,
            "gates": {
              "no_attribute_root_dup": true,
              "intent_scenarios_min": 4
            },
            "blocked_reasons": [
              "below_intent_min"
            ],
            "status": "FAIL"
          }
        },
        "title_guidelines": {
          "entry": {
            "id": "demo-title-0001",
            "listing_id": "LISTING_DEMO_123",
            "timestamp": "2025-01-01T00:00:00Z",
            "violations": [
              "avoid_comma_list"
            ],
            "computed": {
              "length": 127,
              "has_focus": true
            },
            "status": "WARN"
          }
        },
        "description_people_first": {
          "entry": {
            "id": "demo-descpf-0001",
            "listing_id": "LISTING_DEMO_123",
            "timestamp": "2025-01-01T00:00:00Z",
            "checks": {
              "clear_benefit_first_paragraph": true,
              "scannable_structure": true,
              "avoid_keyword_stuffing": true,
              "accurate_attributes_from_step0": true,
              "include_care_and_shipping_info": false
            },
            "passed_count": 4,
            "pass_threshold": 4,
            "status": "PASS",
            "notes": "All good; add care/shipping line to strengthen."
          }
        },
        "tags_selection": {
          "entry": {
            "id": "demo-tagsel-0001",
            "listing_id": "LISTING_DEMO_123",
            "timestamp": "2025-01-01T00:00:00Z",
            "candidates_considered": 58,
            "selected_tags": [
              "14k dainty gold ring",
              "minimalist gold band",
              "stackable ring",
              "gift for her",
              "everyday jewelry",
              "delicate ring",
              "thin gold ring",
              "anniversary gift",
              "dainty stacking ring",
              "simple gold ring",
              "fine gold jewelry",
              "valentine gift",
              "handmade gold ring"
            ],
            "segment_counts": {
              "title_aligned": 4,
              "intent_scenarios": 4,
              "attributes": 3,
              "seasonal_or_niche": 2
            },
            "guards": {
              "unique": true,
              "multiword_ratio_ok": true,
              "same_root_limit_ok": true
            },
            "top_candidates_sample": [
              {
                "tag": "14k gold band",
                "score": 0.82,
                "reasons": [
                  "title_exact",
                  "market_freq"
                ]
              },
              {
                "tag": "delicate gold ring",
                "score": 0.79,
                "reasons": [
                  "long_tail",
                  "competitor_cover"
                ]
              }
            ],
            "status": "PASS"
          }
        }
      },
      "remote_cache": {
        "counters": {
          "pulls": 0,
          "cache_hits": 0,
          "fresh_writes": 0,
          "errors": 0
        },
        "last_run": {
          "started_at": null,
          "ended_at": null
        },
        "log": [],
        "refs": {
          "source_ref": {
            "__REF__": "/_runtime/remote_sources/sources/github_raw_main"
          },
          "mirror_ref": {
            "__REF__": "/_runtime/remote_sources/mirrors/github_raw_main"
          }
        },
        "entry_schema_demo": {
          "id": "rc-2025-01-01T00:00:00Z",
          "timestamp": "2025-01-01T00:00:00Z",
          "cache_key": "github_raw_main",
          "url": "https://raw.githubusercontent.com/…/file.json",
          "action": "fetch|cache_used|write|failover",
          "status": "OK|WARN|ERROR",
          "http_status": 200,
          "etag": "W/\"abc123\"",
          "last_modified": "Sat, 20 Sep 2025 12:00:00 GMT",
          "bytes": 123456,
          "sha256": "…",
          "note": "Fetched fresh and wrote to mirror."
        }
      },
      "preflight": {
        "status": "INIT",
        "summary": {
          "steps_scanned": 0,
          "csv_rules_scanned": 0,
          "schemas_scanned": 0,
          "runtime_objects_scanned": 0
        },
        "report": {
          "missing_inputs": [],
          "inconsistent_deps": [],
          "array_shrink_risk": [],
          "policy_gaps": [],
          "schema_refs_missing": [],
          "csv_headers_gaps": [],
          "runtime_vs_order_mismatch": [],
          "denylist_collisions": []
        },
        "last_run": {
          "started_at": null,
          "ended_at": null
        },
        "refs": {
          "canonical_order_ref": {
            "__REF__": "/step_flow_lock/canonical_order"
          },
          "run_order_ref": {
            "__REF__": "/_run_order/steps"
          },
          "csv_rules_ref": {
            "__REF__": "/_csv_rules"
          },
          "schemas_ref": {
            "__REF__": "/_meta/schemas"
          },
          "denylist_seeds_ref": {
            "__REF__": "/_runtime/compliance/denylist_seeds"
          }
        },
        "run_plan": {
          "paths": [
            "/workflow_patches/steps/*",
            "/_run_order/steps",
            "/step_flow_lock/canonical_order",
            "/_csv_rules/*",
            "/_meta/schemas/*",
            "/_runtime/compliance/denylist_seeds/*",
            "/_runtime/policy_overrides/*"
          ],
          "chunk_bytes": 131072,
          "max_paths": 5000,
          "chunk_bytes_ref": {
            "__REF__": "/_runtime/exec/memory_guard/chunk_bytes_current"
          }
        },
        "run_plan_extra": {
          "paths": [
            "/_store_profile/shipping/*"
          ]
        },
        "guards": {
          "run_order_drift": {
            "enabled": true,
            "mode": "ids_equal_ordered",
            "compare": [
              {
                "__REF__": "/_run_order/steps_list_snapshot"
              },
              {
                "__REF__": "/step_flow_lock/canonical_order"
              }
            ],
            "on_fail": "HALT",
            "notes": "Snapshot != Canonical → HALT; 00 öncesinde snapshot hazırlanır."
          }
        }
      }
    },
    "attributes_coverage_gate": {
      "enabled": true,
      "required_score": 1.0,
      "fail_on_missing": true,
      "attributes_ref": {
        "__COMPUTED__": "attributes_from_step0()"
      },
      "report_sink_ref": {
        "__REF__": "/_runtime/reports/title_guidelines"
      },
      "notes": "Blocks SEO refinement when required attributes are missing."
    },
    "compliance": {
      "denylist": {
        "enabled": true,
        "case_insensitive": true,
        "match_mode": "phrase",
        "patterns": {
          "brands": [],
          "prohibited": [],
          "adult": []
        },
        "notes": "Populate patterns arrays externally; orchestrator blocks any candidate containing these phrases."
      },
      "denylist_seeds": {
        "version": 1,
        "language": "en-US",
        "case_insensitive": true,
        "match_mode": "phrase",
        "last_updated_utc": "2025-09-20T13:50:40Z",
        "source_notes": [
          "Seeds intended to block trademark/policy/adult phrases from leaking via competitor/top listings.",
          "Populate/extend externally as needed; orchestrator should merge seeds into active denylist patterns."
        ],
        "brands": [
          "tiffany",
          "tiffany & co",
          "cartier",
          "pandora",
          "swarovski",
          "bulgari",
          "bvlgari",
          "chopard",
          "van cleef",
          "van cleef & arpels",
          "harry winston",
          "david yurman",
          "mikimoto",
          "gucci",
          "louis vuitton",
          "dior",
          "chanel",
          "hermes",
          "rolex",
          "omega",
          "tag heuer",
          "versace",
          "balenciaga",
          "disney",
          "marvel",
          "star wars",
          "harry potter",
          "apple"
        ],
        "prohibited": [
          "replica",
          "counterfeit",
          "knockoff",
          "ivory",
          "tortoiseshell",
          "endangered",
          "hazardous",
          "lead paint",
          "mercury",
          "weapon",
          "knife",
          "brass knuckles",
          "drug paraphernalia",
          "vape",
          "cbd",
          "thc",
          "fireworks",
          "explosive",
          "hidden camera",
          "spy camera",
          "gps tracker"
        ],
        "adult": [
          "adult",
          "18+",
          "nsfw",
          "explicit",
          "porn",
          "xxx",
          "fetish",
          "nude",
          "erotic",
          "sexual",
          "sex toy",
          "bdsm"
        ]
      }
    },
    "remote_sources": {
      "allowlist_hosts": [
        "raw.githubusercontent.com"
      ],
      "sources": {
        "github_raw_main": {
          "enabled": true,
          "url": "https://raw.githubusercontent.com/mertgs190500/json-proje/refs/heads/main/final_json__FULL_SINGLE_FILE__names_denormalized__1758309827__0dataloss_runtime_patch__with_bridges__fast_wins_patch__denylist_seeds__with_schema.json",
          "cache_key": "github_raw_main",
          "prefer_cache": true,
          "refresh": {
            "mode": "manual_or_stale_ttl",
            "ttl_minutes": 120,
            "failover": "use_cache_on_error",
            "etag": null,
            "last_modified": null,
            "last_checked_utc": null
          },
          "write_to": {
            "__REF__": "/_runtime/remote_sources/mirrors/github_raw_main"
          }
        }
      },
      "mirrors": {
        "github_raw_main": {
          "status": "empty",
          "last_checked_utc": null,
          "etag": null,
          "last_modified": null,
          "bytes": 0,
          "sha256": null,
          "content": null
        }
      }
    },
    "ui_patches": {
      "steps": {
        "0": {
          "review_paths_add": [
            "/_product_static/material",
            "/_product_static/olculer"
          ],
          "notes": "Add-only union to Step 0 UI review list."
        }
      }
    },
    "content_templates": {
      "description": {
        "sections": {
          "shipping_and_returns": {
            "enabled": true,
            "name": "Kargo & İade",
            "render_hint": "markdown",
            "priority": 60,
            "fields": {
              "processing_time_ref": {
                "__REF__": "/_store_profile/islem_suresi"
              },
              "shipping_fee_ref": {
                "__REF__": "/_store_profile/ucret"
              },
              "delivery_time_ref": {
                "__REF__": "/product_record/shop_logistics/delivery_time"
              },
              "tracking_phrase_ref": {
                "__REF__": "/_runtime/policy_overrides/text_mappings/shipping/tracking_true_phrase"
              },
              "returns_ref": {
                "__REF__": "/_store_profile/returns"
              }
            },
            "template_md": "### Kargo & İade\n- Hazırlık: {{processing_time_ref}}\n- Kargo: {{shipping_fee_ref}} — {{tracking_phrase_ref}} — Tahmini teslim: {{delivery_time_ref}}\n- İade: {{returns_ref.window_text}} (kişiselleştirme siparişlerinde istisna olabilir)."
          },
          "tariff_notice": {
            "enabled": true,
            "name": "Tarife & Gümrük Bilgisi",
            "render_hint": "markdown",
            "priority": 62,
            "fields": {
              "ddp_enabled_ref": {
                "__REF__": "/_store_profile/shipping/ddp_enabled"
              },
              "tariff_inclusive_pricing_ref": {
                "__REF__": "/_store_profile/shipping/tariff_inclusive_pricing"
              },
              "destinations_ref": {
                "__REF__": "/product_record/shop_logistics/ships_to"
              },
              "alt_destinations_ref": {
                "__REF__": "/steps/0/product_info/logistics/destinations"
              },
              "phrase_ddp": "Fiyat gümrük ve vergileri içerir (DDP).",
              "phrase_ddu": "Alıcı, gümrük ve vergilerden sorumludur (DDU/DAP).",
              "us_codes": [
                "US",
                "USA",
                "ABD",
                "United States"
              ]
            },
            "conditional": {
              "when": "ddp_enabled_ref && tariff_inclusive_pricing_ref && any(us_codes ∩ (destinations_ref ∪ alt_destinations_ref))",
              "then_render": "{{phrase_ddp}}",
              "else_render": "{{phrase_ddu}}"
            }
          }
        }
      }
    },
    "step_filter": {
      "disabled_ids": [
        "4a",
        "4b"
      ]
    },
    "knowledge": {
      "preflight_profile": {
        "complexity_profile": {
          "category": null,
          "personalization": false,
          "material_sensitivity": false,
          "media_richness": "unknown"
        },
        "length_targets": {
          "title_chars": [
            80,
            140
          ],
          "description_words": [
            300,
            500
          ],
          "simple_words": [
            150,
            300
          ],
          "complex_words": [
            500,
            900
          ]
        },
        "must_have_sections": [
          "size_guide",
          "care",
          "processing_vs_shipping",
          "returns_note",
          "mini_faq"
        ],
        "tags_budget": {
          "title_aligned": 4,
          "intent_scenarios": 4,
          "attributes": 3,
          "seasonal_or_niche": 2
        },
        "risk_flags": {
          "spam_similarity": false,
          "attribute_overlap": false,
          "denylist_risk": false,
          "hypoallergenic_claim": false
        }
      },
      "preflight_fingerprints": {},
      "preflight_index": {}
    },
    "triggers": {
      "hints": {
        "title": {
          "hard_caps": false,
          "forbid_returns": true
        },
        "description": {
          "min_paragraphs": 3,
          "require_sections": [
            "size_guide",
            "care",
            "processing_vs_shipping",
            "returns_note",
            "mini_faq"
          ],
          "dynamic_length": "auto",
          "require_sections_extra": [
            "tariff_note"
          ]
        },
        "tags": {
          "selection": {
            "targets": {
              "title_aligned": 4,
              "intent_scenarios": 4,
              "attributes": 3,
              "seasonal_or_niche": 2
            }
          },
          "hard_gates": {
            "same_root_limit": 1,
            "unique": true,
            "multiword_ratio_min": 0.4
          }
        },
        "media_qc": {
          "min_images": 5,
          "alt_text": {
            "generate": true
          }
        },
        "export": {
          "include_hidden_discounts": false
        }
      }
    },
    "exec": {
      "auto_preflight_on_00": true,
      "memory_guard": {
        "browser_budget_bytes": 8000000,
        "chunk_bytes": 131072,
        "mode": "adaptive",
        "target_browser_utilization_pct": 0.6,
        "chunk_bytes_min": 131072,
        "chunk_bytes_max": 524288,
        "handoff_overlap_bytes": 2048,
        "time_budget_ms": 60000,
        "hard_ceiling_bytes": null,
        "kill_switch": {
          "enabled": true,
          "on_oom": "stop_and_resume",
          "on_time_budget": "stop_and_resume"
        },
        "notes": "Sabit tavan yok; 00 dinamik chunk ve geri-basınç uygular.",
        "chunk_bytes_current": 262144
      }
    },
    "logging": {
      "token_usage": {
        "enabled": true,
        "sample_rate": 1.0,
        "bucket": "session",
        "limits": {
          "soft_limit_tokens": null,
          "hard_limit_tokens": null,
          "alert_threshold_pct": 0.8
        },
        "cost": {
          "enabled": true,
          "currency": "USD",
          "per_1k_prompt": null,
          "per_1k_completion": null
        },
        "counters": {
          "total_prompt_tokens": 0,
          "total_completion_tokens": 0,
          "total_cost": 0.0
        },
        "per_step": {},
        "notes": "Add-only default. Runtime can fill counters; set per-token pricing if available."
      }
    },
    "mirror_cache": {
      "enabled": true,
      "stores": {
        "github_raw": {
          "origin": "https://raw.githubusercontent.com/<owner>/<repo>/<ref>/<path>.json",
          "mirror_dir": "sandbox:/mnt/data/_mirror_cache/github_raw",
          "etag": null,
          "last_modified": null,
          "strategy": "prefer_mirror_on_429_5xx",
          "notes": "Placeholder config; runtime fills etag/last_modified when syncing."
        }
      },
      "notes": "Local mirror for remote JSON sources; avoids 429/5xx and network jitter."
    },
    "usage_counters": {
      "tokens": {
        "total": 0,
        "by_step": {}
      }
    },
    "boot": {
      "sessions": {
        "log": []
      },
      "health": {
        "broken_refs": 0,
        "last_scan": null,
        "alias_conflicts": 0,
        "manifest_drift": 0
      },
      "learned_prefs": {}
    },
    "refs": {
      "unresolved_count": 0,
      "scan": {
        "include_prefixes": [
          "/_runtime",
          "/_runs"
        ],
        "exclude_prefixes": [
          "/_policy",
          "/governance"
        ]
      }
    }
  },
  "step_flow_lock": {
    "canonical_order": [
      "0a",
      "00",
      "0",
      "1",
      "1a",
      "1b",
      "3",
      "3a",
      "3b",
      "3c",
      "5",
      "5a",
      "5b",
      "5c",
      "6",
      "6a",
      "6b",
      "7",
      "8",
      "8a",
      "8B",
      "8C",
      "9",
      "10",
      "11",
      "12",
      "12a",
      "13",
      "14",
      "15",
      "16",
      "17",
      "18",
      "18a",
      "19",
      "20",
      "seo_package"
    ]
  },
  "_ui_policy": {
    "allow_preview": false,
    "allow_excel_open": false,
    "allow_pdf_open": false,
    "allow_download_links": false
  },
  "_ui_defaults": {
    "suppress_downloads": true,
    "forbid_open_if_not_defined": true,
    "respect_step_ui_only": true
  },
  "ui_policies": {
    "global": {
      "token_tracking": {
        "enabled": true,
        "track_on": [
          "render",
          "confirm",
          "error"
        ],
        "fields": [
          "input_tokens",
          "output_tokens",
          "total_tokens"
        ],
        "write": {
          "__REF__": "/_runtime/usage_counters/tokens"
        },
        "notes": "Sayfa/step bazında token takibi; tüm üretim akışında geçerlidir."
      }
    }
  },
  "steps_meta": {
    "0a": {
      "role": "canonical"
    },
    "00": {
      "role": "canonical"
    },
    "0": {
      "role": "canonical"
    },
    "1": {
      "role": "canonical"
    },
    "1a": {
      "role": "canonical"
    },
    "1b": {
      "role": "canonical"
    },
    "3": {
      "role": "canonical"
    },
    "3a": {
      "role": "canonical"
    },
    "3b": {
      "role": "canonical"
    },
    "3c": {
      "role": "canonical",
      "evolves_to": [
        "10",
        "11",
        "12"
      ]
    },
    "5": {
      "role": "canonical"
    },
    "5a": {
      "role": "canonical"
    },
    "5b": {
      "role": "canonical"
    },
    "5c": {
      "role": "canonical"
    },
    "6": {
      "role": "canonical",
      "unified_of": [
        "6a",
        "6b"
      ],
      "labels": [
        "Unified Competitor Intake"
      ]
    },
    "6a": {
      "role": "canonical"
    },
    "6b": {
      "role": "canonical"
    },
    "7": {
      "role": "canonical"
    },
    "8": {
      "role": "canonical"
    },
    "8a": {
      "role": "canonical"
    },
    "8B": {
      "role": "canonical"
    },
    "8C": {
      "role": "canonical"
    },
    "9": {
      "role": "canonical"
    },
    "10": {
      "role": "canonical"
    },
    "11": {
      "role": "canonical"
    },
    "12": {
      "role": "canonical"
    },
    "12a": {
      "role": "canonical"
    },
    "13": {
      "role": "canonical"
    },
    "14": {
      "role": "canonical"
    },
    "15": {
      "role": "canonical"
    },
    "16": {
      "role": "canonical"
    },
    "17": {
      "role": "canonical"
    },
    "18": {
      "role": "canonical"
    },
    "18a": {
      "role": "canonical"
    },
    "19": {
      "role": "canonical"
    },
    "20": {
      "role": "canonical"
    },
    "seo_package": {
      "role": "canonical"
    },
    "2": {
      "role": "aux"
    },
    "21": {
      "role": "aux"
    },
    "22": {
      "role": "aux"
    },
    "23": {
      "role": "aux"
    },
    "2a": {
      "role": "aux"
    },
    "2b": {
      "role": "aux"
    },
    "3d": {
      "role": "aux"
    },
    "3p": {
      "role": "aux"
    },
    "4": {
      "role": "aux"
    },
    "4a": {
      "role": "aux"
    },
    "4b": {
      "role": "aux"
    },
    "4p": {
      "role": "aux"
    },
    "5p": {
      "role": "aux"
    },
    "8A": {
      "role": "aux"
    },
    "6_top_listings.aggregate": {
      "role": "aux"
    },
    "00_profile.hydrate": {
      "role": "aux"
    }
  },
  "env": {
    "profiles": {
      "prod": {
        "allowed_aux_steps": [
          "6_top_listings.aggregate"
        ]
      }
    }
  }
}